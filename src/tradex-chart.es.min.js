function isArray(t){return Array.isArray(t)}function isFunction(t){return t&&"function"==typeof t}function isObject(t){return"object"==typeof t&&!Array.isArray(t)&&null!==t}function isNumber(t){return"number"==typeof t&&!isNaN(t)}function isBoolean(t){return"boolean"==typeof t}function isString$1(t){return"string"==typeof t}function isPromise(t){return!!t&&(isObject(t)||isFunction(t))&&isFunction(t.then)}const DOM={findByID:(t,e=document)=>e.getElementById(t),findByClass:(t,e=document)=>e.getElementsByClassName(t),findByName:(t,e=document)=>e.getElementsByName(t),fndByTag:(t,e=document)=>e.getElementsByTagName(t),findBySelector:(t,e=document)=>e.querySelector(t),findBySelectorAll:(t,e=document)=>e.querySelectorAll(t),isNode:t=>"object"==typeof Node?t instanceof Node:t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName,isElement:t=>"object"==typeof HTMLElement?t instanceof HTMLElement:t&&"object"==typeof t&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName,isVisible(t){return!!this.isElement(t)&&(!!t&&!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length))},isInViewport(t){if(!this.isElement(t))return!1;const e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)},isVisibleToUser(t){if(!this.isElement(t))return!1;const e=getComputedStyle(elem);if("none"===e.display)return!1;if("visible"!==e.visibility)return!1;if(e.opacity<.1)return!1;if(t.offsetWidth+t.offsetHeight+t.getBoundingClientRect().height+t.getBoundingClientRect().width===0)return!1;const i={x:t.getBoundingClientRect().left+t.offsetWidth/2,y:t.getBoundingClientRect().top+t.offsetHeight/2};if(i.x<0)return!1;if(i.x>(document.documentElement.clientWidth||window.innerWidth))return!1;if(i.y<0)return!1;if(i.y>(document.documentElement.clientHeight||window.innerHeight))return!1;let s=document.elementFromPoint(i.x,i.y);do{if(s===elem)return!0}while(s=s.parentNode);return!1},elementDimPos(t){if(!this.isElement(t))return!1;let e=0,i=0,s=t;for(;s&&"body"!=s.tagName.toLowerCase()&&!isNaN(s.offsetLeft)&&!isNaN(s.offsetTop);)e+=s.offsetLeft-s.scrollLeft,i+=s.offsetTop-s.scrollTop,s=s.offsetParent;const n=t.getBoundingClientRect();return{top:i,left:e,width:n.right-n.left,height:n.bottom-n.top,visible:this.isVisible(t),viewport:this.isInViewport(t)}},elementsDistance(t,e){return!(!this.isElement(t)||!this.isElement(t))&&(el1Location=this.elementDimPos(t),el2Location=this.elementDimPos(e),{x:el1Location.top-el2Location.top,y:el1Location.left.el2Location.left,el1Location:el1Location,el2Location:el2Location})},htmlToElement(t){var e=document.createElement("template");return t=t.trim(),e.innerHTML=t,e.content.firstChild},htmlToElements(t){var e=document.createElement("template");return e.innerHTML=t,e.content.childNodes},hideOnClickOutside(t){if(!this.isElement(t))return!1;const e=e=>{!t.contains(e.target)&&this.isVisible(t)&&(t.style.display="none",i())},i=()=>{document.removeEventListener("click",e)};document.addEventListener("click",e)},onClickOutside(t,e){if(!this.isElement(t))return!1;const i=i=>{!t.contains(i.target)&&DOM.isVisible(t)&&(e(),s())},s=()=>{document.removeEventListener("click",i)};document.addEventListener("click",i)},addStyleRule(t,e,i,s){let n=this.findStyleRule(t,e,i,s);n&&(n.i>=0?n.rules[n.i].style[n.property]=n.value:this.addCSSRule(n.styleSheet,n.selector,n.rules,n.index))},deleteStyleRule(t,e,i){let s=this.findStyleRule(t,e,i,"");(s.styleSheet.deleteRule||s.styleSheet.removeRule)(s.i)},findStyleRule(t,e,i,s){if(!t||!isObject(t))return null;if("HTMLStyleElement"==t.constructor.name)t=t.sheet;else if("CSSStyleSheet"!=t.constructor.name)return null;let n=this.styleRuleSanitize(e,i,s);e=n[0],i=n[1],s=n[2];const r=t.cssRules||t.rules;for(var o=r.length-1;o>0;--o){if(r[o].selectorText===e)break}return{styleSheet:t,rules:r,selector:e,property:i,value:s,i:o}},styleRuleSanitize:(t,e,i)=>[t=t.toLowerCase().replace(/\s+/g," "),e=e.toLowerCase(),i=i.toLowerCase()],addCSSRule(t,e,i,s){t.insertRule?t.insertRule(e+"{"+i+"}",s):t.addRule(e,i,s)}},TIMEUNITS=["y","M","d","h","m","s","ms"],TIMEUNITSLONG=["years","months","days","hours","minutes","seconds","milliseconds"],dayCntInc=[0,31,59,90,120,151,181,212,243,273,304,334],dayCntLeapInc=[0,31,60,91,121,152,182,213,244,274,305,335],monthDayCnt=[31,28,31,30,31,30,31,31,30,31,30,31],MONTHMAP=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],BTCGENESIS=1231006505e3,MILLISECOND=1,SECOND_MS=1e3,MINUTE_MS=6e4,HOUR_MS=36e5,DAY_MS=864e5,WEEK_MS=7*DAY_MS,MONTHR_MS=30*DAY_MS;function MONTH_MS(t=3,e=!1){let i=monthDayCnt[t%12]*DAY_MS;return e&&t>0&&(i+=DAY_MS),i}const YEAR_MS=365*DAY_MS,TIMEUNITSVALUESSHORT={y:YEAR_MS,M:MONTHR_MS,w:WEEK_MS,d:DAY_MS,h:36e5,m:6e4,s:1e3,u:1},TIMEUNITSVALUESLONG={years:YEAR_MS,months:MONTHR_MS,weeks:WEEK_MS,days:DAY_MS,hours:36e5,minutes:6e4,seconds:1e3,milliseconds:1},TIMEUNITSVALUES={...TIMEUNITSVALUESSHORT,...TIMEUNITSVALUESLONG},TIMESCALESVALUES={YEARS10:[10*YEAR_MS,"years"],YEARS5:[5*YEAR_MS,"years"],YEARS3:[3*YEAR_MS,"years"],YEARS2:[2*YEAR_MS,"years"],YEARS:[YEAR_MS,"years"],MONTH6:[6*MONTHR_MS,"months"],MONTH4:[4*MONTHR_MS,"months"],MONTH3:[3*MONTHR_MS,"months"],MONTH2:[2*MONTHR_MS,"months"],MONTH:[MONTHR_MS,"months"],DAY15:[15*DAY_MS,"years"],DAY10:[10*DAY_MS,"days"],DAY7:[7*DAY_MS,"days"],DAY5:[5*DAY_MS,"days"],DAY3:[3*DAY_MS,"days"],DAY2:[2*DAY_MS,"days"],DAY:[DAY_MS,"days"],HOUR12:[432e5,"hours"],HOUR6:[216e5,"hours"],HOUR4:[144e5,"hours"],HOUR2:[72e5,"hours"],HOUR:[36e5,"hours"],MINUTE30:[18e5,"minutes"],MINUTE15:[9e5,"minutes"],MINUTE10:[6e5,"minutes"],MINUTE5:[3e5,"minutes"],MINUTE2:[12e4,"minutes"],MINUTE:[6e4,"minutes"],SECOND30:[3e4,"seconds"],SECOND15:[15e3,"seconds"],SECOND10:[1e4,"seconds"],SECOND5:[5e3,"seconds"],SECOND2:[2e3,"seconds"],SECOND:[1e3,"seconds"],MILLISECOND500:[500,"milliseconds"],MILLISECOND250:[250,"milliseconds"],MILLISECOND100:[100,"milliseconds"],MILLISECOND50:[50,"milliseconds"],MILLISECOND:[1,"milliseconds"]},timeScales=()=>{const t=Object.values(TIMESCALESVALUES),e=[];for(let i=t.length;--i;i>0)e[i]=t[i][0];return e},TIMESCALES=timeScales(),timeRanks=()=>{const t=Object.values(TIMESCALESVALUES),e=[];for(let i=t.length;--i;i>0)e[i]=t[i][1];return e},TIMESCALESRANK=timeRanks(),TIMESCALESKEYS=Object.keys(TIMESCALESVALUES),timeScalesValues=()=>{const t={};for(const[e,i]of Object.entries(TIMESCALESVALUES))t[e]=i[0];return t},TIMESCALESVALUESKEYS=timeScalesValues(),timezones={0:"Europe/London","-120":"Europe/Tallinn","-60":"Europe/Zurich",180:"America/Santiago",300:"America/Toronto",240:"America/Caracas",360:"America/Mexico_City",540:"America/Juneau",480:"America/Vancouver",420:"US/Mountain",120:"America/Sao_Paulo","-360":"Asia/Almaty","-300":"Asia/Ashkhabad","-180":"Europe/Moscow","-420":"Asia/Jakarta","-480":"Asia/Taipei","-240":"Asia/Muscat","-345":"Asia/Kathmandu","-330":"Asia/Kolkata","-540":"Asia/Tokyo","-210":"Asia/Tehran","-660":"Pacific/Norfolk","-630":"Australia/Adelaide","-600":"Australia/Brisbane","-780":"Pacific/Fakaofo","-825":"Pacific/Chatham",600:"Pacific/Honolulu"};function getTimezone(){const t=(new Date).getTimezoneOffset();return Object.prototype.hasOwnProperty.call(timezones,t)?timezones[t.toString()]:"Etc/UTC"}function buildSubGrads(){const t={};for(let e in TIMEUNITSVALUESSHORT){let i=0;t[e]=[];do{t[e].push(Math.round(TIMEUNITSVALUESSHORT[e]*i)),i+=.125}while(i<1)}return t}function isValidTimestamp(t){return isNumber(new Date(t).getTime())}function isValidTimeInRange(t,e=BTCGENESIS,i=Date.now()){return!!isValidTimestamp(t)&&(t>e&&t<i)}const timestampDiff={inSeconds:function(t,e){t=new Date(t);var i=(e=new Date(e)).getTime(),s=t.getTime();return parseInt((i-s)/1e3)},inMinutes:function(t,e){t=new Date(t);let i=(e=new Date(e)).getTime(),s=t.getTime();return parseInt((i-s)/6e4)},inHours:function(t,e){t=new Date(t);let i=(e=new Date(e)).getTime(),s=t.getTime();return parseInt((i-s)/36e5)},inDays:function(t,e){t=new Date(t);let i=(e=new Date(e)).getTime(),s=t.getTime();return parseInt((i-s)/DAY_MS)},inWeeks:function(t,e){t=new Date(t);let i=(e=new Date(e)).getTime(),s=t.getTime();return parseInt((i-s)/WEEK_MS)},inMonths:function(t,e){t=new Date(t),e=new Date(e);let i=t.getUTCFullYear(),s=e.getUTCFullYear(),n=t.getUTCMonth();return e.getUTCMonth()+12*s-(n+12*i)},inYears:function(t,e){let i=new Date(t);return new Date(e).getUTCFullYear()-i.getUTCFullYear()}};function timestampDifference(t,e){let i=timestampDiff.inYears(t,e),s=timestampDiff.inMonths(t,e),n=timestampDiff.inWeeks(t,e),r=timestampDiff.inDays(t,e),o=timestampDiff.inHours(t,e),a=timestampDiff.inMinutes(t,e),h=timestampDiff.inSeconds(t,e),l=new Date(e).getTime()-new Date(t).getTime();return{y:i,M:s,w:n,d:r,h:o,m:a,s:h,ms:l,years:i,months:s,weeks:n,days:r,hours:o,minutes:a,seconds:h,milliseconds:l}}function isTimeFrame(t){let e=1e3;return isString$1(t)?(e=interval2MS(t),e||(e=1e3,t="1s")):t="1s",{tf:t,ms:e}}function interval2MS(t){if(!isString$1(t))return!1;let e;return null!==(e=/([0-9]{1,2})([s|m|h|d|w|M|y])/gm.exec(t))&&TIMEUNITSVALUESSHORT[e[2]]*e[1]}function ms2TimeUnits(t){let e=Math.floor(t/1e3),i=Math.floor(e/60);e%=60;let s=Math.floor(i/60);i%=60;let n=Math.floor(s/24);s%=24;let r=Math.floor(n/7);n%=7;let o=Math.floor(r/4),a=Math.floor(r/52),h=r%4;return o%=13,{y:a,M:o,w:h,d:n,h:s,m:i,s:e,years:a,months:o,weeks:h,days:n,hours:s,minutes:i,seconds:e}}function ms2Interval(t){const e=ms2TimeUnits(t);for(const t in e)if(e[t])return`${e[t]}${t}`}function get_second(t){return t?new Date(t).getUTCSeconds():null}function second_start(t){return new Date(t).setUTCMilliseconds(0,0)}function get_minute(t){return t?new Date(t).getUTCMinutes():null}function minute_start(t){return new Date(t).setUTCSeconds(0,0)}function get_hour(t){return t?new Date(t).getUTCHours():null}function hour_start(t){return new Date(t).setUTCMinutes(0,0,0)}function get_day(t){return t?new Date(t).getUTCDate():null}function get_dayName(t,e="en-GB",i="short"){return new Date(t).toLocaleDateString(e,{weekday:i})}function day_start(t){return new Date(t).setUTCHours(0,0,0,0)}function get_month(t){if(t)return new Date(t).getUTCMonth()}function get_monthName(t,e="en-GB",i="short"){return new Date(t).toLocaleDateString(e,{month:i})}function month_start(t){let e=new Date(t);return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),1)}function nextMonth(t){return t+=MONTH_MS((get_month(t)+1)%12,isLeapYear(t))}function get_year(t){if(t)return new Date(t).getUTCFullYear()}function year_start(t){return Date.UTC(new Date(t).getUTCFullYear())}function nextYear(t){return isLeapYear(t=t+YEAR_MS+DAY_MS),t}function isLeapYear(t){let e=new Date(t).getUTCFullYear();return 0==(3&e)&&(e%100!=0||e%400==0)}function dayOfYear(t){let e=new Date(t),i=e.getUTCMonth(),s=e.getUTCDate(),n=dayCount[i]+s;return i>1&&isLeapYear()&&n++,n}function time_start(t,e){const i={years:t=>year_start(t),months:t=>month_start(t),weeks:t=>day_start(t),days:t=>day_start(t),hours:t=>hour_start(t),minutes:t=>minute_start(t),seconds:t=>second_start(t)};return i[e](t)}function unitRange(t,e){let i,s;switch(e){case"years":i=year_start(t),s=nextYear(t);break;case"months":i=month_start(t),s=nextMonth(t);break;case"weeks":case"days":i=day_start(t),s=i+DAY_MS;break;case"hours":i=hour_start(t),s=i+36e5;break;case"minutes":i=minute_start(t),s=i+6e4;break;case"seconds":i=second_start(t),s=i+1e3}return{start:i,end:s}}function DM(t){String(get_day(t)).padStart(2,"0")}function HM(t){return`${String(get_hour(t)).padStart(2,"0")}:${String(get_minute(t)).padStart(2,"0")}`}function HMS(t){return`${String(get_hour(t)).padStart(2,"0")}:${String(get_minute(t)).padStart(2,"0")}:${String(get_second(t)).padStart(2,"0")}`}function MS(t){return`${String(get_minute(t)).padStart(2,"0")}:${String(get_second(t)).padStart(2,"0")}`}var Time=Object.freeze(Object.defineProperty({__proto__:null,TIMEUNITS:TIMEUNITS,TIMEUNITSLONG:TIMEUNITSLONG,dayCntInc:dayCntInc,dayCntLeapInc:dayCntLeapInc,monthDayCnt:monthDayCnt,MONTHMAP:MONTHMAP,BTCGENESIS:BTCGENESIS,MILLISECOND:1,SECOND_MS:1e3,MINUTE_MS:6e4,HOUR_MS:36e5,DAY_MS:DAY_MS,WEEK_MS:WEEK_MS,MONTHR_MS:MONTHR_MS,MONTH_MS:MONTH_MS,YEAR_MS:YEAR_MS,TIMEUNITSVALUESSHORT:TIMEUNITSVALUESSHORT,TIMEUNITSVALUESLONG:TIMEUNITSVALUESLONG,TIMEUNITSVALUES:TIMEUNITSVALUES,TIMESCALESVALUES:TIMESCALESVALUES,TIMESCALES:TIMESCALES,TIMESCALESRANK:TIMESCALESRANK,TIMESCALESKEYS:TIMESCALESKEYS,TIMESCALESVALUESKEYS:TIMESCALESVALUESKEYS,timezones:timezones,getTimezone:getTimezone,buildSubGrads:buildSubGrads,isValidTimestamp:isValidTimestamp,isValidTimeInRange:isValidTimeInRange,timestampDiff:timestampDiff,timestampDifference:timestampDifference,isTimeFrame:isTimeFrame,interval2MS:interval2MS,ms2TimeUnits:ms2TimeUnits,ms2Interval:ms2Interval,get_second:get_second,second_start:second_start,get_minute:get_minute,minute_start:minute_start,get_hour:get_hour,hour_start:hour_start,get_day:get_day,get_dayName:get_dayName,day_start:day_start,get_month:get_month,get_monthName:get_monthName,month_start:month_start,nextMonth:nextMonth,get_year:get_year,year_start:year_start,nextYear:nextYear,isLeapYear:isLeapYear,dayOfYear:dayOfYear,time_start:time_start,unitRange:unitRange,DM:DM,HM:HM,HMS:HMS,MS:MS},Symbol.toStringTag,{value:"Module"}));function getRandomIntBetween(t,e){return t=Math.ceil(t)+1,e=Math.floor(e),Math.floor(Math.random()*(e-t)+t)}function countDigits(t){const e={};return e.value=t,e.sign=!!t,e.integers=numDigits(t),e.decimals=precision(t),e.total=e.integers+e.decimals,e}function numDigits(t){return 1+(0|Math.log10((t^t>>31)-(t>>31)))}function float2Int(t){return 0|t}function round(t,e){e=e||100;const i=Math.pow(10,e);return Math.round((t+Number.EPSILON)*i)/i}function bRound(t,e=0){var i=t*Math.pow(10,e),s=Math.round(i);return((i>0?i:-i)%1==.5?0==s%2?s:s-1:s)/Math.pow(10,e)}function precision(t){if("number"!=typeof t&&(t=parseFloat(t)),isNaN(t))return 0;if(!isFinite(t))return 0;for(var e=1,i=0;Math.round(t*e)/e!==t&&(e*=10)!=1/0;)i++;return i}function log10(t){return Math.log(t)/Math.log(10)}function power(t,e){return Math.pow(t,e)}function limit(t,e,i){return Math.min(i,Math.max(e,t))}function mergeDeep(t,e){return isObject(t)&&isObject(e)?(Object.keys(e).forEach((i=>{const s=t[i],n=e[i];Array.isArray(s)&&Array.isArray(n)?t[i]=mergeDeep(s.concat([]),n):isObject(s)&&isObject(n)?t[i]=mergeDeep(Object.assign({},s),n):t[i]=n})),t):e}function copyDeep(t){if(null===t||"object"!=typeof t||"isActiveClone"in t)return t;if(t instanceof Date)var e=new t.constructor;else e=Array.isArray(t)?[]:{};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(t.isActiveClone=null,e[i]=copyDeep(t[i]),delete t.isActiveClone);return e}function uid(t="ID"){isNumber(t)?t=t.toString():isString$1(t)||(t="ID");return`${t}_${Date.now().toString(36)}_${Math.random().toString(36).substring(2,5)}`}function isArrayEqual(t,e){let i=t.length;for(;i--;)if(t[i]!==e[i])return!1;return!0}const firstItemInMap=t=>t.entries().next().value,firstKeyInMap=t=>t.entries().next().value[0],firstValueInMap=t=>t.entries().next().value[1],lastKeyInMap=t=>Array.from(t.keys()).pop();function debounce(t,e=100,i,s=!1){var n;return function(){var r=i||this,o=arguments,a=s&&!n;clearTimeout(n),n=setTimeout((function(){n=null,s||t.apply(r,o)}),e),a&&t.apply(r,o)}}function throttle(t,e=250,i){var s,n,r=function(){var r=i||this,o=+new Date,a=arguments;s&&o<s+e?(clearTimeout(n),n=setTimeout((function(){s=o,t.apply(r,a)}),e)):(s=o,t.apply(r,a))};return r.reset=function(){timeout&&(clearTimeout(n),timeout=void 0),s=0},r}class Dataset{#t;#e;#i;#s=[];constructor(t,e){this.#t=t,this.#e=isString$1(e.id)?e.id:uid,this.#i=isString$1(e.type)?e.type:"default",this.#s=isArray(e.data)?e.data:[]}}function validateShallow(t,e=!1){if(!isArray(t))return!1;let i=getRandomIntBetween(0,t.length);if(!isValidCandle(t[0],e))return!1;if(!isValidCandle(t[i],e))return!1;if(!isValidCandle(t[t.length-1],e))return!1;let s=t[0][0],n=t[1][0],r=t[2][0];return!(s>n&&n>r)}function validateDeep(t,e=!1){if(!isArray(t))return!1;let i=0,s=0;for(;i<t.length;){if(!isValidCandle(t[i],e))return!1;if(t[i][0]<s)return!1;s=t[i][0],i++}return!0}function isValidCandle(t,e=!1){return!!isArray(t)&&(6===t.length&&(!(e&&!isValidTimeInRange(t[0]))&&!!(isNumber(t[1])&&isNumber(t[2])&&isNumber(t[3])&&isNumber(t[4])&&isNumber(t[5]))))}const DEFAULT_TIMEINTERVAL=6e4,DEFAULT_TIMEFRAME="1m",DEFAULT_TIMEFRAMEMS=6e4,PRICEDIGITS$1=6,XAXIS_ZOOM=.05,XAXIS_STEP=100,YAXIS_STEP=100,YAXIS_TYPES$1=["default","percent","log"],YAXIS_BOUNDS=.01,LIMITFUTURE=200,LIMITPAST=200,MINCANDLES=20,MAXCANDLES=4096,BUFFERSIZE$1=5,ROWMINHEIGHT=50,OFFCHARTDEFAULTHEIGHT=30,DIVIDERHEIGHT=8;class Range{data=[];#n=6e4;#r="1s";indexStart=0;indexEnd=200;valueMin=0;valueMax=0;valueDiff=0;volumeMin=0;volumeMax=0;volumeDiff=0;valueMinIdx=0;valueMaxIdx=0;volumeMinIdx=0;volumeMaxIdx=0;old={};limitFuture=200;limitPast=200;minCandles=20;maxCandles=4096;yAxisBounds=.01;rangeLimit=200;anchor;#o;#a;#h=!0;constructor(t,e=0,i=t.data.length-1,s={}){if(!isObject(t))return!1;if(!isObject(s))return!1;if(!(s?.core instanceof TradeXchart))return!1;this.#h=!0,this.limitFuture=isNumber(this.config?.limitFuture)?this.config.limitFuture:200,this.limitPast=isNumber(this.config?.limitPast)?this.config.limitPast:200,this.minCandles=isNumber(this.config?.minCandles)?this.config.minCandles:20,this.maxCandles=isNumber(this.config?.maxCandles)?this.config.maxCandles:4096,this.yAxisBounds=isNumber(this.config?.limitBounds)?this.config.limitBounds:.01,this.#o=s.core,this.maxMinPriceVol.toString();const n=s?.interval||6e4;if(0==t.data.length){let t=Date.now();e=0,i=this.rangeLimit,this.#n=n,this.#r=ms2Interval(this.interval),this.anchor=t-t%n}else t.data.length<2?(this.#n=n,this.#r=ms2Interval(this.interval)):0==i&&t.data.length>=this.rangeLimit?i=this.rangeLimit:0==i&&(i=t.data.length);for(let e in t)this[e]=t[e];if(!this.set(e,i))return!1;t.data.length>2&&(this.#n=detectInterval(this.data),this.#r=ms2Interval(this.interval))}get dataLength(){return 0==this?.data.length?0:this.data.length-1}get Length(){return this.indexEnd-this.indexStart}get timeDuration(){return this.timeFinish-this.timeStart}get timeMin(){return this.value(this.indexStart)[0]}get timeMax(){return this.value(this.indexEnd)[0]}get rangeDuration(){return this.timeMax-this.timeMin}get timeStart(){return this.value(0)[0]}get timeFinish(){return this.value(this.dataLength)[0]}set interval(t){this.#n=t}get interval(){return this.#n}set intervalStr(t){this.#r=t}get intervalStr(){return this.#r}end(){WebWorker.destroy(this.#a.ID)}set(t=0,e=this.dataLength,i=this.maxCandles){if(!isNumber(t)||!isNumber(e)||!isNumber(i))return!1;t|=0,e|=0,i=limit(i|=0,this.minCandles,this.maxCandles),t>e&&([t,e]=[e,t]);let s=(e=limit(e,t+this.minCandles,t+i))-t;t=limit(t,-1*this.limitPast,this.dataLength+this.limitFuture-this.minCandles-1);const n=t=(e=limit(e,t+this.minCandles,this.dataLength+this.limitFuture-1))-t<s?t-(s-(e-t)):t,r=e,o=this.indexStart,a=this.indexEnd;let h=this.Length;this.indexStart=t,this.indexEnd=e,h-=this.Length;let l=this.maxMinPriceVol({data:this.data,start:this.indexStart,end:this.indexEnd,that:this});return this.setMaxMin(l),this.#o.emit("setRange",[n,r,o,a]),!0}setMaxMin(t){for(let e in t)this.old[e]=this[e],this[e]=t[e];this.scale=0!=this.dataLength?this.Length/this.dataLength:1}value(t,e="chart"){let i;if("chart"==e)i=this.data;else if(i=this.getDataById(e),!i)return null;isNumber(t)||(t=i.length-1);let s=i[t];if(void 0!==s)return s;{const e=i.length-1;return s=[null,null,null,null,null,null],i.length<1?(s[0]=Date.now()+this.interval*t,s):t<0?(s[0]=i[0][0]+this.interval*t,s):t>e?(s[0]=i[e][0]+this.interval*(t-e),s):null}}valueByTS(t,e){if(!isNumber(t)||!isString$1(e))return!1;const i=this.getTimeIndex(t);switch(e){case"chart":case"onchart":case"offchart":case"dataset":case"all":break;default:if(e.length=0)return this.value(i);e.split("_")}}getDataById(t){if(!isString$1(t))return!1;const e=t.split("_");switch(e[1]){case"chart":return this.data;case"onchart":for(let t of this.onChart)if(e[2]in t)return t[e[2]];return!1;case"offchart":for(let t of this.offChart)if(e[2]in t)return t[e[2]];return!1;case"datasets":for(let t of this.datasets)if(e[2]in t)return t[e[2]];return!1;default:return!1}}getTimeIndex(t){if(!isNumber(t))return!1;t-=t%this.interval;let e=this.data.length>0?this.data[0][0]:this.anchor;return t===e?0:t<e?(e-t)/this.interval*-1:(t-e)/this.interval}inRange(t){return t>=this.timeMin&&t<=this.timeMax}inPriceHistory(t){return t>=this.timeStart&&t<=this.timeFinish}inRenderRange(t){let e=this.getTimeIndex(t),i=this.#o.rangeScrollOffset;return e>=this.indexStart-i&&e<=this.indexEnd+i}rangeIndex(t){return this.getTimeIndex(t)-this.indexStart}maxMinPriceVol(t){let{data:e,start:i,end:s,that:n}={...t},r=bRound(this.#o.bufferPx/this.#o.candleW);if(r=isNumber(r)?r:0,i=isNumber(i)?i-r:0,i=i>0?i:0,s="number"==typeof s?s:e?.length-1,0==e.length)return{valueMin:0,valueMax:1,volumeMin:0,volumeMax:0,valueMinIdx:0,valueMaxIdx:0,volumeMinIdx:0,volumeMaxIdx:0};let o=e.length-1,a=x(i,0,o),h=x(s,0,o),l=e[a][3],c=e[a][2],d=e[a][5],u=e[a][5],g=a,m=a,p=a,f=a;for(;a++<h;)e[a][3]<l&&(l=e[a][3],g=a),e[a][2]>c&&(c=e[a][2],m=a),e[a][5]<d&&(d=e[a][5],p=a),e[a][5]>u&&(u=e[a][5],f=a);let y=c-l;return l-=.1*y,l=l>0?l:0,c+=.1*y,y=c-l,{valueMin:l,valueMax:c,valueDiff:c-l,volumeMin:d,volumeMax:u,volumeDiff:u-d,valueMinIdx:g,valueMaxIdx:m,volumeMinIdx:p,volumeMaxIdx:f};function x(t,e,i){return Math.min(i,Math.max(e,t))}}snapshot(t,e){return{snapshot:!0,ts:Date.now(),data:this.data,dataLength:this.dataLength,Length:this.Length,timeDuration:this.timeDuration,timeMin:this.timeMin,timeMax:this.timeMax,rangeDuration:this.rangeDuration,timeStart:this.timeStart,timeFinish:this.timeFinish,interval:this.interval,intervalStr:this.intervalStr}}}function detectInterval(t){let e=Math.min(t.length-1,99),i=1/0;return t.slice(0,e).forEach(((e,s)=>{let n=t[s+1][0]-e[0];n==n&&n<i&&(i=n)})),i}function calcTimeIndex(t,e){if(!isNumber(e))return!1;let i,s=t.timeFrameMS;return i=(e-=e%s)===t.range.data[0][0]?0:e<t.range.data[0][0]?(t.range.data[0][0]-e)/s*-1:(e-t.range.data[0][0])/s,i}const DEFAULT_STATE={chart:{type:"candles",candleType:"CANDLE_SOLID",indexed:!1,data:[],settings:{},row:{},tf:"1m",tfms:6e4},onchart:[],offchart:[],datasets:[],tools:[],ohlcv:[]};class State{static#l=[];#e="";#s={};#c="";#d="";#u;#g={};#m;#p={};#f=!1;#y=!0;static create(t,e=!1,i=!1){const s=new State(t,e,i);return State.#l.push(s),s}static delete(t){}constructor(t,e=!1,i=!1){isObject(t)?(this.#s=this.validateState(t,e,i),this.#f="valid",this.#y=!!this.#s.chart?.isEmpty):(this.defaultState(),this.#f="default",this.#y=!0)}get status(){return this.#f}get data(){return this.#s}get isEmpty(){return this.#y}validateState(t,e=!1,i=!1){const s=copyDeep(DEFAULT_STATE);if("chart"in t||(t.chart=s.chart,t.chart.data=t?.ohlcv||[],t.chart.isEmpty=!0),(t=mergeDeep(s,t)).chart.data=e?validateDeep(t.chart.data,i)?t.chart.data:[]:validateShallow(t.chart.data,i)?t.chart.data:[],!isNumber(t.chart?.tf)||e){let e=detectInterval(t.chart.data);e<1e3&&(e=6e4),t.chart.tfms=e}for(var n of(isString$1(t.chart?.tfms)&&!e||(t.chart.tf=ms2Interval(t.chart.tfms)),"onchart"in t||(t.onchart=s.onchart),"offchart"in t||(t.offchart=s.offchart),t.chart.settings||(t.chart.settings=s.chart.settings),delete t.ohlcv,"datasets"in t||(t.datasets=[]),t.datasets))this.#p||(this.#p={}),this.dss[n.id]=new Dataset(this,n);return t}defaultState(){this.#s=copyDeep(DEFAULT_STATE)}deepMerge(t,e){return mergeDeep(t,e)}}class StateMachine{#e;#t;#x;#v={};#w;#o;#f="stopped";#S;#C;#M;#T;#A=["await","idle","running","stopped"];constructor(t,e){if(!StateMachine.validateConfig(t))return!1;const i={...t};this.#e=i.id,this.#w=i,this.#t=i.initial,this.#v.origin=e,this.#T=i.actions,this.#o=e.core,this.#b()}get id(){return this.#e}get state(){return this.#t}get previousSate(){return this.#x}get context(){return this.#v}get core(){return this.#o}get status(){return this.#f}get event(){return this.#C}get events(){return this.#S}get eventData(){return this.#M}get actions(){return this.#T}notify(t,e){this.#C=t,this.#M=e;const i=this.#w.states[this.#t];let s=i.on[t];if(!s||!isFunction(s.action)||"running"!==this.#f)return!1;let n=s?.condition?.type||s?.condition||!1;if(n&&!this.condition.call(this,n,s.condition))return!1;const r=s.target,o=this.#w.states[r];if(i?.onExit.call(this,e),s.action.call(this,e),this.#x=this.#t,this.#t=r,o?.onEnter.call(this,e),this.#w.states[r]?.on&&(this.#w.states[r].on[""]||this.#w.states[r].on?.always)){const t=this.#w.states[r].on[""]||this.#w.states[r].on.always;if(isArray(t))for(let i of t){let t=i?.condition?.type||i?.condition||!1;this.condition.call(this,t,i.condition)&&isString$1(i.target)&&(i?.action.call(this,e),this.#x=this.#t,this.#t=i?.target,this.notify(null,null))}else if(isObject(t)&&isString$1(t.target)){let i=t?.condition?.type||t?.condition||!1;this.condition.call(this,i,t.condition)&&isString$1(t.target)&&(t?.action.call(this,e),this.#x=this.#t,this.#t=t.target,this.notify(null,null))}}return this.#t}condition(t,e=null,i={}){return!!t&&this.#w.guards[t].call(this,this.#v,e,i)}canTransition(t){return t in this.#w.states[this.#t].on}start(){this.#f="running"}stop(){this.#f="stopped"}destroy(){this.#L(),this.#w=null}#b(){this.#S=new Set;for(let t in this.#w.states)for(let e in this.#w.states[t].on)this.#S.add(e);for(let t of this.#S)this.#o.on(t,this.notify.bind(this,t),this.context)}#L(){for(let t of this.#S)this.#o.off(t,this.notify)}static validateConfig(t){if(!isObject(t))return!1;if(!isArrayEqual(["id","initial","context","states"],Object.keys(t)))return!1;if(!(t.initial in t.states))return!1;for(let e in t.states){if(!isObject(t.states[e]))return!1;if("onEnter"in t.states[e]&&!isFunction(t.states[e].onEnter))return!1;if("onExit"in t.states[e]&&!isFunction(t.states[e].onExit))return!1;if("on"in t.states[e])for(let i in t.states[e].on){let s=t.states[e].on[i];if(!isString$1(s.target))return!1;if("action"in s&&!isFunction(s.action))return!1}}return!0}}const ALERT="alert";class Alerts{#E=new Map;#D={};constructor(t){if(isArray(t))for(let e of t)this.add(e?.price,e?.condition,e?.handler)}get list(){return this.#E}get handlers(){return this.#D}destroy(){this.#E.clear(),this.#D={}}batchAdd(t){if(isArray(t)){let e=[];for(let i of t)e.push(this.add(i?.price,i?.condition,i?.handler));return e}return!1}add(t,e,i){if(isNaN(t)||!isFunction(i))return!1;const s=uid(ALERT),n={price:t,condition:e};if(this.list.has(n)){this.list.get(n)[s]=i}else{const t={};t[s]=i,this.list.set(n,t)}return this.#D[s]={alert:n,handler:i},s}remove(t){if(!(t in this.#D))return!1;const e=this.#D[t],i=e.alert,s=this.#E.get(i);return s.delete(t),e.delete(t),0==Object.keys(s).length&&this.#E.delete(i),!0}delete(t,e){if(this.list.has({price:t,condition:e})){const i=this.list.get({price:t,condition:e});for(let t in i)this.#D.delete(t),i.delete(t)}return this.list.delete({price:t,condition:e})}pause(t){if(!(t in this.#D))return!1;this.#D[t]}handlerByID(t){return t in this.#D&&this.#D[t].handler}check(t,e){if(isArray(t)&&isArray(e))for(let[i,s]of this.list)if(i.condition(i.price,t,e))for(let n in s)try{s[n](i.price,t,e)}catch(t){console.error(t)}}}const NAME="TradeX-Chart",ID="TradeXChart",CLASS_UTILS="tradeXutils",CLASS_TOOLS="tradeXtools",CLASS_MENUS="tradeXmenus",CLASS_MENU="tradeXmenu",CLASS_DIVIDERS="tradeXdividers",CLASS_WINDOWS="tradeXwindows",CLASS_WINDOW="tradeXwindow",RANGELIMIT=500,STREAM_NONE="stream_None",STREAM_LISTENING="stream_Listening",STREAM_STARTED="stream_Started",STREAM_STOPPED="stream_Stopped",STREAM_ERROR="stream_Error",STREAM_FIRSTVALUE="stream_candleFirst",STREAM_UPDATE="stream_candleUpdate",STREAM_NEWVALUE="stream_candleNew",STREAM_MAXUPDATE=250,STREAM_PRECISION=8,PRICE_PRECISION=2,VOLUME_PRECISION=2,T$1=0,O=1,H=2,L=3,C$1=4,V=5,empty=[null,null,null,null,null],defaultStreamConfig={tfCountDown:!0,alerts:[]};class Stream{#o;#w;#f;#O;#R;#I;#P;#_=empty;#N=0;#$=0;#k="";#H=!1;#B;#W;#U=empty;#F;static validateConfig(t){if(!isObject(t))return defaultStreamConfig;(t=mergeDeep(copyDeep(defaultStreamConfig),t)).tfCountDown=isBoolean(t.tfCountDown)?t.tfCountDown:defaultStreamConfig.tfCountDown,t.alerts=isArray(t.alerts)?t.alerts:defaultStreamConfig.alerts;return t}constructor(t){this.#o=t,this.#O=t.time,this.status={status:STREAM_NONE},this.#w=Stream.validateConfig(t.config?.stream),this.#R=isNumber(t.config?.maxCandleUpdate)?t.config.maxCandleUpdate:250,this.#P=isNumber(t.config?.streamPrecision)?t.config.streamPrecision:8}get config(){return this.#w}get countDownMS(){return this.#$}get countDown(){return this.#k}get range(){return this.#o.range}get status(){return this.#f}set status({status:t,data:e}){this.#f=t,this.emit(t,e)}set dataReceived(t){this.#H||(this.#H=!0,this.status={status:STREAM_FIRSTVALUE,data:t})}get alerts(){return this.#F}get lastPriceMin(){return this.#W}set lastPriceMin(t){isNumber(t)&&(this.#W=t)}get lastPriceMax(){return this.#B}set lastPriceMax(t){isNumber(t)&&(this.#B=t)}get lastTick(){return this.#U}set lastTick(t){isArray(t)&&(this.#U,this.#U=t,this.alerts.check(t,this.#_))}set candle(t){const e=[...this.#_];t.t=this.roundTime(new Date(t.t)),t.o=1*t.o,t.h=1*t.h,t.l=1*t.l,t.c=1*t.c,t.v=1*t.v,this.#_[0]!==t.t?this.newCandle(t):this.updateCandle(t),this.status={status:STREAM_LISTENING,data:this.#_},this.lastTick=e}get candle(){return this.#_!==empty?this.#_:null}start(){this.#F=new Alerts(this.#w.alerts),this.status={status:STREAM_STARTED},this.#I=setInterval(this.onUpdate.bind(this),this.#R)}stop(){this.#F.destroy(),this.status={status:STREAM_STOPPED}}emit(t,e){this.#o.emit(t,e)}error(){this.status={status:STREAM_ERROR}}onTick(t){this.#f!=STREAM_STARTED&&this.#f!=STREAM_LISTENING||isObject(t)&&(this.candle=t,this.#o.setNotEmpty())}onUpdate(){this.#_!==empty&&(this.status={status:STREAM_UPDATE,data:this.candle},this.status={status:STREAM_LISTENING,data:this.#_})}newCandle(t){this.prevCandle(),this.#_=[t.t,t.o,t.h,t.l,t.c,t.v,null,!0],this.#o.mergeData({data:[this.#_]},!0,!1),this.status={status:STREAM_NEWVALUE,data:{data:t,candle:this.#_}},this.#$=this.#O.timeFrameMS,this.#N=this.roundTime(Date.now())}prevCandle(){const t=this.#o.allData.data;t.length>0&&t[t.length-1][7]&&t[t.length-1].pop()}updateCandle(t){let e=this.#_;e[1]=t.o,e[2]=t.h,e[3]=t.l,e[4]=t.c,e[5]=t.v,this.#_=e;const i=this.#o.allData.data;i[i.length>0?i.length-1:0]=this.#_,this.countDownUpdate()}parseCandle;countDownUpdate(){let t,e,i,s,n,r,o;this.#O.timeFrameMS;let a=this.#O.timeFrameMS-(Date.now()-this.#N);return a<0&&(a=0),this.#$=a,a>YEAR_MS?(t=String(Math.floor(a/YEAR_MS)),e=String(Math.floor(a%YEAR_MS/MONTHR_MS)).padStart(2,"0"),this.#k=`${t}Y ${e}M`):a>MONTHR_MS?(e=String(Math.floor(a/MONTHR_MS)).padStart(2,"0"),s=String(Math.floor(a%MONTHR_MS/DAY_MS)).padStart(2,"0"),this.#k=`${e}M ${s}D`):a>WEEK_MS?(i=String(Math.floor(a/WEEK_MS)).padStart(2,"0"),s=String(Math.floor(a%MONTHR_MS/DAY_MS)).padStart(2,"0"),this.#k=`${i}W ${s}D`):a>DAY_MS?(s=String(Math.floor(a/DAY_MS)).padStart(2,"0"),n=String(Math.floor(a%DAY_MS/36e5)).padStart(2,"0"),r=String(Math.floor(a%36e5/6e4)).padStart(2,"0"),this.#k=`${s}D ${n}:${r}`):a>36e5?(n=String(Math.floor(a/36e5)).padStart(2,"0"),r=String(Math.floor(a%36e5/6e4)).padStart(2,"0"),o=String(Math.floor(a%6e4/1e3)).padStart(2,"0"),this.#k=`${n}:${r}:${o}`):a>6e4?(r=String(Math.floor(a/6e4)).padStart(2,"0"),o=String(Math.floor(a%6e4/1e3)).padStart(2,"0"),this.#k=`00:${r}:${o}`):(o=String(Math.floor(a/1e3)).padStart(2,"0"),String(a%1e3).padStart(4,"0"),this.#k=`00:00:${o}`),this.#k}roundTime(t){return t-t%this.#o.time.timeFrameMS}}const CHART_MINH=300,CHART_MINW=400,TX_MINW="400px",TX_MINH="300px",TX_MAXW="100%",TX_MAXH="100%",UTILSH=35,TOOLSW=40,TIMEH=50,SCALEW=60,FONTWEIGHT="normal",FONTSIZE=12,FONTSTYLE="normal",FONTFAMILY="Avenir, Helvetica, Arial, sans-serif",COLOUR_BG="#141414",COLOUR_BORDER="#666",COLOUR_TXT="#ccc",COLOUR_ICON="#888",COLOUR_ICONHOVER="#CCC",ICONSIZE="30px",STYLE_ROW="position: relative;",GlobalStyle={COLOUR_BG:"#141414",COLOUR_BORDER:"#666",COLOUR_TXT:"#ccc",COLOUR_ICON:"#888",COLOUR_ICONHOVER:"#CCC",BORDER_THICKNESS:0,FONTWEIGHT:"normal",FONTSIZE:12,FONTSTYLE:"normal",FONTFAMILY:FONTFAMILY,FONT:`normal 12px normal ${FONTFAMILY}`,FONTSTRING:`font-style: normal; font-size: 12px; font-weight: normal; font-family: ${FONTFAMILY};`},ToolsStyle={COLOUR_ICON:"#888",ICONSIZE:"30px"},UtilsStyle={COLOUR_ICON:"#888",ICONSIZE:"30px"},MenuStyle={COLOUR_BG:"#141414",COLOUR_BORDER:"#666",COLOUR_TXT:"#ccc"},WindowStyle={COLOUR_BG:"#141414",COLOUR_BORDER:"#666",COLOUR_TXT:"#ccc"},CandleType={CANDLE_SOLID:"candle_solid",CANDLE_HOLLOW:"candle_hollow",CANDLE_UP_HOLLOW:"candle_up_hollow",CANDLE_DOWN_HOLLOW:"candle_down_hollow",OHLC:"ohlc",AREA:"area",LINE:"line"},CandleStyle={COLOUR_CANDLE_UP:"#00F04088",COLOUR_CANDLE_DN:"#F0004088",COLOUR_WICK_UP:"#0F4",COLOUR_WICK_DN:"#F04"},VolumeStyle={COLOUR_VOLUME_UP:"#00F04044",COLOUR_VOLUME_DN:"#F0004044",ONCHART_VOLUME_HEIGHT:15},YAxisStyle_FONTWEIGHT="normal",YAxisStyle_FONTSIZE=12,YAxisStyle_FONTFAMILY=FONTFAMILY,YAxisStyle={COLOUR_TICK:"#888",COLOUR_LABEL:"888",COLOUR_CURSOR:"#000",COLOUR_CURSOR_BG:"#CCC",FONTFAMILY:FONTFAMILY,FONTSIZE:12,FONTWEIGHT:"normal",FONT_LABEL:`normal 12px ${FONTFAMILY}`,FONT_LABEL_BOLD:`bold 12px ${FONTFAMILY}`},XAxisStyle_FONTWEIGHT="normal",XAxisStyle_FONTSIZE=12,XAxisStyle_FONTFAMILY=FONTFAMILY,XAxisStyle={COLOUR_TICK:"#888",COLOUR_LABEL:"888",COLOUR_CURSOR:"#000",COLOUR_CURSOR_BG:"#CCC",FONTFAMILY:FONTFAMILY,FONTSIZE:12,FONTWEIGHT:"normal",FONT_LABEL:`normal 12px ${FONTFAMILY}`,FONT_LABEL_BOLD:`bold 12px ${FONTFAMILY}`},GridStyle={COLOUR_GRID:"#333"},PriceLineStyle={lineWidth:1,strokeStyle:"#ccc",lineDash:[1,1]},LegendStyle={text:GlobalStyle.FONTSTRING,font:GlobalStyle.FONT,colour:GlobalStyle.COLOUR_TXT},defaultTheme={candle:{Type:CandleType.CANDLE_SOLID,UpBodyColour:CandleStyle.COLOUR_CANDLE_UP,UpWickColour:CandleStyle.COLOUR_WICK_UP,DnBodyColour:CandleStyle.COLOUR_CANDLE_DN,DnWickColour:CandleStyle.COLOUR_WICK_DN},volume:{Height:VolumeStyle.ONCHART_VOLUME_HEIGHT,UpColour:VolumeStyle.COLOUR_VOLUME_UP,DnColour:VolumeStyle.COLOUR_VOLUME_DN},xAxis:{colourTick:XAxisStyle.COLOUR_TICK,colourLabel:XAxisStyle.COLOUR_LABEL,colourCursor:XAxisStyle.COLOUR_CURSOR,colourCursorBG:XAxisStyle.COLOUR_CURSOR_BG,fontFamily:XAxisStyle.FONTFAMILY,fontSize:XAxisStyle.FONTSIZE,fontWeight:XAxisStyle.FONTWEIGHT,line:"#656565",slider:"#555555",handle:"#55555588",icon:"#888",iconHover:"#CCC"},yAxis:{colourTick:YAxisStyle.COLOUR_TICK,colourLabel:YAxisStyle.COLOUR_LABEL,colourCursor:YAxisStyle.COLOUR_CURSOR,colourCursorBG:YAxisStyle.COLOUR_CURSOR_BG,fontFamily:YAxisStyle.FONTFAMILY,fontSize:YAxisStyle.FONTSIZE,fontWeight:YAxisStyle.FONTWEIGHT,line:"#656565"},chart:{Background:GlobalStyle.COLOUR_BG,BorderColour:GlobalStyle.COLOUR_BORDER,BorderThickness:GlobalStyle.BORDER_THICKNESS,TextColour:GlobalStyle.COLOUR_TXT,GridColour:GridStyle.COLOUR_GRID},onChart:{},offChart:{},legend:{font:LegendStyle.font,colour:LegendStyle.colour},icon:{colour:"#888",hover:"#CCC"}},cssVars='\n<style title="txc_CSSVars">\n  --txc-background: #141414:\n  --txc-border-color: #888;\n  --txc-time-scrollbar-color: #888;\n  --txc-time-handle-color: #888;\n  --txc-time-slider-color: #888;\n  --txc-time-cursor-fore: #222;\n  --txc-time-cursor-back: #ccc;\n  --txc-time-icon-color: #888;\n  --txc-time-icon-hover-color: #888;\n</style>',style=`\n<style>\n  tradex-chart {\n    display: flex;\n    width: var(--txc-width, 100%);\n    height: var(--txc-height, 100%);\n    min-width: var(--txc-min-width, 400px);\n    min-height: var(--txc-min-height, 300px);\n    max-width: var(--txc-max-width, 100%);\n    max-height: var(--txc-max-height, 100%);\n    overflow: hidden;\n    background: var(--txc-background, ${GlobalStyle.COLOUR_BG});\n    font: var(--txc-font, ${GlobalStyle.FONT});\n  }\n  .tradeXchart .tradeXtime .navigation { \n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    align-items: stretch;\n    gap: 2px;\n  }\n  .tradeXchart .tradeXtime .navigation .icon { \n    flex-basis: 20px;\n   }\n  .tradeXchart .tradeXtime .navigation #tScrollBar { \n    height: 20px; \n    border: 1px solid; \n    border-radius: 3px; \n    flex-basis: 100%;\n    overflow: hidden;\n  }\n  .tradeXchart .tradeXtime .navigation #tScrollBar .handle { \n    height: 18px; \n    border-radius: 2px; \n    margin: 1px;\n  }\n\n  tradex-grid {\n    position: absolute;\n  }\n</style>\n`;class Theme{#E=new Map;#G;#w;static create(t,e){if(!isObject(t))return!1;t.ID=isString$1(t.name)?uid(t.name):`${e.id}.theme`;const i=new Theme(t,e);return i.#E.set(t.ID,i),i}constructor(t,e){this.#w=isObject(t)?t:{};const i=["constructor","list","current","setCurrent","getCurrent"],s=mergeDeep(copyDeep(defaultTheme),copyDeep(t));for(let t in s)i.includes(t)||(this[t]=s[t])}get list(){return this.#E}set current(t){this.setCurrent(t)}get current(){return this.#G}setCurrent(t){return isString$1(t)&&this.#E.has(t)&&(this.#G=t),this.getCurrent()}getCurrent(){return isString$1(this.#G)&&this.#E.has(this.#G)?this.#E.get(this.#G):defaultTheme}}class ThreadWorker{#V;constructor(t){this.#V=t,self.onmessage=t=>this._onmessage(t.data)}_onmessage(t){const{r:e,data:i}=t,s=this.#V(i);self.postMessage({r:e,result:s})}end(){self.close()}}class Thread{#z;#Y;#X;#j=0;#q={};#a;constructor(t,e,i,s){this.#z=t,this.#Y=i,this.#X=s;const n=`\n      ${WebWorker$1.ThreadWorker.toString()};\n      const fn = ${e}\n      const worker = new ThreadWorker(fn)\n    `,r=new Blob([`;(() => {${n}})()`],{type:"text/javascript"}),o=URL.createObjectURL(r);this.#a=new Worker(o),URL.revokeObjectURL(o)}get ID(){return this.#z}get req(){return`r_${this.#j}`}onmessage(t){return isFunction(this.#Y)?this.#Y(t):t}onerror(t){return isFunction(this.#X)?this.#X(t):t}postMessage(t){return new Promise(((e,i)=>{try{let s=this.req;this.#q[s]={resolve:e,reject:i},this.#a.postMessage({r:s,data:t}),this.#a.onmessage=t=>{const{r:e,result:i}=t.data;if(e in this.#q){const{resolve:t,reject:s}=this.#q[e];delete this.#q[e],t(this.onmessage(i))}},this.#a.onerror=t=>{i(this.onerror(t))}}catch(t){i(t)}}))}terminate(){this.#a.terminate()}}class WebWorker$1{static#K=new Map;static ThreadWorker=ThreadWorker;static Thread=Thread;static create(t="worker",e,i,s){if(void 0===window.Worker)return!1;if(isFunction(e))e=e.toString();else if(!isString$1(e))return!1;return t=isString$1(t)?uid(t):uid("worker"),WebWorker$1.#K.set(t,new WebWorker$1.Thread(t,e,i)),WebWorker$1.#K.get(t)}static destroy(t){if(!isString$1(t))return!1;WebWorker$1.#K.get(t).terminate(),WebWorker$1.#K.delete(t)}static end(){WebWorker$1.#K.forEach(((t,e,i)=>{WebWorker$1.destroy(e)}))}}class Overlay{#Z;#o;#w={};#Q;#J;#tt;#et;#it;#st;#nt=!0;constructor(t,e=!1,i=!1,s,n,r={}){this.#o=n.core,this.#Z=n,this.#w=n.core.config,this.#et=t,this.#it=t.scene,this.#Q=s,this.#J=e,this.#tt=i,this.#st=r}get core(){return this.#o}get parent(){return this.#Z}get target(){return this.#et}get config(){return this.#w}get params(){return this.#st}get scene(){return this.#it}get theme(){return this.#Q}get chart(){return this.#Z.parent.parent}get xAxis(){return this.#J||this.#Z.time.xAxis}get yAxis(){return this.#tt||this.#Z.scale.yAxis}set doDraw(t){this.#nt=!!isBoolean(t)&&t}get doDraw(){return this.#nt}on(t,e,i){this.#o.on(t,e,i)}off(t,e){this.#o.off(t,e)}emit(t,e){this.core.emit(t,e)}}function renderFillRect(t,e,i,s,n,r){t.fillStyle=r,t.fillRect(e,i,s,n)}function renderPath(t,e,i,s){t.save(),t.lineWidth=i.lineWidth||1,t.lineWidth%2&&t.translate(.5,.5),t.strokeStyle=i.strokeStyle,"lineDash"in i&&isArray(i.lineDash)&&t.setLineDash(i.lineDash),t.beginPath();let n=!0;e.forEach((e=>{e&&null!==e.x&&(n?(t.moveTo(e.x,e.y),n=!1):t.lineTo(e.x,e.y))})),s(),t.restore()}function renderHorizontalLine(t,e,i,s,n){renderPath(t,[{x:i,y:e},{x:s,y:e}],n,(()=>{t.stroke(),t.closePath()}))}function renderLine(t,e,i){renderPath(t,e,i,(()=>{t.stroke(),t.closePath()}))}const T=0,C=4;class indicator extends Overlay{#z;#rt;#ot;#at;#ht;#lt;#st;#ct;#dt;#i;#ut;#gt;#mt=[0,0];#pt;#ft;#P=2;#yt={};constructor(t,e=!1,i=!1,s,n,r){super(t,e,i,void 0,n,r),this.#st=r,this.#ct=r.overlay,this.#i=s.type,this.#dt=s.indicator,this.#ut=this.core.TALib,this.#gt=this.xAxis.range,this.eventsListen()}get ID(){return this.#z}set ID(t){this.#z=t}get name(){return this.#rt}set name(t){this.#rt=t}get shortName(){return this.#ot}set shortName(t){this.#ot=t}get onChart(){return this.#at}set onChart(t){this.#at=t}get scaleOverlay(){return this.#ht}set scaleOverlay(t){this.#ht=t}get plots(){return this.#lt}set plots(t){this.#lt=t}get params(){return this.#st}get Timeline(){return this.core.Timeline}get Scale(){return this.parent.scale}get type(){return this.#i}get overlay(){return this.#ct}get indicator(){return this.#dt}get TALib(){return this.#ut}get range(){return this.core.range}set setNewValue(t){this.#pt=t}set setUpdateValue(t){this.#ft=t}set precision(t){this.#P=t}get precision(){return this.#P}set style(t){this.#yt=t}get style(){return this.#yt}set position(t){this.target.setPosition(t[0],t[1])}set value(t){const e=this.core.time.timeFrameMS;let i=Math.floor(new Date(t[0])/e)*e;t[0]=i,this.#mt[0]!==t[0]?(this.#mt[0]=t[0],this.#pt(t)):this.#ft(t)}get value(){return this.#mt}end(){this.off(STREAM_UPDATE,this.onStreamUpdate)}eventsListen(){this.on(STREAM_UPDATE,this.onStreamUpdate.bind(this))}on(t,e,i){this.core.on(t,e,i)}off(t,e){this.core.off(t,e)}emit(t,e){this.core.emit(t,e)}onStreamNewValue(t){}onStreamUpdate(t){this.value=t}defineIndicator(t,e){isObject(t)||(t={}),this.definition.output=e.outputs;const i={...this.definition.input,...t};delete i.style;for(let t of e.options)if(t.name in i){if(typeof i[t.name]!==t.type){i[t.name]=t.defaultValue;continue}"range"in t&&(i[t.name]=limit(i[t.name],t.range.min,t.range.max))}else"timePeriod"==t.name&&(i.timePeriod=t.defaultValue);this.definition.input=i}addLegend(){let t={id:this.shortName,title:this.shortName,type:this.shortName,source:this.legendInputs.bind(this)};this.chart.legend.add(t)}legendInputs(t=this.chart.cursorPos){const e=[this.style.strokeStyle];let i=this.Timeline.xPos2Index(t[0])-(this.range.data.length-this.overlay.data.length),s=limit(this.overlay.data.length-1,0,1/0);return i=limit(i,0,s),{c:i,colours:e}}indicatorInput(t,e){let i=[];do{i.push(this.range.value(t)[4])}while(t++<e);return i}regeneratePlots(t){return t.map(((t,e)=>{const i=e+1;return{key:`${this.shortName}${i}`,title:`${this.shortName}${i}: `,type:"line"}}))}TALibParams(){let t=this.range.dataLength,e=this.definition.input.timePeriod,i=t-e,s=this.indicatorInput(i,t),n=s.find((t=>null===t));return!n&&{inReal:s,timePeriod:e}}calcIndicator(t,e={},i=this.range){if(!(isString$1(t)&&t in this.TALib&&isObject(i)&&this.core.TALibReady))return!1;let s,n;e.timePeriod=e.timePeriod||this.definition.input.timePeriod;let r=e.timePeriod;if(i instanceof Range)s=0,n=i.dataLength-r+1;else{if(!("indexStart"in i||"indexEnd"in i||"tsStart"in i||"tsEnd"in i))return!1;s=i.indexStart||this.Timeline.t2Index(i.tsStart||0)||0,n=i.indexEnd||this.Timeline.t2Index(i.tsEnd)||this.range.Length-1}if(n-s<r)return!1;let o,a,h,l=[];for(;s<n;){e.inReal=this.indicatorInput(s,s+r),h=this.TALib[t](e),a=[],o=0;for(let t of this.definition.output)a[o++]=h[t.name][0];l.push([this.range.value(s+r-1)[0],a]),s++}return l}calcIndicatorHistory(){if(this.overlay.data.length<this.definition.input.timePeriod){let t;const e=()=>{t=this.calcIndicator(this.libName,this.definition.input,this.range),t&&(this.overlay.data=t)};this.core.TALibReady?e():this.core.talibAwait.push(e.bind(this))}}calcIndicatorStream(t,e,i=this.range){if(!this.core.TALibReady||!isString$1(t)||!(t in this.TALib)||!(i instanceof Range)||i.dataLength<this.definition.input.timePeriod)return!1;let s=this.TALib[t](e),n=i.dataLength,r=i.value(n)[0],o=[],a=0;for(let t of this.definition.output)o[a++]=s[t.name][0];return[r,o]}newValue(t){let e=this.TALibParams();if(!e)return!1;let i=this.calcIndicatorStream(this.libName,e);if(!i)return!1;this.overlay.data.push(i),this.target.setPosition(this.core.scrollPos,0),this.draw(this.range)}updateValue(t){let e=this.overlay.data.length-1,i=this.TALibParams();if(!i)return!1;let s=this.calcIndicatorStream(this.libName,i);if(!s)return!1;this.overlay.data[e]=[s[0],s[1]],this.target.setPosition(this.core.scrollPos,0),this.draw(this.range)}plot(t,e,i){const s=this.scene.context;switch(s.save(),e){case"renderLine":renderLine(s,t,i);case"renderFillRect":renderFillRect(s,t[0],t[1],t[2],t[3],i)}s.restore()}draw(){}}const BBANDS={name:"BBANDS",camelCaseName:"bbands",group:"Overlap Studies",description:"Bollinger Bands",inputs:[{name:"inReal",type:"number"}],options:[{name:"timePeriod",displayName:"Time Period",defaultValue:5,hint:"Number of period",type:"number",range:{min:2,max:1e5}},{name:"nbDevUp",displayName:"Deviations up",defaultValue:2,hint:"Deviation multiplier for upper band",type:"number",range:{min:-3e37,max:3e37}},{name:"nbDevDn",displayName:"Deviations down",defaultValue:2,hint:"Deviation multiplier for lower band",type:"number",range:{min:-3e37,max:3e37}},{name:"MAType",displayName:"MA Type",defaultValue:0,hint:"Type of Moving Average",type:"MAType"}],outputs:[{name:"upperBand",type:"number",plot:"limit_upper"},{name:"middleBand",type:"number",plot:"line"},{name:"lowerBand",type:"number",plot:"limit_lower"}]},DX={name:"DX",camelCaseName:"dx",group:"Momentum Indicators",description:"Directional Movement Index",inputs:[{name:"high",type:"number"},{name:"low",type:"number"},{name:"close",type:"number"}],options:[{name:"timePeriod",displayName:"Time Period",defaultValue:14,hint:"Number of period",type:"number",range:{min:2,max:1e5}}],outputs:[{name:"output",type:"number",plot:"line"}]},EMA$1={name:"EMA",camelCaseName:"ema",group:"Overlap Studies",description:"Exponential Moving Average",inputs:[{name:"inReal",type:"number"}],options:[{name:"timePeriod",displayName:"Time Period",defaultValue:30,hint:"Number of period",type:"number",range:{min:2,max:1e5}}],outputs:[{name:"output",type:"number",plot:"line"}]},RSI$1={name:"RSI",camelCaseName:"rsi",group:"Momentum Indicators",description:"Relative Strength Index",inputs:[{name:"inReal",type:"number"}],options:[{name:"timePeriod",displayName:"Time Period",defaultValue:14,hint:"Number of period",type:"number",range:{min:2,max:1e5}}],outputs:[{name:"output",type:"number",plot:"line"}]},SMA$1={name:"SMA",camelCaseName:"sma",group:"Overlap Studies",description:"Simple Moving Average",inputs:[{name:"inReal",type:"number"}],options:[{name:"timePeriod",displayName:"Time Period",defaultValue:30,hint:"Number of period",type:"number",range:{min:2,max:1e5}}],outputs:[{name:"output",type:"number",plot:"line"}]};class BB extends indicator{name="Bollinger Bands";shortName="BB";libName="BBANDS";definition={input:{inReal:[],nbDevDn:2,nbDevUp:2,timePeriod:20},output:{lowerBand:[],middleBand:[],upperBand:[]}};#xt={lowerStrokeStyle:"#08c",lowerLineWidth:"1",lowerLineDash:void 0,middleStrokeStyle:"#0080c088",middleLineWidth:"1",middleLineDash:void 0,upperStrokeStyle:"#08c",upperLineWidth:"1",upperLineDash:void 0,fillStyle:"#0080c044"};precision=2;scaleOverlay=!1;plots=[{key:"BB_1",title:" ",type:"line"}];constructor(t,e=!1,i=!1,s,n,r){super(t,e,i,s,n,r);const o=r.overlay;this.ID=r.overlay?.id||uid(this.shortName),this.defineIndicator(o?.settings,BBANDS),this.style=o?.settings?.style?{...this.#xt,...o.settings.style}:{...this.#xt,...s.style},this.calcIndicatorHistory(),this.setNewValue=t=>{this.newValue(t)},this.setUpdateValue=t=>{this.updateValue(t)},this.addLegend()}get onChart(){return!0}legendInputs(t=this.chart.cursorPos){if(0==this.overlay.data.length)return!1;const e={};let{c:i,colours:s}=super.legendInputs(t);return e.Hi=this.Scale.nicePrice(this.overlay.data[i][1][0]),e.Mid=this.Scale.nicePrice(this.overlay.data[i][1][1]),e.Lo=this.Scale.nicePrice(this.overlay.data[i][1][2]),s=[this.style.upperStrokeStyle,this.style.middleStrokeStyle,this.style.lowerStrokeStyle],{inputs:e,colours:s,labels:[!1,!1,!1]}}draw(t=this.range){if(this.overlay.data.length<2)return!1;this.scene.clear();const e={lower:[],middle:[],upper:[]},i=this.overlay.data,s=this.xAxis.candleW;this.Timeline.smoothScrollOffset;const n={w:s};let r=(t.value(t.indexStart)[0]-this.overlay.data[0][0])/t.interval,o=this.Timeline.rangeScrollOffset,a=t.Length+o+2,h={};for(;a;)r<0||r>=this.overlay.data.length?(e.lower.push({x:null,y:null}),e.middle.push({x:null,y:null}),e.upper.push({x:null,y:null})):(n.x=this.xAxis.xPos(i[r][0]),n.y=this.yAxis.yPos(i[r][1][0]),e.lower.push({...n}),n.x=this.xAxis.xPos(i[r][0]),n.y=this.yAxis.yPos(i[r][1][1]),e.middle.push({...n}),n.x=this.xAxis.xPos(i[r][0]),n.y=this.yAxis.yPos(i[r][1][2]),e.upper.push({...n})),r++,a--;h={lineWidth:this.style.lowerLineWidth,strokeStyle:this.style.lowerStrokeStyle,lineDash:this.style.lowerLineDash},this.plot(e.lower,"renderLine",h),h={lineWidth:this.style.middleLineWidth,strokeStyle:this.style.middleStrokeStyle,lineDash:this.style.middleLineDash},this.plot(e.middle,"renderLine",h),h={lineWidth:this.style.upperLineWidth,strokeStyle:this.style.upperStrokeStyle,lineDash:this.style.upperLineDash},this.plot(e.upper,"renderLine",h),this.target.viewport.render()}}class DMI extends indicator{name="Directional Movement Index";shortName="DX";libName=null;definition={input:{},output:{}};#xt={strokeStyle:"#C80",lineWidth:"1",defaultHigh:75,defaultLow:25,highLowLineWidth:1,highLowStyle:"dashed",highStrokeStyle:"#848",lowStrokeStyle:"#848",highLowRangeStyle:"#22002220"};precision=2;scaleOverlay=!0;plots=[{key:"DMI_1",title:" ",type:"line"}];constructor(t,e=!1,i=!1,s,n,r){super(t,e,i,s,n,r);const o=r.overlay;this.ID=r.overlay?.id||uid(this.shortName),this.defineIndicator(o?.settings,DX),this.style=o?.settings?.style?{...this.#xt,...o.settings.style}:{...this.#xt,...s.style},this.calcIndicatorHistory(),this.setNewValue=t=>{this.newValue(t)},this.setUpdateValue=t=>{this.updateValue(t)}}get onChart(){return!1}legendInputs(t=this.chart.cursorPos){if(0==this.overlay.data.length)return!1;const e={},{c:i,colours:s}=super.legendInputs(t);return e.DMI_1=this.Scale.nicePrice(this.overlay.data[i][1]),{inputs:e,colours:s}}draw(t=this.range){if(this.overlay.data.length<2)return!1;this.scene.clear();const e=this.overlay.data,i=this.xAxis.candleW,s=this.scene.width+2*this.xAxis.bufferPx,n=this.yAxis.yPos(this.style.defaultHigh),r=this.yAxis.yPos(this.style.defaultLow),o=[0,n,this.scene.width,r-n];let a=this.style.highLowRangeStyle;this.plot(o,"renderFillRect",a),o.length=0,o[0]={x:0,y:n},o[1]={x:s,y:n},a={lineWidth:this.style.highLowLineWidth,strokeStyle:this.style.highStrokeStyle,dash:[5,5]},this.plot(o,"renderLine",a),o.length=0,o[0]={x:0,y:r},o[1]={x:s,y:r},a={lineWidth:this.style.highLowLineWidth,strokeStyle:this.style.lowStrokeStyle,dash:[5,5]},this.plot(o,"renderLine",a),o.length=0,this.Timeline.smoothScrollOffset;const h={w:i};let l=this.Timeline.rangeScrollOffset,c=t.data.length-this.overlay.data.length,d=t.indexStart-c-2,u=t.Length+2*l+2;for(;u;)d<0||d>=this.overlay.data.length?o.push({x:null,y:null}):(h.x=this.xAxis.xPos(e[d][0]),h.y=this.yAxis.yPos(e[d][1]),o.push({...h})),d++,u--;this.plot(o,"renderLine",this.style),this.target.viewport.render()}}class EMA extends indicator{name="Exponential Moving Average";shortName="EMA";libName="EMA";definition={input:{inReal:[],timePeriod:20},output:{output:[]}};#xt={strokeStyle:"#C80",lineWidth:"1"};precision=2;checkParamCount=!1;scaleOverlay=!1;plots=[{key:"EMA_1",title:"EMA: ",type:"line"}];static inCnt=0;static colours=["#9C27B0","#9C27B0","#66BB6A","#66BB6A"];constructor(t,e=!1,i=!1,s,n,r){super(t,e,i,s,n,r),EMA.inCnt++;const o=r.overlay;this.ID=r.overlay?.id||uid(this.shortName),this.defineIndicator(o?.settings,EMA$1),this.style=o?.settings?.style?{...this.#xt,...o.settings.style}:{...this.#xt,...s.style},this.calcIndicatorHistory(),this.setNewValue=t=>{this.newValue(t)},this.setUpdateValue=t=>{this.updateValue(t)},this.addLegend()}get onChart(){return!0}updateLegend(){this.parent.legend.update()}legendInputs(t=this.chart.cursorPos){if(0==this.overlay.data.length)return!1;const e={},{c:i,colours:s}=super.legendInputs(t);return e.EMA_1=this.Scale.nicePrice(this.overlay.data[i][1]),{inputs:e,colours:s}}draw(t=this.range){if(this.overlay.data.length<2)return!1;this.scene.clear();const e=this.overlay.data,i=this.xAxis.candleW,s=[];this.xAxis.smoothScrollOffset;const n={w:i};let r=this.Timeline.rangeScrollOffset,o=t.data.length-this.overlay.data.length,a=t.indexStart-o-2,h=t.Length+2*r+2;for(;h;)a<0||a>=this.overlay.data.length?s.push({x:null,y:null}):(n.x=this.xAxis.xPos(e[a][0]),n.y=this.yAxis.yPos(e[a][1]),s.push({...n})),a++,h--;this.plot(s,"renderLine",this.style),this.target.viewport.render()}}class RSI extends indicator{name="Relative Strength Index";shortName="RSI";libName="RSI";definition={input:{inReal:[],timePeriod:20},output:{output:[]}};#xt={strokeStyle:"#C80",lineWidth:"1",defaultHigh:75,defaultLow:25,highLowLineWidth:1,highLowStyle:"dashed",highStrokeStyle:"#848",lowStrokeStyle:"#848",highLowRangeStyle:"#22002220"};checkParamCount=!1;plots=[{key:"RSI_1",title:" ",type:"line"}];constructor(t,e=!1,i=!1,s,n,r){super(t,e,i,s,n,r);const o=r.overlay;this.ID=r.overlay?.id||uid(this.shortName),this.defineIndicator(o?.settings,RSI$1),this.style=o?.settings?.style?{...this.#xt,...o.settings.style}:{...this.#xt,...s.style},this.calcIndicatorHistory(),this.setNewValue=t=>{this.newValue(t)},this.setUpdateValue=t=>{this.updateValue(t)}}get onChart(){return!1}legendInputs(t=this.chart.cursorPos){if(0==this.overlay.data.length)return!1;const e={},{c:i,colours:s}=super.legendInputs(t);return e.RSI_1=this.Scale.nicePrice(this.overlay.data[i][1]),{inputs:e,colours:s}}draw(t=this.range){if(this.overlay.data.length<2)return!1;this.scene.clear();const e=this.overlay.data,i=this.xAxis.candleW,s=this.scene.width+2*this.xAxis.bufferPx,n=this.yAxis.yPos(this.style.defaultHigh),r=this.yAxis.yPos(this.style.defaultLow),o=[0,n,this.scene.width,r-n];let a=this.style.highLowRangeStyle;this.plot(o,"renderFillRect",a),o.length=0,o[0]={x:0,y:n},o[1]={x:s,y:n},a={lineWidth:this.style.highLowLineWidth,strokeStyle:this.style.highStrokeStyle,dash:[5,5]},this.plot(o,"renderLine",a),o.length=0,o[0]={x:0,y:r},o[1]={x:s,y:r},a={lineWidth:this.style.highLowLineWidth,strokeStyle:this.style.lowStrokeStyle,dash:[5,5]},this.plot(o,"renderLine",a),o.length=0,this.Timeline.smoothScrollOffset;const h={w:i};let l=this.Timeline.rangeScrollOffset,c=t.data.length-this.overlay.data.length,d=t.indexStart-c-2,u=t.Length+2*l+2;for(;u;)d<0||d>=this.overlay.data.length?o.push({x:null,y:null}):(h.x=this.xAxis.xPos(e[d][0]),h.y=this.yAxis.yPos(e[d][1]),o.push({...h})),d++,u--;this.plot(o,"renderLine",this.style),this.target.viewport.render()}}class SMA extends indicator{name="Simple Moving Average";shortName="SMA";libName="SMA";definition={input:{inReal:[],timePeriod:20},output:{output:[]}};#xt={strokeStyle:"#C80",lineWidth:"1"};#P=2;onChart=!0;scaleOverlay=!1;plots=[{key:"SMA_1",title:"SMA: ",type:"line"}];static inCnt=0;static colours=["#9C27B0","#9C27B0","#66BB6A","#66BB6A"];constructor(t,e=!1,i=!1,s,n,r){super(t,e,i,s,n,r),SMA.inCnt++;const o=r.overlay;this.ID=r.overlay?.id||uid(this.shortName),this.defineIndicator(o?.settings,SMA$1),this.style=o?.settings?.style?{...this.#xt,...o.settings.style}:{...this.#xt,...s.style},this.calcIndicatorHistory(),this.setNewValue=t=>{this.newValue(t)},this.setUpdateValue=t=>{this.updateValue(t)},this.addLegend()}get onChart(){return!0}updateLegend(){this.parent.legend.update()}legendInputs(t=this.chart.cursorPos){if(0==this.overlay.data.length)return!1;const e={},{c:i,colours:s}=super.legendInputs(t);return e.SMA_1=this.Scale.nicePrice(this.overlay.data[i][1]),{inputs:e,colours:s}}draw(t=this.range){if(this.overlay.data.length<2)return!1;this.scene.clear();const e=this.overlay.data,i=this.xAxis.candleW,s=[];this.xAxis.smoothScrollOffset;const n={w:i};let r=this.Timeline.rangeScrollOffset,o=t.data.length-this.overlay.data.length,a=t.indexStart-o-2,h=t.Length+2*r+2;for(;h;)a<0||a>=this.overlay.data.length?s.push({x:null,y:null}):(n.x=this.xAxis.xPos(e[a][0]),n.y=this.yAxis.yPos(e[a][1]),s.push({...n})),a++,h--;this.plot(s,"renderLine",this.style),this.target.viewport.render()}}class Volume extends indicator{#z;#rt="Relative Strength Index";#ot="RSI";#st;#at=!0;#vt=!1;#ht=!0;#lt=[{key:"RSI_1",title:" ",type:"line"}];#xt={};#yt={};constructor(t,e=!1,i=!1,s,n,r){super(t,e,i,s,n,r),r.overlay}get onChart(){return"both"}}var Indicators={BB:{id:"BB",name:"Bollinger Bands",event:"addIndicator",ind:BB},DMI:{id:"DMI",name:"Directional Movement",event:"addIndicator",ind:DMI},EMA:{id:"EMA",name:"Exponential Moving Average",event:"addIndicator",ind:EMA},RSI:{id:"RSI",name:"Relative Strength Index",event:"addIndicator",ind:RSI},SMA:{id:"SMA",name:"Simple Moving Average",event:"addIndicator",ind:SMA},Vol:{id:"Vol",name:"Volume",event:"addIndicator",ind:Volume}};class element extends HTMLElement{shadowRoot;template;id=uid();doInit=!0;constructor(t,e="open"){super(),this.template=t,this.shadowRoot=this.attachShadow({mode:e})}destroy(){}connectedCallback(){this.doInit&&(this.doInit=!1,this.shadowRoot.appendChild(this.template.content.cloneNode(!0)),this.style.display="block")}disconnectedCallback(){}get width(){return this.offsetWidth}set width(t){this.setDim(t,"width")}get height(){return this.offsetHeight}set height(t){this.setDim(t,"height")}setDim(t,e){if(isNumber(t))t+="px";else if(!isString$1(t))return;this.style[e]=t}setCursor(t){this.style.cursor=t}}class Axis{#o;#Z;#wt;constructor(t){this.#Z=t,this.#o=this.#Z.core,this.#wt=this.#o.Chart}get core(){return this.#o}get chart(){return this.#wt}get parent(){return this.#Z}get theme(){return this.#o.theme}get width(){return this.#wt.width}get height(){return this.#wt.height}get data(){return this.#wt.data}get range(){return this.#wt.range}get yDigits(){return this.#wt.yAxisDigits}float2Int(t){return float2Int(t)}numDigits(t){return numDigits(t)}countDigits(t){return countDigits(t)}precision(t){return precision(t)}}class xAxis extends Axis{#St=4;#Ct;#Mt=!0;constructor(t){super(t)}get range(){return this.parent.range}get width(){return this.parent.width}get interval(){return this.range.interval}get intervalStr(){return this.range.intervalStr}get timeStart(){return this.range.timeStart}get timeFinish(){return this.range.timeFinish}get rangeDuration(){return this.range.rangeDuration}get rangeLength(){return this.range.Length}get indexStart(){return this.range.indexStart}get indexEnd(){return this.range.indexEnd}get timeMax(){return this.range.timeMax}get timeMin(){return this.range.timeMin}get candleW(){return bRound(this.width/this.range.Length)}get candlesOnLayer(){return bRound(this.core.Chart.layerWidth/this.candleW)}get xAxisRatio(){return this.width/this.range.rangeDuration}set xAxisTicks(t){this.#St=isNumber(t)?t:0}get xAxisTicks(){return this.#St}get xAxisGrads(){return this.#Ct}get scrollOffsetPx(){return this.core.scrollPos%this.candleW}get bufferPx(){return this.core.bufferPx}xPos(t){return bRound(this.range.rangeIndex(t)*this.candleW+.5*this.candleW)}t2Index(t){return this.range.rangeIndex(t)}t2Pixel(t){return this.xPos(t)}pixel2T(t){let e=this.pixel2Index(t);return this.range.value(e)[0]}pixel2Index(t){return t-=this.candleW/2,this.range.indexStart+bRound(t/this.candleW)}pixelOHLCV(t){let e=this.pixel2Index(t);return this.range.value(e)}xPosSnap2CandlePos(t){let e=t%this.candleW;return bRound(t-e+(e?this.candleW/2:0))}xPos2Time(t){return this.pixel2T(t)}xPos2Index(t){return this.pixel2Index(t)}xPosOHLCV(t){return this.pixelOHLCV(t)}initXAxisGrads(){this.#Ct=this.calcXAxisGrads()}doCalcXAxisGrads(t){this.#Ct=this.calcXAxisGrads(t)}calcXAxisGrads(t=this.range.snapshot()){const e={entries:{},values:[],major:[],minor:[]},i=ms2TimeUnits(t.rangeDuration);e.units=i;for(let t in i)if(i[t]>0){e.units=[t,t],e.timeSpan=`${i[t]} ${t}`;break}const s=t.interval,{xStep:n,rank:r}=this.xStep(t),o=this.pixel2T(this.width)+n;let a=t.timeMin-t.timeMin%n-n,h=a;for(;a<o;){let t=time_start(a,"years"),i=time_start(a,"months"),r=time_start(a,"days");!(t in e.entries)&&t>=h?e.entries[t]=[this.dateTimeValue(t,s),this.t2Pixel(t),t,"major"]:!(i in e.entries)&&i>=h?e.entries[i]=[this.dateTimeValue(i,s),this.t2Pixel(i),i,"major"]:!(r in e.entries)&&r>=h&&(e.entries[r]=[this.dateTimeValue(r,s),this.t2Pixel(r),r,"major"]),e.entries[a]=[this.dateTimeValue(a,s),this.t2Pixel(a),a,"minor"],a+=n}return e.values=Object.values(e.entries),e}xStep(t){let e=this.#Mt?t.interval:1,i=TIMESCALES[0],s=bRound(this.width/t.Length),n=TIMESCALESRANK[0],r=TIMESCALES.indexOf(e);for(;r-- >=0;){if(s*(TIMESCALES[r]/e)>=100)break}return i=TIMESCALES[r],n=TIMESCALESRANK[r],{xStep:i,rank:n}}dateTimeValue(t,e){if(t/DAY_MS%1==0){const e=get_day(t);if(1===e){return 0===get_month(t)?get_year(t):get_monthName(t)}return e}return e<6e4||e<36e5?MS(t):HM(t)}gradsWorker(){}}const status={idle:0,dragStart:1,dragging:2};class Point{x=0;y=0;constructor(){if(1===arguments.length){const{x:t,y:e}=arguments[0];this.x=t,this.y=e}else if(arguments.length>1){const[t,e]=arguments;this.x=t,this.y=e}}clone(){return new Point(this.x,this.y)}}const keyboard=["keypress","keydown","keyup"],pointer=["pointerdown","pointerup","pointerover","pointerenter","pointerout","pointerleave","pointermove","pointercancel","gotpointercapture","lostpointercapture","dblclick","click","wheel","contextmenu"],mouse=["mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","mousewheel"],touch=["touchcancel","touchend","touchmove","touchstart"],pen=[],misc=[],custom=["pointerdrag","pointerdragend"];class EventsAgent{constructor(t){this.input=t,this.element=t.element,window.PointerEvent?this.type=[...keyboard,...pointer,...mouse,...touch,...pen,...misc,...custom]:this.type=[...keyboard,...mouse,...touch,...pen,...misc,...custom],this.clientPosPrev=new Point([null,null]),this.position=new Point,this.movement=new Point([0,0]),this.dragstart=new Point([null,null]),this.dragend=new Point([null,null]),this.dragCheckThreshold=3,this.dragStatus=!1,this.wheeldelta=0,this.pointerButtons=[!1,!1,!1,!1,!1],this.pointerdrag=new Event("pointerdrag"),this.pointerdragend=new Event("pointerdragend")}has(t){return-1!=this.type.indexOf(t)}addListener(t,e,i){let s=e;if(!this.has(t)||!isFunction(e)||!DOM.isElement(this.element))return!1;if(-1!==pointer.indexOf(t)){switch(t){case"pointerdown":s=function(t){this.onPointerDown(t),e(this.createPointerEventArgument(t))};break;case"pointerup":s=function(t){this.onPointerUp(t),e(this.createPointerEventArgument(t))};break;case"pointermove":s=function(t){this.motion(t),e(this.createPointerEventArgument(t))};break;case"click":case"dbclick":case"pointerenter":case"pointerleave":case"pointerout":case"pointerover":case"contextmenu":s=function(t){this.location(t),e(this.createPointerEventArgument(t))};break;case"wheel":s=function(t){this.wheeldelta=t.wheelDelta,e(this.createPointerEventArgument(t))};break;default:s=function(t){e(t)}}return this.element.addEventListener(t,s.bind(this),i),s}if(-1==custom.indexOf(t))this.element.addEventListener(t,e,i);else switch(t){case"pointerdrag":this.initPointerDrag(e,i);break;case"pointerdragend":s=function(t){this.motion(t),e(this.createPointerEventArgument(t))},this.element.addEventListener(t,s.bind(this),i)}return!0}removerListener(t,i,s,n){return!!(this.has(t)&&isFunction(i)&&DOM.isElement(s))&&("pointerdrag"==t&&(e.target.removeEventListener("pointermove",this.onPointerDrag),e.target.removeEventListener("pointerdown",this.onPointerDown),e.target.removeEventListener("gotpointercapture",this.onPointerDrag),e.target.removeEventListener("lostpointercapture",this.onPointerDragEnd),document.removeEventListener("pointerup",this.onPointerDragEnd)),s.removeEventListener(t,i,n),!0)}initPointerDrag(t,e){this.draginit||(this.draginit=!0,this.element.addEventListener("pointerdown",this.onPointerDown.bind(this),e),this.element.addEventListener("gotpointercapture",this.onPointerCapture.bind(this),e),this.element.addEventListener("lostpointercapture",this.onPointerDragEnd.bind(this),e),this.element.addEventListener("pointermove",this.onPointerMove.bind(this),e));this.dragStatus="ready",this.element.addEventListener("pointerdrag",function(e){e=this.createPointerEventArgument(e),t(e)}.bind(this),e)}onPointerDown(t){this.location(t),this.pointerButtons[t.button]=!0,"ready"==this.dragStatus&&t.target.setPointerCapture(t.pointerId)}onPointerUp(t){this.location(t),this.pointerButtons[t.button]=!1}onPointerMove(t){"dragging"==this.dragStatus&&(this.motion(t),this.dragend=this.position.clone(),t.target.dispatchEvent(this.pointerdrag))}onPointerCapture(t){this.dragstart=this.position.clone(),this.dragend=this.position.clone(),this.dragStatus="dragging"}onPointerDragEnd(t){"dragging"==this.dragStatus&&(this.dragStatus="ready",t.target.dispatchEvent(this.pointerdragend))}createPointerEventArgument(t){return{isProcessed:!1,pointerType:t.pointerType,position:this.position.clone(),movement:this.movement.clone(),dragstart:this.dragstart.clone(),dragend:this.dragend.clone(),wheeldelta:this.wheeldelta,buttons:this.pointerButtons,domEvent:t,timeStamp:Date.now()}}isButtonPressed(t){return-1!==this.pointerButtons.indexOf(t)}setCursor(t){this.element.style.cursor=t}motion(t){const e=t.clientX||this.position.x,i=t.clientY||this.position.y;this.movement.x=e-this.clientPosPrev.x,this.movement.y=i-this.clientPosPrev.y,this.position.x+=this.movement.x,this.position.y+=this.movement.y,this.clientPosPrev.x=e,this.clientPosPrev.y=i}location(t){const e=t.target.getBoundingClientRect();this.clientPosPrev.x=t.clientX,this.clientPosPrev.y=t.clientY,this.position.x=t.clientX-e.left,this.position.y=t.clientY-e.top,this.movement.x=0,this.movement.y=0}createKeyEventArgument(t){return t}}const defaultOptions$1={element:void 0,contextMenu:!0};class Input{constructor(t,e){if(this.options={...defaultOptions$1,...e},this.status=status.idle,this.element=t,!this.element&&this.options.elementId&&(this.element=document.getElementById(this.options.elementId)),!this.element)throw"Must specify an element to receive user input.";this.eventsAgent=new EventsAgent(this),this.options.contextMenu||(window.oncontextmenu=t=>(t.preventDefault(),!1))}on(t,e,i){return this.eventsAgent.addListener(t,e,i)}off(t,e,i){return this.eventsAgent.removeListener(t,e,i)}invoke(t,e,i){this.currentAgent=t,this.eventsAgent.invoke(e,this.createEventArgument(i))}createEventArgument(t){const e=t||{};return e.isButtonPressed=t=>this.isButtonPressed(t),e.isKeyPressed=t=>this.isKeyPressed(t),e.controller=this,e}isButtonPressed(t){return this.eventsAgent.isButtonPressed(t)}isKeyPressed(t){return this.eventsAgent.isKeyPressed(t)}setCursor(t){this.eventsAgent.setCursor(t)}}var stateMachineConfig$6={id:"time",initial:"idle",context:{},states:{idle:{onEnter(t){},onExit(t){},on:{resize:{target:"resize",action(t){}},xAxis_scale:{target:"scale",action(t){}},xAxis_inc:{target:"incremental",action(t){}},xAxis_log:{target:"logarithmic",action(t){}},xAxis_100:{target:"percentual",action(t){}},chart_pan:{target:"chart_pan",action(t){}}}},resize:{onEnter(t){},onExit(t){},on:{someEvent:{target:"",action(t){}}}},chart_pan:{onEnter(t){},onExit(t){},on:{chart_pan:{target:"chart_pan",action(t){}},chart_panDone:{target:"idle",action(t){}}}}}};const isBrowser="undefined"!=typeof window&&void 0!==window.document;"undefined"!=typeof process&&null!=process.versions&&process.versions.node;const isHex=/^#?([0-9a-f]{3}|[0-9a-f]{6}|[0-9a-f]{8})$/i,isHSL=/^hsla?((\d{1,3}?),\s*(\d{1,3}%),\s*(\d{1,3}%)(,\s*[01]?\.?\d*)?)$/,isHSLA=/^hsla[(]\s*0*(?:[12]?\d{1,2}|3(?:[0-5]\d|60))\s*(?:\s*,\s*0*(?:\d\d?(?:\.\d+)?\s*%|\.\d+\s*%|100(?:\.0*)?\s*%)){2}\s*,\s*0*(?:\.\d+|1(?:\.0*)?)\s*[)]$/,isRGB=/^rgba?((\d{1,3}%?),\s*(\d{1,3}%?),\s*(\d{1,3}%?)(,\s*[01]?\.?\d*)?)$/,isRGBA=/^^rgba[(](?:\s*0*(?:\d\d?(?:\.\d+)?(?:\s*%)?|\.\d+\s*%|100(?:\.0*)?\s*%|(?:1\d\d|2[0-4]\d|25[0-5])(?:\.\d+)?)\s*,){3}\s*0*(?:\.\d+|1(?:\.0*)?)\s*[)]$/;class Colour{#mt={r:null,g:null,b:null,a:null,h:null,s:null,l:null,v:null,r16:null,g16:null,b16:null,a16:null,hex:null,hsl:null,hsla:null,rgb:null,rgba:null,isValid:!1};constructor(t){this.#Tt(t),isHex.test(t)&&this.#At(t),isHSL.test(t)&&this.#bt(t),isHSLA.test(t)&&this.#Lt(t),isRGB.test(t)&&this.#Et(t),isRGBA.test(t)&&this.#Dt(t)}get value(){return this.#mt}get isValid(){return this.#mt.isValid}get hex(){return this.#mt.hex.slice(0,-2)}get hexa(){return this.#mt.hex}#Tt(t){if(isBrowser){let e=document.getElementById("divValidColourTest");e||(e=document.createElement("div"),e.id="divValidColourTest"),e.style.backgroundColor="",e.style.backgroundColor=t,this.#mt.isValid=!!e.style.backgroundColor.length}else this.#mt.isValid=!!(isHex.test(t)||isHSL.test(t)||isHSLA.test(t)||isRGB.test(t)||isRGBA.test(t))}setHex(t){let e=this.#mt;[e.r16,e.g16,e.b16,e.a16]=t,e.hex="#"+e.r16+e.g16+e.b16+e.a16}setRGBA(t){let e=this.#mt;[e.r,e.g,e.b,e.a]=t,e.rgb=`rgb(${t[0]},${t[1]},${t[2]})`,e.rgba=`rgb(${t[0]},${t[1]},${t[2]},${t[3]})`}setHSLA(t){let e=this.#mt;[e.h,e.s,e.l,e.a]=t,e.hsl=`hsl(${t[0]},${t[1]}%,${t[2]}%)`,e.hsla=`hsl(${t[0]},${t[1]}%,${t[2]}%,${t[3]})`}#At(t){let e;switch(this.#mt.hex=t,t.length){case 4:e=[`${t[1]}${t[1]}`,`${t[2]}${t[2]}`,`${t[3]}${t[3]}`,"ff"];break;case 7:e=[t.substr(1,2),t.substr(3,2),t.substr(5,2),"ff"];break;case 9:e=[t.substr(1,2),t.substr(3,2),t.substr(5,2),t.substr(7,2)]}this.setHex(e),this.#Ot(e),this.#Rt(e)}#bt(t){this.#mt.hsl=t}#Lt(t){this.#mt.hsla=t}#Et(t){this.#mt.rgb=t,this.#It(rgba)}#Dt(t){this.#mt.rgba=t,this.#It(t)}#Pt(t){let{r:e,g:i,b:s,a:n}=this.#_t(t);return 1==e.length&&(e="0"+e),1==i.length&&(i="0"+i),1==s.length&&(s="0"+s),1==n.length&&(n="0"+n),this.value.r=e,this.value.g=i,this.value.b=s,this.value.a=n,this.setHex([e,i,s,n]),this}#Nt(t){let{r:e,g:i,b:s,a:n}=this.#_t(t);e=parseInt(e,16)/255,i=parseInt(i,16)/255,s=parseInt(s,16)/255,n=parseInt(n,16)/255;const r=Math.max(e,i,s),o=r-Math.min(e,i,s),a=o?r===e?(i-s)/o:r===i?2+(s-e)/o:4+(e-i)/o:0;let h=[(60*a<0?60*a+360:60*a).toString(),(100*(o?r<=.5?o/(2*r-o):o/(2-(2*r-o)):0)).toString(),(100*(2*r-o)/2).toString(),n.toString()];return this.setHSLA(h),this}#$t(t,e,i){i/=100;const s=e=>(e+t/30)%12,n=(e/=100)*Math.min(i,1-i),r=t=>i-n*Math.max(-1,Math.min(s(t)-3,Math.min(9-s(t),1)));return[255*r(0),255*r(8),255*r(4)]}#kt(t,e,i){i/=100;const s=e*Math.min(i,1-i)/100,n=e=>{const n=(e+t/30)%12,r=i-s*Math.max(Math.min(n-3,9-n,1),-1);return Math.round(255*r).toString(16).padStart(2,"0")};return`#${n(0)}${n(8)}${n(4)}`}#Ot(t){isString$1(t)&&(t=/([a-f\d]{2})/gi.exec(t));var e=[parseInt(t[0],16),parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)/255];this.setRGBA(e)}#Rt(t){isString$1(t)&&(t=/([a-f\d]{2})/gi.exec(t));let e=parseInt(t[0],16),i=parseInt(t[1],16),s=parseInt(t[2],16),n=parseInt(t[3],16);e/=255,i/=255,s/=255,n/=255,this.setHSLA([e,i,s,n])}#_t(t){let e,i,s,n,r=this.#mt;if(r.r&&r.g&&r.b&&r.a)return({r:e,g:i,b:s,a:n}={...r});if(isString$1(t)){let e=t.indexOf(",")>-1?",":" ";t=t.substr(4).split(")")[0].split(e)}if(isArray(t)){if(t.length<3||t.length>4)return!1;e=t[0],i=t[1],s=t[2],n=isString$1(t[3])?t[3]:""}else{if(!isObject(t))return!1;e=t.r,i=t.g,s=t.b,n="a"in t?t.a:""}return{r:e,g:i,b:s,a:n}}#It(t){let e,i,s=0,n=[],r=[],o=t.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+),?([^,\s)]+)?/i);o.shift();for(let t of o)i=t.indexOf("%")>-1,e=parseFloat(t),s<3&&i?e=Math.round(255*e/100):3==s&&(e=!i&&e>=0&&e<=1?Math.round(255*e):i&&e>=0&&e<=100?Math.round(255*e/100):""),n[s]=(256|e).toString(16).slice(1),r[s++]=e;this.setHex(n),this.setRGBA(r),this.#Rt(this.#mt.hex)}}class Slider{static#Ht;#e;#o;#Bt;#Wt;#Ut={w:0,h:0};#Ft={w:0,h:0,x:0,y:0};#Gt={x:!1,y:!0};#Vt;#zt={x:0,drag:!1};#Yt;#Xt;constructor(t){this.#e=Slider.#Ht++,this.#o=t.core,this.#Bt=!!DOM.isElement(t.elContainer)&&t.elContainer,this.#Wt=!!DOM.isElement(t.elHandle)&&t.elHandle,this.#Xt=!!isFunction(t.callback)&&t.callback,DOM.isElement(this.#Bt)&&DOM.isElement(this.#Wt)&&(this.mount(),this.eventsListen())}eventsListen(){this.#Yt=new Input(this.#Wt,{disableContextMenu:!1}),this.#Yt.on("mouseenter",debounce(this.onMouseEnter,1,this,!0)),this.#Yt.on("mouseout",debounce(this.onMouseOut,1,this,!0)),this.#Yt.on("drag",throttle(this.onHandleDrag,100,this)),this.#Yt.on("enddrag",this.onHandleDragDone.bind(this)),this.#Yt.on("mousedown",debounce(this.onMouseDown,100,this,!0)),this.#Yt.on("mouseup",this.onMouseUp.bind(this))}on(t,e,i){this.#o.on(t,e,i)}off(t,e){this.#o.off(t,e)}emit(t,e){this.#o.emit(t,e)}onMouseEnter(){const t=getComputedStyle(this.#Wt).backgroundColor;t&&(this.colour=new Colour(t),this.#Wt.style.backgroundColor=this.colour.hex)}onMouseOut(){this.#Wt.style.backgroundColor=this.colour.hexa}onMouseDown(){}onMouseUp(t){this.onHandleDragDone(t)}onHandleDrag(t){this.#zt.drag||(this.#zt.drag=!0,this.#zt.x=t.position.x),this.handlePos(t)}onHandleDragDone(t){this.handlePos(t),this.#zt.drag=!1}mount(){this.#Ut.w=this.#Bt.getBoundingClientRect().width,this.#Ut.h=this.#Bt.getBoundingClientRect().height,this.#Bt.style.overflow="hidden",this.#Ft.w=this.#Wt.getBoundingClientRect().width,this.#Ft.h=this.#Wt.getBoundingClientRect().height,this.#Wt.style.marginRight=0,this.#Wt.style.position="absolute"}handlePos(t){let e=this.#o.range,i=parseInt(this.#Wt.style.marginLeft),s=this.#Bt.getBoundingClientRect().width,n=this.#Wt.getBoundingClientRect().width,r=s-n,o=limit(i+(t.position.x-this.#zt.x),0,r),a=(e.dataLength+e.limitFuture+e.limitPast)/s,h=Math.floor(o*a);this.setHandleDims(o,n),this.#o.jumpToIndex(h)}setHandleDims(t,e){let i=this.#Bt.getBoundingClientRect().width;e=e||this.#Wt.getBoundingClientRect().width,t=t/i*100,this.#Wt.style.marginLeft=`${t}%`,e=e/i*100,this.#Wt.style.width=`${e}%`}setCursor(t){this.#Wt.style.cursor=t}}class Node$1{constructor(t={}){this.container=t.container,this.layers=[],this.id=CEL.idCnt++,this.scene=new CEL.Scene,this.setSize(t.width||0,t.height||0)}setSize(t,e){return this.width=t,this.height=e,this.scene.setSize(t,e),this.layers.forEach((function(i){i.setSize(t,e)})),this}addLayer(t){return this.layers.push(t),t.setSize(t.width||this.width,t.height||this.height),t.viewport=this,this}getIntersection(t,e){for(var i,s=this.layers,n=s.length-1;n>=0;){if((i=s[n].hit.getIntersection(t,e))>=0)return i;n--}return-1}get index(){let t,e=CEL.viewports,i=0;for(t of e){if(this.id===t.id)return i;i++}return null}destroy(){for(let t of this.layers)t.remove()}render(t=!1){let e,i=this.scene,s=this.layers;for(e of(i.clear(),s))t&&e.layers.length>0&&e.render(t),e.visible&&e.width>0&&e.height>0&&i.context.drawImage(e.scene.canvas,e.x,e.y,e.width,e.height)}}class Viewport extends Node$1{constructor(t={}){super(t),t.container.innerHTML="",t.container.appendChild(this.scene.canvas),CEL.viewports.push(this)}destroy(){super.destroy(),this.container.innerHTML="",CEL.viewports.splice(this.index,1)}}class Layer{x=0;y=0;width=0;height=0;visible=!0;constructor(t={}){this.id=CEL.idCnt++,this.hit=new CEL.Hit({contextType:t.contextType}),this.scene=new CEL.Scene({contextType:t.contextType}),t.x&&t.y&&this.setPosition(t.x,t.y),t.width&&t.height&&this.setSize(t.width,t.height)}get index(){let t=this.viewport.layers;t.length;let e,i=0;for(e of t){if(this.id===e.id)return i;i++}return null}setPosition(t,e){return this.x=t,this.y=e,this}setSize(t,e){return this.width=t,this.height=e,this.scene.setSize(t,e),this.hit.setSize(t,e),this}move(t){let e=this.index,i=this.viewport.layers;switch(t){case"up":e<i.length-1&&(i[e]=i[e+1],i[e+1]=this);break;case"down":e>0&&(i[e]=i[e-1],i[e-1]=this);break;case"top":i.splice(e,1),i.push(this);break;case"bottom":i.splice(e,1),i.unshift(this)}return this}moveUp(){return this.move("up")}moveDown(){return this.move("down")}moveTop(){return this.move("top")}moveBottom(){return this.move("bottom")}remove(){this.viewport.layers.splice(this.index,1)}}class Scene{width=0;height=0;constructor(t){t||(t={}),this.id=CEL.idCnt++,this.contextType=t.contextType||"2d",this.canvas=document.createElement("canvas"),this.canvas.className="scene-canvas",this.canvas.style.display="block",this.context=this.canvas.getContext(this.contextType),t.width&&t.height&&this.setSize(t.width,t.height)}setSize(t,e){return this.width=t,this.height=e,this.canvas.width=t*CEL.pixelRatio,this.canvas.style.width=`${t}px`,this.canvas.height=e*CEL.pixelRatio,this.canvas.style.height=`${e}px`,"2d"===this.contextType&&1!==CEL.pixelRatio&&this.context.scale(CEL.pixelRatio,CEL.pixelRatio),this}clear(){let t=this.context;return"2d"===this.contextType?t.clearRect(0,0,this.width*CEL.pixelRatio,this.height*CEL.pixelRatio):t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this}toImage(t="image/png",e,i){let s=this,n=new Image,r=this.canvas.toDataURL(t,e);n.onload=function(){n.width=s.width,n.height=s.height,i(n)},n.src=r}export(t,e,i="image/png",s){"function"!=typeof e&&(e=this.blobCallback.bind({cfg:t})),this.canvas.toBlob(e,i,s)}blobCallback(t){let e=document.createElement("a"),i=URL.createObjectURL(t),s=this.cfg.fileName||"canvas.png";e.setAttribute("href",i),e.setAttribute("target","_blank"),e.setAttribute("export",s),document.createEvent?Object.assign(document.createElement("a"),{href:i,target:"_blank",export:s}).click():e.click&&e.click()}}class Hit{width=0;height=0;constructor(t){t||(t={}),this.contextType=t.contextType||"2d",this.canvas=document.createElement("canvas"),this.canvas.className="hit-canvas",this.canvas.style.display="none",this.canvas.style.position="relative",this.context=this.canvas.getContext(this.contextType,{preserveDrawingBuffer:!0,antialias:!1}),t.width&&t.height&&this.setSize(t.width,t.height)}setSize(t,e){return this.width=t,this.height=e,this.canvas.width=t*CEL.pixelRatio,this.canvas.style.width=`${t}px`,this.canvas.height=e*CEL.pixelRatio,this.canvas.style.height=`${e}px`,this}clear(){let t=this.context;return"2d"===this.contextType?t.clearRect(0,0,this.width*CEL.pixelRatio,this.height*CEL.pixelRatio):t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this}getIntersection(t,e){let i,s=this.context;if(t=Math.round(t),e=Math.round(e),t<0||e<0||t>this.width||e>this.height)return-1;if("2d"===this.contextType){if(i=s.getImageData(t,e,1,1).data,i[3]<255)return-1}else if(i=new Uint8Array(4),s.readPixels(t*CEL.pixelRatio,(this.height-e-1)*CEL.pixelRatio,1,1,s.RGBA,s.UNSIGNED_BYTE,i),255===i[0]&&255===i[1]&&255===i[2])return-1;return this.rgbToInt(i)}getColorFromIndex(t){let e=this.intToRGB(t);return"rgb("+e[0]+", "+e[1]+", "+e[2]+")"}rgbToInt(t){return(t[0]<<16)+(t[1]<<8)+t[2]}intToRGB(t){return[(16711680&t)>>16,(65280&t)>>8,255&t]}}const CEL={idCnt:0,viewports:[],pixelRatio:window&&window.devicePixelRatio||1,Node:Node$1,Viewport:Viewport,Layer:Layer,Scene:Scene,Hit:Hit};class Overlays{#o;#w;#Z;#E;#jt;constructor(t,e=[]){this.#Z=t,this.#o=t.core,this.#E=new Map([...e]);for(const[t,e]of this.#E)this.addOverlay(t,e)}log(t){this.#o.log(t)}info(t){this.#o.info(t)}warning(t){this.#o.warn(t)}error(t){this.#o.error(t)}get core(){return this.#o}get parent(){return this.#Z}get layerConfig(){return this.#Z.layerConfig().layerConfig}get list(){return this.#E}get scale(){return this.#Z.parent.scale}get time(){return this.#Z.parent.time}start(){this.eventsListen()}end(){}eventsListen(){this.#Z.on("resize",(t=>this.onResize.bind(this)))}on(t,e,i){this.#o.on(t,e,i)}off(t,e){this.#o.off(t,e)}emit(t,e){this.#o.emit(t,e)}get(t){return this.#E.get(t)}addOverlays(t){let e,i=[];for(let s of t)e=this.addOverlay(s[0],s[1]),i.push([s[0]],e);return i}addOverlay(t,e){try{const i=new CEL.Layer(this.layerConfig);return this.parent.viewport.addLayer(i),e.layer=i,e.instance=new e.class(i,this.#Z.TimeLine,this.#Z.Scale,this.#o.theme,this,e.params),this.#E.set(t,e),!0}catch(e){return console.error(`Error: Cannot instantiate ${t} overlay / indicator`),console.error(e),!1}}}class chartGrid extends Overlay{constructor(t,e=!1,i=!1,s,n,r){super(t,e,i,s,n,r),this.params.axes=r?.axes||"both"}set position(t){this.target.setPosition(t[0],t[1])}draw(t){if(t=t||this.params.axes,this.scene.clear(),"none"==t)return;const e=this.scene.context;if(e.save(),e.strokeStyle=this.core.theme.chart.GridColour||GridStyle.COLOUR_GRID,"y"!=t){const t=0,i=this.xAxis.xAxisGrads.values;for(let s of i){let i=bRound(s[1]);e.beginPath(),e.moveTo(i+t,0),e.lineTo(i+t,this.scene.height),e.stroke()}}if("x"!=t){const t=this.yAxis.yAxisGrads;for(let i of t){let t=this.yAxis.$2Pixel(i[0]);e.beginPath(),e.moveTo(0,t),e.lineTo(this.scene.width,t),e.stroke()}}e.restore(),this.doDraw=!1}drawX(){this.draw("x")}}class chartCursor extends Overlay{#Vt=[0,0];#qt=!0;#Yt;constructor(t,e=!1,i=!1,s,n,r){super(t,!1,!1,s,n,r),this.core.on("chart_pan",(t=>{this.onMouseDragX(t)})),this.core.on("chart_panDone",(t=>{this.onMouseDragX(t)})),this.core.on("main_mousemove",(t=>{this.onMouseMoveX(t)})),this.#Yt=new Input(this.target.viewport.container,{disableContextMenu:!1}),this.#Yt.on("pointermove",this.onMouseMove.bind(this)),this.#Yt.on("pointerenter",this.onMouseMove.bind(this))}set position(t){}get update(){return this.#qt}onMouseDragX(t){this.#Vt[0]=t[0],this.#Vt[1]=t[1],this.draw(!0),this.core.emit("chart_render")}onMouseMoveX(t){this.#Vt[0]=t[0],this.draw(),this.core.emit("chart_render")}onMouseMove(t){const e=isObject(t)?t.position.x:t[0],i=isObject(t)?t.position.y:t[1];this.#Vt[0]=e,this.#Vt[1]=i,this.draw(),this.core.emit("chart_render")}draw(t=!1){let e=this.#Vt[0];t||(e=this.xAxis.xPosSnap2CandlePos(e)+this.xAxis.scrollOffsetPx);let i=this.#Vt[1];this.scene.clear();const s=this.scene.context;s.save(),s.setLineDash([5,5]);const n=this.xAxis.smoothScrollOffset||0;s.strokeStyle="#666",s.beginPath(),s.moveTo(e+n,0),s.lineTo(e+n,this.scene.height),s.stroke(),this.chart.cursorActive&&(s.beginPath(),s.moveTo(0,i),s.lineTo(this.scene.width,i),s.stroke()),s.restore()}}const defaultOverlays$5=[["grid",{class:chartGrid,fixed:!0}],["cursor",{class:chartCursor,fixed:!0}]];class graph{#o;#w;#Q;#Z;#Kt;#Zt;#Qt;#Jt;#te;#ee;constructor(t,e,i,s=!1){this.#Z=t,this.#o=t.core,this.#w=this.core.config,this.#Q=this.core.theme,this.#Qt=this.#Z.element,this.#te=e,this.createViewport(i,s)}get parent(){return this.#Z}get core(){return this.#o}get config(){return this.#w}set width(t){this.setWidth(t)}get width(){return this.#Qt.getBoundingClientRect().width}set height(t){this.setHeight(t)}get height(){return this.#Qt.getBoundingClientRect().height}get dimensions(){return DOM.elementDimPos(this.#Qt)}set layerWidth(t){this.#ee=t}get layerWidth(){return this.#ee}get stateMachine(){return this.#Z.stateMachine}set state(t){this.#o.setState(t)}get state(){return this.#o.getState()}get data(){return this.#o.chartData}get range(){return this.#o.range}get stream(){return this.#o.stream}get TimeLine(){return this.#o.TimeLine}get xAxis(){return this.#o.TimeLine.xAxis}get Scale(){return this.#Z.Scale}get yAxis(){return this.#Z.Scale.yAxis}get viewport(){return this.#Kt}get overlays(){return this.#Zt}destroy(){let t=this.#Zt.list;for(let[e,i]of t)i.instance=null;t=null,this.#Kt.destroy()}setSize(t,e,i){const s=this.#Zt.list;this.#Kt.setSize(t,e);for(let[t,n]of s)n.layer.setSize(i,e)}createViewport(t=[],e=!1){t=0==t.length?copyDeep(defaultOverlays$5):t;const{width:i,height:s}=this.layerConfig();let n=e?CEL.Node:CEL.Viewport;this.#Kt=new n({width:i,height:s,container:this.#te}),this.#Jt=this.#Kt.scene.canvas,this.#Zt=new Overlays(this,t)}layerConfig(){const t=this.config?.buffer||5,e=this.#te.getBoundingClientRect().width,i=this.#te.getBoundingClientRect().height;this.layerWidth=Math.round(e*(.01*(100+t)));return{width:e,height:i,layerConfig:{width:this.layerWidth,height:i}}}addOverlays(t){return this.#Zt.addOverlays(t)}addOverlay(t,e){return this.#Zt.addOverlay(t,e)}draw(t=this.range,e=!1){const i=this.#Zt.list;for(let[t,s]of i)this.#o.scrollPos==-1*this.#o.bufferPx||0==this.#o.scrollPos||1==e?s.instance.draw():this.#Z.streamCandle&&i.get("stream").instance.draw(),s.fixed||(s.instance.position=[this.#o.scrollPos,0])}render(){this.#Kt.render()}}class TimeLabels extends Overlay{#Vt=[0,0];#Ct;constructor(t,e=!1,i=!1,s,n,r){super(t,n.time.xAxis,i,s,n)}set position(t){this.target.setPosition(t[0],t[1])}draw(t){this.scene.clear();const e=this.scene.context,i=this.xAxis.xAxisGrads.values,s=this.theme.xAxis;e.save(),e.strokeStyle=s.colourTick,e.fillStyle=s.colourTick,e.font=`${s.fontWeight} ${s.fontSize}px ${s.fontFamily}`;for(let t of i){let i=bRound(t[1]),s=Math.floor(.5*e.measureText(`${t[0]}`).width);e.fillText(t[0],i-s+0,this.xAxis.xAxisTicks+12),e.beginPath(),e.moveTo(i+0,0),e.lineTo(i+0,this.xAxis.xAxisTicks),e.stroke()}e.restore()}}class TimeOverlays extends Overlay{#Vt=[0,0];#Ct;constructor(t,e=!1,i=!1,s,n,r){super(t,n.time.xAxis,i,s,n)}set position(t){this.target.setPosition(t[0],t[1])}draw(){this.scene.clear();const t=this.scene.context;this.xAxis.xAxisGrads.values,this.theme.xAxis,t.save(),t.restore()}}const defaultOptions={fontSize:12,fontWeight:"normal",fontFamily:"Helvetica Neue",paddingLeft:3,paddingRight:3,paddingTop:2,paddingBottom:2,borderSize:0,txtCol:"#000",bakCol:"#CCC"};function calcTextWidth(t,e){return Math.round(t.measureText(e).width)}function createFont(t=defaultOptions.fontSize,e=defaultOptions.fontWeight,i=defaultOptions.fontFamily){return`${e} ${t}px ${i}`}function getTextRectWidth(t,e,i){t.font=createFont(i.fontSize,i.fontWeight,i.fontFamily);const s=calcTextWidth(t,e);return(i.paddingLeft||0)+(i.paddingRight||0)+s+2*(i.borderSize||0)}function getTextRectHeight(t){const e=t.paddingTop||0,i=t.paddingBottom||0,s=t.borderSize||0;return e+i+(t.fontSize||0)+2*s}function drawTextBG(t,e,i,s,n){t.save(),t.font=createFont(n?.fontSize,n?.fontWeight,n?.fontFamily),t.textBaseline="top",t.fillStyle=n.bakCol||defaultOptions.bakCol;let r=n.width||getTextRectWidth(t,e,n),o=n.height||getTextRectHeight(n);t.fillRect(i,s,r,o),t.fillStyle=n.txtCol||defaultOptions.txtCol,i+=n?.paddingLeft,s+=n?.paddingTop,t.fillText(`${e}`,i,s),t.restore()}class TimeCursor extends Overlay{#Vt=[0,0];constructor(t,e=!1,i=!1,s,n){super(t,n.time.xAxis,i,s,n),this.viewport=t.viewport}set position(t){this.target.setPosition(t[0],t[1])}draw(){const t=this.scene.context,e=this.target.viewport.container.getBoundingClientRect(),i=this.core.mousePos.x-e.left;let s=this.xAxis.xPos2Time(i),n=new Date(s).toUTCString(),r={fontSize:1.05*this.theme.xAxis.fontSize,fontWeight:this.theme.xAxis.fontWeight,fontFamily:this.theme.xAxis.fontFamily,txtCol:this.theme.xAxis.colourCursor,bakCol:this.theme.xAxis.colourCursorBG,paddingTop:5,paddingBottom:3,paddingLeft:4,paddingRight:4},o=getTextRectWidth(t,n,r),a=i+this.core.bufferPx;a=this.xAxis.xPosSnap2CandlePos(a),a=a-Math.round(.5*o)-this.core.scrollPos-this.core.bufferPx,this.scene.clear(),t.save(),drawTextBG(t,n,a,1,r),t.restore()}}const defaultOverlays$4=[["labels",{class:TimeLabels,fixed:!1,required:!0}],["overlay",{class:TimeOverlays,fixed:!1,required:!0}],["cursor",{class:TimeCursor,fixed:!1,required:!0}]];class Timeline{#rt="Timeline";#ot="time";#ie;#se;#o;#wt;#J;#ne;#te;#re;#oe;#ae=new Map;#Kt;#he;#le;#ce;#de;#ue;#ge;#me;#pe;#fe;#Yt;#ye;#xe={width:20,height:20,fill:"#aaa"};constructor(t,e){this.#o=t,this.#ie=e,this.#se=e.elements.elTime,this.#wt=t.Chart,this.#J=new xAxis(this,this.#wt),this.init()}log(t){this.#o.log(t)}info(t){this.#o.info(t)}warning(t){this.#o.warn(t)}error(t){this.#o.error(t)}get name(){return this.#rt}get shortName(){return this.#ot}get options(){return this.#ie}get core(){return this.#o}get element(){return this.#se}get elViewport(){return this.#te}get height(){return this.#se.getBoundingClientRect().height}set width(t){this.setWidth(t)}get width(){return this.#se.getBoundingClientRect().width}get xAxis(){return this.#J}get xAxisWidth(){return this.#J.width}get xAxisRatio(){return this.#J.xAxisRatio}get layerLabels(){return this.#me}get layerOverlays(){return this.#pe}get xAxisGrads(){return this.#J.xAxisGrads}get candleW(){return this.#J.candleW}get candlesOnLayer(){return this.#J.candlesOnLayer}get theme(){return this.#o.theme}get config(){return this.#o.config}get graph(){return this.#oe}get viewport(){return this.#Kt}get navigation(){return this.#he}get range(){return this.#o.range}get pos(){return this.dimensions}get dimensions(){return DOM.elementDimPos(this.#se)}get bufferPx(){return this.#o.bufferPx}get scrollPos(){return this.#o.scrollPos}get scrollOffsetPx(){return this.#o.scrollPos%this.candleW}get smoothScrollOffset(){return this.#o.smoothScrollOffset}get rangeScrollOffset(){return this.#o.rangeScrollOffset}set stateMachine(t){this.#ne=new StateMachine(t,this)}get stateMachine(){return this.#ne}get time(){return this}init(){const t=this.#se;this.#te=t.viewport,this.#re=t.overview,this.#le=t.overview.icons,this.#ce=t.overview.scrollBar,this.#de=t.overview.handle,this.#ue=t.overview.rwdStart,this.#ge=t.overview.fwdEnd;const e={core:this.#o,elContainer:this.#ce,elHandle:this.#de,callback:null};this.#ye=new Slider(e)}setWidth(t){this.#se.style.width=`${t}px`,this.#te.style.width=`${t}px`}setDimensions(t){const e=this.config.buffer||5,i=t.w,s=this.height,n=Math.round(i*(.01*(100+e)));this.#oe.setSize(i,s,n),this.draw()}start(){this.createGraph(),this.onSetRange(),this.#J.initXAxisGrads(),this.draw(),this.eventsListen(),stateMachineConfig$6.context=this,this.stateMachine=stateMachineConfig$6,this.stateMachine.start()}end(){this.stateMachine.destroy(),this.#Kt.destroy(),this.#Yt.off("dblclick",this.onDoubleClick),this.#Yt.off("pointerenter",this.onPointerEnter),this.#Yt.on("pointerdrag",this.onPointerDrag),this.#Yt=null,this.off("main_mousemove",this.drawCursorTime),this.off("setRange",this.onSetRange),this.#ge.removeEventListener("click",debounce),this.#ue.removeEventListener("click",debounce)}eventsListen(){let t=this.#oe.viewport.scene.canvas;this.#Yt=new Input(t,{disableContextMenu:!1}),this.#Yt.on("dblclick",this.onDoubleClick.bind(this)),this.#Yt.on("pointerenter",this.onPointerEnter.bind(this)),this.#Yt.on("pointerdrag",this.onPointerDrag.bind(this)),this.on("main_mousemove",this.#fe.draw.bind(this.#fe)),this.on("setRange",this.onSetRange.bind(this)),this.#ge.addEventListener("click",debounce(this.onMouseClick,1e3,this,!0)),this.#ue.addEventListener("click",debounce(this.onMouseClick,1e3,this,!0))}on(t,e,i){this.#o.on(t,e,i)}off(t,e){this.#o.off(t,e)}emit(t,e){this.#o.emit(t,e)}onMouseClick(t){switch(t?.currentTarget?.id||t.target.parentElement.id){case"fwdEnd":this.onFwdEnd();break;case"rwdStart":this.onRwdStart()}}onPointerEnter(t){t.domEvent.target.style.cursor="ew-resize"}onPointerDrag(t){let e=this.range,i=e.indexStart-t.movement.x,s=e.indexEnd;e.set(i,s)}onDoubleClick(t){this.core.jumpToEnd(),this.core.MainPane.draw(void 0,!0)}onFwdEnd(){this.core.jumpToEnd(),this.core.MainPane.draw(void 0,!0)}onRwdStart(){this.core.jumpToStart(),this.core.MainPane.draw(void 0,!0)}onSetRange(){let t=this.range,e=t.indexStart;t.indexEnd;let i=this.#ce.getBoundingClientRect().width/(t.dataLength+t.limitFuture+t.limitPast),s=t.Length*i,n=(e+t.limitPast)*i;this.#ye.setHandleDims(n,s)}t2Index(t){return this.#J.t2Index(t)}xPos(t){return this.#J.xPos(t)}xPosSnap2CandlePos(t){return this.#J.xPosSnap2CandlePos(t)}xPos2Time(t){return this.#J.xPos2Time(t)}xPos2Index(t){return this.#J.xPos2Index(t)}xPosOHLCV(t){return this.#J.xPosOHLCV(t)}createGraph(){let t=copyDeep(defaultOverlays$4);this.#oe=new graph(this,this.#te,t,!1),this.#fe=this.graph.overlays.get("cursor").instance,this.#me=this.graph.overlays.get("labels").instance,this.#pe=this.graph.overlays.get("overlay").instance}addOverlays(t){for(let e of t);this.graph.addOverlays(Array.from(this.#ae))}render(){this.#oe.render()}draw(t=this.range,e=!0){this.#oe.draw(t,e)}hideCursorTime(){this.#fe.visible=!1,this.render()}showCursorTime(){this.#fe.visible=!0,this.render()}}const renderLoop={renderQ:new Map,rendered:[],renderLog:!1,dropFrames:!0,graphs:[],range:{},init:function(t){isObject(t)&&(this.renderLog=t?.renderLog||!1,this.dropFrames=t?.dropFrames||!0,this.graphs=isArray(t?.graphs)?[...t.graphs]:[],this.range=isObject(t?.range)?t.range:{})},queueFrame:function(t=this.range,e=this.graphs,i=!1){this.renderQ.size>1&&this.dropFrames&&this.dropFrame();const s=Date.now();return t=t.snapshot(),this.renderQ.set(s,{graphs:e,range:t,update:i}),s},dropFrame:function(t=-1){var e;-1===t&&(e=this.renderQ,t=Array.from(e.keys()).pop()),this.renderQ.size>1&&this.renderQ.has(t)&&this.renderQ.delete(t)},getFrame:function(t=0){return this.renderQ.has(t)?this.renderQ.get(t):this.renderQ.entries().next().value[1]},frameDone:function(){if(0===this.renderQ.size)return;const t=this.renderQ.entries().next().value[0];this.renderLog&&this.rendered.push([t,Date.now()]),this.renderQ.delete(t)},start:function(){requestAnimationFrame(this.execute.bind(this))},execute:function(){if(requestAnimationFrame(this.execute.bind(this)),0===this.renderQ.size)return;const[t,e]=this.renderQ.entries().next().value;if(e.range?.snapshot){for(let t of e.graphs)isFunction(t.draw)&&t.draw(e.range,e.update);for(let t of e.graphs)isFunction(t.render)&&t.render();this.frameDone()}}};class Chart{#z;#rt;#ot;#i;#o;#ie;#Z;#ne;#ve;#Jt;#te;#we;#Se;#Ce;#Me;#oe;#Te;#Ae;#Kt;#be;#Le;#fe;#Ee=new Map;#Zt=new Map;#De;#Oe=new Map;#Re=new Map;#Vt=[0,0];#Ie=!1;#Pe;#_e;#Ne;#$e;#Q;#ke;#Yt;#He;constructor(t,e){if(this.#o=t,isObject(e)){this.#ie={...e},this.#rt=e.name,this.#ot=e.shortName,this.#ve=this.#ie.elements.elTarget,this.#Se=this.#ie.elements.elScale,this.#Z=this.#ie.parent,this.#Q=t.theme,this.#_e=t.settings,this.#i=e.type||"offChart";for(const t in this.#ie)t in this.props()&&this.props()[t](this.#ie[t])}}log(t){this.core.log(t)}info(t){this.core.info(t)}warn(t){this.core.warn(t)}error(t){this.core.error(t)}set id(t){this.#z=t}get id(){return this.#z?`${this.#z}`:`${this.#o.id}.${this.#rt}`}get name(){return this.#rt}get shortName(){return this.#ot}get title(){return this.#$e}get type(){return this.#i}get parent(){return this.#Z}get core(){return this.#o}get options(){return this.#ie}get element(){return this.#ve}get pos(){return this.dimensions}get dimensions(){return DOM.elementDimPos(this.#ve)}set width(t){this.setWidth(t)}get width(){return this.#ve.getBoundingClientRect().width}set height(t){this.setHeight(t)}get height(){return this.#ve.getBoundingClientRect().height}get data(){}get range(){return this.#o.range}get stream(){return this.#Ae}get cursorPos(){return this.#Vt}set cursorActive(t){this.#Ie=t}get cursorActive(){return this.#Ie}get cursorClick(){return this.#Pe}get candleW(){return this.#o.Timeline.candleW}get theme(){return this.#o.theme}get config(){return this.#o.config}get scrollPos(){return this.#o.scrollPos}get bufferPx(){return this.#o.bufferPx}get elCanvas(){return this.#oe.viewport.scene.canvas}get elScale(){return this.#Se}get elLegend(){return this.#ve.legend}get elViewport(){return this.#ve.viewport}set layerWidth(t){this.#oe.layerWidth=t}get layerWidth(){return this.#oe.layerWidth}set legend(t){this.#Te=t}get legend(){return this.#Te}set time(t){this.#Me=t}get time(){return this.#Me}set scale(t){this.#Ce=t}get scale(){return this.#Ce}get axes(){return"x"}set graph(t){this.#oe=t}get graph(){return this.#oe}get viewport(){return this.#oe.viewport}get layerGrid(){return this.#oe.overlays.get("grid").layer}get overlays(){return this.#Zt}get overlayGrid(){return this.#oe.overlays.get("grid").instance}get overlayTools(){return this.#Re}set stateMachine(t){this.#ne=new StateMachine(t,this)}get stateMachine(){return this.#ne}start(t){this.#Me=this.#o.Timeline,this.createGraph(),this.#Ce.start(),this.draw(this.range),this.setCursor("crosshair"),t.id=this.id,t.context=this,this.stateMachine=t,this.stateMachine.start()}end(){this.stateMachine.destroy(),this.#Ce.end(),this.#oe.destroy(),this.#Yt.off("pointerdrag",this.onChartDrag),this.#Yt.off("pointerdragend",this.onChartDrag),this.#Yt.off("pointermove",this.onMouseMove),this.#Yt.off("pointerenter",this.onMouseEnter),this.#Yt.off("pointerout",this.onMouseOut),this.#Yt.off("pointerdown",this.onMouseDown),this.#ke=null,this.off("main_mousemove",this.onMouseMove),this.off(STREAM_LISTENING,this.onStreamListening),this.off(STREAM_NEWVALUE,this.onStreamNewValue),this.off(STREAM_UPDATE,this.onStreamUpdate),this.off(STREAM_FIRSTVALUE,this.onStreamNewValue)}eventsListen(){this.#Yt=new Input(this.#ve,{disableContextMenu:!1}),this.#Yt.on("pointerdrag",this.onChartDrag.bind(this)),this.#Yt.on("pointerdragend",this.onChartDragDone.bind(this)),this.#Yt.on("pointermove",this.onMouseMove.bind(this)),this.#Yt.on("pointerenter",this.onMouseEnter.bind(this)),this.#Yt.on("pointerout",this.onMouseOut.bind(this)),this.#Yt.on("pointerdown",this.onMouseDown.bind(this)),this.on("main_mousemove",this.updateLegends.bind(this)),this.on(STREAM_LISTENING,this.onStreamListening.bind(this)),this.on(STREAM_NEWVALUE,this.onStreamNewValue.bind(this)),this.on(STREAM_UPDATE,this.onStreamUpdate.bind(this)),this.on(STREAM_FIRSTVALUE,this.onStreamNewValue.bind(this))}on(t,e,i){this.#o.on(t,e,i)}off(t,e){this.#o.off(t,e)}emit(t,e){this.#o.emit(t,e)}onChartDrag(t){this.setCursor("grab"),this.core.MainPane.onChartDrag(t),this.scale.onChartDrag(t)}onChartDragDone(t){this.setCursor("crosshair"),this.core.MainPane.onChartDragDone(t)}onMouseMove(t){this.core.MainPane.onPointerActive(this),this.scale.layerCursor.visible=!0,this.graph.overlays.list.get("cursor").layer.visible=!0,this.#Vt=[Math.round(t.position.x),Math.round(t.position.y)],this.#Ce.onMouseMove(this.#Vt),this.emit(`${this.id}_mousemove`,this.#Vt)}onMouseEnter(t){this.core.MainPane.onPointerActive(this),this.#Vt=[Math.round(t.position.x),Math.round(t.position.y)],this.core.MainPane.onMouseEnter(),this.scale.layerCursor.visible=!0,this.graph.overlays.list.get("cursor").layer.visible=!0,this.emit(`${this.id}_mouseenter`,this.#Vt)}onMouseOut(t){this.#Ie=!1,this.#Vt=[Math.round(t.position.x),Math.round(t.position.y)],this.scale.layerCursor.visible=!1,this.emit(`${this.id}_mouseout`,this.#Vt)}onMouseDown(t){this.#Pe=[Math.floor(t.position.x),Math.floor(t.position.y)],"tool_activated"===this.stateMachine.state&&this.emit("tool_targetSelected",{target:this,position:t})}onStreamListening(t){this.#Ae!==t&&(this.#Ae=t)}onStreamNewValue(t){this.draw(this.range,!0)}props(){return{title:t=>this.#$e=t,yAxisDigits:t=>this.setYAxisDigits(t)}}setHeight(t){isNumber(t)||(t=this.height||this.#Z.height),this.#ve.style.height=`${t}px`,this.#Se.style.height=`${t}px`,this.elViewport.style.height=`${t}px`,this.#Ce.setDimensions({w:null,h:t})}setDimensions(t){const e=this.config.buffer||5;let{w:i,h:s}=t;i=this.width,s=s||this.height,this.layerWidth=Math.round(i*(.01*(100+e))),this.graph.setSize(i,s,this.layerWidth),this.setHeight(s),this.draw(void 0,!0),this.core.MainPane.draw(void 0,!1)}setCursor(t){this.element.style.cursor=t}addIndicator(t){const e="onChart"===this.type,i=this.core.indicators[t.type].ind,s="both"===i.constructor.type?e:i.prototype.onChart;if(!(t?.type in this.core.indicators)||e!==s)return!1;{const e={class:i,params:{overlay:t}};if(this.graph.addOverlay(t.name,e))return this.#Zt.set(t.name,e),!0}}addTool(t){let{layerConfig:e}=this.layerConfig(),i=new CEL.Layer(e);this.#Ee.set(t.id,i),this.#Kt.addLayer(i),t.layerTool=i,this.#Re.set(t.id,t)}addTools(t){}overlayTools(){}overlayToolAdd(t){this.#Re.set(t.id,t)}overlayToolDelete(t){this.#Re.delete(t)}drawGrid(){this.layerGrid.setPosition(this.#o.scrollPos,0),this.overlayGrid.draw("y"),this.#oe.render()}refresh(){this.#Ce.draw(),this.draw()}updateLegends(t=this.#Vt,e=!1){if(this.#o.isEmpty)return;const i=this.#Te.list;for(const s in i)this.#Te.update(s,{pos:t,candle:e})}render(){this.#oe.render(),this.#Ce.render()}draw(t=this.range,e=!1){this.#oe.draw(t,e)}drawGrid(){this.layerGrid.setPosition(this.core.scrollPos,0),this.overlayGrid.draw("y"),this.#oe.render()}resize(t=this.width,e=this.height){}zoomRange(){this.draw(this.range,!0),this.emit("zoomDone")}}class yAxis extends Axis{#Be;#Z;#wt;#o;#We=YAXIS_TYPES$1[0];#Ue="automatic";#Fe={automatic:{get max(){return this.range?.valueMax},get min(){return this.range?.valueMin},get mid(){return this.range?.valueMin+.5*this.range?.valueDiff},get diff(){return this.range?.valueDiff},get zoom(){return 1},get offset(){return 0},range:null},manual:{max:1,min:0,mid:.5,diff:1,zoom:1,offset:0}};#Ge=1.04;#Ve=100;#ze=6;#Ye=3;#Xe;#gt;constructor(t,e,i=YAXIS_TYPES$1[0],s){super(t),this.#wt=e,this.#Z=t,this.#Be=t.parent,this.yAxisType=i,s=s||this.core.range,this.#Fe.automatic.range=s,this.#gt=new Proxy(s,{get:(t,e)=>{const i=this.#Ue,s=this.#Fe;switch(e){case"max":case"min":case"mid":case"diff":case"zoom":case"offset":return s[i][e];default:return t[e]}}})}get chart(){return this.#wt}get range(){return this.#gt}get height(){return this.chart.height}get rangeH(){return this.#gt.diff*this.yAxisPadding}get yAxisRatio(){return this.getYAxisRatio()}get yAxisPrecision(){return this.yAxisCalcPrecision}set yAxisPadding(t){this.#Ge=t}get yAxisPadding(){return this.#Ge}set yAxisType(t){this.#We=YAXIS_TYPES$1.includes(t)?t:YAXIS_TYPES$1[0]}get yAxisType(){return this.#We}set yAxisStep(t){this.#Ve=isNumber(t)?t:100}get yAxisStep(){return this.#Ve}set yAxisTicks(t){this.#Ye=isNumber(t)?t:0}get yAxisTicks(){return this.#Ye}get yAxisGrads(){return this.#Xe}set mode(t){this.setMode(t)}get mode(){return this.#Ue}set offset(t){this.setOffset(t)}get offset(){return this.#gt.offset}set zoom(t){this.setZoom(t)}get zoom(){return this.#gt.zoom}getYAxisRatio(){return this.height/this.#gt.diff}yAxisRangeBounds(){}yAxisLog(){}yAxisCntDigits(t){return this.countDigits(t)}yAxisCalcPrecision(){let t=this.numDigits(this.#gt.max);return this.yDigits-t}yAxisCursor(){}yPos(t){switch(this.yAxisType){case"percent":return bRound(this.p100toPixel(t));case"log":return bRound(this.$2Pixel(log10(t)));default:return bRound(this.$2Pixel(t))}}yPos2Price(t){return this.pixel2$(t)}$2Pixel(t){const e=t-this.#gt.min;return this.height-e*this.yAxisRatio}lastYData2Pixel(t){let e=t-this.core.stream.lastPriceMin;return this.height-e*this.yAxisRatio}pixel2$(t){let e=(this.height-t)/this.height,i=this.#gt.diff*e;return this.#gt.min+i}p100toPixel(t){let e=this.height/this.#gt.diff;return-1*(t-this.#gt.max)*e}yAxisTransform(){}setMode(t){if(!["automatic","manual"].includes(t))return!1;const e=this.#Fe;"automatic"==this.mode&&"manual"==t?(e.manual.zoom=0,e.manual.max=this.#gt.valueMax,e.manual.min=this.#gt.valueMin,this.#Ue=t):"manual"==this.mode&&"automatic"==t&&(e.manual.zoom=0,this.#Ue=t)}setOffset(t){if(!isNumber(t)||0==t||"manual"!==this.#Ue)return!1;const e=this.#Fe;let i=this.pixel2$(-1*t),s=this.pixel2$(this.height-t),n=i-s;e.manual.min=s,e.manual.max=i,e.manual.mid=n/2,e.manual.diff=n,e.manual.zoom=0}setZoom(t){if(!isNumber(t)||"manual"!==this.#Ue)return!1;const e=this.#Fe;let i=e.manual.min,s=e.manual.max;const n=s-i,r=t*(.01*n);i-=r,s+=r,s<i||i<=-1/0||s>=1/0||(e.manual.max=s,e.manual.min=i,e.manual.mid=n/2,e.manual.diff=n,e.manual.zoom=r,this.calcGradations())}calcGradations(){let t,e,i;if("percent"===this.yAxisType)t=this.#gt.max>0?this.#gt.max:100,e=this.#gt.min>0?this.#gt.min:0,i=this.#gt.offset,this.#Xe=this.gradations(t+i,e+i);else t=this.#gt.max>0?this.#gt.max:1,e=this.#gt.min>0?this.#gt.min:0,i=this.#gt.offset,this.#Xe=this.gradations(t+i,e+i);return this.#Xe}gradations(t,e,i=!0,s=!1){let n,r,o;const a=[];r=t-e,r=this.rangeH>0?this.rangeH:1,o=r/(this.height/(1.75*this.core.theme.yAxis.fontSize));let h=Math.pow(10,Math.ceil(Math.log10(o)));o<.25*h?h*=.25:o<.5*h&&(h*=.5);var l=Math.ceil(e/h)*h,c=Math.floor(t/h)*h;let d,u=this.height,g=(c-l)/h,m=this.height/g,p=this.countDigits(g);for(var f=l;f<=c;f+=h)n=this.countDigits(f),d=this.niceValue(n,i,p),a.push([d,round(u),n]),u-=m;return a}niceValue(t,e=!0,i){if(t.integers){let s=i.integers;if(s-2>0){let e=power(10,s-2);return Math.floor(t.value/e)*e}return e?(s=s>0?s:-1*s,round(t.value,s)):Math.floor(t.value)}{let e=t.decimals-i.decimals;return e=e>0?e:-1*e,round(t.value,e)}}limitPrecision(t){let e=t.value,i=this.#ze-t.total,s=4-t.integers;if(i<1){let s=limit(t.decimals+i,0,100);e=Number.parseFloat(e).toFixed(s)}else if(s<1){let t=2-s;e=Number.parseFloat(e).toFixed(t)}return e}}var stateMachineConfig$5={id:"scale",initial:"idle",context:{},states:{idle:{onEnter(t){this.context.origin.setCursor("ns-resize")},onExit(t){},on:{resize:{target:"resize",action(t){}},yAxis_scale:{target:"scale",action(t){}},yAxis_inc:{target:"incremental",action(t){}},yAxis_log:{target:"logarithmic",action(t){}},yAxis_100:{target:"percentual",action(t){}},setRange:{target:"setRange",action(t){}}}},resize:{onEnter(t){},onExit(t){},on:{someEvent:{target:"",action(t){}}}},setRange:{onEnter(t){},onExit(t){},on:{always:{target:"idle",condition:"zoomDone",action(t){this.context.origin.draw()}}}}},guards:{receiver(){return this.eventData.scale.ID==this.context.origin.ID},zoomDone:()=>!0}};class ScaleCursor extends Overlay{#Vt=[0,0];constructor(t,e,i,s,n,r){n=i,super(t,e,i=i.yAxis,s,n,r),this.viewport=t.viewport}set position(t){this.target.setPosition(t[0],t[1])}draw(t){if(!this.parent.parent.cursorActive)return;this.#Vt=isArray(t)?t:this.#Vt;let[e,i]=this.#Vt,s=this.parent.yPos2Price(i),n=this.parent.nicePrice(s),r={fontSize:1.05*this.theme.yAxis.fontSize,fontWeight:this.theme.yAxis.fontWeight,fontFamily:this.theme.yAxis.fontFamily,txtCol:this.theme.yAxis.colourCursor,bakCol:this.theme.yAxis.colourCursorBG,paddingTop:2,paddingBottom:2,paddingLeft:3,paddingRight:3,width:this.viewport.width},o=r.fontSize+r.paddingTop+r.paddingBottom,a=i-.5*o;const h=this.scene.context;this.scene.clear(),h.save(),h.fillStyle=r.bakCol,h.fillRect(1,a,this.width,o),drawTextBG(h,`${n}`,1,a,r),h.restore()}erase(){this.scene.clear(),this.target.viewport.render()}}class ScaleLabels extends Overlay{constructor(t,e,i,s,n,r){n=i,super(t,e,i=i.yAxis,s,n,r),this.viewport=t.viewport}set position(t){this.target.setPosition(t[0],t[1])}draw(){const t=this.scene.context,e=this.yAxis,i=this.yAxis.calcGradations()||[],s=this.theme.yAxis,n=!isBoolean(s.tickMarker)||s.tickMarker;let r,o=[];if("left"===s?.location)o=[this.width,this.width-e.yAxisTicks];else o=[1,e.yAxisTicks];this.scene.clear(),t.save(),t.strokeStyle=s.colourTick,t.fillStyle=s.colourTick,t.font=`${s.fontWeight} ${s.fontSize}px ${s.fontFamily}`;for(let a of i)r=e.$2Pixel(a[0]),t.fillText(a[0],e.yAxisTicks+5,r+.3*s.fontSize),n&&(t.beginPath(),t.moveTo(o[0],r),t.lineTo(o[1],r),t.stroke());t.restore()}}class ScaleOverly extends Overlay{constructor(t,e,i,s,n,r){n=i,super(t,e,i=i.yAxis,s,n,r),this.viewport=t.viewport}set position(t){this.target.setPosition(t[0],t[1])}draw(){const t=this.scene.context;this.yAxis.yAxis,this.scene.clear(),t.save(),t.restore()}}class ScalePriceLine extends Overlay{constructor(t,e,i,s,n,r){n=i,super(t,e,i=i.yAxis,s,n,r),this.viewport=t.viewport}set position(t){this.target.setPosition(t[0],t[1])}draw(t){if(void 0===t)return;const e=this.scene.context,i=this.core.stream instanceof Stream&&this.config.stream.tfCountDown;let s=t[4],n=this.parent.nicePrice(s),r={fontSize:1.05*YAxisStyle.FONTSIZE,fontWeight:YAxisStyle.FONTWEIGHT,fontFamily:YAxisStyle.FONTFAMILY,txtCol:"#FFFFFF",bakCol:YAxisStyle.COLOUR_CURSOR_BG,paddingTop:2,paddingBottom:2,paddingLeft:5,paddingRight:3,width:this.viewport.width},o=getTextRectHeight(r),a=this.parent.yPos(s)-.5*o;this.scene.clear(),e.save(),t[4]>=t[1]?r.bakCol=this.theme.candle.UpBodyColour:r.bakCol=this.theme.candle.DnBodyColour,drawTextBG(e,n,0,a,r),i&&(n=this.core.stream.countDownUpdate(),r.fontSize=r?.fontSize/1.1,drawTextBG(e,n,0,a+o,r)),e.restore(),this.viewport.render()}}const defaultOverlays$3=[["labels",{class:ScaleLabels,fixed:!0,required:!0}],["overlay",{class:ScaleOverly,fixed:!0,required:!0}],["price",{class:ScalePriceLine,fixed:!0,required:!0}],["cursor",{class:ScaleCursor,fixed:!0,required:!0}]];class ScaleBar{#z;#rt="Y Scale Axis";#ot="scale";#o;#ie;#Z;#ne;#wt;#et;#tt;#se;#te;#Kt;#me;#pe;#je;#fe;#qe=new Map;#oe;#Yt;#Ke;#Vt;constructor(t,e){this.#o=t,this.#ie={...e},this.#se=this.#ie.elScale,this.#wt=this.#ie.chart,this.#Z=this.#ie.parent,this.#z=this.#ie.offChartID||uid("TX_scale_"),this.init()}log(t){this.#o.log(t)}info(t){this.#o.info(t)}warning(t){this.#o.warn(t)}error(t){this.#o.error(t)}get ID(){return this.#z}get name(){return this.#rt}get shortName(){return this.#ot}get core(){return this.#o}get options(){return this.#ie}get parent(){return this.#Z}set height(t){this.setHeight(t)}get height(){return this.#se.getBoundingClientRect().height}get width(){return this.#se.getBoundingClientRect().width}get element(){return this.#se}get layerCursor(){return this.#fe}get layerLabels(){return this.#me}get layerOverlays(){return this.#pe}get layerPriceLine(){return this.#je}get yAxis(){return this.#tt}set yAxisType(t){this.#tt.yAxisType=YAXIS_TYPES.includes(t)?t:YAXIS_TYPES[0]}get yAxisType(){return this.#tt.yAxisType}get yAxisHeight(){return this.#tt.height}get yAxisRatio(){return this.#tt.yAxisRatio}get yAxisGrads(){return this.#tt.yAxisGrads}set graph(t){this.#oe=t}get graph(){return this.#oe}get viewport(){return this.#Kt}get pos(){return this.dimensions}get dimensions(){return DOM.elementDimPos(this.#se)}get theme(){return this.#o.theme}get config(){return this.#o.config}set scaleRange(t){this.setScaleRange(t)}set rangeMode(t){this.#tt.mode=t}get rangeMode(){return this.#tt.mode}set rangeYFactor(t){this.core.range.yFactor(t)}set yOffset(t){this.#tt.offset=t}get yOffset(){return this.#tt.offset}set stateMachine(t){this.#ne=new StateMachine(t,this)}get stateMachine(){return this.#ne}get Scale(){return this}init(){this.#te=this.#se.viewport||this.#se}start(){const t="OffChart"==this.#Z.name?this.#Z.localRange:void 0;this.#tt=new yAxis(this,this,this.options.yAxisType,t),this.createGraph(),this.addOverlays([]),this.#tt.calcGradations(),this.draw(),this.eventsListen();const e=copyDeep(stateMachineConfig$5);e.context=this,this.stateMachine=e,this.stateMachine.start()}end(){this.stateMachine.destroy(),this.#Yt=null,this.#Kt.destroy(),this.#Yt.on("pointerdrag",this.onDrag),this.#Yt.on("wheel",this.onMouseWheel),this.#Yt.on("dblclick",this.resetScaleRange),this.off(`${this.#Z.ID}_mousemove`,this.onMouseMove),this.off(`${this.#Z.ID}_mouseout`,this.#fe.erase),this.off(STREAM_UPDATE,this.onStreamUpdate),this.off("chart_pan",this.onMouseMove),this.off("chart_panDone",this.onMouseMove)}eventsListen(){let t=this.#oe.viewport.scene.canvas;this.#Yt=new Input(t,{disableContextMenu:!1}),this.#Yt.setCursor("ns-resize"),this.#Yt.on("pointerdrag",throttle(this.onDrag,100,this)),this.#Yt.on("pointerdragend",this.onDragDone.bind(this)),this.#Yt.on("wheel",this.onMouseWheel.bind(this)),this.#Yt.on("dblclick",this.resetScaleRange.bind(this)),this.on(`${this.#Z.id}_mousemove`,this.onMouseMove.bind(this)),this.on(`${this.#Z.id}_mouseout`,this.#fe.erase.bind(this.#fe)),this.on(STREAM_UPDATE,this.#je.draw.bind(this.#je))}on(t,e,i){this.core.on(t,e,i)}off(t,e){this.core.off(t,e)}emit(t,e){this.core.emit(t,e)}onResize(t){this.setDimensions(t)}onMouseMove(t){this.#Vt=isArray(t)?t:[Math.floor(t.position.x),Math.floor(t.position.y)],this.#fe.draw(this.#Vt)}onDrag(t){this.#Vt=[Math.floor(t.position.x),Math.floor(t.position.y),t.dragstart.x,t.dragstart.y,t.movement.x,t.movement.y],this.#Vt,this.setScaleRange(this.#Vt[5]),this.render()}onDragDone(t){}onMouseWheel(t){t.domEvent.preventDefault();const e=-1*Math.sign(t.wheeldelta);this.setScaleRange(e),this.render()}onStreamUpdate(t){}onChartDrag(t){"manual"===this.#tt.mode&&(this.#tt.offset=this.#o.MainPane.cursorPos[5],this.parent.draw(this.range,!0),this.draw())}setHeight(t){this.#se.style.height=`${t}px`}setDimensions(t){const e=this.#se.getBoundingClientRect().width;this.#oe.setSize(e,t.h,e),this.setHeight(t.h),this.draw()}setScaleRange(t){"automatic"==this.#tt.mode&&(this.#tt.mode="manual"),this.#tt.zoom=t,this.parent.draw(this.range,!0),this.draw()}resetScaleRange(){this.#tt.mode="automatic",this.parent.draw(this.range,!0),this.draw()}setCursor(t){this.#se.style.cursor=t}yPos(t){return this.#tt.yPos(t)}yPosStream(t){return this.#tt.lastYData2Pixel(t)}yPos2Price(t){return this.#tt.yPos2Price(t)}nicePrice(t){let e=this.#tt.countDigits(t);return this.#tt.limitPrecision(e)}createGraph(){let t=copyDeep(defaultOverlays$3);this.graph=new graph(this,this.#te,t,!1),this.#fe=this.graph.overlays.get("cursor").instance,this.#me=this.graph.overlays.get("labels").instance,this.#pe=this.graph.overlays.get("overlay").instance,this.#je=this.graph.overlays.get("price").instance}addOverlays(t){for(let e of t);this.graph.addOverlays(Array.from(this.#qe))}render(){this.#oe.render()}draw(t=this.range,e=!0){this.#oe.draw(t,e),this.#Z.drawGrid()}resize(t=this.width,e=this.height){this.setDimensions({w:t,h:e})}}class Legends{#ve;#E;#Z;#o;#Yt;#Ze={width:18,height:18,fill:"#aaa"};#Qe;constructor(t,e){this.#ve=t,this.#E={},this.#Z=e,this.#o=e.core,this.eventsListen()}get list(){return this.#E}eventsListen(){this.moveEvent=new PointerEvent("pointermove",{bubbles:!0,cancelable:!0}),this.#Yt=new Input(this.#ve,{disableContextMenu:!1}),this.#Yt.on("pointermove",this.onMouseMove.bind(this))}onMouseMove(t){}onMouseClick(){}buildLegend(t){const e=this.#o.theme;const i=`${e.legend.text}; color: ${e.legend.colour}; text-align: left;`;let s="margin-right: 1em; white-space: nowrap;";const n=this.#ve;s+="chart"===t?.type?"font-size: 1.5em;":"font-size: 1.2em;";return`\n      <div slot="legend" id="${t.id}" class="legend" style="${i}">\n        <div>\n          <span slot="title" class="title" style="${s}">${t.title}</span>\n          <dl style="order: 1; display: inline; margin: 0 0 0 -1em;">${n.buildInputs(t)}</dl>\n        </div>\n        <div slot="controls" class="controls" style="order:2; float: right; margin: 0 0.5em 0; opacity:0" onmouseover='this.style.opacity=1' onmouseout='this.style.opacity=0'>${n.buildControls(t)}</div>\n      </div>\n    `}add(t){if(!isObject(t)||!("title"in t))return!1;t.id=uid(t?.id||"legend"),t.type=t?.type||"overlay",t.parent=this.#Z.ID;const e=this.buildLegend(t);this.#ve.insertAdjacentHTML("beforeend",e);const i=this.#ve.querySelector(`#${t.id}`);this.#E[t.id]={el:i,type:t.type,source:t?.source},this.#Qe=i.querySelectorAll(".control");for(let t of this.#Qe){let e=t.querySelector("svg");e.style.width=`${this.#Ze.width}px`,e.style.height=`${this.#Ze.height}px`,e.style.fill=`${this.#Ze.fill}`,t.addEventListener("click",this.onMouseClick.bind(this))}return t.id}remove(t){if(!(t in this.#E)||"chart"===this.#E[t].type)return!1;this.#E[t].el.remove(),delete this.#E[t];for(let t of this.#Qe)t.removeEventListener("click",this.onMouseClick);return!0}update(t,e){if(!isObject(e)||!(t in this.#E))return!1;let i=this.#E[t].source(e.pos);const s=this.#ve.buildInputs(i);this.#ve.querySelector(`#${t} dl`).innerHTML=s}}class VolumeBar{constructor(t,e){this.scene=t,this.ctx=this.scene.context,this.width=this.scene.width,this.cfg={...defaultTheme,...e}}draw(t){const e=this.ctx,i=t.raw[4]>=t.raw[1]?this.cfg.volume.UpColour:this.cfg.volume.DnColour;e.save(),e.strokeStyle=i,e.fillStyle=i,e.fillRect(Math.floor(t.x),Math.floor(t.z-t.h),Math.floor(t.w),Math.floor(t.h)),e.restore()}}class chartVolume extends Overlay{#Je;#ti;constructor(t,e=!1,i=!1,s,n,r){super(t,!1,!1,s,n,r),this.#Je=new VolumeBar(t.scene,s),this.theme.volume.Height=limit(s?.volume?.Height,0,100)||100}set position(t){this.target.setPosition(t[0],t[1])}draw(t=this.core.range){this.scene.clear();const e=t.data,i=this.scene.height,s=this.xAxis.smoothScrollOffset||0,n=this.xAxis.candleW,r=n>5?Math.ceil(.8*n):n,o={x:0+s-this.xAxis.candleW,w:r,z:i},a=Math.floor(i*this.theme.volume.Height/100);let h,l=this.core.rangeScrollOffset,c=t.indexStart-l,d=t.Length+2*l,u=d,g=c,m=0;for(;u--;)h=t.value(g),null!==h[4]&&(m=h[5]>m?h[5]:m),g++;for(;d--;)h=t.value(c),o.x=bRound(this.xAxis.xPos(h[0])-r/2),null!==h[4]&&(o.h=a-a*((m-h[5])/m),o.raw=e[c],this.#Je.draw(o)),c++}}class Candle{areaCoordinates=[];constructor(t,e){this.scene=t,this.ctx=this.scene.context,this.width=this.scene.width,this.cfg={...defaultTheme,...e}}draw(t){const e=this.ctx,i=t.raw[4]>=t.raw[1],s=i?this.cfg.candle.UpBodyColour:this.cfg.candle.DnBodyColour,n=i?this.cfg.candle.UpWickColour:this.cfg.candle.DnWickColour;switch(this.cfg.candle.Type){case CandleType.CANDLE_SOLID:this.fill=!0;break;case CandleType.CANDLE_HOLLOW:case CandleType.OHLC:this.fill=!1;break;case CandleType.CANDLE_UP_HOLLOW:this.fill=!i;break;case CandleType.CANDLE_DOWN_HOLLOW:this.fill=i}let r=Math.max(t.w-1,1);r=r>5?Math.ceil(.8*r):r;let o=Math.max(Math.floor(.5*r),1),a=Math.abs(t.o-t.c),h=t.c===t.o?1:2,l=t.x,c=Math.floor(l)-.5;if(e.save(),e.strokeStyle=n,e.beginPath(),e.moveTo(c,Math.floor(t.h)),this.cfg.candle.Type===CandleType.OHLC?e.lineTo(c,Math.floor(t.l)):i?(e.lineTo(c,Math.floor(t.c)),e.moveTo(c,Math.floor(t.o))):(e.lineTo(c,Math.floor(t.o)),e.moveTo(c,Math.floor(t.c))),e.lineTo(c,Math.floor(t.l)),e.stroke(),t.w>1.5&&this.fill){e.fillStyle=s;let n=i?1:-1;e.rect(Math.floor(l-o),t.c,Math.floor(2*o),n*Math.max(a,h)),e.fill(),e.stroke()}else if(t.w>1.5&&!this.fill&&this.cfg.candle.Type!==CandleType.OHLC){let s=i?1:-1;e.rect(Math.floor(l-o),t.c,Math.floor(2*o),s*Math.max(a,h)),e.stroke()}else this.cfg.candle.Type===CandleType.OHLC?(e.beginPath(),e.moveTo(c-o,t.o),e.lineTo(c,t.o),e.moveTo(c,t.c),e.lineTo(c+o,t.c),e.stroke()):(e.strokeStyle=s,e.beginPath(),e.moveTo(c,Math.floor(Math.min(t.o,t.c))),e.lineTo(c,Math.floor(Math.max(t.o,t.c))+(t.o===t.c?1:0)),e.stroke());e.restore()}body(t){}area(t){this.areaCoordinates.push(t)}areaRender(){const t=this.areaCoordinates;if(!isArray(t)||0==t.length)return;let e,i=this.ctx,s=this.cfg.candle;Math.max(t[0].w-1,1),t[0].x;let n=[t[0].x,t[0].h];i.save(),i.strokeStyle=s.AreaLineColour||s.UpBodyColour||s.DnBodyColour,i.lineWidth=1,i.beginPath(),i.moveTo(t[0].x,t[0].h);let r=0;for(;r<t.length;)i.lineTo(t[r].x,t[r].h),r++;if("area"==s?.Type){if(e=i.createLinearGradient(0,0,0,this.scene.height),isArray(s.AreaFillColour))for(let[t,i]of s.AreaFillColour.entries())e.addColorStop(t,i);else e=isString$1()?s.AreaFillColour:s.UpBodyColour||s.DnBodyColour;i.stroke(),i.lineTo(t[r-1].x,this.scene.height),i.lineTo(n[0],this.scene.height),i.fillStyle=e,i.closePath(),i.fill()}else i.stroke();i.restore(),t.length=0}}class chartCandles extends Overlay{#_;constructor(t,e=!1,i=!1,s,n){super(t,!1,!1,s,n),this.#_=new Candle(t.scene,s)}set position(t){this.target.setPosition(t[0],t[1])}draw(t=this.core.range){let e;this.scene.clear();let i=this.theme.candle.Type;switch(i){case CandleType.AREA:case CandleType.LINE:e=t=>{this.#_.area({...t})};break;default:e=t=>{this.#_.draw(t)}}const s={x:(this.xAxis.smoothScrollOffset||0)-this.xAxis.candleW,w:this.xAxis.candleW};let n,r=this.core.rangeScrollOffset,o=t.indexStart-r,a=t.Length+2*r;for(this.core.stream&&(this.core.stream.lastPriceMax=t.valueMax,this.core.stream.lastPriceMin=t.valueMin);a;){if(n=t.value(o),s.x=this.xAxis.xPos(n[0]),n?.[7]){this.core.stream.lastXPos=s.x,this.core.stream.lastYPos={o:s.o,h:s.h,l:s.l,c:s.c};break}null!==n[4]&&(s.o=this.yAxis.yPos(n[1]),s.h=this.yAxis.yPos(n[2]),s.l=this.yAxis.yPos(n[3]),s.c=this.yAxis.yPos(n[4]),s.raw=n,e(s)),o++,a--}i!==CandleType.AREA&&i!==CandleType.LINE||this.#_.areaRender()}}class chartStreamCandle extends Overlay{#_;constructor(t,e=!1,i=!1,s,n,r){super(t,!1,!1,s,n,r),this.#_=new Candle(t.scene,s),this.theme.priceLineStyle=this.theme?.priceLineStyle||PriceLineStyle}set position(t){this.setPosition(t[0],t[1])}setPosition(t,e){void 0!==this.core.stream&&(this.target.setPosition(t,e),this.core.stream.lastScrollPos=this.core.scrollPos)}draw(){if(void 0===this.core.stream||!isArray(this.chart.streamCandle))return;this.scene.clear();const t=this.core.range,e=this.chart.streamCandle,i=this.theme.candle.Type===CandleType.AREA||this.theme.candle.Type===CandleType.LINE?t=>{this.areaRender(t)}:t=>{this.#_.draw(t)};this.xAxis.smoothScrollOffset;const s={x:this.core.stream.lastXPos,w:this.xAxis.candleW};s.o=this.yAxis.yPos(e[1]),s.h=this.yAxis.yPos(e[2]),s.l=this.yAxis.yPos(e[3]),s.c=this.yAxis.yPos(e[4]),s.raw=e,t.inRenderRange(e[0])&&i(s),e[4]>=e[1]?this.theme.priceLineStyle.strokeStyle=this.core.theme.candle.UpBodyColour:this.theme.priceLineStyle.strokeStyle=this.core.theme.candle.DnBodyColour,renderHorizontalLine(this.scene.context,s.c,0,this.target.width,this.theme.priceLineStyle)}areaRender(t){const e=this.core.range,i=e.value(e.data.length-2);if(null===i)return;const s={x:this.xAxis.xPos(i[0]),o:this.yAxis.yPos(i[1]),h:this.yAxis.yPos(i[2]),l:this.yAxis.yPos(i[3]),c:this.yAxis.yPos(i[4])},n=this.scene.context,r=this.theme,o=r.candle.UpBodyColour||r.candle.DnBodyColour;let a;if(Math.max(t.w-1,1),t.x,n.save(),n.fillStyle=o,n.strokeStyle=o,n.lineWidth=1,n.beginPath(),n.moveTo(t.x,t.c),n.lineTo(s.x,s.h),r.candle.Type===CandleType.AREA){if(a=n.createLinearGradient(0,0,0,this.scene.height),isArray(r.candle.AreaFillColour))for(let[t,e]of r.candle.AreaFillColour.entries())a.addColorStop(t,e);else a=isString()?r.candle.AreaFillColour:r.candle.UpBodyColour||r.candle.DnBodyColour;n.stroke(),n.lineTo(s.x,this.scene.height),n.lineTo(t.x,this.scene.height),n.fillStyle=a,n.closePath(),n.fill()}else n.stroke();n.restore()}}const watermark={FONTSIZE:50,FONTWEIGHT:"bold",FONTFAMILY:GlobalStyle.FONTFAMILY,COLOUR:"#181818"};class chartWatermark extends Overlay{constructor(t,e=!1,i=!1,s,n,r){super(t,e,i,s,n,r),this.params.content=r?.content||""}set position(t){this.target.setPosition(0,0)}draw(){let t=isString$1(this.config?.watermark?.text),e=isString$1(this.config?.watermark?.imgURL);if(!t&&!e)return;this.scene.clear();const i=this.scene.context;i.save(),t?this.renderText():e&&this.renderImage(),i.restore()}renderText(){const t=this.core.config?.watermark?.fontSize,e=this.core.config?.watermark?.fontWeight,i=this.core.config?.watermark?.fontFamily,s=this.core.config?.watermark?.textColour,n={fontSize:t||watermark.FONTSIZE,fontWeight:e||watermark.FONTWEIGHT,fontFamily:i||watermark.FONTFAMILY,txtCol:s||watermark.COLOUR},r=this.config.watermark.text,o=this.scene.context;o.font=createFont(n?.fontSize,n?.fontWeight,n?.fontFamily),o.textBaseline="top",o.fillStyle=n.txtCol;const a=getTextRectHeight(n),h=getTextRectWidth(o,r,n),l=(this.scene.width-h)/2,c=(this.scene.height-a)/2;o.fillText(r,l,c)}renderImage(){this.scene.context}}var stateMachineConfig$4={id:"chart",initial:"idle",context:{},states:{idle:{onEnter(t){this.context.origin.setCursor("crosshair")},onExit(t){},on:{xAxis_scale:{target:"xAxis_scale",action(t){}},chart_yAxisRedraw:{target:"chart_yAxisRedraw",action(t){}},chart_tool:{target:"chart_tool",action(t){}},tool_activated:{target:"tool_activated",action(t){this.context.origin.setCursor("default")}}}},xAxis_scale:{onEnter(t){},onExit(t){},on:{Idle:{target:"idle",action(t){}}}},chart_yAxisRedraw:{onEnter(t){},onExit(t){},on:{always:{target:"idle",condition:"yAxisRedraw",action(t){this.context.origin.drawGrid()}}}},tool_activated:{onEnter(t){},onExit(t){},on:{tool_targetSelected:{target:"idle",condition:"toolSelectedThis",action(t){console.log("tool_targetSelected:",t)}}}}},guards:{priceMaxMin:()=>!0,toolSelectedThis(t,e){return this.eventData===this.context},yAxisRedraw:()=>!0,zoomDone:()=>!0}};const defaultOverlays$2=[["watermark",{class:chartWatermark,fixed:!0,required:!0,params:{content:null}}],["grid",{class:chartGrid,fixed:!0,required:!0,params:{axes:"y"}}],["volume",{class:chartVolume,fixed:!1,required:!0,params:{maxVolumeH:VolumeStyle.ONCHART_VOLUME_HEIGHT}}],["candles",{class:chartCandles,fixed:!1,required:!0}],["stream",{class:chartStreamCandle,fixed:!1,required:!0}],["cursor",{class:chartCursor,fixed:!0,required:!0}]];class OnChart extends Chart{#at;#ei=5;#ii=2.5;#ze;#si;#ni;#Le;#ri;#Ne;constructor(t,e){e.type="onChart",super(t,e),this.#at=t.onChart,this.init(e)}set state(t){this.core.setState(t)}get state(){return this.core.getState()}get data(){return this.core.chartData}get streamCandle(){return this.#Ne}get onChart(){return this.#at}set priceDigits(t){this.setYAxisDigits(t)}get priceDigits(){return this.#ze||PRICEDIGITS}get indicators(){return this.overlays}init(t){let e={id:"chart",title:this.title,type:"chart",source:this.legendInputs.bind(this)};this.legend=new Legends(this.elLegend,this),this.legend.add(e);const i={...t};i.parent=this,i.chart=this,i.elScale=this.elScale,i.legends=this.legend,i.yAxisType="default",this.scale=new ScaleBar(this.core,i),this.log(`${this.name} instantiated`)}start(){super.start(stateMachineConfig$4),this.eventsListen(),this.addOverlays(this.core.onChart),isObject(this.Stream)&&this.Stream}end(){this.off("chart_yAxisRedraw",this.onYAxisRedraw),super.end()}eventsListen(){super.eventsListen(),this.on("chart_yAxisRedraw",this.onYAxisRedraw.bind(this))}onStreamUpdate(t){this.#Ne=t,this.#ri.draw(),this.#Le.setPosition(this.core.stream.lastScrollPos,0),this.graph.render(),this.updateLegends(this.cursorPos,t)}onYAxisRedraw(){this.scale.draw(),this.draw(this.range,!0)}setDimensions(t){super.setDimensions(t),this.draw(this.range,!0)}setYAxisDigits(t){this.#ze=isNumber(t)&&t>=3?parseInt(t):PRICEDIGITS}getPriceDigits(){return this.#ze}loadData(t){}updateData(t){}createGraph(){let t=new Map(copyDeep(defaultOverlays$2));if(t.has("volume")){const e=t.get("volume");e.params.maxVolumeH=this.theme?.volume?.Height||VolumeStyle.ONCHART_VOLUME_HEIGHT,t.set("volume",e)}t=Array.from(t),this.graph=new graph(this,this.elViewport,t,!1),this.#Le=this.graph.overlays.get("stream").layer,this.#ri=this.graph.overlays.get("stream").instance}addOverlays(t){for(let e of t){const t={fixed:!1,required:!1};e.type in this.core.indicators&&(t.class=this.core.indicators[e.type].ind,t.params={overlay:e},this.overlays.set(e.name,t))}const e=this.graph.addOverlays(Array.from(this.overlays));for(let t of e)t[0]||this.overlays.delete(t[0])}refresh(){this.scale.draw(),this.draw(this.range,!0)}time2XPos(t){return this.time.xPos(t)}price2YPos(t){return this.scale.yPos(t)}setPriceVolumePrecision(t){!isNumber(t)||t<0?this.warning("setPriceVolumePrecision","pricePrecision","pricePrecision must be a number and greater than zero!!!"):this.#si=t}setPriceVolumePrecision(t){!isNumber(t)||t<0?logWarn("setPriceVolumePrecision","volumePrecision","volumePrecision must be a number and greater than zero!!!"):this.#ni=t}legendInputs(t=this.cursorPos,e){t=this.cursorPos;let i={},s=[],n=this.time.xPos2Index(t[0]-this.core.scrollPos);n=limit(n,0,this.range.data.length-1);let r=this.range.data[n];return s=r[4]>=r[1]?new Array(5).fill(this.theme.candle.UpWickColour):new Array(5).fill(this.theme.candle.DnWickColour),i.O=this.scale.nicePrice(r[1]),i.H=this.scale.nicePrice(r[2]),i.L=this.scale.nicePrice(r[3]),i.C=this.scale.nicePrice(r[4]),i.V=this.scale.nicePrice(r[5]),{inputs:i,colours:s,labels:[!0,!0,!0,!0,!0]}}}var stateMachineConfig$3={id:"offChart",initial:"idle",context:{},states:{idle:{onEnter(t){this.context.origin.setCursor("crosshair")},onExit(t){},on:{chart_tool:{target:"chart_tool",action(t){}},xAxis_scale:{target:"xAxis_scale",action(t){}},offChart_mouseDown:{target:"offChart_mouseDown",action(t){}},offChart_mouseUp:{target:"offChart_mouseUp",action(t){}},tool_activated:{target:"tool_activated",action(t){this.context.origin.setCursor("default")}}}},xAxis_scale:{onEnter(t){},onExit(t){},on:{Idle:{target:"idle",action(t){}}}},offChart_mouseDown:{onEnter(t){},onExit(t){},on:{Idle:{target:"idle",action(t){}}}},offChart_mouseUp:{onEnter(t){},onExit(t){},on:{Idle:{target:"idle",action(t){}}}},tool_activated:{onEnter(t){},onExit(t){},on:{tool_targetSelected:{target:"idle",condition:"toolSelectedThis",action(t){console.log("tool_targetSelected:",t)}}}}},guards:{zoomDone:()=>!0,toolSelectedThis(t,e){return this.eventData===this.context}}};const defaultOverlays$1=[["grid",{class:chartGrid,fixed:!0,required:!0,params:{axes:"y"}}],["cursor",{class:chartCursor,fixed:!0,required:!0}]];class OffChart extends Chart{#z;#oi;#ai;#hi;#ct;#li;#Le;#ci;#Oe=new Map;#di;#Ne;#ui={valueMax:100,valueMin:0,valueDiff:100};#Yt;constructor(t,e){e.type="offChart",super(t,e),this.#z=this.options.offChartID||uid("TX_OC_"),this.#ct=e.offChart,this.overlays.set(e.offChart.name,e.offChart),this.init(e)}get elOffChart(){return this.element}get widgets(){return this.core.WidgetsG}get offChartID(){return this.#oi}get localRange(){return this.#ui}get data(){}get Divider(){return this.#li}init(t){const e={...t};e.parent=this,e.chart=this,e.elScale=this.elScale,this.#ai=this.core.indicators[this.#ct.type].ind,e.yAxisType=this.#ai.scale,this.scale=new ScaleBar(this.core,e),this.time=this.core.Timeline}start(t){this.#oi=t,super.start(stateMachineConfig$3),this.eventsListen();const e={offChart:this};this.#li=this.widgets.insert("Divider",e),this.#li.start();let i=this.#di,s={id:this.options.offChart.type,title:this.options.offChart.name,type:this.options.offChart.type,source:i.legendInputs.bind(i)};this.legend=new Legends(this.elLegend,this),this.legend.add(s)}end(){this.#li.end(),super.end()}eventsListen(){super.eventsListen()}onStreamUpdate(t){this.#Ne=t,this.graph.render(),this.updateLegends()}setDimensions(t){super.setDimensions(t),this.draw(void 0,!0)}createGraph(){const t=[this.#ct.name,{class:this.#ai,fixed:!1,required:!1,params:{overlay:this.#ct}}],e=copyDeep(defaultOverlays$1);e.splice(1,0,t),this.graph=new graph(this,this.elViewport,e),this.#di=this.graph.overlays.get(this.#ct.name).instance}refresh(){this.scale.draw(),this.draw()}}var stateMachineConfig$2={id:"main",initial:"idle",context:{},states:{idle:{onEnter(t){},onExit(t){},on:{chart_pan:{target:"chart_pan",action(t){}},setRange:{target:"setRange",action(t){}},chart_scrollTo:{target:"chart_scrollTo",action(t){}},addIndicator:{target:"addIndicator",action(t){}},divider_pointerdrag:{target:"divider_pointerdrag",action(t){}},global_resize:{target:"global_resize",action(t){}}}},chart_pan:{onEnter(t){this.context.origin.setCursor("grab")},onExit(t){},on:{chart_pan:{target:"chart_pan",action(t){this.context.origin.updateRange(t),this.context.origin.setCursor("grab")}},chart_panDone:{target:"idle",action(t){this.context.origin.updateRange(t),this.context.origin.setCursor("default")}}}},setRange:{onEnter(t){},onExit(t){},on:{always:{target:"idle",condition:"zoomDone",action(t){this.context.origin.zoomRange(t)}}}},chart_scrollTo:{onEnter(t){},onExit(t){},on:{always:{target:"idle",action(t){this.context.origin.updateRange(t)}}}},addIndicator:{onEnter(t){this.context.origin.addIndicator(t)},onExit(t){},on:{addIndicatorDone:{target:"idle",action(t){}}}},divider_mousedown:{onEnter(t){this.context.divider=t},onExit(t){},on:{main_mousemove:{target:"divider_mousemove",action(t){console.log(`${this.id}: transition from "${this.state}" to "divider_mousemove"`)}}}},divider_mousemove:{onEnter(t){console.log(`${this.id}: state: "${this.state}" - onEnter`);let e=this.context.divider;this.context.pair=this.context.origin.resizeRowPair(e,t)},onExit(t){},on:{main_mousemove:{target:"divider_mousemove",action(t){}},main_mouseup:{target:"idle",action(t){this.actions.removeProperty.call(this)}},divider_mouseup:{target:"idle",action(t){this.actions.removeProperty.call(this),console.log(`${this.id}: transition from "${this.state}" to "ilde"`)}}}},divider_pointerdrag:{onEnter(t){const e=[t.e.dragstart.x,t.e.dragstart.y,t.e.dragend.x,t.e.dragend.y,t.e.movement.x,t.e.movement.y];this.context.pair=this.context.origin.resizeRowPair(t,e)},onExit(t){},on:{divider_pointerdrag:{target:"divider_pointerdrag",action(t){}},divider_pointerdragend:{target:"idle",action(t){this.actions.removeProperty.call(this)}}}},global_resize:{onEnter(t){this.context.origin.setDimensions()},onExit(t){},on:{always:{target:"idle",condition:"resizeDone",action(t){}}}}},guards:{zoomDone:()=>!0,resizeDone:()=>!0},actions:{removeProperty(){let t=this.context.pair.active,e=this.context.pair.prev;t.element.style.removeProperty("user-select"),e.element.style.removeProperty("user-select")}}};const defaultOverlays=[["grid",{class:chartGrid,fixed:!1,required:!0,params:{axes:"x"}}]];class MainPane{#rt="MainPane";#ot="Main";#ie;#Z;#o;#ne;#gi;#mi;#pi;#fi;#yi;#Se;#xi=[];#vi=[];#wi;#Jt;#te;#Si;#oe;#Kt;#be;#Ci;#Mi=new Map;#Ti;#Me;#Ai;#bi=30;#Li=120;#Ei=50;#Vt=[0,0];#Di={active:!1,start:[0,0],prev:[0,0],delta:[0,0]};#Oi;#Ri;#ke;#Yt;constructor(t,e){this.#o=t,this.#ie=e,this.#Z=t,this.#mi=this.#o.elMain,this.#gi=this.#o.elYAxis,this.init(e)}log(t){this.#o.log(t)}info(t){this.#o.info(t)}warning(t){this.#o.warn(t)}error(t){this.#o.error(t)}get id(){return`${this.#o.id}.${this.#rt}`}get name(){return this.#rt}get shortName(){return this.#ot}get core(){return this.#o}get chart(){return this.#Ti}get time(){return this.#Me}get offCharts(){return this.#Mi}get options(){return this.#ie}get element(){return this.#mi}get width(){return this.#mi.getBoundingClientRect().width}get height(){return this.#mi.getBoundingClientRect().height}get chartW(){return this.#yi.getBoundingClientRect().width}get chartH(){return this.#yi.getBoundingClientRect().height}get rowsW(){return this.#pi.getBoundingClientRect().width}get rowsH(){return this.#pi.getBoundingClientRect().height}get rowMinH(){return this.#Ei}set rowMinH(t){isNumber(t)&&(this.#Ei=Math.abs(t))}get pos(){return this.dimensions}get dimensions(){return DOM.elementDimPos(this.#mi)}get range(){return this.#o.range}get cursorPos(){return this.#Vt}get candleW(){return this.#Me.candleW}get theme(){return this.#o.theme}get config(){return this.#o.config}get buffer(){return this.#Oi}get bufferPx(){return this.getBufferPx()}get scrollPos(){return this.#o.scrollPos}set stateMachine(t){this.#ne=new StateMachine(t,this)}get stateMachine(){return this.#ne}get graph(){return this.#oe}get indicators(){return{onchart:this.#Ti.indicators,offchart:this.#Mi}}get elements(){return{elTarget:this.#yi,elTime:this.#fi,elRows:this.#pi,elChart:this.#yi,elOffCharts:this.#xi,elScale:this.#Se}}init(t){this.#o,this.#Ri=this.#o.indicators,this.#pi=this.#mi.rows,this.#fi=this.#mi.time,this.#yi=this.#mi.rows.onChart,this.#wi=this.#mi.rows.grid,this.#te=this.#mi.viewport,this.#Se=this.#o.elBody.scale,t.name="Chart",t.shortName="Chart",t.parent=this,t.chartData=this.#o.chartData,t.onChart=this.#o.onChart,t.offChart=this.#o.offChart,t.rangeLimit=this.#o.rangeLimit,t.settings=this.#o.settings,t.elements={...t.elements,elTarget:this.#yi,elTime:this.#fi,elRows:this.#pi,elChart:this.#yi,elOffCharts:this.#xi,elScale:this.#Se},this.#Me=new Timeline(this.#o,t),this.#Ti=new OnChart(this.#o,t),this.registerOffCharts(t),this.#Oi=isNumber(this.config.buffer)?this.config.buffer:5,this.#Ei=isNumber(this.config.rowMinH)?this.config.rowMinH:50,this.#bi=isNumber(this.config.offChartDefaultH)?this.config.offChartDefaultH:30,this.rowsOldH=this.rowsH,this.log(`${this.#rt} instantiated`)}start(){let t=0;this.#mi.start(this.theme),this.#Me.start(),this.#Ti.start(),this.#Mi.forEach(((e,i)=>{e.start(t++)})),this.rowsOldH=this.rowsH,this.createGraph(),this.draw(this.range,!0),renderLoop.init({graphs:[this.#oe],range:this.range}),renderLoop.start(),renderLoop.queueFrame(this.range,[this.#oe],!1),this.eventsListen(),stateMachineConfig$2.id=this.id,this.stateMachine=stateMachineConfig$2,this.stateMachine.start()}end(){this.stateMachine.destroy(),this.#Me.end(),this.#Ti.end(),this.#Mi.forEach(((t,e)=>{t.end()})),this.#Kt.destroy(),this.#Yt.off("wheel",this.onMouseWheel),this.#Yt.off("pointerdrag",this.onChartDrag),this.#Yt.off("pointerdragend",this.onChartDragDone),this.#Yt.off("pointermove",this.onMouseMove),this.#Yt.off("pointerenter",this.onMouseEnter),this.#Yt.off("pointerout",this.onMouseOut),this.#Yt.off("keydown",this.onChartKeyDown),this.#Yt.off("keyup",this.onChartKeyDown),this.#Yt=null,this.off(STREAM_NEWVALUE,this.onNewStreamValue),this.off("setRange",this.draw)}eventsListen(){this.#pi.tabIndex=0,this.#pi.focus(),this.#Yt=new Input(this.#pi,{disableContextMenu:!1}),this.#Yt.on("keydown",this.onChartKeyDown.bind(this)),this.#Yt.on("keyup",this.onChartKeyUp.bind(this)),this.#Yt.on("wheel",this.onMouseWheel.bind(this)),this.#Yt.on("pointermove",this.onMouseMove.bind(this)),this.#Yt.on("pointerenter",this.onMouseEnter.bind(this)),this.#Yt.on("pointerout",this.onMouseOut.bind(this)),this.on(STREAM_FIRSTVALUE,this.onFirstStreamValue.bind(this)),this.on(STREAM_NEWVALUE,this.onNewStreamValue.bind(this)),this.on("setRange",this.draw.bind(this)),this.on("scrollUpdate",this.draw.bind(this)),this.on("chart_render",this.draw.bind(this))}on(t,e,i){this.#o.on(t,e,i)}off(t,e){this.#o.off(t,e)}emit(t,e){this.#o.emit(t,e)}onMouseWheel(t){t.domEvent.preventDefault();const e=-1*Math.sign(t.wheeldelta),i=this.range,s=i.indexStart-Math.floor(.05*e*i.Length),n=i.indexEnd+Math.ceil(.05*e*i.Length);this.#o.setRange(s,n),this.draw(this.range,!0)}onMouseMove(t){this.#Vt=[t.position.x,t.position.y,t.dragstart.x,t.dragstart.y,t.movement.x,t.movement.y],this.core.Chart.graph.overlays.list.get("cursor").layer.visible=!0;for(let[t,e]of this.offCharts)e.graph.overlays.list.get("cursor").layer.visible=!0;this.emit("main_mousemove",this.#Vt)}onMouseEnter(t){this.core.Timeline.showCursorTime(),this.core.Chart.graph.overlays.list.get("cursor").layer.visible=!0,this.core.Chart.graph.render();for(let[t,e]of this.offCharts)e.graph.overlays.list.get("cursor").layer.visible=!0,e.graph.render()}onMouseOut(t){this.core.Timeline.hideCursorTime(),this.onPointerActive(!1),this.core.Chart.graph.overlays.list.get("cursor").layer.visible=!1,this.core.Chart.graph.render();for(let[t,e]of this.offCharts)e.graph.overlays.list.get("cursor").layer.visible=!1,e.graph.render();this.draw()}onChartDrag(t){const e=this.#Di;e.active?(e.delta=[t.position.x-e.prev[0],t.position.y-e.prev[1]],e.prev=[t.position.x,t.position.y]):(e.active=!0,e.start=[t.dragstart.x,t.dragstart.y],e.prev=e.start,e.delta=[t.movement.x,t.movement.y]),this.#Vt=[t.position.x,t.position.y,...e.start,...e.delta],this.emit("chart_pan",this.#Vt)}onChartDragDone(t){const e=this.#Di;e.active=!1,e.delta=[0,0],this.#Vt=[...e.prev,...e.start,...e.delta],this.emit("chart_panDone",this.#Vt)}onChartKeyDown(t){let e=this.candleW>1?this.candleW:1;switch(t.key){case"ArrowLeft":this.emit("chart_pan",[0,null,e,null,-1*e,null]);break;case"ArrowRight":this.emit("chart_pan",[e,null,0,null,e,null])}}onChartKeyUp(t){let e=this.candleW>1?this.candleW:1;switch(t.key){case"ArrowLeft":this.emit("chart_panDone",[0,null,e,null,-1*e,null]);break;case"ArrowRight":this.emit("chart_panDone",[e,null,0,null,e,null])}}onFirstStreamValue(t){this.chart.scale.xAxis.calcXAxisGrads(this.range),this.draw(this.range,!0)}onNewStreamValue(t){}onPointerActive(t){t&&(t.cursorActive=!0,t.scale.layerCursor.visible=!0),t!==this.chart&&(this.chart.cursorActive=!1,this.chart.scale.layerCursor.visible=!1,this.chart.scale.layerCursor.erase()),this.#Mi.forEach(((e,i)=>{t!==e&&(e.cursorActive=!1,e.scale.layerCursor.visible=!1,e.scale.layerCursor.erase())}))}mount(t){this.#gi.innerHTML=this.scaleNode(CLASS_CHART),this.#gi.querySelector(`.${CLASS_CHART}`).style.height="100%",this.#gi.querySelector(`.${CLASS_CHART} tradex-scale`).style.height="100%"}setWidth(t){}setHeight(t){}setDimensions(){this.#pi.previousDimensions();let t=this.#pi.heightDeltaR,e=Math.round(this.chartH*t),i=this.rowsW,s=this.rowsH,n=Math.round(i*(.01*(100+this.#Oi))),r={resizeH:t,mainH:this.element.height,mainW:this.element.width,rowsH:this.rowsH,rowsW:this.rowsW};0==this.#Mi.size&&e!=this.#pi.height&&(e=this.#pi.height),this.#o.scrollPos=-1,this.#Me.setDimensions({w:i}),this.#oe.setSize(i,s,n),this.#Ti.setDimensions({w:i,h:e}),this.#Mi.forEach(((s,n)=>{e=Math.round(s.viewport.height*t),s.setDimensions({w:i,h:e}),s.Divider.setDividerPos()})),this.rowsOldH=this.rowsH,this.draw(this.range,!0),this.emit("rowsResize",r)}getBufferPx(){let t=Math.round(this.width*this.buffer/100);return t-t%this.candleW}setCursor(t){this.element.style.cursor=t}registerOffCharts(t){if(0===this.#o.offChart.length)return;for(const[t,e]of this.#o.offChart.entries())e.type in this.core.indicators||(this.#o.log(`offChart indicator ${this.#o.offChart.type} not added: not supported.`),this.#o.offChart.splice(t,1));let e=this.#bi*this.#o.offChart.length,i=e/Math.log10(2*e)/100,s=Math.round(this.rowsH*i);t.offChartsH=i,1===this.#o.offChart.length?(t.rowH=Math.round(this.rowsH*this.#bi/100),t.chartH=this.rowsH-t.rowH):(t.rowH=Math.round(s/this.#Mi.size),t.chartH=this.rowsH-s,t.height=t.rowH),t.chartH,this.rowsH,this.#yi.style.height=`${t.chartH}px`,this.#Ti.scale.element.style.height=`${t.chartH}px`;for(let e of this.#o.offChart)t.rowY=t.chartH,this.addOffChart(e,t),t.rowY=t.chartH+t.rowH}addOffChart(t,e){let i,s,n,r;this.#pi.insertAdjacentHTML("beforeend",this.#mi.rowNode(t.type,this.#o)),i=this.#pi.lastElementChild,this.#xi.push(i),s=this.#pi.offChartSlot.assignedElements().slice(-1)[0],s.style.height=`${e.rowH}px`,s.style.width="100%",this.#gi.insertAdjacentHTML("beforeend",this.scaleNode(t.type)),n=this.#gi.lastElementChild,this.#vi.push(n),r=this.#gi.offChartSlot.assignedElements().slice(-1)[0],r.style.height=`${e.rowH}px`,r.style.width="100%",e.elements.elTarget=s,e.elements.elScale=r,e.offChart=t,e.name="OffChart",e.shortName="offChart";let o=new OffChart(this.#o,e);this.#Mi.set(o.id,o),this.emit("addOffChart",o)}addIndicator(t){const e=this.#Ri[t].ind;console.log("indicator:",e)}scaleNode(t){return`\n    <div slot="offchart" class="viewport ${t}" style="$${STYLE_ROW+` width: 100%; border-top: 1px solid ${this.theme.chart.BorderColour};`}"></div>\n  `}createGraph(){let t=copyDeep(defaultOverlays);this.#oe=new graph(this,this.#te,t)}draw(t=this.range,e=!1){const i=[this.#oe,this.#Me,this.#Ti];this.time.xAxis.doCalcXAxisGrads(t),this.#Mi.forEach(((t,e)=>{i.push(t)})),renderLoop.queueFrame(this.range,i,e)}updateRange(t){this.#o.updateRange(t)}zoomRange(){this.draw(this.range,!0)}resizeRowPair(t,e){let i=t.offChart,s=i.id,n=[...this.#Mi.keys()],r=n.indexOf(s),o=0==r?this.#Ti:this.#Mi.get(n[r]),a=i.height-e[5]-1,h=o.height+e[5];return a>=this.#Ei&&h>=this.#Ei&&(t.offChart.Divider.updateDividerPos(e),i.setDimensions({w:void 0,h:a}),o.setDimensions({w:void 0,h:h})),i.element.style.userSelect="none",o.element.style.userSelect="none",{active:i,prev:o}}}const camera='<svg width="46.08" height="46.08" viewBox="-51.2 -51.2 614.4 614.4" ><path d="M471.993 112h-89.2l-16.242-46.75a32.023 32.023 0 00-30.229-21.5H175.241a31.991 31.991 0 00-30.294 21.691L129.1 112H40a24.027 24.027 0 00-24 24v312a24.027 24.027 0 0024 24h431.993a24.027 24.027 0 0024-24V136a24.027 24.027 0 00-24-24zm-8 328H48.007V144h104.01l23.224-68.25h161.081l23.71 68.25h103.961z" class="ci-primary"></path><path d="M256 168a114 114 0 10114 114 114.13 114.13 0 00-114-114zm0 196a82 82 0 1182-82 82.093 82.093 0 01-82 82z"></path></svg>',chart='<svg width="46.08" height="46.08" viewBox="-51.2 -51.2 614.4 614.4"><path d="M376 160v32h65.372L252 381.373l-72-72L76.686 412.686l22.628 22.628L180 354.627l72 72 212-211.999V280h32V160H376z"></path><path d="M48 104H16v392h480v-32H48V104z"></path></svg>',clock='<svg width="46.08" height="46.08" viewBox="-51.2 -51.2 614.4 614.4"><path d="M271.514 95.5h-32v178.111l115.613 54.948 13.737-28.902-97.35-46.268V95.5z"></path><path d="M256 16C123.452 16 16 123.452 16 256s107.452 240 240 240 240-107.452 240-240S388.548 16 256 16zm0 448c-114.875 0-208-93.125-208-208S141.125 48 256 48s208 93.125 208 208-93.125 208-208 208z"></path></svg>',config='<svg width="46.08" height="46.08" viewBox="-51.2 -51.2 614.4 614.4"><path d="M245.151 168a88 88 0 1088 88 88.1 88.1 0 00-88-88zm0 144a56 56 0 1156-56 56.063 56.063 0 01-56 56z"></path><path d="M464.7 322.319l-31.77-26.153a193.081 193.081 0 000-80.332l31.77-26.153a19.941 19.941 0 004.606-25.439l-32.612-56.483a19.936 19.936 0 00-24.337-8.73l-38.561 14.447a192.038 192.038 0 00-69.54-40.192l-6.766-40.571A19.936 19.936 0 00277.762 16H212.54a19.937 19.937 0 00-19.728 16.712l-6.762 40.572a192.03 192.03 0 00-69.54 40.192L77.945 99.027a19.937 19.937 0 00-24.334 8.731L21 164.245a19.94 19.94 0 004.61 25.438l31.767 26.151a193.081 193.081 0 000 80.332l-31.77 26.153A19.942 19.942 0 0021 347.758l32.612 56.483a19.937 19.937 0 0024.337 8.73l38.562-14.447a192.03 192.03 0 0069.54 40.192l6.762 40.571A19.937 19.937 0 00212.54 496h65.222a19.936 19.936 0 0019.728-16.712l6.763-40.572a192.038 192.038 0 0069.54-40.192l38.564 14.449a19.938 19.938 0 0024.334-8.731l32.609-56.487a19.939 19.939 0 00-4.6-25.436zm-50.636 57.12l-48.109-18.024-7.285 7.334a159.955 159.955 0 01-72.625 41.973l-10 2.636L267.6 464h-44.89l-8.442-50.642-10-2.636a159.955 159.955 0 01-72.625-41.973l-7.285-7.334-48.117 18.024L53.8 340.562l39.629-32.624-2.7-9.973a160.9 160.9 0 010-83.93l2.7-9.972L53.8 171.439l22.446-38.878 48.109 18.024 7.285-7.334a159.955 159.955 0 0172.625-41.973l10-2.636L222.706 48H267.6l8.442 50.642 10 2.636a159.955 159.955 0 0172.625 41.973l7.285 7.334 48.109-18.024 22.447 38.877-39.629 32.625 2.7 9.972a160.9 160.9 0 010 83.93l-2.7 9.973 39.629 32.623z"></path></svg>',cursor='<svg width="46.08" height="46.08" version="1.1" viewBox="-51.2 -51.2 614.4 614.4"><rect x="16" y="240.18" width="188.84" height="31.635"/><g transform="translate(-3.3234e-7 -112.18)"><rect x="307.16" y="352.37" width="188.84" height="31.635"/></g><rect transform="rotate(-90)" x="-496" y="240.18" width="188.84" height="31.635"/><rect transform="rotate(-90)" x="-204.84" y="240.18" width="188.84" height="31.635"/></svg>',del='<svg width="46.08" height="46.08" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"></path><path d="M6.535 3H21a1 1 0 011 1v16a1 1 0 01-1 1H6.535a1 1 0 01-.832-.445l-5.333-8a1 1 0 010-1.11l5.333-8A1 1 0 016.535 3zm.535 2l-4.666 7 4.666 7H20V5H7.07zM13 10.586l2.828-2.829 1.415 1.415L14.414 12l2.829 2.828-1.415 1.415L13 13.414l-2.828 2.829-1.415-1.415L11.586 12 8.757 9.172l1.415-1.415L13 10.586z"></path></svg>',fibonacci='<svg width="46.08" height="46.08" version="1.1" viewBox="-51.2 -51.2 614.4 614.4"><g stroke-width="30.155"><rect x="14.757" y="240.92" width="482.49" height="30.155" rx="15.078"/><rect x="14.757" y="147" width="482.49" height="30.155" rx="15.078"/><rect x="14.757" y="334.84" width="482.49" height="30.155" rx="15.078"/></g ><g transform="translate(5.937 -288.34)"><path d="m23.904 712.34c-8.3532 0-15.078 6.7252-15.078 15.078s6.7249 15.078 15.078 15.078h173.93c-0.65295-3.3651-2.0312-6.4697-2.0312-10.026 0-7.1393 1.5573-13.888 4.0625-20.13zm276.35 0c2.5051 6.2423 4.0365 12.991 4.0365 20.13 0 3.5554-1.3526 6.6618-2.0052 10.026h173.93c8.3532 0 15.078-6.7252 15.078-15.078s-6.7249-15.078-15.078-15.078z"/><path d="m250.06 759.97c17.965 0 32.545-14.58 32.545-32.545 0-17.965-14.58-32.545-32.545-32.545-17.965 0-32.545 14.58-32.545 32.545 0 17.965 14.58 32.545 32.545 32.545zm0 21.697c-29.964 0-54.242-24.279-54.242-54.242 0-29.964 24.279-54.242 54.242-54.242 29.964 0 54.242 24.279 54.242 54.242 0 29.964-24.279 54.242-54.242 54.242z" stroke-width="21.697"/></g ><path d="m144.05 18.672c-24.694 0-45.285 16.595-51.849 39.167h-62.37c-8.3532 0-15.078 6.7252-15.078 15.078s6.7249 15.078 15.078 15.078h62.37c6.5639 22.572 27.155 39.167 51.849 39.167s45.285-16.595 51.849-39.167h120.03c6.5639 22.572 27.155 39.167 51.849 39.167 24.694 0 45.285-16.595 51.849-39.167h62.552c8.3532 0 15.078-6.7252 15.078-15.078s-6.7249-15.078-15.078-15.078h-62.552c-6.5639-22.572-27.155-39.167-51.849-39.167-24.694 0-45.285 16.595-51.849 39.167h-120.03c-6.5639-22.572-27.155-39.167-51.849-39.167zm0 21.693c17.965 0 32.552 14.587 32.552 32.552 0 17.965-14.587 32.552-32.552 32.552-17.965 1e-5 -32.552-14.587-32.552-32.552 0-17.965 14.587-32.552 32.552-32.552zm223.72 0c17.965 0 32.552 14.587 32.552 32.552 0 17.965-14.587 32.552-32.552 32.552-17.965 0-32.552-14.587-32.552-32.552 0-17.965 14.587-32.552 32.552-32.552z" stroke-width="30.155"/></svg>',line='<svg width="46.08" height="46.08" version="1.1" viewBox="-51.2 -51.2 614.4 614.4"><g transform="matrix(21.697 0 0 21.697 -47.758 -47.758)"><path d="m7.354 21.354 14-14-0.707-0.707-14 14z"/><path d="m22.5 7c0.828 0 1.5-0.672 1.5-1.5s-0.672-1.5-1.5-1.5-1.5 0.672-1.5 1.5 0.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zm-17 16c0.828 0 1.5-0.672 1.5-1.5s-0.672-1.5-1.5-1.5-1.5 0.672-1.5 1.5 0.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"/></g></svg>',measure='<svg width="46.08" height="46.08" viewBox="0 0 32 32"><path d="M 3.2758709,20.241377 11.758622,28.72413 28.72413,11.758622 20.241377,3.2758709 Z m 2.1206881,0 1.5905161,-1.590515 3.7112049,3.711203 1.060342,-1.060345 -3.7112027,-3.711204 1.0603441,-1.060344 2.1206876,2.12069 1.060346,-1.060346 -2.120689,-2.120688 1.060343,-1.060344 3.711203,3.711203 L 16,17.060346 l -3.711203,-3.711208 1.060341,-1.060341 2.12069,2.120687 1.060344,-1.060346 -2.120688,-2.120687 1.060344,-1.060343 3.711204,3.711205 1.060345,-1.060345 -3.711205,-3.7112046 1.060344,-1.0603441 2.120687,2.1206887 1.060346,-1.0603446 -2.120687,-2.1206883 1.590515,-1.5905161 6.362065,6.362063 -14.84482,14.84482 z" style="stroke-width:0.749776" /></svg>',range='<svg width="46.08" height="46.08" viewBox="-51.2 -51.2 614.4 614.4"><g id="g930" transform="matrix(21.128963,0,0,21.128963,-29.235597,-50.369964)"><path clip-rule="evenodd" d="m 4.5,5 a 1.5,1.5 0 1 0 0,3 1.5,1.5 0 0 0 0,-3 z M 2,6.5 A 2.5,2.5 0 0 1 6.95,6 H 24 V 7 H 6.95 A 2.5,2.5 0 0 1 2,6.5 Z M 4.5,15 a 1.5,1.5 0 1 0 0,3 1.5,1.5 0 0 0 0,-3 z M 2,16.5 A 2.5,2.5 0 0 1 6.95,16 h 13.1 a 2.5,2.5 0 1 1 0,1 H 6.95 A 2.5,2.5 0 0 1 2,16.5 Z M 22.5,15 a 1.5,1.5 0 1 0 0,3 1.5,1.5 0 0 0 0,-3 z m -18,6 a 1.5,1.5 0 1 0 0,3 1.5,1.5 0 0 0 0,-3 z M 2,22.5 A 2.5,2.5 0 0 1 6.95,22 H 24 v 1 H 6.95 A 2.5,2.5 0 0 1 2,22.5 Z" id="path908" /><path clip-rule="evenodd" d="M 22.4,8.94 21.01,9.57 20.6,8.66 21.99,8.03 Z m -4,1.8 -1.39,0.63 -0.41,-0.91 1.39,-0.63 z m -4,1.8 -1.4,0.63 -0.4,-0.91 1.39,-0.63 z m -4,1.8 L 9,14.97 8.6,14.06 9.99,13.43 Z" id="path910" /></g></svg>',text='<svg width="46.08" height="46.08" viewBox="-51.2 -51.2 614.4 614.4"><path d="M231.359 147l-80.921 205h45.155l15.593-39.5h89.628l15.593 39.5h45.155l-80.921-205zm-3.594 123.5L256 198.967l28.235 71.533z"></path><path d="M384 56H128V16H16v112h40v256H16v112h112v-40h256v40h112V384h-40V128h40V16H384zM48 96V48h48v48zm48 368H48v-48h48zm288-40H128v-40H88V128h40V88h256v40h40v256h-40zm80-8v48h-48v-48zM416 48h48v48h-48z"></path></svg>',close='<svg style="width: 46px; height: 46px" viewBox="-1.6 -1.6 19.2 19.2"><path d="M 15,2 C 15,1.4477153 14.552285,1 14,1 H 2 C 1.4477153,1 1,1.4477153 1,2 v 12 c 0,0.552285 0.4477153,1 1,1 h 12 c 0.552285,0 1,-0.447715 1,-1 z M 0,2 C 0,0.8954305 0.8954305,0 2,0 h 12 c 1.104569,0 2,0.8954305 2,2 v 12 c 0,1.104569 -0.895431,2 -2,2 H 2 C 0.8954305,16 0,15.104569 0,14 Z" id="path2" /><g id="g718" transform="translate(0,1.2499996)"><path d="M 7.5010125,7.9560661 5.355012,10.103066 c -0.472,0.472 -1.18,-0.2360003 -0.708,-0.7080003 L 7.6470125,6.3950659 c 0.195364,-0.195858 0.512636,-0.195858 0.708,0 l 3.0000005,2.9999998 c 0.472,0.472 -0.236,1.1800003 -0.708,0.7080003 L 8.5010125,7.9560661 c -0.431103,-0.417289 -0.523896,-0.423024 -1,0 z" style="" id="path566-5" /><path d="m 7.4989873,5.5439348 -2.1460003,-2.147 c -0.472,-0.472 -1.18,0.236 -0.708,0.708 l 3.0000003,3 c 0.1953639,0.195858 0.5126361,0.195858 0.708,0 l 2.9999997,-3 c 0.472,-0.472 -0.236,-1.18 -0.708,-0.708 l -2.1459997,2.147 c -0.4311027,0.417289 -0.5238956,0.423024 -1,0 z" style="" id="path566-6-3" /></g></svg>',up='<svg style="width: 46px; height: 46px" viewBox="-1.6 -1.6 19.2 19.2"><path d="M 15,2 C 15,1.4477153 14.552285,1 14,1 H 2 C 1.4477153,1 1,1.4477153 1,2 v 12 c 0,0.552285 0.4477153,1 1,1 h 12 c 0.552285,0 1,-0.447715 1,-1 z M 0,2 C 0,0.8954305 0.8954305,0 2,0 h 12 c 1.104569,0 2,0.8954305 2,2 v 12 c 0,1.104569 -0.895431,2 -2,2 H 2 C 0.8954305,16 0,15.104569 0,14 Z" id="path2" /><path d="m 7.4989873,7.7026182 -2.1460003,2.147 c -0.472,0.4719998 -1.18,-0.236 -0.708,-0.708 l 3.0000003,-3 c 0.1953639,-0.1958581 0.5126361,-0.1958581 0.708,0 l 2.9999997,3 c 0.472,0.472 -0.236,1.1799998 -0.708,0.708 l -2.1459997,-2.147 c -0.4311027,-0.417289 -0.5238956,-0.423024 -1,0 z" style="" id="path566-6-3" /></svg>',down='<svg style="width: 46px; height: 46px" viewBox="-1.6 -1.6 19.2 19.2"><path d="M 15,2 C 15,1.4477153 14.552285,1 14,1 H 2 C 1.4477153,1 1,1.4477153 1,2 v 12 c 0,0.552285 0.4477153,1 1,1 h 12 c 0.552285,0 1,-0.447715 1,-1 z M 0,2 C 0,0.8954305 0.8954305,0 2,0 h 12 c 1.104569,0 2,0.8954305 2,2 v 12 c 0,1.104569 -0.895431,2 -2,2 H 2 C 0.8954305,16 0,15.104569 0,14 Z" id="path2" /><path d="m 7.4989873,8.2973819 -2.1460003,-2.147 c -0.472,-0.472 -1.18,0.236 -0.708,0.708 l 3.0000003,3 c 0.1953639,0.1958581 0.5126361,0.1958581 0.708,0 l 2.9999997,-3 c 0.472,-0.472 -0.236,-1.18 -0.708,-0.708 l -2.1459997,2.147 c -0.4311027,0.417289 -0.5238956,0.423024 -1,0 z" style="" id="path566-6-3" /></svg>',restore='<svg style="width: 46px; height: 46px" viewBox="-1.6 -1.6 19.2 19.2"><path d="M 15,2 C 15,1.4477153 14.552285,1 14,1 H 2 C 1.4477153,1 1,1.4477153 1,2 v 12 c 0,0.552285 0.4477153,1 1,1 h 12 c 0.552285,0 1,-0.447715 1,-1 z M 0,2 C 0,0.8954305 0.8954305,0 2,0 h 12 c 1.104569,0 2,0.8954305 2,2 v 12 c 0,1.104569 -0.895431,2 -2,2 H 2 C 0.8954305,16 0,15.104569 0,14 Z" id="path2" /><g id="g687" transform="translate(15.647255,-0.0288128)"><path d="m -8.1462425,10.484879 -2.1460005,2.146999 c -0.472,0.472 -1.18,-0.236 -0.708,-0.708 l 3.0000005,-2.9999994 c 0.195364,-0.195858 0.512636,-0.195858 0.708,0 l 3.0000005,2.9999994 c 0.472,0.472 -0.236,1.18 -0.708,0.708 l -2.1460005,-2.146999 c -0.431103,-0.417289 -0.523896,-0.423024 -1,0 z" style="" id="path566-5" /><path d="m -8.1482677,5.5727476 -2.1460003,-2.147 c -0.472,-0.472 -1.18,0.236 -0.708,0.708 l 3.0000003,3 c 0.1953639,0.195858 0.5126361,0.195858 0.708,0 l 2.9999997,-3 c 0.472,-0.472 -0.236,-1.18 -0.708,-0.708 l -2.1459997,2.147 c -0.4311027,0.417289 -0.5238956,0.423024 -1,0 z" style="" id="path566-6-3" /></g></svg>',maximize='<svg style="width: 46px; height: 46px" viewBox="-1.6 -1.6 19.2 19.2"><path d="M 15,2 C 15,1.4477153 14.552285,1 14,1 H 2 C 1.4477153,1 1,1.4477153 1,2 v 12 c 0,0.552285 0.4477153,1 1,1 h 12 c 0.552285,0 1,-0.447715 1,-1 z M 0,2 C 0,0.8954305 0.8954305,0 2,0 h 12 c 1.104569,0 2,0.8954305 2,2 v 12 c 0,1.104569 -0.895431,2 -2,2 H 2 C 0.8954305,16 0,15.104569 0,14 Z" id="path2" /><g id="g611" transform="translate(0.2050748,-0.8829888)"><path d="m 7.2959375,11.933818 -2.146,-2.1469999 c -0.472,-0.4719998 -1.18,0.2359999 -0.708,0.7079999 l 3,3 c 0.195364,0.195858 0.512636,0.195858 0.708,0 l 3.0000005,-3 c 0.472,-0.472 -0.236,-1.1799997 -0.708,-0.7079999 L 8.2959375,11.933818 c -0.431103,0.417289 -0.523896,0.423024 -1,0 z" style="" id="path566" /><path d="m 7.2939123,5.8321596 -2.146,2.147 c -0.4719998,0.472 -1.1799998,-0.236 -0.708,-0.708 l 3,-3 c 0.1953639,-0.195858 0.5126361,-0.195858 0.708,0 l 2.9999997,3 c 0.472,0.472 -0.236,1.18 -0.708,0.708 l -2.1459997,-2.147 c -0.4311027,-0.417289 -0.5238956,-0.423024 -1,0 z" style="" id="path566-6" /></g></svg>',collapse='<svg style="width: 46px; height: 46px" viewBox="-1.6 -1.6 19.2 19.2"><path d="M 15,2 C 15,1.4477153 14.552285,1 14,1 H 2 C 1.4477153,1 1,1.4477153 1,2 v 12 c 0,0.552285 0.4477153,1 1,1 h 12 c 0.552285,0 1,-0.447715 1,-1 z M 0,2 C 0,0.8954305 0.8954305,0 2,0 h 12 c 1.104569,0 2,0.8954305 2,2 v 12 c 0,1.104569 -0.895431,2 -2,2 H 2 C 0.8954305,16 0,15.104569 0,14 Z" id="path2" /><path d="m 11.500447,8.5 c 0.666666,0 0.666666,-1 0,-1 H 4.444275 c -0.1571231,0 -0.224029,0.07336 -0.2978281,0.1459999 -0.1958579,0.195364 -0.1958579,0.5126361 0,0.7080001 0,0 0.113806,0.146 0.320186,0.146 z" style="" id="path887" /></svg>',fwdEnd='<svg class="ov-icon" width="46.08" height="46.08" font-size="2.88em" version="1.1" viewBox="-1.6 -1.6 19.2 19.2"><path d="m14 15c0.55228 0 1-0.44772 1-1v-12c0-0.55228-0.44772-1-1-1h-12c-0.55228 0-1 0.44772-1 1v12c0 0.55228 0.44772 1 1 1zm0-15c1.1046 0 2 0.89543 2 2v12c0 1.1046-0.89543 2-2 2h-12c-1.1046 0-2-0.89543-2-2v-12c0-1.1046 0.89543-2 2-2z" fill-rule="evenodd"/><g transform="translate(-1.1585)" fill-rule="evenodd">  <path d="m8.2964 7.5-2.147-2.146c-0.472-0.472 0.236-1.18 0.708-0.708l3 3c0.19586 0.19536 0.19586 0.51264 0 0.708l-3 3c-0.472 0.472-1.18-0.236-0.708-0.708l2.147-2.146c0.41729-0.4311 0.42302-0.5239 0-1z"/>  <path d="m12.323 4.4996c0-0.66667-1-0.66667-1 0v7.0562c0 0.15712 0.07336 0.22403 0.146 0.29783 0.19536 0.19586 0.51264 0.19586 0.708 0 0 0 0.146-0.11381 0.146-0.32019z"/></g></svg>',rwdStart='<svg class="ov-icon" width="46.08" height="46.08" font-size="2.88em" version="1.1" viewBox="-1.6 -1.6 19.2 19.2"><path d="m2 15c-0.55228 0-1-0.44772-1-1v-12c0-0.55228 0.44772-1 1-1h12c0.55228 0 1 0.44772 1 1v12c0 0.55228-0.44772 1-1 1zm0-15c-1.1046 0-2 0.89543-2 2v12c0 1.1046 0.89543 2 2 2h12c1.1046 0 2-0.89543 2-2v-12c0-1.1046-0.89543-2-2-2z" fill-rule="evenodd"/><g transform="matrix(-1 0 0 1 17.159 0)" fill-rule="evenodd">  <path d="m8.2964 7.5-2.147-2.146c-0.472-0.472 0.236-1.18 0.708-0.708l3 3c0.19586 0.19536 0.19586 0.51264 0 0.708l-3 3c-0.472 0.472-1.18-0.236-0.708-0.708l2.147-2.146c0.41729-0.4311 0.42302-0.5239 0-1z"/>  <path d="m12.323 4.4996c0-0.66667-1-0.66667-1 0v7.0562c0 0.15712 0.07336 0.22403 0.146 0.29783 0.19536 0.19586 0.51264 0.19586 0.708 0 0 0 0.146-0.11381 0.146-0.32019z"/></g></svg>',iconW=20,iconH=20,handleColour=new Colour(GlobalStyle.COLOUR_BORDER),template$c=document.createElement("template");template$c.innerHTML=`\n<style>\n  .scrollBarWidget {\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    align-items: stretch;\n    gap: 2px;\n  }\n  .scrollBar {\n    position: relative;\n    border: 1px solid var(--txc-time-scrollbar-color, ${GlobalStyle.COLOUR_BORDER});\n    height: 20px;\n    border-radius: 3px;\n    flex-basis: 100%;\n    overflow: hidden;\n  }\n  .scrollBar input {\n    pointer-events: none;\n    position: absolute;\n    overflow: hidden;\n    left: 0;\n    top: 0;\n    width: 100%;\n    outline: none;\n    height: 100%;\n    margin: 0;\n    padding: 0;\n    background:  var(--txc-time-slider-color, #555);\n\n  }\n  .scrollBar input::-moz-range-thumb {\n    -moz-appearance: none;\n    appearance: none; \n    pointer-events: auto;\n    position: relative;\n    z-index: 10;\n    outline: 0;\n    height: 100%;\n  }\n  .scrollBar input::-webkit-slider-thumb {\n    -webkit-appearance: none !important;\n    appearance: none; \n    pointer-events: auto;\n    position: relative;\n    z-index: 1;\n    height: 100%;\n  }\n  .scrollBar input::-moz-range-track {\n    position: relative;\n    z-index: -1;\n    background-color: rgba(0, 0, 0, 1);\n    border: 0;\n  }\n  .scrollBar input:last-of-type::-moz-range-track {\n    -moz-appearance: none;\n    background: none transparent;\n    border: 0;\n  }\n  .scrollBar input[type="range"]::-webkit-slider-runnable-track {\n    -webkit-appearance: none !important;\n    appearance: none;\n    background: none transparent;\n    cursor: default;\n    height: 1px; /* Required for Samsung internet based browsers */\n    outline: 0;\n  }\n  .scrollBar input[type=range]::-moz-focus-outer {\n    border: 0;\n  }\n  input[type=range] {\n    -webkit-appearance: none;\n    background: none;\n  }\n\n  input[type=range]::-webkit-slider-runnable-track {\n    height: 5px;\n    border: none;\n    border-radius: 3px;\n    background: transparent;\n  }\n\n  input[type=range]::-ms-track {\n    height: 5px;\n    background: transparent;\n    border: none;\n    border-radius: 3px;\n  }\n\n  input[type=range]::-moz-range-track {\n    height: 5px;\n    background: transparent;\n    border: none;\n    border-radius: 3px;\n  }\n\n  input[type=range]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    border: none;\n    height: 20px;\n    width: 16px;\n    border-radius: 3px;\n    background: var(--txc-time-slider-color, #555);\n    margin-top: -10px;\n    position: relative;\n    z-index: 10000;\n  }\n\n  input[type=range]::-ms-thumb {\n    -webkit-appearance: none;\n    border: none;\n    height: 20px;\n    width: 16px;\n    border-radius: 3px;\n    background:  var(--txc-time-slider-color, #555);\n    margin-top: -5px;\n    position: relative;\n    z-index: 10000;\n  }\n\n  input[type=range]::-moz-range-thumb {\n    -webkit-appearance: none;\n    border: none;\n    height: 100%;\n    width: 16px;\n    border-radius: 3px;\n    background:  var(--txc-time-slider-color, #555);\n    margin-top: -5px;\n    position: relative;\n    z-index: 10000;\n  }\n\n  input[type=range]:focus {\n    outline: none;\n  }\n\n  .handle {\n    background-color: var(--txc-time-handle-color, ${handleColour.hex}44); \n    width: 2px;\n    height: 18px;\n    margin: 1px;\n    margin-left: 872.968px;\n    margin-right: 0px;\n    position: absolute;\n  }\n  .icon {\n    flex-basis: 20px;\n  }\n  .icon svg {\n    fill: var(--txc-time-icon-color, ${GlobalStyle.COLOUR_ICON});\n    width: 20px;\n    height: 20px;\n    margin-top: 1px;\n  }\n  .icon svg:hover {\n    fill: var(--txc-time-icon-hover-color, ${GlobalStyle.COLOUR_ICONHOVER});\n  }\n</style>\n<div class="scrollBarWidget">\n  <span id="rwdStart" class="icon rwdStart">${rwdStart}</span>\n  <span class="scrollBar">\n    <div class="viewport"></div>\n    <input id="min" class="min" name="min" type="range" step="1" min="0" max="3000" />\n    <input id="max" class="max" name="max" type="range" step="1" min="0" max="3000" />\n    <div class="handle"></div>\n  </span>\n  <span id="fwdEnd" class="icon fwdEnd">${fwdEnd}</span>\n</div>\n`;class tradeXOverview extends element{#Ii;constructor(){super(template$c),this.#Ii=template$c}destroy(){}connectedCallback(){this.doInit&&(this.doInit=!1,this.shadowRoot.appendChild(this.#Ii.content.cloneNode(!0)),document.getElementById("slider-bar"),this.max.addEventListener("input",this.onChangeSliderHandler.bind({self:this,input:this.max})),this.min.addEventListener("input",this.onChangeSliderHandler.bind({self:this,input:this.min})))}disconnectedCallback(){}get scrollBarWidget(){return this.shadowRoot.querySelector(".scrollBarWidget")}get rwdStart(){return this.shadowRoot.querySelector(".rwdStart")}get fwdEnd(){return this.shadowRoot.querySelector(".fwdEnd")}get scrollBar(){return this.shadowRoot.querySelector(".scrollBar")}get viewport(){return this.shadowRoot.querySelector(".viewport")}get handle(){return this.shadowRoot.querySelector(".handle")}get icons(){return this.shadowRoot.querySelectorAll("svg")}get max(){return this.shadowRoot.querySelector("#max")}get min(){return this.shadowRoot.querySelector("#min")}get sliders(){return this.shadowRoot.querySelectorAll("input")}get overviewCSS(){return this.shadowRoot.querySelector("style[title=overview]")}onChangeSliderHandler(){console.log(`${this.input.value}, ${this.input.getAttribute("max")}`)}}window.customElements.define("tradex-overview",tradeXOverview);const template$b=document.createElement("template");template$b.innerHTML='\n<style>\n  .viewport {\n    width: 100%;\n    height: 50%;\n  }\n</style>\n<div class="viewport"></div>\n<tradex-overview></tradex-overview>\n';class tradeXTime extends element{constructor(){super(template$b)}destroy(){}disconnectedCallback(){}createGraph(){}get viewport(){return this.shadowRoot.querySelector(".viewport")}get overview(){return this.shadowRoot.querySelector("tradex-overview")}}window.customElements.define("tradex-time",tradeXTime);const template$a=document.createElement("template");template$a.innerHTML='\n<style>\n  .viewport {\n    position: relative;\n    width: 100%;\n    height: 100%;\n  }\n</style>\n  <div class="viewport"></div>\n';class tradeXGrid extends element{constructor(){super(template$a)}destroy(){}disconnectedCallback(){}get viewport(){return this.shadowRoot.querySelector(".viewport")}}window.customElements.define("tradex-grid",tradeXGrid);const template$9=document.createElement("template");template$9.innerHTML='\n<style>\n  ::slotted(.legend) {\n    display: flex;\n    align-items: flex-end;\n    justify-content: space-between;\n    white-space: nowrap;\n    width: calc(100% - 1em); \n    margin: 0 0 0 1em;\n    text-align: left;\n  }\n</style>\n<div class="legends">\n  <slot name="legend"></slot>\n</div>\n';class tradeXLegend extends element{#$e;#we;#Pi;#_i;#Ni;constructor(){super(template$9)}destroy(){}connectedCallback(){this.doInit&&(this.doInit=!1,this.shadowRoot.appendChild(this.template.content.cloneNode(!0)),this.style.display="block",this.#we=this.shadowRoot.querySelector(".legend"),this.#Pi=this.shadowRoot.querySelector(".title"),this.#_i=this.shadowRoot.querySelector("dl"),this.#Ni=this.shadowRoot.querySelector(".controls"))}disconnectedCallback(){}get elLegend(){return this.#we}get elTitle(){return this.#Pi}get elInputs(){return this.#_i}get elControls(){return this.#Ni}get title(){return this.#$e}set title(t){this.setTittle(t)}setTittle(t){isString$1&&(this.#$e=t,this.elTitle.innerHTML=t)}buildInputs(t){let e,i=0,s="",n="display: inline; margin-left: ";for(e in t.inputs){let r=t?.colours?.[i]?` color: ${t.colours[i]};`:"",o=void 0!==t?.inputs?.[e]?t.inputs[e]:"",a=t?.labels?.[i]?`${e}:`:"";n+=t?.labels?.[i]?"1em;":".25em",s+=`<dt style="${n}">${a}</dt>\n      <dd style="display: inline; margin-left: .25em;${r}">${o}</dd>`,++i}return s}buildControls(t){let e="",i=t.ID;return"chart"!==t?.type&&(e+=`<span id="${i}_up" class="control">${up}</span>`,e+=`<span id="${i}_down" class="control">${down}</span>`),e+=`<span id="${i}_collapse" class="control">${collapse}</span>`,e+=`<span id="${i}_maximize" class="control">${maximize}</span>`,e+=`<span id="${i}_restore" class="control">${restore}</span>`,e+="chart"!==t?.type?`<span id="${i}_remove" class="control">${close}</span>`:"",e+=`<span id="${i}_config" class="control">${config}</span>`,e}}window.customElements.define("tradex-legends",tradeXLegend);const template$8=document.createElement("template");template$8.innerHTML='\n<style>\n  .viewport {\n    position: relative;\n    width: 100%;\n    height: inherit;\n    background: var(--txc-onchart-background, none);\n  }\n  .viewport canvas {\n    position: absolute;\n    top: 1px;\n  }\n  tradex-legends {\n    position: absolute;\n    top: 0;\n    left: 0;\n    z-index:100;\n    width: 100%;\n  }\n</style>\n<div class="viewport"></div>\n<tradex-legends></tradex-legends>\n';class tradeXOnChart extends element{#Z;#te;#we;#Se;#Jt;constructor(){super(template$8)}destroy(){}connectedCallback(){this.doInit&&(this.doInit=!1,this.shadowRoot.appendChild(this.template.content.cloneNode(!0)),this.style.display="block",this.#te=this.shadowRoot.querySelector(".viewport"),this.#we=this.shadowRoot.querySelector("tradex-legends"))}disconnectedCallback(){}get viewport(){return this.#te}get legend(){return this.#we}}window.customElements.define("tradex-onchart",tradeXOnChart);const template$7=document.createElement("template");template$7.innerHTML='\n<style>\n  .viewport {\n    width: 100%;\n    height: inherit;\n    background: var(--txc-onchart-background, none);\n  }\n  tradex-legends {\n    position: absolute;\n    top: 0;\n    left: 0;\n    z-index:100;\n    width: 100%;\n  }\n</style>\n<tradex-legends></tradex-legends>\n<div class="viewport"></div>\n';class tradeXOffChart extends element{#Z;#te;#we;#Jt;#ie;constructor(){super(template$7)}destroy(){}connectedCallback(){this.doInit&&(this.doInit=!1,this.shadowRoot.appendChild(this.template.content.cloneNode(!0)),this.#te=this.shadowRoot.querySelector(".viewport"),this.#we=this.shadowRoot.querySelector("tradex-legends"))}disconnectedCallback(){}get viewport(){return this.#te}get legend(){return this.#we}}window.customElements.define("tradex-offchart",tradeXOffChart);const template$6=document.createElement("template");template$6.innerHTML='\n<style>\n  tradex-grid, tradex-onchart, tradex-offchart {\n    overflow: hidden;\n  }\n  tradex-grid {\n    position: absolute;\n    height: inherit;\n  }\n  tradex-onchart {\n    position: relative;\n    height: 100%;\n  }\n  tradex-grid,\n  tradex-onchart {\n    display: block;\n    width: 100%;\n  }\n  ::slotted(tradex-offchart) {\n    display: block;\n    position: relative;\n    top: 1px;\n    width: 100%;\n    border-top: 1px solid;\n  }\n</style>\n<tradex-grid></tradex-grid>\n<tradex-onchart></tradex-onchart>\n<slot name="offchart" id="offchart"></slot>\n';class tradeXRows extends element{#$i;#ki;#Hi;#Bi;constructor(){super(template$6)}destroy(){}connectedCallback(){super.connectedCallback(),this.previousDimensions()}disconnectedCallback(){}get grid(){return this.shadowRoot.querySelector("tradex-grid")}get onChart(){return this.shadowRoot.querySelector("tradex-onchart")}get offCharts(){return this.shadowRoot.querySelectorAll("tradex-offchart")}get offChartSlot(){return this.shadowRoot.querySelector("#offchart")}get width(){return this.clientWidth}get height(){return this.clientHeight}get oWidth(){return this.#$i}get oHeight(){return this.#ki}get widthDeltaR(){return this.clientWidth/this.#$i}get heightDeltaR(){return this.clientHeight/this.#ki}previousDimensions(){this.#$i=this.#Hi?this.#Hi:this.clientWidth,this.#ki=this.#Bi?this.#Bi:this.clientHeight,this.#Hi=this.clientWidth,this.#Bi=this.clientHeight}}window.customElements.define("tradex-rows",tradeXRows);const template$5=document.createElement("template");template$5.innerHTML=`\n<style>\n  #viewport {\n    position: absolute;\n    width: 100%;\n    height: inherit;\n    background: var(--txc-onchart-background, none);\n    z-index: 0;\n  }\n  #viewport canvas {\n    position: absolute;\n    top: 1px;\n  }\n  tradex-rows {\n    position:relative;\n    overflow: hidden;\n    width: calc(100% - 60px);\n    height: calc(100% - 50px);\n    border: 1px solid;\n    border-color: var(--txc-border-color, ${GlobalStyle.COLOUR_BORDER}); \n  }\n  tradex-time {\n    position: relative;\n    width: calc(100% - 60px);\n    height: 50px;\n    overflow: hidden;\n    margin-left: 1px;\n    z-index: 1;\n  }\n</style>\n<div id="viewport"></div>\n<tradex-rows></tradex-rows>\n<tradex-time></tradex-time>\n`;class tradeXMain extends element{#gi;#Q;constructor(){super(template$5)}destroy(){}disconnectedCallback(){}get viewport(){return this.shadowRoot.querySelector("#viewport")}get rows(){return this.shadowRoot.querySelector("tradex-rows")}get time(){return this.shadowRoot.querySelector("tradex-time")}start(t){this.#Q=t,this.setMain()}rowNode(t,e){return`\n      <tradex-offchart slot="offchart" class="${t}" style="${` border-top: 1px solid ${e.theme.chart.BorderColour};`}">\n      </tradex-offchart>\n    `}setMain(){let t=isNumber(this.#Q?.time?.height)?this.#Q.time.height:50,e="none"==this.#Q.tools.location?60:0;this.rows.style.height=`calc(100% - ${t}px)`,this.rows.style.left=`${e}px`,this.time.style.left=`${e}px`,this.viewport.style.left=`${e}px`}}window.customElements.define("tradex-main",tradeXMain);const template$4=document.createElement("template");template$4.innerHTML="\n  <slot></slot>\n";class tradeXTools extends element{constructor(){super(template$4)}destroy(){}disconnectedCallback(){}get icons(){return this.shadowRoot.querySelector("slot").assignedElements()}}window.customElements.define("tradex-tools",tradeXTools);const template$3=document.createElement("template");template$3.innerHTML='\n<style>\n  .viewport {\n    width: 100%;\n    height: 100%;\n    margin-top: 2px;\n    margin-left: 2px;\n  }\n</style>\n<div class="viewport"></div>\n<slot name="offchart" id="offchart"></slot>\n';class tradeXScale extends element{#Kt;#Wi;constructor(){super(template$3)}destroy(){}connectedCallback(){this.doInit&&(this.doInit=!1,this.shadowRoot.appendChild(this.template.content.cloneNode(!0)),this.style.display="block",this.#Kt=this.shadowRoot.querySelector(".viewport"),this.#Wi=this.shadowRoot.querySelector("#offchart"))}disconnectedCallback(){}get viewport(){return this.#Kt}get offCharts(){return this.shadowRoot.querySelectorAll("tradex-offchart")}get offChartSlot(){return this.#Wi}}window.customElements.define("tradex-scale",tradeXScale);const right="\n<style>\n  tradex-tools {\n    position: absolute; \n    top: 0; left: 0;\n    width: 40px;\n    height: 100%; \n    min-height: 100%; \n  }\n  tradex-main {\n    position: absolute; \n    top: 0;\n    right: 0;\n    width: calc(100% - 40px);\n    height: 100%;\n  }\n  tradex-scale {\n    position: absolute; \n    top: 0; \n    right: 0; \n    width: 60px; \n    height: 100%;\n  }\n</style>\n<tradex-tools></tradex-tools>\n<tradex-main></tradex-main>\n<tradex-scale></tradex-scale>\n",template$2=document.createElement("template");template$2.innerHTML=right;class tradeXBody extends element{#Q;constructor(){super(template$2)}destroy(){}disconnectedCallback(){}get tools(){return this.shadowRoot.querySelector("tradex-tools")}get main(){return this.shadowRoot.querySelector("tradex-main")}get scale(){return this.shadowRoot.querySelector("tradex-scale")}start(t){this.#Q=t,this.setToolsLocation()}setYAxisLocation(t=this.#Q?.yAxis?.location){let e,i=isNumber(this.#Q?.tools?.width)?this.#Q.tools.width:40;if("left"===t)e=0==i?0:60,this.scale.style.left=`${i}px`,this.scale.style.right=void 0,this.main.style.left=void 0,this.main.style.right=`-${e}px`,this.main.style.width=`calc(100% - ${i}px)`;else e=0==i?60:0,this.scale.style.left=void 0,this.scale.style.right=0,this.main.style.left=void 0,this.main.style.right=`${e}px`,this.main.style.width=`calc(100% - ${i}px)`}setToolsLocation(t=this.#Q?.tools?.location){switch(this.#Q.tools=this.#Q.tools||{},t){case"none":case!1:this.#Q.tools.location="none",this.#Q.tools.width=0,this.tools.style.display="none",this.tools.style.width="0px";break;case"right":this.#Q.tools.location="right",this.#Q.tools.width=this.#Q?.tools?.width||40,this.tools.style.display="block",this.tools.style.left=void 0,this.tools.style.right=0,this.tools.style.width="40px";break;default:this.#Q.tools.location="left",this.#Q.tools.width=this.#Q?.tools?.width||40,this.tools.style.display="block",this.tools.style.left=0,this.tools.style.right=void 0,this.tools.style.width="40px"}this.setYAxisLocation()}}window.customElements.define("tradex-body",tradeXBody);const template$1=document.createElement("template");template$1.innerHTML='\n  <style>\n    .utilsOptions {\n      display: inline-block; float: right;\n    }\n  </style>\n  <slot></slot>\n  <div class="utilsOptions">\n  </div>\n';class tradeXUtils extends element{constructor(){super(template$1)}destroy(){}disconnectedCallback(){}get icons(){return this.shadowRoot.querySelector("slot").assignedElements()[0].children}}window.customElements.define("tradex-utils",tradeXUtils);const template=document.createElement("template");template.innerHTML='\n  <slot name="widget"></slot>\n';class tradeXWidgets extends element{constructor(){super(template)}destroy(){}disconnectedCallback(){}}window.customElements.define("tradex-widgets",tradeXWidgets);const HTML='\n  <style title="core">\n    tradex-utils {\n      height: 35px; \n      width: 100%; \n    }\n    tradex-body {\n      position: relative;\n      height: calc(100% - 35px); \n      min-height: 265px;\n      width: 100%;\n    }\n    tradex-widgets {\n      position: relative;\n    }\n  </style>\n  <div style="display: none;">\n    <slot></slot>\n  </div>\n  <tradex-utils></tradex-utils>\n  <tradex-body></tradex-body>\n  <tradex-widgets></tradex-widgets>\n';class tradeXChart extends element{#Ui;#Fi;#Gi;#Ii;#Vi=400;#zi=300;#$i;#ki;#Hi;#Bi;#Q;constructor(){const t=document.createElement("template");t.innerHTML=HTML,super(t,"closed"),this.#Ii=t}destroy(){this.resizeObserver.disconnect()}static get observedAttributes(){return["config","disabled","height","stream","width"]}connectedCallback(){if(this.doInit){this.doInit=!1,this.shadowRoot.appendChild(this.#Ii.content.cloneNode(!0)),this.style.display="block",this.style.minHeight="300px",this.elWidgetsG=this.shadowRoot.querySelector("tradex-widgets"),this.elUtils=this.shadowRoot.querySelector("tradex-utils"),this.elBody=this.shadowRoot.querySelector("tradex-body"),this.elMain=this.elBody.main,this.elTime=this.elBody.main.time,this.elTools=this.elBody.tools,this.elYAxis=this.elBody.scale,this.previousDimensions();let t=this.getAttribute("height")||"100%",e=this.getAttribute("width")||"100%";this.setDimensions(e,t),this.resizeObserver=new ResizeObserver(debounce(this.onResized,50,this)),this.resizeObserver.observe(this)}}disconnectedCallback(){this.resizeObserver.disconnect(),this.removeEventListener("click",this.onClick)}attributeChangedCallback(t,e,i){switch(t){case"config":case"disabled":break;case"height":this.height(i);break;case"width":this.width(i)}}get id(){return this.getAttribute("id")}set id(t){this.setAttribute("id",t)}get disabled(){return this.hasAttribute("disabled")}set disabled(t){t?this.setAttribute("disabled",""):this.removeAttribute("disabled")}get width(){return this.offsetWidth}set width(t){this.setWidth(t)}get height(){return this.offsetHeight}set height(t){this.setHeight(t)}get oWidth(){return this.#$i}get oHeight(){return this.#ki}get widthDeltaR(){return this.offsetWidth/this.#$i}get heightDeltaR(){return this.offsetHeight/this.#ki}get stream(){}set stream(t){}get body(){return this.#Ui}get utils(){return this.#Fi}get widgets(){return this.#Gi}elStart(t){this.#Q=t,this.setUtilsLocation()}onResized(t){console.log("onResize"),console.log(this.offsetWidth),console.log(this.offsetHeight),isObject(this.MainPane)&&this.MainPane instanceof MainPane&&(this.previousDimensions(),this.emit("global_resize",{w:this.offsetWidth,h:this.offsetHeight}))}previousDimensions(){this.#$i=this.#Hi?this.#Hi:this.offsetWidth,this.#ki=this.#Bi?this.#Bi:this.offsetHeight,this.#Hi=this.offsetWidth,this.#Bi=this.offsetHeight}setWidth(t){isNumber(t)?(this.#Vi=t,t+="px"):isString$1(t)||(this.#Vi=this.parentElement.getBoundingClientRect().width,t=this.#Vi+"px"),this.style.width=t}setHeight(t){isNumber(t)?(this.#zi=t,t+="px"):isString$1(t)||(this.#zi=this.parentElement.getBoundingClientRect().height,w=this.#zi+"px"),this.style.height=t}setWidthMin(t){this.style.minWidth=`var(--txc-min-width, ${t})`}setHeightMin(t){this.style.minHeight=`var(--txc-min-height, ${w})`}setWidthMax(t){this.style.minWidth=`var(--txc-max-width, ${t})`}setHeightMax(t){this.style.minHeight=`var(--txc-max-height, ${w})`}setDimensions(t,e){let i,s=this.width,n=this.height;if(!t||!e){const i=this.getBoundingClientRect(),s=this.parentElement.getBoundingClientRect();e=i.height?i.height:s.height?s.height:300,t=i.width?i.width:s.width?s.width:400}return i={width:this.width,height:this.height,resizeW:t/s,resizeH:e/n,resizeWDiff:t-s,resizeHDiff:e-n},this.setWidth(t),this.setHeight(e),i}setUtilsLocation(t=this.#Q?.utils?.location){switch(this.#Q.utils=this.#Q.utils||{},t){case"none":case!1:this.#Q.utils.location="none",this.#Q.utils.height=0,this.elUtils.style.display="none",this.elUtils.style.height="0px",this.elBody.style.height="100%",this.elBody.style.minHeight="300px";break;default:this.#Q.utils.location="top",this.#Q.utils.height=35,this.elUtils.style.display="block",this.elUtils.style.height="35px",this.elBody.style.height="calc(100% - 35px)",this.elBody.style.minHeight="265px"}}}var utilsList=[{id:"indicators",name:"Indicators",icon:chart,event:"utils_indicators",sub:[]},{id:"timezone",name:"Timezone",icon:clock,event:"utils_timezone"},{id:"screenshot",name:"Screenshot",icon:camera,event:"utils_screenshot"},{id:"settings",name:"Settings",icon:config,event:"utils_settings"}];class UtilsBar{#rt="Utilities";#ot="utils";#o;#ie;#Fi;#Yi;#Xi;#Ri;#ji={};constructor(t,e){this.#o=t,this.#ie=e,this.#Fi=t.elUtils,this.#Yi=t.config?.utilsBar||utilsList,this.#Xi=t.WidgetsG,this.#Ri=t.indicators||Indicators,this.init()}log(t){this.#o.log(t)}info(t){this.#o.info(t)}warning(t){this.#o.warn(t)}error(t){this.#o.error(t)}get name(){return this.#rt}get shortName(){return this.#ot}get core(){return this.#o}get options(){return this.#ie}get pos(){return this.dimensions}get dimensions(){return DOM.elementDimPos(this.#Fi)}init(){this.mount(this.#Fi),this.log(`${this.#rt} instantiated`)}start(){this.initAllUtils(),this.eventsListen()}end(){const t=this.#o,e=DOM.findBySelectorAll(`#${t.id} .${CLASS_UTILS} .icon-wrapper`);for(let t of e)for(let e of this.#Yi)e.id===id&&t.removeEventListener("click",this.onIconClick);this.off("utils_indicators",this.onIndicators),this.off("utils_timezone",this.onTimezone),this.off("utils_settings",this.onSettings),this.off("utils_screenshot",this.onScreenshot)}eventsListen(){this.on("utils_indicators",this.onIndicators.bind(this)),this.on("utils_timezone",this.onTimezone.bind(this)),this.on("utils_settings",this.onSettings.bind(this)),this.on("utils_screenshot",this.onScreenshot.bind(this))}on(t,e,i){this.#o.on(t,e,i)}off(t,e){this.#o.off(t,e)}emit(t,e){this.#o.emit(t,e)}onIconClick(t){let e=t.currentTarget.dataset.event,i=t.currentTarget.dataset.menu||!1,s={target:t.currentTarget.id,menu:i,evt:t.currentTarget.dataset.event};this.emit(e,s),i?this.emit("openMenu",s):(this.emit("menuItemSelected",s),this.emit("utilSelected",s))}mount(t){t.innerHTML=this.defaultNode()}initAllUtils(){const t=this.#o,e=DOM.findBySelectorAll(`#${t.id} .${CLASS_UTILS} .icon-wrapper`);for(let t of e){let e=t.id.replace("TX_",""),i=t.querySelector("svg");i.style.fill=UtilsStyle.COLOUR_ICON,i.style.height="90%";for(let i of this.#Yi)if(i.id===e&&(t.addEventListener("click",this.onIconClick.bind(this)),"indicators"===i.id&&(i.sub=Object.values(this.#Ri)),i?.sub)){let e={content:i.sub,primary:t},s=this.#Xi.insert("Menu",e);t.dataset.menu=s.id,s.start()}}}defaultNode(){let t=`\n    <div style="display: inline-block; float: right;">\n    <style>\n      svg {\n        height: ${UtilsStyle.ICONSIZE};\n        fill: ${UtilsStyle.COLOUR_ICON};\n      }\n    </style>\n    `;for(const e of this.#Yi)t+=this.iconNode(e);return t+"</div>"}iconNode(t){const e=`display: inline-block; height: ${UtilsStyle.ICONSIZE}; padding-top: 2px`,i="sub"in t?'data-menu="true"':"";return`\n      <div id="TX_${t.id}" data-event="${t.event}" ${i} class="icon-wrapper" style="${e}">${t.icon}</div>\n\n    `}onIndicators(t){console.log("Indicator:",t)}onTimezone(t){console.log("Timezone:",t),this.#o.notImplemented()}onSettings(t){console.log("Settings:",t),this.#o.notImplemented()}onScreenshot(t){console.log("Screenshot:",t),this.#o.notImplemented()}}class Tool{static#Ht=0;static#qi={};#z;#Ki=null;#rt;#ot;#ie;#w;#o;#Z;#Yt;#yi;#Jt;#te;#Zi;#et;#Vt=[0,0];#Ie=!1;#Pe;constructor(t){this.#w=t,this.#Ki=t.cnt,this.#z=this.#w.ID||uid("TX_Tool_"),this.#rt=t.name,this.#o=t.core,this.#yi=t.elements.elChart,this.#Z={...t.parent},this.#et=t.target,this.#et.addTool(this),this.#te=this.#Zi.viewport,this.#Jt=this.#te.scene.canvas,this.#Pe=t.pos}get inCnt(){return this.#Ki}get ID(){return this.#z}get name(){return this.#rt}get shortName(){return this.#ot}get core(){return this.#o}get stateMachine(){return this.#o.stateMachine}get state(){return this.#o.getState()}get data(){return this.#o.chartData}get range(){return this.#o.range}get target(){return this.#et}set layerTool(t){this.#Zi=t}get layerTool(){return this.#Zi}get elViewport(){return this.#te}get cursorPos(){return this.#Vt}get cursorActive(){return this.#Ie}get cursorClick(){return this.#Pe}get candleW(){return this.#o.Timeline.candleW}get theme(){return this.#o.theme}get config(){return this.#o.config}get scrollPos(){return this.#o.scrollPos}get bufferPx(){return this.#o.bufferPx}static create(t,e){const i=++Tool.#Ht;e.cnt=i,e.modID=`${e.toolID}_${i}`,e.toolID=e.modID,e.target=t;const s=new e.tool(e);return Tool.#qi[i]=s,t.chartToolAdd(s),s}static destroy(t){if(t instanceof Tool){const e=t.inCnt;delete Tool.#qi[e]}}end(){this.stop()}stop(){this.#Yt.off("mousemove",this.onMouseMove)}eventsListen(){this.#Yt=new Input(this.#Jt,{disableContextMenu:!1}),this.#Yt.on("mousemove",this.onMouseMove.bind(this))}on(t,e,i){this.#o.on(t,e,i)}off(t,e){this.#o.off(t,e)}emit(t,e){this.#o.emit(t,e)}onMouseMove(t){this.#Vt=[Math.round(t.position.x),Math.round(t.position.y)],this.emit("tool_mousemove",this.#Vt)}createViewport(){this.config.buffer||BUFFERSIZE,this.#te.getBoundingClientRect().width,this.#ie.chartH||this.#Z.rowsH}draw(){}}class Fibonacci extends Tool{constructor(t){super(t)}}class Line extends Tool{#Qi=lineConfig.colour;#Ji=lineConfig.lineWidth;#ne;constructor(t){super(t)}set colour(t=this.#Qi){this.#Qi=t}get colour(){return this.#Qi}set lineWidth(t){this.#Ji=isNumber(t)?t:this.#Ji}get lineWidth(){return this.#Ji}set stateMachine(t){this.#ne=new StateMachine(t,this)}get stateMachine(){return this.#ne}start(){this.eventsListen();let[t,e]=this.cursorClick;this.layerTool.scene.clear();const i=this.layerTool.scene.context;i.save(),i.lineWidth=this.lineWidth,i.strokeStyle=this.colour,i.beginPath(),i.moveTo(t,e),i.lineTo(300,150),i.stroke(),i.closePath(),i.restore(),this.elViewport.render()}}class Measure extends Tool{constructor(t){super(t)}}class RangeTool extends Tool{constructor(t){super(t)}}class Text extends Tool{constructor(t){super(t)}}var tools=[{id:"cursor",name:"Cursor",icon:cursor,event:"tool_activated"},{id:"line",name:"Line",icon:line,event:"tool_activated",class:Line,sub:[{id:"ray",name:"Ray",icon:line,event:"tool_activated",class:Line},{id:"hRay",name:"Horizontal Ray",icon:line,event:"tool_activated",class:Line},{id:"vRay",name:"Vertical Ray",icon:line,event:"tool_activated",class:Line}]},{id:"fibonacci",name:"Fibonacci",icon:fibonacci,event:"tool_activated",class:Fibonacci,sub:[{id:"fib",name:"Not Implemented Yet",icon:line}]},{id:"range",name:"Range",icon:range,event:"tool_activated",class:RangeTool,sub:[{id:"rng",name:"Not Implemented Yet",icon:line}]},{id:"text",name:"Text",icon:text,event:"tool_activated",class:Text,sub:[{id:"txt",name:"Not Implemented Yet",icon:line}]},{id:"measure",name:"Measure",icon:measure,event:"tool_activated",class:Measure},{id:"delete",name:"Delete",icon:del,event:"tool_activated",class:void 0}];const lineConfig={colour:"#8888AACC",lineWidth:1};var stateMachineConfig$1={id:"template",initial:"idle",context:{},states:{idle:{onEnter(t){console.log("idle: onEnter")},onExit(t){console.log("idle: onExit")},on:{tool_activated:{target:"tool_activated",action(t){this.context.origin.onToolActivated(t)}}}},tool_activated:{onEnter(t){},onExit(t){},on:{tool_targetSelected:{target:"tool_addToTarget",action(t){this.context.origin.onToolTargetSelected(t)}}}},tool_addToTarget:{onEnter(t){},onExit(t){},on:{always:{target:"idle",condition:"toolTarget",action(t){this.context.origin.addNewTool()}}}}},guards:{toolTarget:()=>!0}};class ToolsBar{#rt="Toolbar";#ot="tools";#o;#ie;#ne;#ts;#Xi;#es=Tool;#is;#ss={};#ns=void 0;#rs;constructor(t,e){this.#o=t,this.#ie=e,this.#ts=t.elTools,this.#is=tools||t.config.tools,this.#Xi=t.WidgetsG,this.init()}log(t){this.#o.log(t)}info(t){this.#o.info(t)}warning(t){this.#o.warn(t)}error(t){this.#o.error(t)}get name(){return this.#rt}get shortName(){return this.#ot}get core(){return this.#o}get options(){return this.#ie}get pos(){return this.dimensions}get dimensions(){return DOM.elementDimPos(this.#ts)}set stateMachine(t){this.#ne=new StateMachine(t,this)}get stateMachine(){return this.#ne}init(){this.mount(this.#ts),this.log(`${this.#rt} instantiated`)}start(){this.initAllTools(),this.addAllTools(),this.eventsListen(),stateMachineConfig$1.context=this,this.stateMachine=stateMachineConfig$1,this.stateMachine.start()}end(){this.stateMachine.destroy();const t=this.#o,e=DOM.findBySelectorAll(`#${t.id} .${CLASS_TOOLS} .icon-wrapper`);for(let t of e)for(let e of this.#is)e.id===id&&t.removeEventListener("click",this.onIconClick);this.off("tool_selected",this.onToolSelect),this.off("tool_deselected",this.onToolDeselect)}eventsListen(){this.on("tool_selected",(t=>{this.onToolSelect.bind(this)})),this.on("tool_deselected",(t=>{this.onToolDeselect.bind(this)}))}on(t,e,i){this.#o.on(t,e,i)}off(t,e){this.#o.off(t,e)}emit(t,e){this.#o.emit(t,e)}onIconClick(t){t.currentTarget.dataset.event;let e=t.currentTarget.dataset.menu||!1,i={target:t.currentTarget.id,menu:e,evt:t.currentTarget.dataset.event,tool:t.currentTarget.dataset.tool};e?this.emit("openMenu",i):this.emit("menuItemSelected",i)}onToolTargetSelected(t){console.log("tool_targetSelected",t.target),this.#rs=t.target}onToolActivated(t){console.log("Tool activated:",t),this.#ns=t}onToolSelect(t){}onToolDeselect(t){}mount(t){t.innerHTML=this.defaultNode()}initAllTools(){const t=this.#o,e=DOM.findBySelectorAll(`#${t.id} .${CLASS_TOOLS} .icon-wrapper`);for(let t of e){let e=t.id,i=t.querySelector("svg");i.style.fill=ToolsStyle.COLOUR_ICON,i.style.width="90%";for(let i of this.#is)if(i.id===e)if(t.addEventListener("click",this.onIconClick.bind(this)),i?.sub){let e={content:i.sub,primary:t},s=this.#Xi.insert("Menu",e);t.dataset.menu=s.id,s.start();for(let t of i.sub)this.#ss[t.id]=t.class}else this.#ss[i.id]=i.class}}defaultNode(){let t=`\n    <style>\n      svg {\n        height: ${ToolsStyle.ICONSIZE};\n        fill: ${ToolsStyle.COLOUR_ICON};\n      }\n    </style>\n    `;for(const e of this.#is)t+=this.iconNode(e);return t}iconNode(t){const e=`display: inline-block; height: ${ToolsStyle.ICONSIZE}; margin-left: -3px;`,i="sub"in t?'data-menu="true"':"";return`\n      <div id="${t.id}" data-event="${t.event}" ${i} class="icon-wrapper" style="${e}">${t.icon}</div>\n\n    `}addTool(t=this.#ns,e=this.#rs){let i={name:t,tool:this.#ss[t],pos:e.cursorClick},s=this.#es.create(e,i);return s.start(),console.log(s),s}addNewTool(t,e){let i=this.addTool(t,e);this.activeTool=i,this.emit("tool_active",i),this.emit(`tool_${i.ID}_active`,i)}addAllTools(){}}const MENUMINWIDTH=150;class Menu{#e;#Xi;#o;#w;#os;#as;#hs;#Vt;#ke;static menuList={};static menuCnt=0;static class=CLASS_MENUS;static name="Menus";static type="menu";static currentActive;constructor(t,e){this.#Xi=t,this.#o=e.core,this.#w=e,this.#e=e.id,this.#as=t.elements.elMenus,this.#os=this.#o.elWidgetsG,this.init()}static create(t,e){const i="menu"+ ++Menu.menuCnt;return e.id=i,Menu.menuList[i]=new Menu(t,e),Menu.menuList[i]}static destroy(t){Menu.menuList[t].end(),delete Menu.menuList[t]}get el(){return this.#hs}get id(){return this.#e}get pos(){return this.dimensions}get dimensions(){return DOM.elementDimPos(this.#hs)}init(){this.mount(this.#as)}start(){this.position(this.#w.primary),this.eventsListen()}end(){const t=this.#w;DOM.findBySelectorAll(`#${t.id} .${CLASS_MENU} li`).forEach((t=>{t.removeEventListener("click",this.onMenuSelect)})),document.removeEventListener("click",this.onOutsideClickListener)}eventsListen(){const t=this.#o;DOM.findBySelectorAll(`#${t.id} #${this.#w.id} li`).forEach((t=>{t.addEventListener("click",this.onMenuSelect.bind(this))})),document.addEventListener("click",this.onOutsideClickListener.bind(this))}on(t,e,i){this.#o.on(t,e,i)}off(t,e){this.#o.off(t,e)}emit(t,e){this.#o.emit(t,e)}onMenuSelect(t){let e=t.currentTarget.dataset.event,i={target:t.currentTarget.id,menu:this.#e,evt:e};this.emit("menuItemSelected",i),this.emit("closeMenu",i)}onOutsideClickListener(t){if(!this.#hs.contains(t.target)&&!this.#w.primary.contains(t.target)&&DOM.isVisible(this.#hs)){let e={target:t.currentTarget.id,menu:this.#e};this.emit("closeMenu",e)}}mount(t){const e=this.#o;null==t.lastElementChild?t.innerHTML=this.menuNode():t.lastElementChild.insertAdjacentHTML("afterend",this.menuNode()),this.#hs=DOM.findBySelector(`#${e.id} #${this.#w.id}`)}static defaultNode(){return`\n      <div slot="widget" class="${CLASS_MENUS}" style=""></div>\n    `}menuNode(){const t=this.#w,e=`position: absolute; z-index: 1000; display: none; border: 1px solid ${MenuStyle.COLOUR_BORDER}; background: ${MenuStyle.COLOUR_BG}; color: ${MenuStyle.COLOUR_TXT};`;let i=this.content(t);return`\n      <div id="${t.id}" class="${CLASS_MENU}" style="${e}">\n        ${i}\n      </div>\n    `}content(t){const e="cursor: pointer;";let i='<ul style="list-style: none; text-align: left; margin:1em 1em 1em -2.5em; min-width: 150px">';if(t?.content)for(let s of t.content)i+=`<li id="${s.id}" data-event="${s.event}" style="padding: .25em 1em .25em 1em; white-space: nowrap; ${e}" onmouseover="this.style.background ='#222'" onmouseout="this.style.background ='none'"><a style="${e}"><span style="display: inline-block; width: 4em;">${s.id}</span><span>${s.name}</span></li></a>`;return i+="</ul>",i}position(t){let e=this.#os.getBoundingClientRect(),i=t.getBoundingClientRect();this.#hs.style.left=Math.round(i.left-e.left)+"px",this.#hs.style.top=Math.round(i.bottom-e.top)+"px"}remove(){}open(){let t=Menu.currentActive?.id||!1;t&&this.emit("closeMenu",{menu:t}),Menu.currentActive=this,this.#hs.style.display="block";let e=DOM.elementDimPos(this.#hs);if(e.left+e.width>this.#os.offsetWidth){let t=Math.floor(this.#os.offsetWidth-e.width);t=limit(t,0,this.#os.offsetWidth),this.#hs.style.left=`${t}px`}}close(){Menu.currentActive=null,this.#hs.style.display="none",this.emit("menuClosed",this.id)}}class Window{#e;#Xi;#o;#w;#os;#ls;#cs;#Vt;#ke;static windowList={};static windowCnt=0;static class=CLASS_WINDOWS;static name="Windows";static type="window";static currentActive=null;constructor(t,e){this.#Xi=t,this.#o=e.core,this.#w=e,this.#e=e.id,this.#ls=t.elements.elWindows,this.#os=this.#o.elWidgetsG,this.init()}static create(t,e){const i="window"+ ++Window.windowCnt;return e.id=i,Window.windowList[i]=new Window(t,e),Window.windowList[i]}static destroy(t){Window.windowList[t].end(),delete Window.windowList[t]}get el(){return this.#cs}get id(){return this.#e}get pos(){return this.dimensions}get config(){return this.#w}set config(t){this.#w=t}get dimensions(){return DOM.elementDimPos(this.#cs)}init(){this.mount(this.#ls)}start(){this.eventsListen(),this.open()}end(){document.removeEventListener("click",this.onOutsideClickListener)}eventsListen(){this.#o,this.on("closeWindow",(t=>{t.window===this.#e&&this.close()}))}on(t,e,i){this.#o.on(t,e,i)}off(t,e){this.#o.off(t,e)}emit(t,e){this.#o.emit(t,e)}onOutsideClickListener(t){if(!this.#cs.contains(t.target)&&DOM.isVisible(this.#cs)){let e={target:t.currentTarget.id,window:this.#e};this.emit("closeWindow",e)}}mount(t){const e=this.#o;let i,s;if(null==t.lastElementChild?t.innerHTML=this.windowNode():t.lastElementChild.insertAdjacentHTML("afterend",this.windowNode()),this.#cs=DOM.findBySelector(`#${e.id} #${this.#w.id}`),this.#w.x&&this.#w.y)i=this.#w.x,s=this.#w.y;else{let t=DOM.elementDimPos(this.#cs);i=(this.#o.width-t.width)/2,s=(this.#o.height-t.height)/2}this.#cs.style.bottom=`${s}px`,this.#cs.style.left=`${i}px`}static defaultNode(){return`\n      <div slot="widget" class="${CLASS_WINDOWS}" style=""></div>\n    `}windowNode(){const t=this.#w,e=`position: absolute; z-index: 1000; display: block; border: 1px solid ${WindowStyle.COLOUR_BORDER}; background: ${WindowStyle.COLOUR_BG}; color: ${WindowStyle.COLOUR_TXT};`;let i=this.dragBar(t),s=this.content(t),n=this.closeIcon(t);return`\n      <div id="${t.id}" class="${CLASS_WINDOW}" style="${e}">\n          ${i}\n          ${n}\n          ${s}\n        </div>\n      </div>\n    `}content(t){return`\n      <div class="content" style="padding: 2em;">\n        ${t?.content?t.content:""}\n      </div>\n    `}dragBar(t){this.#o;let e="";return t.dragBar&&(e+='\n      <div class="dragBar" cursor: grab; onmouseover="this.style.background =\'#222\'" onmouseout="this.style.background =\'none\'">\n      </div>\n    '),e}closeIcon(t){this.#o;let e="";return t.closeIcon&&(e+='\n      <div class="closeIcon" cursor: pointer; onmouseover="this.style.background =\'#222\'" onmouseout="this.style.background =\'none\'">\n        <span>X</span>\n      </div>\n    '),e}position(t){let e=this.#os.getBoundingClientRect(),i=t.getBoundingClientRect();this.#cs.style.left=Math.round(i.left-e.left)+"px",this.#cs.style.top=Math.round(i.bottom-e.top)+"px"}remove(){}open(){Window.currentActive=this,this.#cs.style.display="block",this.emit("windowOpened",this.id),setTimeout((()=>{document.addEventListener("click",this.onOutsideClickListener.bind(this))}),1e3)}close(){Window.currentActive=null,this.#cs.style.display="none",this.emit("windowClosed",this.id),document.removeEventListener("click",this.onOutsideClickListener)}}class Dialogue extends Window{static type="window";constructor(t,e){super(),e.dragbar=!0,e.close=tue,this.config=e}}class Divider{#e;#o;#w;#Xi;#ds;#us;#gs;#ms;#Vt;#ke;#Yt;static dividerList={};static divideCnt=0;static class=CLASS_DIVIDERS;static name="Dividers";static type="divider";constructor(t,e){const i={...e};this.#Xi=t,this.#o=i.core,this.#w=i,this.#e=i.id,this.#ds=i.offChart,this.#us=t.elements.elDividers,this.#ms=this.#ds.element,this.init()}static create(t,e){const i="divider"+ ++Divider.divideCnt;return e.id=i,Divider.dividerList[i]=new Divider(t,e),Divider.dividerList[i]}static destroy(t){Divider.dividerList[t].end(),delete Divider.dividerList[t]}get el(){return this.#gs}get ID(){return this.#e}get offChart(){return this.#ds}get config(){return this.#o.config}get pos(){return this.dimensions}get dimensions(){return DOM.elementDimPos(this.#gs)}get height(){return this.#gs.getBoundingClientRect().height}init(){this.mount()}start(){this.setCursor("n-resize"),this.eventsListen()}end(){this.#Yt.off("pointerenter",this.onMouseEnter),this.#Yt.off("pointerout",this.onMouseOut),this.#Yt.off("pointerdrag",this.onPointerDrag),this.#Yt.off("pointerdragend",this.onPointerDragEnd),this.#Yt=null,this.el.remove()}eventsListen(){this.#Yt=new Input(this.#gs,{disableContextMenu:!1}),this.#Yt.on("pointerenter",this.onMouseEnter.bind(this)),this.#Yt.on("pointerout",this.onMouseOut.bind(this)),this.#Yt.on("pointerdrag",this.onPointerDrag.bind(this)),this.#Yt.on("pointerdragend",this.onPointerDragEnd.bind(this))}on(t,e,i){this.#o.on(t,e,i)}off(t,e){this.#o.off(t,e)}emit(t,e){this.#o.emit(t,e)}onMouseEnter(){this.#gs.style.background="#888888C0",this.#o.MainPane.onMouseEnter()}onMouseOut(){this.#gs.style.background="#FFFFFF00",this.#o.MainPane.onMouseEnter()}onPointerDrag(t){this.#Vt=[t.position.x,t.position.y],this.emit(`${this.ID}_pointerdrag`,this.#Vt),this.emit("divider_pointerdrag",{id:this.ID,e:t,pos:this.#Vt,offChart:this.offChart})}onPointerDragEnd(t){"position"in t&&(this.#Vt=[t.position.x,t.position.y]),this.emit(`${this.ID}_pointerdragend`,this.#Vt),this.emit("divider_pointerdragend",{id:this.ID,e:t,pos:this.#Vt,offChart:this.offChart})}mount(){null==this.#us.lastElementChild?this.#us.innerHTML=this.dividerNode():this.#us.lastElementChild.insertAdjacentHTML("afterend",this.defaultNode()),this.#gs=DOM.findBySelector(`#${this.#e}`,this.#us)}setCursor(t){this.#gs.style.cursor=t}static defaultNode(){return`\n  <div slot="widget" class="${CLASS_DIVIDERS}" style="position: absolute;"></div>\n  `}dividerNode(){let t=this.#ds.pos.top-DOM.elementDimPos(this.#us).top,e=this.#o.MainPane.rowsW+this.#o.scaleW,i=isNumber(this.config.dividerHeight)?this.config.dividerHeight:8,s=this.#o.theme.tools.width;switch(t-=i/2,this.#o.theme.tools.location){case"left":break;case!1:case"none":case"right":s*=-1}const n=`position: absolute; top: ${t}px; left: ${s}px; z-index:100; width: ${e}px; height: ${i}px; background: #FFFFFF00;`;return`\n      <div id="${this.#e}" class="divider" style="${n}"></div>\n    `}updateDividerPos(t){let e=this.#gs.offsetTop;e+=t[5],this.#gs.style.top=`${e}px`}setDividerPos(){let t=this.#ds.pos.top-DOM.elementDimPos(this.#us).top;t-=this.height/2,this.#gs.style.top=`${t}px`}}var stateMachineConfig={id:"widgets",initial:"idle",context:{},states:{idle:{onEnter(t){console.log(`${this.id}: state: "${this.state}" - onEnter`)},onExit(t){console.log(`${this.id}: state: "${this.state}" - onExit (${this.event})`)},on:{openMenu:{target:"openMenu",action(t){console.log(`${this.id}: transition from "${this.state}" to "openMenu" on ${this.event}`)}}}},openMenu:{onEnter(t){console.log(`${this.id}: state: "${this.state}" - onEnter`)},onExit(t){console.log(`${this.id}: state: "${this.state}" - onExit (${this.event})`)},on:{closeMenu:{target:"idle",action(t){console.log(`${this.id}: transition from "${this.state}" to "idle" on "${this.event}"`)}}}},openWindow:{onEnter(t){console.log(`${this.id}: state: "${this.state}" - onEnter`)},onExit(t){console.log(`${this.id}: state: "${this.state}" - onExit (${this.event})`)},on:{closeWindow:{target:"idle",action(t){console.log(`${this.id}: transition from "${this.state}" to "idle" on "${this.event}"`)}}}}}};class Widgets{#rt="Widgets";#ot="widgets";#o;#ie;#ne;#Xi;#ps={Dialogue:Dialogue,Divider:Divider,Menu:Menu,Window:Window};#fs={};#Si={};#os;#ys;#xs;constructor(t,e){this.#o=t,this.#ie=e,this.#Xi={...this.#ps,...e.widgets},this.#os=t.elWidgetsG,this.init()}log(t){this.#o.log(t)}info(t){this.#o.info(t)}warning(t){this.#o.warn(t)}error(t){this.#o.error(t)}get name(){return this.#rt}get shortName(){return this.#ot}get core(){return this.#o}get options(){return this.#ie}get elements(){return this.#Si}get instances(){return this.#fs}set stateMachine(t){this.#ne=new StateMachine(t,this)}get stateMachine(){return this.#ne}init(){this.mount(this.#os);for(let t in this.#Xi){let e=this.#Xi[t],i=`el${e.name}`;this.#Si[i]=this.#os.querySelector(`.${e.class}`)}}start(){this.eventsListen(),stateMachineConfig.context=this,this.stateMachine=stateMachineConfig,this.stateMachine.start()}end(){this.off("openMenu",this.onOpenMenu),this.off("closeMenu",this.onCloseMenu),this.off("offMenu",this.onCloseMenu),this.off("menuItemSelected",this.onMenuItemSelected),this.stateMachine.destroy()}eventsListen(){this.on("openMenu",this.onOpenMenu.bind(this)),this.on("closeMenu",this.onCloseMenu.bind(this)),this.on("offMenu",this.onCloseMenu.bind(this)),this.on("menuItemSelected",this.onMenuItemSelected.bind(this))}on(t,e,i){this.#o.on(t,e,i)}off(t,e){this.#o.off(t,e)}emit(t,e){this.#o.emit(t,e)}onResize(t){this.setDimensions(t)}onOpenMenu(t){console.log("onOpenMenu:",t),this.#fs[t.menu].open()}onCloseMenu(t){console.log("onCloseMenu:",t),this.#fs[t.menu].close()}onMenuItemSelected(t){this.emit(t.evt,t.target)}mount(t){t.innerHTML=this.defaultNode()}setWidth(t){this.#ys=t}setHeight(t){this.#xs=t}setDimensions(t){this.setWidth(t.mainW),this.setHeight(t.mainH)}defaultNode(){let t="",e=[];for(let i in this.#Xi){let s=this.#Xi[i];-1===e.indexOf(s.type)&&(t+=s.defaultNode(),e.push(s.type))}return t}insert(t,e){e.core=this.core;const i=this.#Xi[t].create(this,e);return this.#fs[i.id]=i,i}remove(t,e){delete this.#fs[e],this.#Xi[t].destroy(e)}}class TradeXchart extends tradeXChart{static#Ht=0;static#vs={};static#qi={};static#ws=null;static#Ss=!1;static#Cs=[];static#Ms=null;static get talibPromise(){return TradeXchart.#ws}static get talibReady(){return TradeXchart.#Ss}static get talibAwait(){return TradeXchart.#Cs}static get talibError(){return TradeXchart.#Ms}static initErrMsg=`${NAME} requires "talib-web" to function properly. Without it, some features maybe missing or broken.`;static permittedClassNames=["TradeXchart","Chart","MainPane","OffChart","OnChart","ScaleBar","Timeline","ToolsBar","UtilsBar","Widgets"];#e;#rt=NAME;#ot=NAME;#Ts=void 0;#As;#o;#w;#ie;#Si={};#bs;#Fi;#Ui;#ts;#mi;#pi;#fi;#gi;#os;#Ki=null;#Ls;#Es={};#t={};#Ds=[];#Os=!0;#s;#gt;#Rs;#Is=500;#Ri=Indicators;#ut;#Q;#Ps;chartWMin=400;chartHMin=300;chartW_Reactive=!0;chartH_Reactive=!0;chartBGColour=GlobalStyle.COLOUR_BG;chartTxtColour=GlobalStyle.COLOUR_TXT;chartBorderColour=GlobalStyle.COLOUR_BORDER;utilsH=35;toolsW=40;timeH=50;scaleW=60;#_s;#Ns;#$s={chart:{},time:{}};#ks;panes={utils:this.#_s,tools:this.#Ns,main:this.#$s};#O={rangeTotal:!0,range:{},total:{},timeFrameMS:0,timeFrame:"",timeZone:"",indexed:!1};logs=!1;infos=!1;warnings=!1;errors=!1;timer=!1;#Hs={x:0,y:0};#Bs=0;#Ws=0;#Us=[null,null,null,null];#Fs;#Gs;#Vs;#si;#ni;#zs=!1;#Ys={status:"idle",buffer:{n:!0,1:{},2:{}},curr:{frame:null,priority:0},cache:[]};static create(t={}){0==TradeXchart.#Ht&&(TradeXchart.#vs.CPUCores=navigator.hardwareConcurrency,TradeXchart.#vs.api={permittedClassNames:TradeXchart.permittedClassNames}),"object"==typeof t.talib&&"function"==typeof t.talib.init||(TradeXchart.#Ss=!1,TradeXchart.#Ms=new Error(`${TradeXchart.initErrMsg}`)),TradeXchart.#Ss||null!==TradeXchart.#Ms||(TradeXchart.#ws=t.talib.init(t.wasm)),TradeXchart.#ws.then((()=>{TradeXchart.#Ss=!0;for(let t of TradeXchart.#Cs)isFunction(t)&&t()}),(()=>{TradeXchart.#Ss=!1}))}static destroy(t){if(t instanceof TradeXchart){t.end();const e=t.inCnt;delete TradeXchart.#qi[e]}}static cnt(){return TradeXchart.#Ht++}constructor(){super(),this.#Ki=TradeXchart.cnt(),this.#e=`${ID}_${this.#Ki}`,console.warn(`!WARNING!: ${NAME} breaking changes since V 0.101.7`),console.log("TXC:",this.inCnt),this.oncontextmenu=window.oncontextmenu,this.#Fs=WebWorker$1}log(t){this.logs&&console.log(t)}info(t){this.infos&&console.info(t)}warning(t){this.warnings&&console.warn(t)}error(t){this.errors&&console.error(t)}time(t){this.timer&&console.time(t)}timeLog(t){this.timer&&console.timeLog(t)}timeEnd(t){this.timer&&console.timeEnd(t)}set id(t){this.#e=t}get id(){return this.#e}get name(){return this.#rt}get shortName(){return this.#ot}get mediator(){return this.#As}get options(){return this.#ie}get config(){return this.#w}get core(){return this.#o}get inCnt(){return this.#Ki}set elUtils(t){this.#Fi=t}get elUtils(){return this.#Fi}set elTools(t){this.#ts=t}get elTools(){return this.#ts}set elBody(t){this.#Ui=t}get elBody(){return this.#Ui}set elMain(t){this.#mi=t}get elMain(){return this.#mi}set elTime(t){this.#fi=t}get elTime(){return this.#fi}set elYAxis(t){this.#gi=t}get elYAxis(){return this.#gi}set elWidgetsG(t){this.#os=t}get elWidgetsG(){return this.#os}get UtilsBar(){return this.#_s}get ToolsBar(){return this.#Ns}get MainPane(){return this.#$s}get Timeline(){return this.#$s.time}get WidgetsG(){return this.#ks}get Chart(){return this.#$s.chart}get Indicators(){return this.#$s.indicators}get state(){return this.#t}get chartData(){return this.#t.data.chart.data}get offChart(){return this.#t.data.offchart}get onChart(){return this.#t.data.onchart}get datasets(){return this.#t.data.datasets}get allData(){return{data:this.chartData,onChart:this.onChart,offChart:this.offChart,datasets:this.datasets}}get rangeLimit(){return isNumber(this.#Is)?this.#Is:500}get range(){return this.#gt}get time(){return this.#O}get TimeUtils(){return Time}get theme(){return this.#Q.getCurrent()}get settings(){return this.#t.data.chart.settings}get indicators(){return this.#Ri}get TALib(){return this.#ut}get TALibReady(){return TradeXchart.talibReady}get TALibError(){return TradeXchart.talibError}get talibAwait(){return TradeXchart.talibAwait}get TALibPromise(){return TradeXchart.talibPromise}get hub(){return this.#Es}get candleW(){return this.Timeline.candleW}get candlesOnLayer(){return this.Timeline.candlesOnLayer}get buffer(){return this.MainPane.buffer}get bufferPx(){return this.MainPane.bufferPx}set scrollPos(t){this.setScrollPos(t)}get scrollPos(){return this.#Bs}get smoothScrollOffset(){return 0}get rangeScrollOffset(){return Math.floor(this.bufferPx/this.candleW)}get mousePos(){return this.#Hs}get pricePrecision(){return this.#si}get volumePrecision(){return this.#ni}set stream(t){return this.setStream(t)}get stream(){return this.#Gs}get worker(){return this.#Fs}get isEmpty(){return this.#Os}set candles(t){isObject(t)&&(this.#Vs=t)}get candles(){return this.#Vs}start(t){t={...TradeXchart.create(t),...t},this.logs=!!t?.logs&&t.logs,this.infos=!!t?.infos&&t.infos,this.warnings=!!t?.warnings&&t.warnings,this.errors=!!t?.errors&&t.errors,this.timer=!!t?.timer&&t.timer,this.#w=t,this.#Ki=t.cnt||this.#Ki,this.#Ls=t.modID,this.#ut=t.talib,this.#Ts=this,this.#o=this;let e=copyDeep(t?.state),i=t?.deepValidate||!1,s=t?.isCrypto||!1;this.#t=State.create(e,i,s),delete t.state,this.log(`Chart ${this.#e} created with a ${this.#t.status} state`);let n="1s",r=1e3;this.#Os=!0,!isObject(t?.stream)&&this.#t.data.chart.data.length<2?(this.warning(`${NAME} has no chart data or streaming provided.`),({tf:n,ms:r}=isTimeFrame(t?.timeFrame))):isObject(t?.stream)&&this.#t.data.chart.data.length<2?(({tf:n,ms:r}=isTimeFrame(t?.timeFrame)),this.#zs=!0):(n=this.#t.data.chart.tf,r=this.#t.data.chart.tfms,this.#Os=!1),this.#O.timeFrame=n,this.#O.timeFrameMS=r,console.log("tf:",n,"ms:",r);const o=isObject(t)&&isString$1(t.id)?t.id:null;if(this.setID(o),this.classList.add(this.id),isObject(t))for(const e in t)e in this.props()&&this.props()[e](t[e]);if(this.getRange(null,null,{interval:this.#O.timeFrameMS,core:this}),this.#gt.Length>1){const t=calcTimeIndex(this.#O,this.#Rs),e=t?t+this.#Is:this.chartData.length-1,i=t||e-this.#Is;this.#Is=e-i,this.setRange(i,e)}this.insertAdjacentHTML("beforebegin",`<style title="${this.id}_style"></style>`),this.#ks=new Widgets(this,{widgets:t?.widgets}),this.#_s=new UtilsBar(this,t),this.#Ns=new ToolsBar(this,t),this.#$s=new MainPane(this,t),this.setTheme(this.#Ps.ID),this.log(`${this.#rt} instantiated`),this.log("...processing state"),this.#Bs=-1*this.bufferPx,this.eventsListen(),this.elStart(this.theme),this.elBody.start(this.theme),this.UtilsBar.start(),this.ToolsBar.start(),this.MainPane.start(),this.WidgetsG.start(),this.stream=this.#w.stream,this.#zs&&this.on(STREAM_UPDATE,this.delayedSetRange.bind(this)),this.refresh()}end(){this.log("...cleanup the mess"),this.removeEventListener("mousemove",this.onMouseMove),this.off(STREAM_UPDATE,this.onStreamUpdate),this.UtilsBar.end(),this.ToolsBar.end(),this.MainPane.end(),this.WidgetsG.end(),this.#Fs.end(),this.#t=null}eventsListen(){this.addEventListener("mousemove",this.onMouseMove.bind(this)),this.on(STREAM_UPDATE,this.onStreamUpdate.bind(this))}on(t,e,i){isString$1(t)&&isFunction(e)&&(this.#Es[t]||(this.#Es[t]=[]),this.#Es[t].push({handler:e,context:i}))}off(t,e){if(!isString$1(t))return;const i=(this.#Es[t]||[]).findIndex((t=>t===e));i>-1&&this.#Es[t].splice(i,1),0===this.#Es[t].length&&delete this.#Es[t]}emit(t,e){isString$1(t)&&(this.#Es[t]||[]).forEach((t=>t.handler.call(t.context,e)))}execute(t,e,i){}onMouseMove(t){this.#Hs.x=t.clientX,this.#Hs.y=t.clientY}onStreamUpdate(t){const e=this.range;if(e.inRange(t[0])){const i=e.valueMax,s=e.valueMin;(t[2]>i||t[3]<s)&&(this.setRange(e.indexStart,e.indexEnd),this.emit("chart_yAxisRedraw",this.range))}}props(){return{width:t=>this.setWidth(t),height:t=>this.setHeight(t),widthMin:t=>this.setWidthMin(t),heightMin:t=>this.setHeightMin(t),widthMax:t=>this.setWidthMax(t),heightMax:t=>this.setHeightMax(t),logs:t=>this.logs=!!isBoolean(t)&&t,infos:t=>this.infos=!!isBoolean(t)&&t,warnings:t=>this.warnings=!!isBoolean(t)&&t,errors:t=>this.errors=!!isBoolean(t)&&t,rangeStartTS:t=>this.#Rs=isNumber(t)?t:void 0,rangeLimit:t=>this.#Is=isNumber(t)?t:500,indicators:t=>this.setIndicators(t),theme:t=>{this.#Ps=this.addTheme(t)},stream:t=>this.#Gs=isObject(t)?t:{},pricePrecision:t=>this.setPricePrecision(t),volumePrecision:t=>this.setVolumePrecision(t)}}getInCnt(){return this.#Ki}setID(t){isString$1(t)?this.#e=t+this.#Ki:this.#e=ID+this.#Ki}getID(){return this.#e}getModID(){return this.#Ls}setDimensions(t,e){const i=super.setDimensions(t,e);this.emit("global_resize",i)}setUtilsH(t){this.utilsH=t,this.#Fi.style.height=`${t}px`}setToolsW(t){this.toolsW=t,this.#ts.style.width=`${t}px`}setNotEmpty(){this.#Os=!1}setPricePrecision(t){(!isNumber(t)||t<0)&&(t=2),this.#si=t}setVolumePrecision(t){(!isNumber(t)||t<0)&&(t=2),this.#ni=t}addTheme(t){return this.#Q=Theme.create(t,this),this.#Q}setTheme(t){this.#Q.current=t;const e=this.#Q,i=document.querySelector(`style[title=${this.id}_style]`),s=`var(--txc-border-color, ${e.chart.BorderColour}`;let n=`.${this.id} { `;n+=`--txc-background: ${e.chart.Background}; `,this.style.background=`var(--txc-background, ${e.chart.Background})`,this.style.border=`${e.chart.BorderThickness}px solid`,this.style.borderColor=s,n+=`--txc-border-color:  ${e.chart.BorderColour}; `,this.#mi.rows.style.borderColor=s,n+=`--txc-time-scrollbar-color: ${e.chart.BorderColour}; `,n+=`--txc-time-handle-color: ${e.xAxis.handle}; `,n+=`--txc-time-slider-color: ${e.xAxis.slider}; `,n+=`--txc-time-cursor-fore: ${e.xAxis.colourCursor}; `,n+=`--txc-time-cursor-back: ${e.xAxis.colourCursorBG}; `,n+=`--txc-time-icon-color: ${e.icon.colour}; `,n+=`--txc-time-icon-hover-color: ${e.icon.hover}; `,this.#fi.overview.scrollBar.style.borderColor=s,this.#fi.overview.handle.style.backgroundColor=`var(--txc-time-handle-color, ${e.xAxis.handle})`,this.#fi.overview.style.setProperty("--txc-time-slider-color",e.xAxis.slider),this.#fi.overview.style.setProperty("--txc-time-icon-color",e.icon.colour),this.#fi.overview.style.setProperty("--txc-time-icon-hover-color",e.icon.hover);for(let[t,i]of Object.entries(this.Chart.legend.list))i.el.style.color=`var(--txc-legend-color, ${e.legend.colour})`,i.el.style.font=`var(--txc-legend-font, ${e.legend.font})`;for(let t of this.#Fi.icons)"icon-wrapper"==t.className&&(t.children[0].style.fill=e.icon.colour);for(let t of this.#ts.icons)"icon-wrapper"==t.className&&(t.children[0].style.fill=e.icon.colour);n+=" }",i.innerHTML=n}setScrollPos(t){isNumber(t=Math.round(t))&&t<=0&&t>=-1*this.bufferPx?this.#Bs=t:this.emit("Error","setScrollPos: not a valid value")}setStream(t){return this.stream instanceof Stream?(this.error("Error: Invoke stopStream() before starting a new one."),!1):isObject(t)?(0==this.allData.data.length&&isString$1(t.timeFrame)&&(({tf:tf,ms:ms}=isTimeFrame(t?.timeFrame)),this.#O.timeFrame=tf,this.#O.timeFrameMS=ms),this.#Gs=new Stream(this),this.#w.stream=this.#Gs.config,this.#Gs):void 0}stopStream(){this.stream instanceof Stream&&this.stream.stop()}delayedSetRange(){for(;this.#zs;){let t=.5*this.range.Length;this.setRange(-1*t,t),this.off(STREAM_UPDATE,this.delayedSetRange),this.#zs=!1}}updateRange(t){if(!isArray(t)||!isNumber(t[4])||0==t[4])return;let e,i;e=t[4],i=this.#Bs+e,this.candleW,i<-1*this.bufferPx?(i=0,this.offsetRange(-1*this.rangeScrollOffset)):i>0&&(i=-1*this.bufferPx,this.offsetRange(this.rangeScrollOffset)),this.#Bs=i,this.emit("scrollUpdate",i)}offsetRange(t){let e=this.range.indexStart-t,i=this.range.indexEnd-t;this.setRange(e,i)}getRange(t=0,e=0,i={}){this.#gt=new Range(this.allData,t,e,i),this.#gt.interval=this.#O.timeFrameMS,this.#gt.intervalStr=this.#O.timeFrame,this.#O.range=this.#gt}setRange(t=0,e=this.rangeLimit){const i=this.config?.maxCandles?this.config.maxCandles:this.Chart?.layerWidth?this.Chart.layerWidth:this.Chart.width;this.#gt.set(t,e,i)}jumpToIndex(t,e=!0,i=!0){let s=this.range.Length,n=t+s;e&&(t=limit(t,0,this.range.dataLength)),i&&(t-=s/2,n-=s/2),this.setRange(t,n)}jumpToTS(t,e=!0,i=!0){let s=this.Timeline.xAxis.t2Index(t);this.jumpToIndex(s,!0,!0)}jumpToStart(t=!0,e=!0){this.jumpToIndex(0,!0,!0)}jumpToEnd(t=!0,e=!0){let i=this.range.dataLength-this.range.Length;e&&(i+=this.range.Length/2),this.jumpToIndex(i,!0,e=!1)}mergeData(t,e=!1,i=!0){if(!isObject(t))return!1;let s,n,r,o;const a=this.allData.data,h=t?.data||!1;this.allData?.onChart,t?.onChart,this.allData?.offChart,t?.offChart,this.allData?.dataset?.data;const l=t?.dataset?.data||!1,c=this.allData?.trades?.data;t?.trades?.data;const d=this.range.inRange(h[0][0])?1:0;if(isArray(h)&&h.length>0){if(s=h.length-1,n=a.length-1,0==a.length)this.allData.data.push(...h),i&&this.calcAllIndicators();else{const t=[a[0][0],a[n][0]],e=[h[0][0],h[s][0]],r=[Math.max(t[0],e[0]),Math.min(t[1],e[1])];r[1]>=r[0]||(this.allData.data.push(...h),i&&this.calcAllIndicators())}if(isArray(l)&&l.length>0)for(let t of l)isArray(t?.data)&&t?.data.length;if(isArray(c)&&c.length>0)for(let t of c);e&&(isObject(e)?(r=isNumber(e.start)?e.start:this.range.indexStart,o=isNumber(e.end)?e.end:this.range.indexEnd):(h[0][0]&&(r=this.range.indexStart+d),o=this.range.indexEnd+d),this.setRange(r,o))}}isIndicator(t){return!("function"!=typeof t||!("onChart"in t.prototype)||!isFunction(t.prototype?.draw))}setIndicators(t,e=!1){if(!isObject(t))return!1;e&&(console.warn("Expunging all default indicators!"),this.#Ri={});for(const[e,i]of Object.entries(t))isString$1(i?.id)&&isString$1(i?.name)&&isString$1(i?.event)&&this.isIndicator(i?.ind)&&(this.#Ri[e]=i);return!0}addIndicator(t,e=t,i={}){if(!(isString$1(t)||t in this.#Ri||isString$1(e)||isObject(i)))return!1;const s={type:t,name:e,...i};console.log(`Adding the ${e} : ${t} indicator`),this.#Ri[t].ind.prototype.onChart?this.Chart.addIndicator(s):this.#$s.addIndicator(s),this.emit("addIndicatorDone",s)}hasStateIndicator(t,e="searchAll"){if(!isString$1(t)||!isString$1(e))return!1;const i=function(t,e){for(let i of e)return i?.id==t||i.name==t};if("searchAll"==e){for(let e of this.allData)if(i(t,e))return!0;return!1}return e in this.allData?i(t,d):void 0}calcAllIndicators(){for(let t of this.Indicators.onchart.values())t.instance.calcIndicatorHistory();for(let t of this.Indicators.offchart.values())t.instance.calcIndicatorHistory()}resize(t,e){return!(!isNumber(t)&&!isNumber(e))&&(this.setDimensions(t,e),!0)}refresh(){let t=this.range.indexStart,e=this.range.indexEnd;this.setRange(t,e),this.MainPane.draw(void 0,!0)}notImplemented(){if(this.implemented)this.implemented.open();else{let t={content:"\n        This feature is not implemented yet.\n      "};this.implemented=this.#ks.insert("Dialogue",t),this.implemented.start()}}}window.customElements.get("tradex-chart")||(document.head.insertAdjacentHTML("beforeend",cssVars),document.head.insertAdjacentHTML("beforeend",style),window.customElements.define("tradex-chart",TradeXchart));export{TradeXchart as Chart,DOM,indicator as Indicator,Overlay,copyDeep,isPromise,mergeDeep,uid};