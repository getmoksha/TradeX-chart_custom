(function(_,x){typeof exports=="object"&&typeof module<"u"?x(exports):typeof define=="function"&&define.amd?define(["exports"],x):(_=typeof globalThis<"u"?globalThis:_||self,x(_["TradeX-chart"]={}))})(this,function(_){"use strict";function x(r){return Array.isArray(r)}function E(r){return r&&typeof r=="function"}function p(r){return typeof r=="object"&&!Array.isArray(r)&&r!==null}function g(r){return typeof r=="number"&&!isNaN(r)}function it(r){return typeof r=="boolean"}function m(r){return typeof r=="string"}function $e(r){return!!r&&(p(r)||E(r))&&E(r.then)}const v={findByID(r,t=document){return t.getElementById(r)},findByClass(r,t=document){return t.getElementsByClassName(r)},findByName(r,t=document){return t.getElementsByName(r)},fndByTag(r,t=document){return t.getElementsByTagName(r)},findBySelector(r,t=document){return t.querySelector(r)},findBySelectorAll(r,t=document){return t.querySelectorAll(r)},isNode(r){return typeof Node=="object"?r instanceof Node:r&&typeof r=="object"&&typeof r.nodeType=="number"&&typeof r.nodeName=="string"},isElement(r){return typeof HTMLElement=="object"?r instanceof HTMLElement:r&&typeof r=="object"&&r!==null&&r.nodeType===1&&typeof r.nodeName=="string"},isVisible(r){return this.isElement(r)?!!r&&!!(r.offsetWidth||r.offsetHeight||r.getClientRects().length):!1},isInViewport(r){if(!this.isElement(r))return!1;const t=r.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},isVisibleToUser(r){if(!this.isElement(r))return!1;const t=getComputedStyle(elem);if(t.display==="none"||t.visibility!=="visible"||t.opacity<.1||r.offsetWidth+r.offsetHeight+r.getBoundingClientRect().height+r.getBoundingClientRect().width===0)return!1;const i={x:r.getBoundingClientRect().left+r.offsetWidth/2,y:r.getBoundingClientRect().top+r.offsetHeight/2};if(i.x<0||i.x>(document.documentElement.clientWidth||window.innerWidth)||i.y<0||i.y>(document.documentElement.clientHeight||window.innerHeight))return!1;let s=document.elementFromPoint(i.x,i.y);do if(s===elem)return!0;while(s=s.parentNode);return!1},elementDimPos(r){if(!this.isElement(r))return!1;let t=0,i=0,s=r;for(;s&&s.tagName.toLowerCase()!="body"&&!isNaN(s.offsetLeft)&&!isNaN(s.offsetTop);)t+=s.offsetLeft-s.scrollLeft,i+=s.offsetTop-s.scrollTop,s=s.offsetParent;const n=r.getBoundingClientRect();let o=n.right-n.left,a=n.bottom-n.top,h=this.isVisible(r),l=this.isInViewport(r);return{top:i,left:t,width:o,height:a,visible:h,viewport:l}},elementsDistance(r,t){return!this.isElement(r)||!this.isElement(r)?!1:(el1Location=this.elementDimPos(r),el2Location=this.elementDimPos(t),{x:el1Location.top-el2Location.top,y:el1Location.left.el2Location.left,el1Location,el2Location})},htmlToElement(r){var t=document.createElement("template");return r=r.trim(),t.innerHTML=r,t.content.firstChild},htmlToElements(r){var t=document.createElement("template");return t.innerHTML=r,t.content.childNodes},hideOnClickOutside(r){if(!this.isElement(r))return!1;const t=s=>{!r.contains(s.target)&&this.isVisible(r)&&(r.style.display="none",i())},i=()=>{document.removeEventListener("click",t)};document.addEventListener("click",t)},onClickOutside(r,t){if(!this.isElement(r))return!1;const i=n=>{!r.contains(n.target)&&v.isVisible(r)&&(t(),s())},s=()=>{document.removeEventListener("click",i)};document.addEventListener("click",i)},addStyleRule(r,t,i,s){let n=this.findStyleRule(r,t,i,s);if(n)n.i>=0?n.rules[n.i].style[n.property]=n.value:this.addCSSRule(n.styleSheet,n.selector,n.rules,n.index);else return},deleteStyleRule(r,t,i){let s=this.findStyleRule(r,t,i,"");(s.styleSheet.deleteRule||s.styleSheet.removeRule)(s.i)},findStyleRule(r,t,i,s){if(!r||!p(r))return null;if(r.constructor.name=="HTMLStyleElement")r=r.sheet;else if(r.constructor.name!="CSSStyleSheet")return null;let n=this.styleRuleSanitize(t,i,s);t=n[0],i=n[1],s=n[2];const o=r.cssRules||r.rules;for(var a=o.length-1;a>0&&o[a].selectorText!==t;--a);return{styleSheet:r,rules:o,selector:t,property:i,value:s,i:a}},styleRuleSanitize(r,t,i){return[r=r.toLowerCase().replace(/\s+/g," "),t=t.toLowerCase(),i=i.toLowerCase()]},addCSSRule(r,t,i,s){r.insertRule?r.insertRule(t+"{"+i+"}",s):r.addRule(t,i,s)}},ls=["y","M","d","h","m","s","ms"],cs=["years","months","days","hours","minutes","seconds","milliseconds"],ds=[0,31,59,90,120,151,181,212,243,273,304,334],us=[0,31,60,91,121,152,182,213,244,274,305,335],_e=[31,28,31,30,31,30,31,31,30,31,30,31],gs=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Ne=1231006505e3,Z=1,b=1e3,L=b*60,R=L*60,M=R*24,lt=M*7,N=M*30;function He(r=3,t=!1){let i=_e[r%12]*M;return t&&r>0&&(i+=M),i}const W=M*365,gt={y:W,M:N,w:lt,d:M,h:R,m:L,s:b,u:Z},Be={years:W,months:N,weeks:lt,days:M,hours:R,minutes:L,seconds:b,milliseconds:Z},fs={...gt,...Be},ft={YEARS10:[W*10,"years"],YEARS5:[W*5,"years"],YEARS3:[W*3,"years"],YEARS2:[W*2,"years"],YEARS:[W,"years"],MONTH6:[N*6,"months"],MONTH4:[N*4,"months"],MONTH3:[N*3,"months"],MONTH2:[N*2,"months"],MONTH:[N,"months"],DAY15:[M*15,"years"],DAY10:[M*10,"days"],DAY7:[M*7,"days"],DAY5:[M*5,"days"],DAY3:[M*3,"days"],DAY2:[M*2,"days"],DAY:[M,"days"],HOUR12:[R*12,"hours"],HOUR6:[R*6,"hours"],HOUR4:[R*4,"hours"],HOUR2:[R*2,"hours"],HOUR:[R,"hours"],MINUTE30:[L*30,"minutes"],MINUTE15:[L*15,"minutes"],MINUTE10:[L*10,"minutes"],MINUTE5:[L*5,"minutes"],MINUTE2:[L*2,"minutes"],MINUTE:[L,"minutes"],SECOND30:[b*30,"seconds"],SECOND15:[b*15,"seconds"],SECOND10:[b*10,"seconds"],SECOND5:[b*5,"seconds"],SECOND2:[b*2,"seconds"],SECOND:[b,"seconds"],MILLISECOND500:[Z*500,"milliseconds"],MILLISECOND250:[Z*250,"milliseconds"],MILLISECOND100:[Z*100,"milliseconds"],MILLISECOND50:[Z*50,"milliseconds"],MILLISECOND:[Z,"milliseconds"]},mt=(()=>{const r=Object.values(ft),t=[];for(let i=r.length;--i;i>0)t[i]=r[i][0];return t})(),ee=(()=>{const r=Object.values(ft),t=[];for(let i=r.length;--i;i>0)t[i]=r[i][1];return t})(),ps=Object.keys(ft),ys=(()=>{const r={};for(const[t,i]of Object.entries(ft))r[t]=i[0];return r})(),ie={0:"Europe/London","-120":"Europe/Tallinn","-60":"Europe/Zurich",180:"America/Santiago",300:"America/Toronto",240:"America/Caracas",360:"America/Mexico_City",540:"America/Juneau",480:"America/Vancouver",420:"US/Mountain",120:"America/Sao_Paulo","-360":"Asia/Almaty","-300":"Asia/Ashkhabad","-180":"Europe/Moscow","-420":"Asia/Jakarta","-480":"Asia/Taipei","-240":"Asia/Muscat","-345":"Asia/Kathmandu","-330":"Asia/Kolkata","-540":"Asia/Tokyo","-210":"Asia/Tehran","-660":"Pacific/Norfolk","-630":"Australia/Adelaide","-600":"Australia/Brisbane","-780":"Pacific/Fakaofo","-825":"Pacific/Chatham",600:"Pacific/Honolulu"};function vs(){const r=new Date().getTimezoneOffset();return Object.prototype.hasOwnProperty.call(ie,r)?ie[r.toString()]:"Etc/UTC"}function xs(){const r={};for(let t in gt){let i=0;r[t]=[];do r[t].push(Math.round(gt[t]*i)),i+=.125;while(i<1)}return r}function Ue(r){const t=new Date(r).getTime();return g(t)}function We(r,t=Ne,i=Date.now()){return Ue(r)?r>t&&r<i:!1}const K={inSeconds:function(r,t){r=new Date(r),t=new Date(t);var i=t.getTime(),s=r.getTime();return parseInt((i-s)/b)},inMinutes:function(r,t){r=new Date(r),t=new Date(t);let i=t.getTime(),s=r.getTime();return parseInt((i-s)/L)},inHours:function(r,t){r=new Date(r),t=new Date(t);let i=t.getTime(),s=r.getTime();return parseInt((i-s)/R)},inDays:function(r,t){r=new Date(r),t=new Date(t);let i=t.getTime(),s=r.getTime();return parseInt((i-s)/M)},inWeeks:function(r,t){r=new Date(r),t=new Date(t);let i=t.getTime(),s=r.getTime();return parseInt((i-s)/lt)},inMonths:function(r,t){r=new Date(r),t=new Date(t);let i=r.getUTCFullYear(),s=t.getUTCFullYear(),n=r.getUTCMonth();return t.getUTCMonth()+12*s-(n+12*i)},inYears:function(r,t){let i=new Date(r);return new Date(t).getUTCFullYear()-i.getUTCFullYear()}};function ws(r,t){let i=K.inYears(r,t),s=K.inMonths(r,t),n=K.inWeeks(r,t),o=K.inDays(r,t),a=K.inHours(r,t),h=K.inMinutes(r,t),l=K.inSeconds(r,t),c=new Date(t).getTime()-new Date(r).getTime();return{y:i,M:s,w:n,d:o,h:a,m:h,s:l,ms:c,years:i,months:s,weeks:n,days:o,hours:a,minutes:h,seconds:l,milliseconds:c}}function Rt(r){let t=b;return m(r)?(t=ze(r),t?r=r:(t=b,r="1s")):r="1s",{tf:r,ms:t}}function ze(r){if(!m(r))return!1;const t=/([0-9]{1,2})([s|m|h|d|w|M|y])/gm;let i;return(i=t.exec(r))!==null?gt[i[2]]*i[1]:!1}function se(r){let t=Math.floor(r/1e3),i=Math.floor(t/60);t=t%60;let s=Math.floor(i/60);i=i%60;let n=Math.floor(s/24);s=s%24;let o=Math.floor(n/7);n=n%7;let a=Math.floor(o/4),h=Math.floor(o/52),l=o%4;return a=a%13,{y:h,M:a,w:l,d:n,h:s,m:i,s:t,years:h,months:a,weeks:l,days:n,hours:s,minutes:i,seconds:t}}function pt(r){const t=se(r);for(const i in t)if(t[i])return`${t[i]}${i}`}function ne(r){return r?new Date(r).getUTCSeconds():null}function re(r){return new Date(r).setUTCMilliseconds(0,0)}function Dt(r){return r?new Date(r).getUTCMinutes():null}function oe(r){return new Date(r).setUTCSeconds(0,0)}function ae(r){return r?new Date(r).getUTCHours():null}function he(r){return new Date(r).setUTCMinutes(0,0,0)}function le(r){return r?new Date(r).getUTCDate():null}function Ss(r,t="en-GB",i="short"){return new Date(r).toLocaleDateString(t,{weekday:i})}function yt(r){return new Date(r).setUTCHours(0,0,0,0)}function ce(r){if(!!r)return new Date(r).getUTCMonth()}function Fe(r,t="en-GB",i="short"){return new Date(r).toLocaleDateString(t,{month:i})}function de(r){let t=new Date(r);return Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),1)}function Ve(r){let t=(ce(r)+1)%12;return r+=He(t,It(r)),r}function Ge(r){if(!!r)return new Date(r).getUTCFullYear()}function ue(r){return Date.UTC(new Date(r).getUTCFullYear())}function Ye(r){return r=r+W+M,It(r),r}function It(r){let i=new Date(r).getUTCFullYear();return(i&3)!=0?!1:i%100!=0||i%400==0}function Cs(r){let t=new Date(r),i=t.getUTCMonth(),s=t.getUTCDate(),n=dayCount[i]+s;return i>1&&It()&&n++,n}function Ot(r,t){return{years:s=>ue(s),months:s=>de(s),weeks:s=>yt(s),days:s=>yt(s),hours:s=>he(s),minutes:s=>oe(s),seconds:s=>re(s)}[t](r)}function Ms(r,t){let i,s;switch(t){case"years":i=ue(r),s=Ye(r);break;case"months":i=de(r),s=Ve(r);break;case"weeks":i=yt(r),s=i+M;break;case"days":i=yt(r),s=i+M;break;case"hours":i=he(r),s=i+R;break;case"minutes":i=oe(r),s=i+L;break;case"seconds":i=re(r),s=i+b}return{start:i,end:s}}function Ts(r){String(le(r)).padStart(2,"0")}function qe(r){let t=String(ae(r)).padStart(2,"0"),i=String(Dt(r)).padStart(2,"0");return`${t}:${i}`}function bs(r){let t=String(ae(r)).padStart(2,"0"),i=String(Dt(r)).padStart(2,"0"),s=String(ne(r)).padStart(2,"0");return`${t}:${i}:${s}`}function ge(r){let t=String(Dt(r)).padStart(2,"0"),i=String(ne(r)).padStart(2,"0");return`${t}:${i}`}var Ls=Object.freeze(Object.defineProperty({__proto__:null,TIMEUNITS:ls,TIMEUNITSLONG:cs,dayCntInc:ds,dayCntLeapInc:us,monthDayCnt:_e,MONTHMAP:gs,BTCGENESIS:Ne,MILLISECOND:Z,SECOND_MS:b,MINUTE_MS:L,HOUR_MS:R,DAY_MS:M,WEEK_MS:lt,MONTHR_MS:N,MONTH_MS:He,YEAR_MS:W,TIMEUNITSVALUESSHORT:gt,TIMEUNITSVALUESLONG:Be,TIMEUNITSVALUES:fs,TIMESCALESVALUES:ft,TIMESCALES:mt,TIMESCALESRANK:ee,TIMESCALESKEYS:ps,TIMESCALESVALUESKEYS:ys,timezones:ie,getTimezone:vs,buildSubGrads:xs,isValidTimestamp:Ue,isValidTimeInRange:We,timestampDiff:K,timestampDifference:ws,isTimeFrame:Rt,interval2MS:ze,ms2TimeUnits:se,ms2Interval:pt,get_second:ne,second_start:re,get_minute:Dt,minute_start:oe,get_hour:ae,hour_start:he,get_day:le,get_dayName:Ss,day_start:yt,get_month:ce,get_monthName:Fe,month_start:de,nextMonth:Ve,get_year:Ge,year_start:ue,nextYear:Ye,isLeapYear:It,dayOfYear:Cs,time_start:Ot,unitRange:Ms,DM:Ts,HM:qe,HMS:bs,MS:ge},Symbol.toStringTag,{value:"Module"}));function As(r,t){return r=Math.ceil(r)+1,t=Math.floor(t),Math.floor(Math.random()*(t-r)+r)}function Es(r){const t={};return t.value=r,t.sign=!!r,t.integers=Xe(r),t.decimals=je(r),t.total=t.integers+t.decimals,t}function Xe(r){return(Math.log10((r^r>>31)-(r>>31))|0)+1}function Rs(r){return r|0}function fe(r,t){t=t||100;const i=Math.pow(10,t);return Math.round((r+Number.EPSILON)*i)/i}function H(r,t=0){var i=r*Math.pow(10,t),s=Math.round(i),n=(i>0?i:-i)%1===.5?s%2===0?s:s-1:s;return n/Math.pow(10,t)}function je(r){if(typeof r!="number"&&(r=parseFloat(r)),isNaN(r)||!isFinite(r))return 0;for(var t=1,i=0;Math.round(r*t)/t!==r&&(t*=10,t!==1/0);)i++;return i}function Ds(r){return Math.log(r)/Math.log(10)}function Is(r,t){return Math.pow(r,t)}function B(r,t,i){return Math.min(i,Math.max(t,r))}function st(r,t){return!p(r)||!p(t)?t:(Object.keys(t).forEach(i=>{const s=r[i],n=t[i];Array.isArray(s)&&Array.isArray(n)?r[i]=st(s.concat([]),n):p(s)&&p(n)?r[i]=st(Object.assign({},s),n):r[i]=n}),r)}function P(r){if(r===null||typeof r!="object"||"isActiveClone"in r)return r;if(r instanceof Date)var t=new r.constructor;else var t=Array.isArray(r)?[]:{};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(r.isActiveClone=null,t[i]=P(r[i]),delete r.isActiveClone);return t}function D(r="ID"){g(r)?r=r.toString():m(r)||(r="ID");const t=Date.now().toString(36),i=Math.random().toString(36).substring(2,5);return`${r}_${t}_${i}`}function Os(r,t){let i=r.length;for(;i--;)if(r[i]!==t[i])return!1;return!0}const Ps=r=>r.entries().next().value,ks=r=>r.entries().next().value[0],$s=r=>r.entries().next().value[1],_s=r=>Array.from(r.keys()).pop();function Q(r,t=100,i,s=!1){var n,o=function(){var a=i||this,h=arguments,l=function(){n=null,s||r.apply(a,h)},c=s&&!n;clearTimeout(n),n=setTimeout(l,t),c&&r.apply(a,h)};return o}function Ze(r,t=250,i){var s,n,o=function(){var h=i||this,l=+new Date,c=arguments;s&&l<s+t?(clearTimeout(n),n=setTimeout(function(){s=l,r.apply(h,c)},t)):(s=l,r.apply(h,c))};function a(){timeout&&(clearTimeout(n),timeout=void 0)}return o.reset=function(){a(),s=0},o}class Ns{#t;#s;#i;#r=[];constructor(t,i){this.#t=t,this.#s=m(i.id)?i.id:D,this.#i=m(i.type)?i.type:"default",this.#r=x(i.data)?i.data:[]}}function Hs(r,t=!1){if(!x(r))return!1;let i=As(0,r.length);if(!Pt(r[0],t)||!Pt(r[i],t)||!Pt(r[r.length-1],t))return!1;let s=r[0][0],n=r[1][0],o=r[2][0];return!(s>n&&n>o)}function Bs(r,t=!1){if(!x(r))return!1;let i=0,s=0;for(;i<r.length;){if(!Pt(r[i],t)||r[i][0]<s)return!1;s=r[i][0],i++}return!0}function Pt(r,t=!1){return!(!x(r)||r.length!==6||t&&!We(r[0])||!g(r[1])||!g(r[2])||!g(r[3])||!g(r[4])||!g(r[5]))}const Us=L,Ws="1m",kt=Us,zs=6,Ke=.05,Fs=100,Qe=100,$t=["default","percent","log"],Je=.01,_t=200,ti=200,ei=20,ii=4096,Nt=5,si=50,ni=30,Vs=8;class Gs{data=[];#t=kt;#s="1s";indexStart=0;indexEnd=_t;valueMin=0;valueMax=0;valueDiff=0;volumeMin=0;volumeMax=0;volumeDiff=0;valueMinIdx=0;valueMaxIdx=0;volumeMinIdx=0;volumeMaxIdx=0;old={};limitFuture=_t;limitPast=ti;minCandles=ei;maxCandles=ii;yAxisBounds=Je;rangeLimit=_t;anchor;#i;#r;#e=!0;constructor(t,i=0,s=t.data.length-1,n={}){if(!p(t)||!p(n)||n?.core?.constructor.name!="TradeXchart")return!1;this.#e=!0,this.limitFuture=g(this.config?.limitFuture)?this.config.limitFuture:_t,this.limitPast=g(this.config?.limitPast)?this.config.limitPast:ti,this.minCandles=g(this.config?.minCandles)?this.config.minCandles:ei,this.maxCandles=g(this.config?.maxCandles)?this.config.maxCandles:ii,this.yAxisBounds=g(this.config?.limitBounds)?this.config.limitBounds:Je,this.#i=n.core,`${this.maxMinPriceVol.toString()}`;const o=n?.interval||kt;if(t.data.length==0){let a=Date.now();i=0,s=this.rangeLimit,this.#t=o,this.#s=pt(this.interval),this.anchor=a-a%o}else t.data.length<2?(this.#t=o,this.#s=pt(this.interval)):s==0&&t.data.length>=this.rangeLimit?s=this.rangeLimit:s==0&&(s=t.data.length);for(let a in t)this[a]=t[a];if(!this.set(i,s))return!1;t.data.length>2&&(this.#t=ri(this.data),this.#s=pt(this.interval))}get dataLength(){return this.data.length==0?0:this.data.length-1}get Length(){return this.indexEnd-this.indexStart}get timeDuration(){return this.timeFinish-this.timeStart}get timeMin(){return this.value(this.indexStart)[0]}get timeMax(){return this.value(this.indexEnd)[0]}get rangeDuration(){return this.timeMax-this.timeMin}get timeStart(){return this.value(0)[0]}get timeFinish(){return this.value(this.dataLength)[0]}set interval(t){this.#t=t}get interval(){return this.#t}set intervalStr(t){this.#s=t}get intervalStr(){return this.#s}end(){WebWorker.destroy(this.#r.ID)}set(t=0,i=this.dataLength,s=this.maxCandles){if(!g(t)||!g(i)||!g(s))return!1;t=t|0,i=i|0,s=s|0,s=B(s,this.minCandles,this.maxCandles),t>i&&([t,i]=[i,t]),i=B(i,t+this.minCandles,t+s);let n=i-t;t=B(t,this.limitPast*-1,this.dataLength+this.limitFuture-this.minCandles-1),i=B(i,t+this.minCandles,this.dataLength+this.limitFuture-1),t=i-t<n?t-(n-(i-t)):t;const o=t,a=i,h=this.indexStart,l=this.indexEnd;let c=this.Length;this.indexStart=t,this.indexEnd=i,c-=this.Length;let u=this.maxMinPriceVol({data:this.data,start:this.indexStart,end:this.indexEnd,that:this});return this.setMaxMin(u),this.#i.emit("setRange",[o,a,h,l]),!0}setMaxMin(t){for(let i in t)this.old[i]=this[i],this[i]=t[i];this.scale=this.dataLength!=0?this.Length/this.dataLength:1}value(t,i="chart"){let s;if(i=="chart")s=this.data;else if(s=this.getDataById(i),!s)return null;g(t)||(t=s.length-1);let n=s[t];if(n!==void 0)return n;{const o=s.length-1;return n=[null,null,null,null,null,null],s.length<1?(n[0]=Date.now()+this.interval*t,n):t<0?(n[0]=s[0][0]+this.interval*t,n):t>o?(n[0]=s[o][0]+this.interval*(t-o),n):null}}valueByTS(t,i){if(!g(t)||!m(i))return!1;const s=this.getTimeIndex(t);switch(i){case"chart":break;case"onchart":break;case"offchart":break;case"dataset":break;case"all":break;default:if(i.length=0)return this.value(s);i.split("_");break}}getDataById(t){if(!m(t))return!1;const i=t.split("_");switch(i[1]){case"chart":return this.data;case"onchart":for(let s of this.onChart)if(i[2]in s)return s[i[2]];return!1;case"offchart":for(let s of this.offChart)if(i[2]in s)return s[i[2]];return!1;case"datasets":for(let s of this.datasets)if(i[2]in s)return s[i[2]];return!1;default:return!1}}getTimeIndex(t){if(!g(t))return!1;t=t-t%this.interval;let i=this.data.length>0?this.data[0][0]:this.anchor;return t===i?0:t<i?(i-t)/this.interval*-1:(t-i)/this.interval}inRange(t){return t>=this.timeMin&&t<=this.timeMax}inPriceHistory(t){return t>=this.timeStart&&t<=this.timeFinish}inRenderRange(t){let i=this.getTimeIndex(t),s=this.#i.rangeScrollOffset;return i>=this.indexStart-s&&i<=this.indexEnd+s}rangeIndex(t){return this.getTimeIndex(t)-this.indexStart}maxMinPriceVol(t){let{data:i,start:s,end:n,that:o}={...t},a=H(this.#i.bufferPx/this.#i.candleW);if(a=g(a)?a:0,s=g(s)?s-a:0,s=s>0?s:0,n=typeof n=="number"?n:i?.length-1,i.length==0)return{valueMin:0,valueMax:1,volumeMin:0,volumeMax:0,valueMinIdx:0,valueMaxIdx:0,volumeMinIdx:0,volumeMaxIdx:0};let h=i.length-1,l=hs(s,0,h),c=hs(n,0,h),u=i[l][3],f=i[l][2],y=i[l][5],T=i[l][5],O=l,U=l,Et=l,ut=l;for(;l++<c;)i[l][3]<u&&(u=i[l][3],O=l),i[l][2]>f&&(f=i[l][2],U=l),i[l][5]<y&&(y=i[l][5],Et=l),i[l][5]>T&&(T=i[l][5],ut=l);let ke=f-u;return u-=ke*.1,u=u>0?u:0,f+=ke*.1,ke=f-u,{valueMin:u,valueMax:f,valueDiff:f-u,volumeMin:y,volumeMax:T,volumeDiff:T-y,valueMinIdx:O,valueMaxIdx:U,volumeMinIdx:Et,volumeMaxIdx:ut};function hs(ao,ho,lo){return Math.min(lo,Math.max(ho,ao))}}snapshot(t,i){return{constructor:{name:"RangeSnapshot"},ts:Date.now(),data:this.data,dataLength:this.dataLength,Length:this.Length,timeDuration:this.timeDuration,timeMin:this.timeMin,timeMax:this.timeMax,rangeDuration:this.rangeDuration,timeStart:this.timeStart,timeFinish:this.timeFinish,interval:this.interval,intervalStr:this.intervalStr}}}function ri(r){let t=Math.min(r.length-1,99),i=1/0;return r.slice(0,t).forEach((s,n)=>{let o=r[n+1][0]-s[0];o===o&&o<i&&(i=o)}),i}function Ys(r,t){if(!g(t))return!1;let i,s=r.timeFrameMS;return t=t-t%s,t===r.range.data[0][0]?i=0:t<r.range.data[0][0]?i=(r.range.data[0][0]-t)/s*-1:i=(t-r.range.data[0][0])/s,i}const oi={chart:{type:"candles",candleType:"CANDLE_SOLID",indexed:!1,data:[],settings:{},row:{},tf:Ws,tfms:kt},onchart:[],offchart:[],datasets:[],tools:[],ohlcv:[]};class Ht{static#t=[];#s="";#i={};#r="";#e="";#o;#n={};#l;#a={};#c=!1;#h=!0;static create(t,i=!1,s=!1){const n=new Ht(t,i,s);return Ht.#t.push(n),n}static delete(t){}constructor(t,i=!1,s=!1){p(t)?(this.#i=this.validateState(t,i,s),this.#c="valid",this.#h=!!this.#i.chart?.isEmpty):(this.defaultState(),this.#c="default",this.#h=!0)}get status(){return this.#c}get data(){return this.#i}get isEmpty(){return this.#h}validateState(t,i=!1,s=!1){const n=P(oi);if("chart"in t||(t.chart=n.chart,t.chart.data=t?.ohlcv||[],t.chart.isEmpty=!0),t=st(n,t),i?t.chart.data=Bs(t.chart.data,s)?t.chart.data:[]:t.chart.data=Hs(t.chart.data,s)?t.chart.data:[],!g(t.chart?.tf)||i){let a=ri(t.chart.data);a<b&&(a=kt),t.chart.tfms=a}(!m(t.chart?.tfms)||i)&&(t.chart.tf=pt(t.chart.tfms)),"onchart"in t||(t.onchart=n.onchart),"offchart"in t||(t.offchart=n.offchart),t.chart.settings||(t.chart.settings=n.chart.settings),delete t.ohlcv,"datasets"in t||(t.datasets=[]);for(var o of t.datasets)this.#a||(this.#a={}),this.dss[o.id]=new Ns(this,o);return t}defaultState(){this.#i=P(oi)}deepMerge(t,i){return st(t,i)}}class X{#t;#s;#i;#r={};#e;#o;#n="stopped";#l;#a;#c;#h;#u=["await","idle","running","stopped"];constructor(t,i){if(!X.validateConfig(t))return!1;const s={...t};this.#t=s.id,this.#e=s,this.#s=s.initial,this.#r.origin=i,this.#h=s.actions,this.#o=i.core,this.#d()}get id(){return this.#t}get state(){return this.#s}get previousSate(){return this.#i}get context(){return this.#r}get core(){return this.#o}get status(){return this.#n}get event(){return this.#a}get events(){return this.#l}get eventData(){return this.#c}get actions(){return this.#h}notify(t,i){this.#a=t,this.#c=i;const s=this.#e.states[this.#s];let n=s.on[t];if(!n||!E(n.action)||this.#n!=="running")return!1;let o=n?.condition?.type||n?.condition||!1;if(o&&!this.condition.call(this,o,n.condition))return!1;const a=n.target,h=this.#e.states[a];if(s?.onExit.call(this,i),n.action.call(this,i),this.#i=this.#s,this.#s=a,h?.onEnter.call(this,i),this.#e.states[a]?.on&&(this.#e.states[a].on[""]||this.#e.states[a].on?.always)){const l=this.#e.states[a].on[""]||this.#e.states[a].on.always;if(x(l))for(let c of l){let u=c?.condition?.type||c?.condition||!1;this.condition.call(this,u,c.condition)&&m(c.target)&&(c?.action.call(this,i),this.#i=this.#s,this.#s=c?.target,this.notify(null,null))}else if(p(l)&&m(l.target)){let c=l?.condition?.type||l?.condition||!1;this.condition.call(this,c,l.condition)&&m(l.target)&&(l?.action.call(this,i),this.#i=this.#s,this.#s=l.target,this.notify(null,null))}}return this.#s}condition(t,i=null,s={}){return t?this.#e.guards[t].call(this,this.#r,i,s):!1}canTransition(t){const i=this.#e.states[this.#s];return t in i.on}start(){this.#n="running"}stop(){this.#n="stopped"}destroy(){this.#f(),this.#e=null}#d(){this.#l=new Set;for(let t in this.#e.states)for(let i in this.#e.states[t].on)this.#l.add(i);for(let t of this.#l)this.#o.on(t,this.notify.bind(this,t),this.context)}#f(){for(let t of this.#l)this.#o.off(t,this.notify)}static validateConfig(t){if(!p(t))return!1;const i=["id","initial","context","states"];let s=Object.keys(t);if(!Os(i,s)||!(t.initial in t.states))return!1;for(let n in t.states){if(!p(t.states[n])||"onEnter"in t.states[n]&&!E(t.states[n].onEnter)||"onExit"in t.states[n]&&!E(t.states[n].onExit))return!1;if("on"in t.states[n])for(let o in t.states[n].on){let a=t.states[n].on[o];if(!m(a.target)||"action"in a&&!E(a.action))return!1}}return!0}}const qs="alert";class Xs{#t=new Map;#s={};constructor(t){if(x(t))for(let i of t)this.add(i?.price,i?.condition,i?.handler)}get list(){return this.#t}get handlers(){return this.#s}destroy(){this.#t.clear(),this.#s={}}batchAdd(t){if(x(t)){let i=[];for(let s of t)i.push(this.add(s?.price,s?.condition,s?.handler));return i}else return!1}add(t,i,s){if(isNaN(t)||!E(s))return!1;const n=D(qs),o={price:t,condition:i};if(this.list.has(o)){let a=this.list.get(o);a[n]=s}else{const a={};a[n]=s,this.list.set(o,a)}return this.#s[n]={alert:o,handler:s},n}remove(t){if(!(t in this.#s))return!1;const i=this.#s[t],s=i.alert,n=this.#t.get(s);return n.delete(t),i.delete(t),Object.keys(n).length==0&&this.#t.delete(s),!0}delete(t,i){if(this.list.has({price:t,condition:i})){const s=this.list.get({price:t,condition:i});for(let n in s)this.#s.delete(n),s.delete(n)}return this.list.delete({price:t,condition:i})}pause(t){if(!(t in this.#s))return!1;this.#s[t]}handlerByID(t){return t in this.#s?this.#s[t].handler:!1}check(t,i){if(!(!x(t)||!x(i))){for(let[s,n]of this.list)if(s.condition(s.price,t,i))for(let o in n)try{n[o](s.price,t,i)}catch(a){console.error(a)}}}}const vt="TradeX-Chart",ai="TradeXChart",hi="tradeXutils",li="tradeXtools",ci="tradeXmenus",di="tradeXmenu",ui="tradeXdividers",gi="tradeXwindows",js="tradeXwindow",me=500,Zs="stream_None",xt="stream_Listening",fi="stream_Started",Ks="stream_Stopped",Qs="stream_Error",Bt="stream_candleFirst",z="stream_candleUpdate",wt="stream_candleNew",Js=250,tn=8,en=2,sn=2,nn=0,rn=1,on=2,an=3,hn=4,ln=5,Ut=[null,null,null,null,null],Wt={tfCountDown:!0,alerts:[]};class pe{#t;#s;#i;#r;#e;#o;#n;#l=Ut;#a=0;#c=0;#h="";#u=!1;#d;#f;#v=Ut;#g;static validateConfig(t){if(p(t)){let i=P(Wt);t=st(i,t),t.tfCountDown=it(t.tfCountDown)?t.tfCountDown:Wt.tfCountDown,t.alerts=x(t.alerts)?t.alerts:Wt.alerts}else return Wt;return t}constructor(t){this.#t=t,this.#r=t.time,this.status={status:Zs},this.#s=pe.validateConfig(t.config?.stream),this.#e=g(t.config?.maxCandleUpdate)?t.config.maxCandleUpdate:Js,this.#n=g(t.config?.streamPrecision)?t.config.streamPrecision:tn}get config(){return this.#s}get countDownMS(){return this.#c}get countDown(){return this.#h}get range(){return this.#t.range}get status(){return this.#i}set status({status:t,data:i}){this.#i=t,this.emit(t,i)}set dataReceived(t){this.#u||(this.#u=!0,this.status={status:Bt,data:t})}get alerts(){return this.#g}get lastPriceMin(){return this.#f}set lastPriceMin(t){g(t)&&(this.#f=t)}get lastPriceMax(){return this.#d}set lastPriceMax(t){g(t)&&(this.#d=t)}get lastTick(){return this.#v}set lastTick(t){!x(t)||(this.#v,this.#v=t,this.alerts.check(t,this.#l))}set candle(t){const i=[...this.#l];t.t=this.roundTime(new Date(t.t)),t.o=t.o*1,t.h=t.h*1,t.l=t.l*1,t.c=t.c*1,t.v=t.v*1,this.#l[nn]!==t.t?this.newCandle(t):this.updateCandle(t),this.status={status:xt,data:this.#l},this.lastTick=i}get candle(){return this.#l!==Ut?this.#l:null}start(){this.#g=new Xs(this.#s.alerts),this.status={status:fi},this.#o=setInterval(this.onUpdate.bind(this),this.#e)}stop(){this.#g.destroy(),this.status={status:Ks}}emit(t,i){this.#t.emit(t,i)}error(){this.status={status:Qs}}onTick(t){(this.#i==fi||this.#i==xt)&&p(t)&&(this.candle=t,this.#t.setNotEmpty())}onUpdate(){this.#l!==Ut&&(this.status={status:z,data:this.candle},this.status={status:xt,data:this.#l})}newCandle(t){this.prevCandle(),this.#l=[t.t,t.o,t.h,t.l,t.c,t.v,null,!0],this.#t.mergeData({data:[this.#l]},!0,!1),this.status={status:wt,data:{data:t,candle:this.#l}},this.#c=this.#r.timeFrameMS,this.#a=this.roundTime(Date.now())}prevCandle(){const t=this.#t.allData.data;t.length>0&&t[t.length-1][7]&&t[t.length-1].pop()}updateCandle(t){let i=this.#l;i[rn]=t.o,i[on]=t.h,i[an]=t.l,i[hn]=t.c,i[ln]=t.v,this.#l=i;const s=this.#t.allData.data,n=s.length>0?s.length-1:0;s[n]=this.#l,this.countDownUpdate()}parseCandle;countDownUpdate(){let t,i,s,n,o,a,h;this.#r.timeFrameMS;let l=this.#r.timeFrameMS-(Date.now()-this.#a);return l<0&&(l=0),this.#c=l,l>W?(t=String(Math.floor(l/W)),i=String(Math.floor(l%W/N)).padStart(2,"0"),this.#h=`${t}Y ${i}M`):l>N?(i=String(Math.floor(l/N)).padStart(2,"0"),n=String(Math.floor(l%N/M)).padStart(2,"0"),this.#h=`${i}M ${n}D`):l>lt?(s=String(Math.floor(l/lt)).padStart(2,"0"),n=String(Math.floor(l%N/M)).padStart(2,"0"),this.#h=`${s}W ${n}D`):l>M?(n=String(Math.floor(l/M)).padStart(2,"0"),o=String(Math.floor(l%M/R)).padStart(2,"0"),a=String(Math.floor(l%R/L)).padStart(2,"0"),this.#h=`${n}D ${o}:${a}`):l>R?(o=String(Math.floor(l/R)).padStart(2,"0"),a=String(Math.floor(l%R/L)).padStart(2,"0"),h=String(Math.floor(l%L/b)).padStart(2,"0"),this.#h=`${o}:${a}:${h}`):l>L?(a=String(Math.floor(l/L)).padStart(2,"0"),h=String(Math.floor(l%L/b)).padStart(2,"0"),this.#h=`00:${a}:${h}`):(h=String(Math.floor(l/b)).padStart(2,"0"),String(l%b).padStart(4,"0"),this.#h=`00:00:${h}`),this.#h}roundTime(t){return t-t%this.#t.time.timeFrameMS}}const nt=300,zt=400,cn=`${zt}px`,mi=`${nt}px`,dn="100%",un="100%",J=35,tt=40,Ft=50,ct=60,St="normal",Ct=12,ye="normal",Mt="Avenir, Helvetica, Arial, sans-serif",ve="#141414",xe="#666",we="#ccc",Tt="#888",Se="#CCC",pi="30px",gn="position: relative;",A={COLOUR_BG:ve,COLOUR_BORDER:xe,COLOUR_TXT:we,COLOUR_ICON:Tt,COLOUR_ICONHOVER:Se,BORDER_THICKNESS:0,FONTWEIGHT:St,FONTSIZE:Ct,FONTSTYLE:ye,FONTFAMILY:Mt,FONT:`${ye} ${Ct}px ${St} ${Mt}`,FONTSTRING:`font-style: ${ye}; font-size: ${Ct}px; font-weight: ${St}; font-family: ${Mt};`},Vt={COLOUR_ICON:Tt,ICONSIZE:pi},Gt={COLOUR_ICON:Tt,ICONSIZE:pi},Ce={COLOUR_BG:ve,COLOUR_BORDER:xe,COLOUR_TXT:we},Me={COLOUR_BG:ve,COLOUR_BORDER:xe,COLOUR_TXT:we},I={CANDLE_SOLID:"candle_solid",CANDLE_HOLLOW:"candle_hollow",CANDLE_UP_HOLLOW:"candle_up_hollow",CANDLE_DOWN_HOLLOW:"candle_down_hollow",OHLC:"ohlc",AREA:"area",LINE:"line"},Yt={COLOUR_CANDLE_UP:"#00F04088",COLOUR_CANDLE_DN:"#F0004088",COLOUR_WICK_UP:"#0F4",COLOUR_WICK_DN:"#F04"},bt={COLOUR_VOLUME_UP:"#00F04044",COLOUR_VOLUME_DN:"#F0004044",ONCHART_VOLUME_HEIGHT:15},yi=St,qt=Ct,Xt=Mt,F={COLOUR_TICK:"#888",COLOUR_LABEL:"888",COLOUR_CURSOR:"#000",COLOUR_CURSOR_BG:"#CCC",FONTFAMILY:Xt,FONTSIZE:qt,FONTWEIGHT:yi,FONT_LABEL:`${yi} ${qt}px ${Xt}`,FONT_LABEL_BOLD:`bold ${qt}px ${Xt}`},vi=St,xi=Ct,wi=Mt,rt={COLOUR_TICK:"#888",COLOUR_LABEL:"888",COLOUR_CURSOR:"#000",COLOUR_CURSOR_BG:"#CCC",FONTFAMILY:wi,FONTSIZE:xi,FONTWEIGHT:vi,FONT_LABEL:`${vi} ${xi}px ${wi}`,FONT_LABEL_BOLD:`bold ${qt}px ${Xt}`},Si={COLOUR_GRID:"#333"},fn={lineWidth:1,strokeStyle:"#ccc",lineDash:[1,1]},Ci={text:A.FONTSTRING,font:A.FONT,colour:A.COLOUR_TXT},jt={candle:{Type:I.CANDLE_SOLID,UpBodyColour:Yt.COLOUR_CANDLE_UP,UpWickColour:Yt.COLOUR_WICK_UP,DnBodyColour:Yt.COLOUR_CANDLE_DN,DnWickColour:Yt.COLOUR_WICK_DN},volume:{Height:bt.ONCHART_VOLUME_HEIGHT,UpColour:bt.COLOUR_VOLUME_UP,DnColour:bt.COLOUR_VOLUME_DN},xAxis:{colourTick:rt.COLOUR_TICK,colourLabel:rt.COLOUR_LABEL,colourCursor:rt.COLOUR_CURSOR,colourCursorBG:rt.COLOUR_CURSOR_BG,fontFamily:rt.FONTFAMILY,fontSize:rt.FONTSIZE,fontWeight:rt.FONTWEIGHT,line:"#656565",slider:"#555555",handle:"#55555588",icon:Tt,iconHover:Se},yAxis:{colourTick:F.COLOUR_TICK,colourLabel:F.COLOUR_LABEL,colourCursor:F.COLOUR_CURSOR,colourCursorBG:F.COLOUR_CURSOR_BG,fontFamily:F.FONTFAMILY,fontSize:F.FONTSIZE,fontWeight:F.FONTWEIGHT,line:"#656565"},chart:{Background:A.COLOUR_BG,BorderColour:A.COLOUR_BORDER,BorderThickness:A.BORDER_THICKNESS,TextColour:A.COLOUR_TXT,GridColour:Si.COLOUR_GRID},onChart:{},offChart:{},legend:{font:Ci.font,colour:Ci.colour},icon:{colour:Tt,hover:Se}},mn=`
<style title="txc_CSSVars">
  --txc-background: #141414:
  --txc-border-color: #888;
  --txc-time-scrollbar-color: #888;
  --txc-time-handle-color: #888;
  --txc-time-slider-color: #888;
  --txc-time-cursor-fore: #222;
  --txc-time-cursor-back: #ccc;
  --txc-time-icon-color: #888;
  --txc-time-icon-hover-color: #888;
</style>`,pn=`
<style>
  tradex-chart {
    display: flex;
    width: var(--txc-width, 100%);
    height: var(--txc-height, 100%);
    min-width: var(--txc-min-width, ${cn});
    min-height: var(--txc-min-height, ${mi});
    max-width: var(--txc-max-width, ${dn});
    max-height: var(--txc-max-height, ${un});
    overflow: hidden;
    background: var(--txc-background, ${A.COLOUR_BG});
    font: var(--txc-font, ${A.FONT});
  }
  .tradeXchart .tradeXtime .navigation { 
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: stretch;
    gap: 2px;
  }
  .tradeXchart .tradeXtime .navigation .icon { 
    flex-basis: 20px;
   }
  .tradeXchart .tradeXtime .navigation #tScrollBar { 
    height: 20px; 
    border: 1px solid; 
    border-radius: 3px; 
    flex-basis: 100%;
    overflow: hidden;
  }
  .tradeXchart .tradeXtime .navigation #tScrollBar .handle { 
    height: 18px; 
    border-radius: 2px; 
    margin: 1px;
  }

  tradex-grid {
    position: absolute;
  }
</style>
`;class Te{#t=new Map;#s;#i;static create(t,i){if(!p(t))return!1;t.ID=m(t.name)?D(t.name):`${i.id}.theme`;const s=new Te(t,i);return s.#t.set(t.ID,s),s}constructor(t,i){this.#i=p(t)?t:{};const s=["constructor","list","current","setCurrent","getCurrent"],n=P(jt),o=P(t),a=st(n,o);for(let h in a)s.includes(h)||(this[h]=a[h])}get list(){return this.#t}set current(t){this.setCurrent(t)}get current(){return this.#s}setCurrent(t){return m(t)&&this.#t.has(t)&&(this.#s=t),this.getCurrent()}getCurrent(){return m(this.#s)&&this.#t.has(this.#s)?this.#t.get(this.#s):jt}}class yn{#t;constructor(t){this.#t=t,self.onmessage=i=>this._onmessage(i.data)}_onmessage(t){const{r:i,data:s}=t,n=this.#t(s);self.postMessage({r:i,result:n})}end(){self.close()}}class vn{#t;#s;#i;#r=0;#e={};#o;constructor(t,i,s,n){this.#t=t,this.#s=s,this.#i=n;const o=`
      ${Y.ThreadWorker.toString()};
      const fn = ${i}
      const worker = new ThreadWorker(fn)
    `,a=new Blob([`;(() => {${o}})()`],{type:"text/javascript"}),h=URL.createObjectURL(a);this.#o=new Worker(h),URL.revokeObjectURL(h)}get ID(){return this.#t}get req(){return`r_${this.#r}`}onmessage(t){return E(this.#s)?this.#s(t):t}onerror(t){return E(this.#i)?this.#i(t):t}postMessage(t){return new Promise((i,s)=>{try{let n=this.req;this.#e[n]={resolve:i,reject:s},this.#o.postMessage({r:n,data:t}),this.#o.onmessage=o=>{const{r:a,result:h}=o.data;if(a in this.#e){const{resolve:l,reject:c}=this.#e[a];delete this.#e[a],l(this.onmessage(h))}},this.#o.onerror=o=>{s(this.onerror(o))}}catch(n){s(n)}})}terminate(){this.#o.terminate()}}class Y{static#t=new Map;static ThreadWorker=yn;static Thread=vn;static create(t="worker",i,s,n){if(typeof window.Worker>"u")return!1;if(E(i))i=i.toString();else if(!m(i))return!1;return t=m(t)?D(t):D("worker"),Y.#t.set(t,new Y.Thread(t,i,s)),Y.#t.get(t)}static destroy(t){if(!m(t))return!1;Y.#t.get(t).terminate(),Y.#t.delete(t)}static end(){Y.#t.forEach((t,i,s)=>{Y.destroy(i)})}}class k{#t;#s;#i={};#r;#e;#o;#n;#l;#a;#c=!0;constructor(t,i=!1,s=!1,n,o,a={}){this.#s=o.core,this.#t=o,this.#i=o.core.config,this.#n=t,this.#l=t.scene,this.#r=n,this.#e=i,this.#o=s,this.#a=a}get core(){return this.#s}get parent(){return this.#t}get target(){return this.#n}get config(){return this.#i}get params(){return this.#a}get scene(){return this.#l}get theme(){return this.#r}get chart(){return this.#t.parent.parent}get xAxis(){return this.#e||this.#t.time.xAxis}get yAxis(){return this.#o||this.#t.scale.yAxis}set doDraw(t){this.#c=it(t)?t:!1}get doDraw(){return this.#c}on(t,i,s){this.#s.on(t,i,s)}off(t,i){this.#s.off(t,i)}emit(t,i){this.core.emit(t,i)}}function xn(r,t,i,s,n,o){r.fillStyle=o,r.fillRect(t,i,s,n)}function Mi(r,t,i,s){r.save(),r.lineWidth=i.lineWidth||1,r.lineWidth%2&&r.translate(.5,.5),r.strokeStyle=i.strokeStyle,"lineDash"in i&&x(i.lineDash)&&r.setLineDash(i.lineDash),r.beginPath();let n=!0;t.forEach(o=>{o&&o.x!==null&&(n?(r.moveTo(o.x,o.y),n=!1):r.lineTo(o.x,o.y))}),s(),r.restore()}function wn(r,t,i,s,n){Mi(r,[{x:i,y:t},{x:s,y:t}],n,()=>{r.stroke(),r.closePath()})}function Sn(r,t,i){Mi(r,t,i,()=>{r.stroke(),r.closePath()})}const dt=0,Cn=4;class ot extends k{#t;#s;#i;#r;#e;#o;#n;#l;#a;#c;#h;#u;#d=[0,0];#f;#v;#g=2;#m={};constructor(t,i=!1,s=!1,n,o,a){super(t,i,s,void 0,o,a),this.#n=a,this.#l=a.overlay,this.#c=n.type,this.#a=n.indicator,this.#h=this.core.TALib,this.#u=this.xAxis.range,this.eventsListen()}get ID(){return this.#t}set ID(t){this.#t=t}get name(){return this.#s}set name(t){this.#s=t}get shortName(){return this.#i}set shortName(t){this.#i=t}get onChart(){return this.#r}set onChart(t){this.#r=t}get scaleOverlay(){return this.#e}set scaleOverlay(t){this.#e=t}get plots(){return this.#o}set plots(t){this.#o=t}get params(){return this.#n}get Timeline(){return this.core.Timeline}get Scale(){return this.parent.scale}get type(){return this.#c}get overlay(){return this.#l}get indicator(){return this.#a}get TALib(){return this.#h}get range(){return this.core.range}set setNewValue(t){this.#f=t}set setUpdateValue(t){this.#v=t}set precision(t){this.#g=t}get precision(){return this.#g}set style(t){this.#m=t}get style(){return this.#m}set position(t){this.target.setPosition(t[0],t[1])}set value(t){const i=this.core.time.timeFrameMS;let s=Math.floor(new Date(t[dt])/i)*i;t[dt]=s,this.#d[dt]!==t[dt]?(this.#d[dt]=t[dt],this.#f(t)):this.#v(t)}get value(){return this.#d}end(){this.off(z,this.onStreamUpdate)}eventsListen(){this.on(z,this.onStreamUpdate.bind(this))}on(t,i,s){this.core.on(t,i,s)}off(t,i){this.core.off(t,i)}emit(t,i){this.core.emit(t,i)}onStreamNewValue(t){}onStreamUpdate(t){this.value=t}defineIndicator(t,i){p(t)||(t={}),this.definition.output=i.outputs;const s={...this.definition.input,...t};delete s.style;for(let n of i.options)if(n.name in s)if(typeof s[n.name]!==n.type){s[n.name]=n.defaultValue;continue}else"range"in n&&(s[n.name]=B(s[n.name],n.range.min,n.range.max));else n.name=="timePeriod"&&(s.timePeriod=n.defaultValue);this.definition.input=s}addLegend(){let t={id:this.shortName,title:this.shortName,type:this.shortName,source:this.legendInputs.bind(this)};this.chart.legend.add(t)}legendInputs(t=this.chart.cursorPos){const i=[this.style.strokeStyle];let n=this.Timeline.xPos2Index(t[0])-(this.range.data.length-this.overlay.data.length),o=B(this.overlay.data.length-1,0,1/0);return n=B(n,0,o),{c:n,colours:i}}indicatorInput(t,i){let s=[];do s.push(this.range.value(t)[Cn]);while(t++<i);return s}regeneratePlots(t){return t.map((i,s)=>{const n=s+1;return{key:`${this.shortName}${n}`,title:`${this.shortName}${n}: `,type:"line"}})}TALibParams(){let t=this.range.dataLength,i=this.definition.input.timePeriod,s=t-i,n=this.indicatorInput(s,t);return n.find(a=>a===null)?!1:{inReal:n,timePeriod:i}}calcIndicator(t,i={},s=this.range){if(!this.core.TALibReady||!m(t)||!(t in this.TALib)||!p(s))return!1;i.timePeriod=i.timePeriod||this.definition.input.timePeriod;let n,o,a=i.timePeriod;if(s.constructor.name=="Range")n=0,o=s.dataLength-a+1;else if("indexStart"in s||"indexEnd"in s||"tsStart"in s||"tsEnd"in s)n=s.indexStart||this.Timeline.t2Index(s.tsStart||0)||0,o=s.indexEnd||this.Timeline.t2Index(s.tsEnd)||this.range.Length-1;else return!1;if(o-n<a)return!1;let h=[],l,c,u;for(;n<o;){i.inReal=this.indicatorInput(n,n+a),u=this.TALib[t](i),c=[],l=0;for(let f of this.definition.output)c[l++]=u[f.name][0];h.push([this.range.value(n+a-1)[0],c]),n++}return h}calcIndicatorHistory(){if(this.overlay.data.length<this.definition.input.timePeriod){let t;const i=()=>{t=this.calcIndicator(this.libName,this.definition.input,this.range),t&&(this.overlay.data=t)};this.core.TALibReady?i():$e(this.core.TALibPromise)&&this.core.TALibPromise.then(i(),s=>{this.core.error(s)})}}calcIndicatorStream(t,i,s=this.range){if(!this.core.TALibReady||!m(t)||!(t in this.TALib)||s.constructor.name!=="Range"||s.dataLength<this.definition.input.timePeriod)return!1;let n=this.TALib[t](i),o=s.dataLength,a=s.value(o)[0],h=[],l=0;for(let c of this.definition.output)h[l++]=n[c.name][0];return[a,h]}newValue(t){let i=this.TALibParams();if(!i)return!1;let s=this.calcIndicatorStream(this.libName,i);if(!s)return!1;this.overlay.data.push(s),this.target.setPosition(this.core.scrollPos,0),this.draw(this.range)}updateValue(t){let i=this.overlay.data.length-1,s=this.TALibParams();if(!s)return!1;let n=this.calcIndicatorStream(this.libName,s);if(!n)return!1;this.overlay.data[i]=[n[0],n[1]],this.target.setPosition(this.core.scrollPos,0),this.draw(this.range)}plot(t,i,s){const n=this.scene.context;switch(n.save(),i){case"renderLine":Sn(n,t,s);case"renderFillRect":xn(n,t[0],t[1],t[2],t[3],s)}n.restore()}draw(){}}const Mn={name:"BBANDS",camelCaseName:"bbands",group:"Overlap Studies",description:"Bollinger Bands",inputs:[{name:"inReal",type:"number"}],options:[{name:"timePeriod",displayName:"Time Period",defaultValue:5,hint:"Number of period",type:"number",range:{min:2,max:1e5}},{name:"nbDevUp",displayName:"Deviations up",defaultValue:2,hint:"Deviation multiplier for upper band",type:"number",range:{min:-3e37,max:3e37}},{name:"nbDevDn",displayName:"Deviations down",defaultValue:2,hint:"Deviation multiplier for lower band",type:"number",range:{min:-3e37,max:3e37}},{name:"MAType",displayName:"MA Type",defaultValue:0,hint:"Type of Moving Average",type:"MAType"}],outputs:[{name:"upperBand",type:"number",plot:"limit_upper"},{name:"middleBand",type:"number",plot:"line"},{name:"lowerBand",type:"number",plot:"limit_lower"}]},Tn={name:"DX",camelCaseName:"dx",group:"Momentum Indicators",description:"Directional Movement Index",inputs:[{name:"high",type:"number"},{name:"low",type:"number"},{name:"close",type:"number"}],options:[{name:"timePeriod",displayName:"Time Period",defaultValue:14,hint:"Number of period",type:"number",range:{min:2,max:1e5}}],outputs:[{name:"output",type:"number",plot:"line"}]},bn={name:"EMA",camelCaseName:"ema",group:"Overlap Studies",description:"Exponential Moving Average",inputs:[{name:"inReal",type:"number"}],options:[{name:"timePeriod",displayName:"Time Period",defaultValue:30,hint:"Number of period",type:"number",range:{min:2,max:1e5}}],outputs:[{name:"output",type:"number",plot:"line"}]},Ln={name:"RSI",camelCaseName:"rsi",group:"Momentum Indicators",description:"Relative Strength Index",inputs:[{name:"inReal",type:"number"}],options:[{name:"timePeriod",displayName:"Time Period",defaultValue:14,hint:"Number of period",type:"number",range:{min:2,max:1e5}}],outputs:[{name:"output",type:"number",plot:"line"}]},An={name:"SMA",camelCaseName:"sma",group:"Overlap Studies",description:"Simple Moving Average",inputs:[{name:"inReal",type:"number"}],options:[{name:"timePeriod",displayName:"Time Period",defaultValue:30,hint:"Number of period",type:"number",range:{min:2,max:1e5}}],outputs:[{name:"output",type:"number",plot:"line"}]};class En extends ot{name="Bollinger Bands";shortName="BB";libName="BBANDS";definition={input:{inReal:[],nbDevDn:2,nbDevUp:2,timePeriod:20},output:{lowerBand:[],middleBand:[],upperBand:[]}};#t={lowerStrokeStyle:"#08c",lowerLineWidth:"1",lowerLineDash:void 0,middleStrokeStyle:"#0080c088",middleLineWidth:"1",middleLineDash:void 0,upperStrokeStyle:"#08c",upperLineWidth:"1",upperLineDash:void 0,fillStyle:"#0080c044"};precision=2;scaleOverlay=!1;plots=[{key:"BB_1",title:" ",type:"line"}];constructor(t,i=!1,s=!1,n,o,a){super(t,i,s,n,o,a);const h=a.overlay;this.ID=a.overlay?.id||D(this.shortName),this.defineIndicator(h?.settings,Mn),this.style=h?.settings?.style?{...this.#t,...h.settings.style}:{...this.#t,...n.style},this.calcIndicatorHistory(),this.setNewValue=l=>{this.newValue(l)},this.setUpdateValue=l=>{this.updateValue(l)},this.addLegend()}get onChart(){return!0}legendInputs(t=this.chart.cursorPos){if(this.overlay.data.length==0)return!1;const i={};let s=[!1,!1,!1],{c:n,colours:o}=super.legendInputs(t);return i.Hi=this.Scale.nicePrice(this.overlay.data[n][1][0]),i.Mid=this.Scale.nicePrice(this.overlay.data[n][1][1]),i.Lo=this.Scale.nicePrice(this.overlay.data[n][1][2]),o=[this.style.upperStrokeStyle,this.style.middleStrokeStyle,this.style.lowerStrokeStyle],{inputs:i,colours:o,labels:s}}draw(t=this.range){if(this.overlay.data.length<2)return!1;this.scene.clear();const i={lower:[],middle:[],upper:[]},s=this.overlay.data,n=this.xAxis.candleW;i.length=0,this.Timeline.smoothScrollOffset;const o={w:n};let a=t.value(t.indexStart)[0],h=this.overlay.data[0][0],l=(a-h)/t.interval,c=this.Timeline.rangeScrollOffset,u=t.Length+c+2,f={};for(;u;)l<0||l>=this.overlay.data.length?(i.lower.push({x:null,y:null}),i.middle.push({x:null,y:null}),i.upper.push({x:null,y:null})):(o.x=this.xAxis.xPos(s[l][0]),o.y=this.yAxis.yPos(s[l][1][0]),i.lower.push({...o}),o.x=this.xAxis.xPos(s[l][0]),o.y=this.yAxis.yPos(s[l][1][1]),i.middle.push({...o}),o.x=this.xAxis.xPos(s[l][0]),o.y=this.yAxis.yPos(s[l][1][2]),i.upper.push({...o})),l++,u--;f={lineWidth:this.style.lowerLineWidth,strokeStyle:this.style.lowerStrokeStyle,lineDash:this.style.lowerLineDash},this.plot(i.lower,"renderLine",f),f={lineWidth:this.style.middleLineWidth,strokeStyle:this.style.middleStrokeStyle,lineDash:this.style.middleLineDash},this.plot(i.middle,"renderLine",f),f={lineWidth:this.style.upperLineWidth,strokeStyle:this.style.upperStrokeStyle,lineDash:this.style.upperLineDash},this.plot(i.upper,"renderLine",f),this.target.viewport.render()}}class Rn extends ot{name="Directional Movement Index";shortName="DX";libName=null;definition={input:{},output:{}};#t={strokeStyle:"#C80",lineWidth:"1",defaultHigh:75,defaultLow:25,highLowLineWidth:1,highLowStyle:"dashed",highStrokeStyle:"#848",lowStrokeStyle:"#848",highLowRangeStyle:"#22002220"};precision=2;scaleOverlay=!0;plots=[{key:"DMI_1",title:" ",type:"line"}];constructor(t,i=!1,s=!1,n,o,a){super(t,i,s,n,o,a);const h=a.overlay;this.ID=a.overlay?.id||D(this.shortName),this.defineIndicator(h?.settings,Tn),this.style=h?.settings?.style?{...this.#t,...h.settings.style}:{...this.#t,...n.style},this.calcIndicatorHistory(),this.setNewValue=l=>{this.newValue(l)},this.setUpdateValue=l=>{this.updateValue(l)}}get onChart(){return!1}legendInputs(t=this.chart.cursorPos){if(this.overlay.data.length==0)return!1;const i={},{c:s,colours:n}=super.legendInputs(t);return i.DMI_1=this.Scale.nicePrice(this.overlay.data[s][1]),{inputs:i,colours:n}}draw(t=this.range){if(this.overlay.data.length<2)return!1;this.scene.clear();const i=this.overlay.data,s=this.xAxis.candleW,n=this.scene.width+this.xAxis.bufferPx*2,o=this.yAxis.yPos(this.style.defaultHigh),a=this.yAxis.yPos(this.style.defaultLow),h=[0,o,this.scene.width,a-o];let l=this.style.highLowRangeStyle;this.plot(h,"renderFillRect",l),h.length=0,h[0]={x:0,y:o},h[1]={x:n,y:o},l={lineWidth:this.style.highLowLineWidth,strokeStyle:this.style.highStrokeStyle,dash:[5,5]},this.plot(h,"renderLine",l),h.length=0,h[0]={x:0,y:a},h[1]={x:n,y:a},l={lineWidth:this.style.highLowLineWidth,strokeStyle:this.style.lowStrokeStyle,dash:[5,5]},this.plot(h,"renderLine",l),h.length=0,this.Timeline.smoothScrollOffset;const c={w:s};let u=this.Timeline.rangeScrollOffset,f=t.data.length-this.overlay.data.length,y=t.indexStart-f-2,T=t.Length+u*2+2;for(;T;)y<0||y>=this.overlay.data.length?h.push({x:null,y:null}):(c.x=this.xAxis.xPos(i[y][0]),c.y=this.yAxis.yPos(i[y][1]),h.push({...c})),y++,T--;this.plot(h,"renderLine",this.style),this.target.viewport.render()}}class be extends ot{name="Exponential Moving Average";shortName="EMA";libName="EMA";definition={input:{inReal:[],timePeriod:20},output:{output:[]}};#t={strokeStyle:"#C80",lineWidth:"1"};precision=2;checkParamCount=!1;scaleOverlay=!1;plots=[{key:"EMA_1",title:"EMA: ",type:"line"}];static inCnt=0;static colours=["#9C27B0","#9C27B0","#66BB6A","#66BB6A"];constructor(t,i=!1,s=!1,n,o,a){super(t,i,s,n,o,a),be.inCnt++;const h=a.overlay;this.ID=a.overlay?.id||D(this.shortName),this.defineIndicator(h?.settings,bn),this.style=h?.settings?.style?{...this.#t,...h.settings.style}:{...this.#t,...n.style},this.calcIndicatorHistory(),this.setNewValue=l=>{this.newValue(l)},this.setUpdateValue=l=>{this.updateValue(l)},this.addLegend()}get onChart(){return!0}updateLegend(){this.parent.legend.update()}legendInputs(t=this.chart.cursorPos){if(this.overlay.data.length==0)return!1;const i={},{c:s,colours:n}=super.legendInputs(t);return i.EMA_1=this.Scale.nicePrice(this.overlay.data[s][1]),{inputs:i,colours:n}}draw(t=this.range){if(this.overlay.data.length<2)return!1;this.scene.clear();const i=this.overlay.data,s=this.xAxis.candleW,n=[];this.xAxis.smoothScrollOffset;const o={w:s};let a=this.Timeline.rangeScrollOffset,h=t.data.length-this.overlay.data.length,l=t.indexStart-h-2,c=t.Length+a*2+2;for(;c;)l<0||l>=this.overlay.data.length?n.push({x:null,y:null}):(o.x=this.xAxis.xPos(i[l][0]),o.y=this.yAxis.yPos(i[l][1]),n.push({...o})),l++,c--;this.plot(n,"renderLine",this.style),this.target.viewport.render()}}class Dn extends ot{name="Relative Strength Index";shortName="RSI";libName="RSI";definition={input:{inReal:[],timePeriod:20},output:{output:[]}};#t={strokeStyle:"#C80",lineWidth:"1",defaultHigh:75,defaultLow:25,highLowLineWidth:1,highLowStyle:"dashed",highStrokeStyle:"#848",lowStrokeStyle:"#848",highLowRangeStyle:"#22002220"};checkParamCount=!1;plots=[{key:"RSI_1",title:" ",type:"line"}];constructor(t,i=!1,s=!1,n,o,a){super(t,i,s,n,o,a);const h=a.overlay;this.ID=a.overlay?.id||D(this.shortName),this.defineIndicator(h?.settings,Ln),this.style=h?.settings?.style?{...this.#t,...h.settings.style}:{...this.#t,...n.style},this.calcIndicatorHistory(),this.setNewValue=l=>{this.newValue(l)},this.setUpdateValue=l=>{this.updateValue(l)}}get onChart(){return!1}legendInputs(t=this.chart.cursorPos){if(this.overlay.data.length==0)return!1;const i={},{c:s,colours:n}=super.legendInputs(t);return i.RSI_1=this.Scale.nicePrice(this.overlay.data[s][1]),{inputs:i,colours:n}}draw(t=this.range){if(this.overlay.data.length<2)return!1;this.scene.clear();const i=this.overlay.data,s=this.xAxis.candleW,n=this.scene.width+this.xAxis.bufferPx*2,o=this.yAxis.yPos(this.style.defaultHigh),a=this.yAxis.yPos(this.style.defaultLow),h=[0,o,this.scene.width,a-o];let l=this.style.highLowRangeStyle;this.plot(h,"renderFillRect",l),h.length=0,h[0]={x:0,y:o},h[1]={x:n,y:o},l={lineWidth:this.style.highLowLineWidth,strokeStyle:this.style.highStrokeStyle,dash:[5,5]},this.plot(h,"renderLine",l),h.length=0,h[0]={x:0,y:a},h[1]={x:n,y:a},l={lineWidth:this.style.highLowLineWidth,strokeStyle:this.style.lowStrokeStyle,dash:[5,5]},this.plot(h,"renderLine",l),h.length=0,this.Timeline.smoothScrollOffset;const c={w:s};let u=this.Timeline.rangeScrollOffset,f=t.data.length-this.overlay.data.length,y=t.indexStart-f-2,T=t.Length+u*2+2;for(;T;)y<0||y>=this.overlay.data.length?h.push({x:null,y:null}):(c.x=this.xAxis.xPos(i[y][0]),c.y=this.yAxis.yPos(i[y][1]),h.push({...c})),y++,T--;this.plot(h,"renderLine",this.style),this.target.viewport.render()}}class Le extends ot{name="Simple Moving Average";shortName="SMA";libName="SMA";definition={input:{inReal:[],timePeriod:20},output:{output:[]}};#t={strokeStyle:"#C80",lineWidth:"1"};#s=2;onChart=!0;scaleOverlay=!1;plots=[{key:"SMA_1",title:"SMA: ",type:"line"}];static inCnt=0;static colours=["#9C27B0","#9C27B0","#66BB6A","#66BB6A"];constructor(t,i=!1,s=!1,n,o,a){super(t,i,s,n,o,a),Le.inCnt++;const h=a.overlay;this.ID=a.overlay?.id||D(this.shortName),this.defineIndicator(h?.settings,An),this.style=h?.settings?.style?{...this.#t,...h.settings.style}:{...this.#t,...n.style},this.calcIndicatorHistory(),this.setNewValue=l=>{this.newValue(l)},this.setUpdateValue=l=>{this.updateValue(l)},this.addLegend()}get onChart(){return!0}updateLegend(){this.parent.legend.update()}legendInputs(t=this.chart.cursorPos){if(this.overlay.data.length==0)return!1;const i={},{c:s,colours:n}=super.legendInputs(t);return i.SMA_1=this.Scale.nicePrice(this.overlay.data[s][1]),{inputs:i,colours:n}}draw(t=this.range){if(this.overlay.data.length<2)return!1;this.scene.clear();const i=this.overlay.data,s=this.xAxis.candleW,n=[];this.xAxis.smoothScrollOffset;const o={w:s};let a=this.Timeline.rangeScrollOffset,h=t.data.length-this.overlay.data.length,l=t.indexStart-h-2,c=t.Length+a*2+2;for(;c;)l<0||l>=this.overlay.data.length?n.push({x:null,y:null}):(o.x=this.xAxis.xPos(i[l][0]),o.y=this.yAxis.yPos(i[l][1]),n.push({...o})),l++,c--;this.plot(n,"renderLine",this.style),this.target.viewport.render()}}class In extends ot{#t;#s="Relative Strength Index";#i="RSI";#r;#e=!0;#o=!1;#n=!0;#l=[{key:"RSI_1",title:" ",type:"line"}];#a={};#c={};constructor(t,i=!1,s=!1,n,o,a){super(t,i,s,n,o,a),a.overlay}get onChart(){return"both"}}var Ti={BB:{id:"BB",name:"Bollinger Bands",event:"addIndicator",ind:En},DMI:{id:"DMI",name:"Directional Movement",event:"addIndicator",ind:Rn},EMA:{id:"EMA",name:"Exponential Moving Average",event:"addIndicator",ind:be},RSI:{id:"RSI",name:"Relative Strength Index",event:"addIndicator",ind:Dn},SMA:{id:"SMA",name:"Simple Moving Average",event:"addIndicator",ind:Le},Vol:{id:"Vol",name:"Volume",event:"addIndicator",ind:In}};class $ extends HTMLElement{shadowRoot;template;id=D();doInit=!0;constructor(t,i="open"){super(),this.template=t,this.shadowRoot=this.attachShadow({mode:i})}destroy(){}connectedCallback(){this.doInit&&(this.doInit=!1,this.shadowRoot.appendChild(this.template.content.cloneNode(!0)),this.style.display="block")}disconnectedCallback(){}get width(){return this.offsetWidth}set width(t){this.setDim(t,"width")}get height(){return this.offsetHeight}set height(t){this.setDim(t,"height")}setDim(t,i){if(g(t))t+="px";else if(!m(t))return;this.style[i]=t}setCursor(t){this.style.cursor=t}}class bi{constructor(t={}){this.container=t.container,this.layers=[],this.id=S.idCnt++,this.scene=new S.Scene,this.setSize(t.width||0,t.height||0)}setSize(t,i){return this.width=t,this.height=i,this.scene.setSize(t,i),this.layers.forEach(function(s){s.setSize(t,i)}),this}addLayer(t){return this.layers.push(t),t.setSize(t.width||this.width,t.height||this.height),t.viewport=this,this}getIntersection(t,i){for(var s=this.layers,n=s.length,o=n-1,a,h;o>=0;){if(a=s[o],h=a.hit.getIntersection(t,i),h>=0)return h;o--}return-1}get index(){let t=S.viewports,i,s=0;for(i of t){if(this.id===i.id)return s;s++}return null}destroy(){for(let t of this.layers)t.remove()}render(t=!1){let i=this.scene,s=this.layers,n;i.clear();for(n of s)t&&n.layers.length>0&&n.render(t),n.visible&&n.width>0&&n.height>0&&i.context.drawImage(n.scene.canvas,n.x,n.y,n.width,n.height)}}class On extends bi{constructor(t={}){super(t),t.container.innerHTML="",t.container.appendChild(this.scene.canvas),S.viewports.push(this)}destroy(){super.destroy(),this.container.innerHTML="",S.viewports.splice(this.index,1)}}class Pn{x=0;y=0;width=0;height=0;visible=!0;constructor(t={}){this.id=S.idCnt++,this.hit=new S.Hit({contextType:t.contextType}),this.scene=new S.Scene({contextType:t.contextType}),t.x&&t.y&&this.setPosition(t.x,t.y),t.width&&t.height&&this.setSize(t.width,t.height)}get index(){let t=this.viewport.layers;t.length;let i=0,s;for(s of t){if(this.id===s.id)return i;i++}return null}setPosition(t,i){return this.x=t,this.y=i,this}setSize(t,i){return this.width=t,this.height=i,this.scene.setSize(t,i),this.hit.setSize(t,i),this}move(t){let i=this.index,s=this.viewport,n=s.layers;switch(t){case"up":i<n.length-1&&(n[i]=n[i+1],n[i+1]=this);break;case"down":i>0&&(n[i]=n[i-1],n[i-1]=this);break;case"top":n.splice(i,1),n.push(this);break;case"bottom":n.splice(i,1),n.unshift(this);break}return this}moveUp(){return this.move("up")}moveDown(){return this.move("down")}moveTop(){return this.move("top")}moveBottom(){return this.move("bottom")}remove(){this.viewport.layers.splice(this.index,1)}}class kn{width=0;height=0;constructor(t){t||(t={}),this.id=S.idCnt++,this.contextType=t.contextType||"2d",this.canvas=document.createElement("canvas"),this.canvas.className="scene-canvas",this.canvas.style.display="block",this.context=this.canvas.getContext(this.contextType),t.width&&t.height&&this.setSize(t.width,t.height)}setSize(t,i){return this.width=t,this.height=i,this.canvas.width=t*S.pixelRatio,this.canvas.style.width=`${t}px`,this.canvas.height=i*S.pixelRatio,this.canvas.style.height=`${i}px`,this.contextType==="2d"&&S.pixelRatio!==1&&this.context.scale(S.pixelRatio,S.pixelRatio),this}clear(){let t=this.context;return this.contextType==="2d"?t.clearRect(0,0,this.width*S.pixelRatio,this.height*S.pixelRatio):t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this}toImage(t="image/png",i,s){let n=this,o=new Image,a=this.canvas.toDataURL(t,i);o.onload=function(){o.width=n.width,o.height=n.height,s(o)},o.src=a}export(t,i,s="image/png",n){typeof i!="function"&&(i=this.blobCallback.bind({cfg:t})),this.canvas.toBlob(i,s,n)}blobCallback(t){let i=document.createElement("a"),s=URL.createObjectURL(t),n=this.cfg.fileName||"canvas.png";i.setAttribute("href",s),i.setAttribute("target","_blank"),i.setAttribute("export",n),document.createEvent?Object.assign(document.createElement("a"),{href:s,target:"_blank",export:n}).click():i.click&&i.click()}}class $n{width=0;height=0;constructor(t){t||(t={}),this.contextType=t.contextType||"2d",this.canvas=document.createElement("canvas"),this.canvas.className="hit-canvas",this.canvas.style.display="none",this.canvas.style.position="relative",this.context=this.canvas.getContext(this.contextType,{preserveDrawingBuffer:!0,antialias:!1}),t.width&&t.height&&this.setSize(t.width,t.height)}setSize(t,i){return this.width=t,this.height=i,this.canvas.width=t*S.pixelRatio,this.canvas.style.width=`${t}px`,this.canvas.height=i*S.pixelRatio,this.canvas.style.height=`${i}px`,this}clear(){let t=this.context;return this.contextType==="2d"?t.clearRect(0,0,this.width*S.pixelRatio,this.height*S.pixelRatio):t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this}getIntersection(t,i){let s=this.context,n;if(t=Math.round(t),i=Math.round(i),t<0||i<0||t>this.width||i>this.height)return-1;if(this.contextType==="2d"){if(n=s.getImageData(t,i,1,1).data,n[3]<255)return-1}else if(n=new Uint8Array(4),s.readPixels(t*S.pixelRatio,(this.height-i-1)*S.pixelRatio,1,1,s.RGBA,s.UNSIGNED_BYTE,n),n[0]===255&&n[1]===255&&n[2]===255)return-1;return this.rgbToInt(n)}getColorFromIndex(t){let i=this.intToRGB(t);return"rgb("+i[0]+", "+i[1]+", "+i[2]+")"}rgbToInt(t){let i=t[0],s=t[1],n=t[2];return(i<<16)+(s<<8)+n}intToRGB(t){let i=(t&16711680)>>16,s=(t&65280)>>8,n=t&255;return[i,s,n]}}const S={idCnt:0,viewports:[],pixelRatio:window&&window.devicePixelRatio||1,Node:bi,Viewport:On,Layer:Pn,Scene:kn,Hit:$n};class _n{#t;#s;#i;#r;#e;constructor(t,i=[]){this.#i=t,this.#t=t.core,this.#r=new Map([...i]);for(const[s,n]of this.#r)this.addOverlay(s,n)}log(t){this.#t.log(t)}info(t){this.#t.info(t)}warning(t){this.#t.warn(t)}error(t){this.#t.error(t)}get core(){return this.#t}get parent(){return this.#i}get layerConfig(){return this.#i.layerConfig().layerConfig}get list(){return this.#r}get scale(){return this.#i.parent.scale}get time(){return this.#i.parent.time}start(){this.eventsListen()}end(){}eventsListen(){this.#i.on("resize",t=>this.onResize.bind(this))}on(t,i,s){this.#t.on(t,i,s)}off(t,i){this.#t.off(t,i)}emit(t,i){this.#t.emit(t,i)}get(t){return this.#r.get(t)}addOverlays(t){let i=[],s;for(let n of t)s=this.addOverlay(n[0],n[1]),i.push([n[0]],s);return i}addOverlay(t,i){try{const s=new S.Layer(this.layerConfig);return this.parent.viewport.addLayer(s),i.layer=s,i.instance=new i.class(s,this.#i.TimeLine,this.#i.Scale,this.#t.theme,this,i.params),this.#r.set(t,i),!0}catch(s){return console.error(`Error: Cannot instantiate ${t} overlay / indicator`),console.error(s),!1}}}class Zt extends k{constructor(t,i=!1,s=!1,n,o,a){super(t,i,s,n,o,a),this.params.axes=a?.axes||"both"}set position(t){this.target.setPosition(t[0],t[1])}draw(t){if(t=t||this.params.axes,this.scene.clear(),t=="none")return;const i=this.scene.context;if(i.save(),i.strokeStyle=this.core.theme.chart.GridColour||Si.COLOUR_GRID,t!="y"){const n=this.xAxis.xAxisGrads.values;for(let o of n){let a=H(o[1]);i.beginPath(),i.moveTo(a+0,0),i.lineTo(a+0,this.scene.height),i.stroke()}}if(t!="x"){const s=this.yAxis.yAxisGrads;for(let n of s){let o=this.yAxis.$2Pixel(n[0]);i.beginPath(),i.moveTo(0,o),i.lineTo(this.scene.width,o),i.stroke()}}i.restore(),this.doDraw=!1}drawX(){this.draw("x")}}const Nn={idle:0,dragStart:1,dragging:2};class at{x=0;y=0;constructor(){if(arguments.length===1){const{x:t,y:i}=arguments[0];this.x=t,this.y=i}else if(arguments.length>1){const[t,i]=arguments;this.x=t,this.y=i}}clone(){return new at(this.x,this.y)}}const Li=["keypress","keydown","keyup"],Ai=["pointerdown","pointerup","pointerover","pointerenter","pointerout","pointerleave","pointermove","pointercancel","gotpointercapture","lostpointercapture","dblclick","click","wheel","contextmenu"],Ei=["mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","mousewheel"],Ri=["touchcancel","touchend","touchmove","touchstart"],Di=[],Ii=[],Ae=["pointerdrag","pointerdragend"];class Hn{constructor(t){this.input=t,this.element=t.element,window.PointerEvent?this.type=[...Li,...Ai,...Ei,...Ri,...Di,...Ii,...Ae]:this.type=[...Li,...Ei,...Ri,...Di,...Ii,...Ae],this.clientPosPrev=new at([null,null]),this.position=new at,this.movement=new at([0,0]),this.dragstart=new at([null,null]),this.dragend=new at([null,null]),this.dragCheckThreshold=3,this.dragStatus=!1,this.wheeldelta=0,this.pointerButtons=[!1,!1,!1,!1,!1],this.pointerdrag=new Event("pointerdrag"),this.pointerdragend=new Event("pointerdragend")}has(t){return this.type.indexOf(t)!=-1}addListener(t,i,s){let n=i;if(!this.has(t)||!E(i)||!v.isElement(this.element))return!1;if(Ai.indexOf(t)!==-1){switch(t){case"pointerdown":n=function(o){this.onPointerDown(o),i(this.createPointerEventArgument(o))};break;case"pointerup":n=function(o){this.onPointerUp(o),i(this.createPointerEventArgument(o))};break;case"pointermove":n=function(o){this.motion(o),i(this.createPointerEventArgument(o))};break;case"click":case"dbclick":case"pointerenter":case"pointerleave":case"pointerout":case"pointerover":case"contextmenu":n=function(o){this.location(o),i(this.createPointerEventArgument(o))};break;case"wheel":n=function(o){this.wheeldelta=o.wheelDelta,i(this.createPointerEventArgument(o))};break;case"pointercancel":case"gotpointercapture":case"lostpointercapture":default:n=function(o){i(o)};break}return this.element.addEventListener(t,n.bind(this),s),n}else if(Ae.indexOf(t)==-1)this.element.addEventListener(t,i,s);else switch(t){case"pointerdrag":this.initPointerDrag(i,s);break;case"pointerdragend":n=function(o){this.motion(o),i(this.createPointerEventArgument(o))},this.element.addEventListener(t,n.bind(this),s);break}return!0}removerListener(t,i,s,n){return!this.has(t)||!E(i)||!v.isElement(s)?!1:(t=="pointerdrag"&&(e.target.removeEventListener("pointermove",this.onPointerDrag),e.target.removeEventListener("pointerdown",this.onPointerDown),e.target.removeEventListener("gotpointercapture",this.onPointerDrag),e.target.removeEventListener("lostpointercapture",this.onPointerDragEnd),document.removeEventListener("pointerup",this.onPointerDragEnd)),s.removeEventListener(t,i,n),!0)}initPointerDrag(t,i){this.draginit||(this.draginit=!0,this.element.addEventListener("pointerdown",this.onPointerDown.bind(this),i),this.element.addEventListener("gotpointercapture",this.onPointerCapture.bind(this),i),this.element.addEventListener("lostpointercapture",this.onPointerDragEnd.bind(this),i),this.element.addEventListener("pointermove",this.onPointerMove.bind(this),i));let s=function(n){n=this.createPointerEventArgument(n),t(n)};this.dragStatus="ready",this.element.addEventListener("pointerdrag",s.bind(this),i)}onPointerDown(t){this.location(t),this.pointerButtons[t.button]=!0,this.dragStatus=="ready"&&t.target.setPointerCapture(t.pointerId)}onPointerUp(t){this.location(t),this.pointerButtons[t.button]=!1}onPointerMove(t){this.dragStatus=="dragging"&&(this.motion(t),this.dragend=this.position.clone(),t.target.dispatchEvent(this.pointerdrag))}onPointerCapture(t){this.dragstart=this.position.clone(),this.dragend=this.position.clone(),this.dragStatus="dragging"}onPointerDragEnd(t){this.dragStatus=="dragging"&&(this.dragStatus="ready",t.target.dispatchEvent(this.pointerdragend))}createPointerEventArgument(t){return{isProcessed:!1,pointerType:t.pointerType,position:this.position.clone(),movement:this.movement.clone(),dragstart:this.dragstart.clone(),dragend:this.dragend.clone(),wheeldelta:this.wheeldelta,buttons:this.pointerButtons,domEvent:t,timeStamp:Date.now()}}isButtonPressed(t){return this.pointerButtons.indexOf(t)!==-1}setCursor(t){this.element.style.cursor=t}motion(t){const i=t.clientX||this.position.x,s=t.clientY||this.position.y;this.movement.x=i-this.clientPosPrev.x,this.movement.y=s-this.clientPosPrev.y,this.position.x+=this.movement.x,this.position.y+=this.movement.y,this.clientPosPrev.x=i,this.clientPosPrev.y=s}location(t){const i=t.target.getBoundingClientRect();this.clientPosPrev.x=t.clientX,this.clientPosPrev.y=t.clientY,this.position.x=t.clientX-i.left,this.position.y=t.clientY-i.top,this.movement.x=0,this.movement.y=0}createKeyEventArgument(t){return t}}const Bn={element:void 0,contextMenu:!0};class j{constructor(t,i){if(this.options={...Bn,...i},this.status=Nn.idle,this.element=t,!this.element&&this.options.elementId&&(this.element=document.getElementById(this.options.elementId)),!this.element)throw"Must specify an element to receive user input.";this.eventsAgent=new Hn(this),this.options.contextMenu||(window.oncontextmenu=s=>(s.preventDefault(),!1))}on(t,i,s){return this.eventsAgent.addListener(t,i,s)}off(t,i,s){return this.eventsAgent.removeListener(t,i,s)}invoke(t,i,s){this.currentAgent=t,this.eventsAgent.invoke(i,this.createEventArgument(s))}createEventArgument(t){const i=t||{};return i.isButtonPressed=s=>this.isButtonPressed(s),i.isKeyPressed=s=>this.isKeyPressed(s),i.controller=this,i}isButtonPressed(t){return this.eventsAgent.isButtonPressed(t)}isKeyPressed(t){return this.eventsAgent.isKeyPressed(t)}setCursor(t){this.eventsAgent.setCursor(t)}}class Ee extends k{#t=[0,0];#s=!0;#i;constructor(t,i=!1,s=!1,n,o,a){super(t,i=!1,s=!1,n,o,a),this.core.on("chart_pan",h=>{this.onMouseDragX(h)}),this.core.on("chart_panDone",h=>{this.onMouseDragX(h)}),this.core.on("main_mousemove",h=>{this.onMouseMoveX(h)}),this.#i=new j(this.target.viewport.container,{disableContextMenu:!1}),this.#i.on("pointermove",this.onMouseMove.bind(this)),this.#i.on("pointerenter",this.onMouseMove.bind(this))}set position(t){}get update(){return this.#s}onMouseDragX(t){this.#t[0]=t[0],this.#t[1]=t[1],this.draw(!0),this.core.emit("chart_render")}onMouseMoveX(t){this.#t[0]=t[0],this.draw(),this.core.emit("chart_render")}onMouseMove(t){const i=p(t)?t.position.x:t[0],s=p(t)?t.position.y:t[1];this.#t[0]=i,this.#t[1]=s,this.draw(),this.core.emit("chart_render")}draw(t=!1){let i=this.#t[0];t||(i=this.xAxis.xPosSnap2CandlePos(i)+this.xAxis.scrollOffsetPx);let s=this.#t[1];this.scene.clear();const n=this.scene.context;n.save(),n.setLineDash([5,5]);const o=this.xAxis.smoothScrollOffset||0;n.strokeStyle="#666",n.beginPath(),n.moveTo(i+o,0),n.lineTo(i+o,this.scene.height),n.stroke(),this.chart.cursorActive&&(n.beginPath(),n.moveTo(0,s),n.lineTo(this.scene.width,s),n.stroke()),n.restore()}}const Un=[["grid",{class:Zt,fixed:!0}],["cursor",{class:Ee,fixed:!0}]];class Lt{#t;#s;#i;#r;#e;#o;#n;#l;#a;#c;constructor(t,i,s,n=!1){this.#r=t,this.#t=t.core,this.#s=this.core.config,this.#i=this.core.theme,this.#n=this.#r.element,this.#a=i,this.createViewport(s,n)}get parent(){return this.#r}get core(){return this.#t}get config(){return this.#s}set width(t){this.setWidth(t)}get width(){return this.#n.getBoundingClientRect().width}set height(t){this.setHeight(t)}get height(){return this.#n.getBoundingClientRect().height}get dimensions(){return v.elementDimPos(this.#n)}set layerWidth(t){this.#c=t}get layerWidth(){return this.#c}get stateMachine(){return this.#r.stateMachine}set state(t){this.#t.setState(t)}get state(){return this.#t.getState()}get data(){return this.#t.chartData}get range(){return this.#t.range}get stream(){return this.#t.stream}get TimeLine(){return this.#t.TimeLine}get xAxis(){return this.#t.TimeLine.xAxis}get Scale(){return this.#r.Scale}get yAxis(){return this.#r.Scale.yAxis}get viewport(){return this.#e}get overlays(){return this.#o}destroy(){let t=this.#o.list;for(let[i,s]of t)s.instance=null;t=null,this.#e.destroy()}setSize(t,i,s){const n=this.#o.list;this.#e.setSize(t,i);for(let[o,a]of n)a.layer.setSize(s,i)}createViewport(t=[],i=!1){t=t.length==0?P(Un):t;const{width:s,height:n}=this.layerConfig();let o=i?S.Node:S.Viewport;this.#e=new o({width:s,height:n,container:this.#a}),this.#l=this.#e.scene.canvas,this.#o=new _n(this,t)}layerConfig(){const t=this.config?.buffer||Nt,i=this.#a.getBoundingClientRect().width,s=this.#a.getBoundingClientRect().height;this.layerWidth=Math.round(i*((100+t)*.01));const n={width:this.layerWidth,height:s};return{width:i,height:s,layerConfig:n}}addOverlays(t){return this.#o.addOverlays(t)}addOverlay(t,i){return this.#o.addOverlay(t,i)}draw(t=this.range,i=!1){const s=this.#o.list;for(let[n,o]of s)this.#t.scrollPos==this.#t.bufferPx*-1||this.#t.scrollPos==0||i==!0?o.instance.draw():this.#r.streamCandle&&s.get("stream").instance.draw(),o.fixed||(o.instance.position=[this.#t.scrollPos,0])}render(){this.#e.render()}}const Wn='<svg width="46.08" height="46.08" viewBox="-51.2 -51.2 614.4 614.4" ><path d="M471.993 112h-89.2l-16.242-46.75a32.023 32.023 0 00-30.229-21.5H175.241a31.991 31.991 0 00-30.294 21.691L129.1 112H40a24.027 24.027 0 00-24 24v312a24.027 24.027 0 0024 24h431.993a24.027 24.027 0 0024-24V136a24.027 24.027 0 00-24-24zm-8 328H48.007V144h104.01l23.224-68.25h161.081l23.71 68.25h103.961z" class="ci-primary"></path><path d="M256 168a114 114 0 10114 114 114.13 114.13 0 00-114-114zm0 196a82 82 0 1182-82 82.093 82.093 0 01-82 82z"></path></svg>',zn='<svg width="46.08" height="46.08" viewBox="-51.2 -51.2 614.4 614.4"><path d="M376 160v32h65.372L252 381.373l-72-72L76.686 412.686l22.628 22.628L180 354.627l72 72 212-211.999V280h32V160H376z"></path><path d="M48 104H16v392h480v-32H48V104z"></path></svg>',Fn='<svg width="46.08" height="46.08" viewBox="-51.2 -51.2 614.4 614.4"><path d="M271.514 95.5h-32v178.111l115.613 54.948 13.737-28.902-97.35-46.268V95.5z"></path><path d="M256 16C123.452 16 16 123.452 16 256s107.452 240 240 240 240-107.452 240-240S388.548 16 256 16zm0 448c-114.875 0-208-93.125-208-208S141.125 48 256 48s208 93.125 208 208-93.125 208-208 208z"></path></svg>',Oi='<svg width="46.08" height="46.08" viewBox="-51.2 -51.2 614.4 614.4"><path d="M245.151 168a88 88 0 1088 88 88.1 88.1 0 00-88-88zm0 144a56 56 0 1156-56 56.063 56.063 0 01-56 56z"></path><path d="M464.7 322.319l-31.77-26.153a193.081 193.081 0 000-80.332l31.77-26.153a19.941 19.941 0 004.606-25.439l-32.612-56.483a19.936 19.936 0 00-24.337-8.73l-38.561 14.447a192.038 192.038 0 00-69.54-40.192l-6.766-40.571A19.936 19.936 0 00277.762 16H212.54a19.937 19.937 0 00-19.728 16.712l-6.762 40.572a192.03 192.03 0 00-69.54 40.192L77.945 99.027a19.937 19.937 0 00-24.334 8.731L21 164.245a19.94 19.94 0 004.61 25.438l31.767 26.151a193.081 193.081 0 000 80.332l-31.77 26.153A19.942 19.942 0 0021 347.758l32.612 56.483a19.937 19.937 0 0024.337 8.73l38.562-14.447a192.03 192.03 0 0069.54 40.192l6.762 40.571A19.937 19.937 0 00212.54 496h65.222a19.936 19.936 0 0019.728-16.712l6.763-40.572a192.038 192.038 0 0069.54-40.192l38.564 14.449a19.938 19.938 0 0024.334-8.731l32.609-56.487a19.939 19.939 0 00-4.6-25.436zm-50.636 57.12l-48.109-18.024-7.285 7.334a159.955 159.955 0 01-72.625 41.973l-10 2.636L267.6 464h-44.89l-8.442-50.642-10-2.636a159.955 159.955 0 01-72.625-41.973l-7.285-7.334-48.117 18.024L53.8 340.562l39.629-32.624-2.7-9.973a160.9 160.9 0 010-83.93l2.7-9.972L53.8 171.439l22.446-38.878 48.109 18.024 7.285-7.334a159.955 159.955 0 0172.625-41.973l10-2.636L222.706 48H267.6l8.442 50.642 10 2.636a159.955 159.955 0 0172.625 41.973l7.285 7.334 48.109-18.024 22.447 38.877-39.629 32.625 2.7 9.972a160.9 160.9 0 010 83.93l-2.7 9.973 39.629 32.623z"></path></svg>',Vn='<svg width="46.08" height="46.08" version="1.1" viewBox="-51.2 -51.2 614.4 614.4"><rect x="16" y="240.18" width="188.84" height="31.635"/><g transform="translate(-3.3234e-7 -112.18)"><rect x="307.16" y="352.37" width="188.84" height="31.635"/></g><rect transform="rotate(-90)" x="-496" y="240.18" width="188.84" height="31.635"/><rect transform="rotate(-90)" x="-204.84" y="240.18" width="188.84" height="31.635"/></svg>',Gn='<svg width="46.08" height="46.08" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"></path><path d="M6.535 3H21a1 1 0 011 1v16a1 1 0 01-1 1H6.535a1 1 0 01-.832-.445l-5.333-8a1 1 0 010-1.11l5.333-8A1 1 0 016.535 3zm.535 2l-4.666 7 4.666 7H20V5H7.07zM13 10.586l2.828-2.829 1.415 1.415L14.414 12l2.829 2.828-1.415 1.415L13 13.414l-2.828 2.829-1.415-1.415L11.586 12 8.757 9.172l1.415-1.415L13 10.586z"></path></svg>',Yn='<svg width="46.08" height="46.08" version="1.1" viewBox="-51.2 -51.2 614.4 614.4"><g stroke-width="30.155"><rect x="14.757" y="240.92" width="482.49" height="30.155" rx="15.078"/><rect x="14.757" y="147" width="482.49" height="30.155" rx="15.078"/><rect x="14.757" y="334.84" width="482.49" height="30.155" rx="15.078"/></g ><g transform="translate(5.937 -288.34)"><path d="m23.904 712.34c-8.3532 0-15.078 6.7252-15.078 15.078s6.7249 15.078 15.078 15.078h173.93c-0.65295-3.3651-2.0312-6.4697-2.0312-10.026 0-7.1393 1.5573-13.888 4.0625-20.13zm276.35 0c2.5051 6.2423 4.0365 12.991 4.0365 20.13 0 3.5554-1.3526 6.6618-2.0052 10.026h173.93c8.3532 0 15.078-6.7252 15.078-15.078s-6.7249-15.078-15.078-15.078z"/><path d="m250.06 759.97c17.965 0 32.545-14.58 32.545-32.545 0-17.965-14.58-32.545-32.545-32.545-17.965 0-32.545 14.58-32.545 32.545 0 17.965 14.58 32.545 32.545 32.545zm0 21.697c-29.964 0-54.242-24.279-54.242-54.242 0-29.964 24.279-54.242 54.242-54.242 29.964 0 54.242 24.279 54.242 54.242 0 29.964-24.279 54.242-54.242 54.242z" stroke-width="21.697"/></g ><path d="m144.05 18.672c-24.694 0-45.285 16.595-51.849 39.167h-62.37c-8.3532 0-15.078 6.7252-15.078 15.078s6.7249 15.078 15.078 15.078h62.37c6.5639 22.572 27.155 39.167 51.849 39.167s45.285-16.595 51.849-39.167h120.03c6.5639 22.572 27.155 39.167 51.849 39.167 24.694 0 45.285-16.595 51.849-39.167h62.552c8.3532 0 15.078-6.7252 15.078-15.078s-6.7249-15.078-15.078-15.078h-62.552c-6.5639-22.572-27.155-39.167-51.849-39.167-24.694 0-45.285 16.595-51.849 39.167h-120.03c-6.5639-22.572-27.155-39.167-51.849-39.167zm0 21.693c17.965 0 32.552 14.587 32.552 32.552 0 17.965-14.587 32.552-32.552 32.552-17.965 1e-5 -32.552-14.587-32.552-32.552 0-17.965 14.587-32.552 32.552-32.552zm223.72 0c17.965 0 32.552 14.587 32.552 32.552 0 17.965-14.587 32.552-32.552 32.552-17.965 0-32.552-14.587-32.552-32.552 0-17.965 14.587-32.552 32.552-32.552z" stroke-width="30.155"/></svg>',ht='<svg width="46.08" height="46.08" version="1.1" viewBox="-51.2 -51.2 614.4 614.4"><g transform="matrix(21.697 0 0 21.697 -47.758 -47.758)"><path d="m7.354 21.354 14-14-0.707-0.707-14 14z"/><path d="m22.5 7c0.828 0 1.5-0.672 1.5-1.5s-0.672-1.5-1.5-1.5-1.5 0.672-1.5 1.5 0.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zm-17 16c0.828 0 1.5-0.672 1.5-1.5s-0.672-1.5-1.5-1.5-1.5 0.672-1.5 1.5 0.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"/></g></svg>',qn='<svg width="46.08" height="46.08" viewBox="0 0 32 32"><path d="M 3.2758709,20.241377 11.758622,28.72413 28.72413,11.758622 20.241377,3.2758709 Z m 2.1206881,0 1.5905161,-1.590515 3.7112049,3.711203 1.060342,-1.060345 -3.7112027,-3.711204 1.0603441,-1.060344 2.1206876,2.12069 1.060346,-1.060346 -2.120689,-2.120688 1.060343,-1.060344 3.711203,3.711203 L 16,17.060346 l -3.711203,-3.711208 1.060341,-1.060341 2.12069,2.120687 1.060344,-1.060346 -2.120688,-2.120687 1.060344,-1.060343 3.711204,3.711205 1.060345,-1.060345 -3.711205,-3.7112046 1.060344,-1.0603441 2.120687,2.1206887 1.060346,-1.0603446 -2.120687,-2.1206883 1.590515,-1.5905161 6.362065,6.362063 -14.84482,14.84482 z" style="stroke-width:0.749776" /></svg>',Xn='<svg width="46.08" height="46.08" viewBox="-51.2 -51.2 614.4 614.4"><g id="g930" transform="matrix(21.128963,0,0,21.128963,-29.235597,-50.369964)"><path clip-rule="evenodd" d="m 4.5,5 a 1.5,1.5 0 1 0 0,3 1.5,1.5 0 0 0 0,-3 z M 2,6.5 A 2.5,2.5 0 0 1 6.95,6 H 24 V 7 H 6.95 A 2.5,2.5 0 0 1 2,6.5 Z M 4.5,15 a 1.5,1.5 0 1 0 0,3 1.5,1.5 0 0 0 0,-3 z M 2,16.5 A 2.5,2.5 0 0 1 6.95,16 h 13.1 a 2.5,2.5 0 1 1 0,1 H 6.95 A 2.5,2.5 0 0 1 2,16.5 Z M 22.5,15 a 1.5,1.5 0 1 0 0,3 1.5,1.5 0 0 0 0,-3 z m -18,6 a 1.5,1.5 0 1 0 0,3 1.5,1.5 0 0 0 0,-3 z M 2,22.5 A 2.5,2.5 0 0 1 6.95,22 H 24 v 1 H 6.95 A 2.5,2.5 0 0 1 2,22.5 Z" id="path908" /><path clip-rule="evenodd" d="M 22.4,8.94 21.01,9.57 20.6,8.66 21.99,8.03 Z m -4,1.8 -1.39,0.63 -0.41,-0.91 1.39,-0.63 z m -4,1.8 -1.4,0.63 -0.4,-0.91 1.39,-0.63 z m -4,1.8 L 9,14.97 8.6,14.06 9.99,13.43 Z" id="path910" /></g></svg>',jn='<svg width="46.08" height="46.08" viewBox="-51.2 -51.2 614.4 614.4"><path d="M231.359 147l-80.921 205h45.155l15.593-39.5h89.628l15.593 39.5h45.155l-80.921-205zm-3.594 123.5L256 198.967l28.235 71.533z"></path><path d="M384 56H128V16H16v112h40v256H16v112h112v-40h256v40h112V384h-40V128h40V16H384zM48 96V48h48v48zm48 368H48v-48h48zm288-40H128v-40H88V128h40V88h256v40h40v256h-40zm80-8v48h-48v-48zM416 48h48v48h-48z"></path></svg>',Zn='<svg style="width: 46px; height: 46px" viewBox="-1.6 -1.6 19.2 19.2"><path d="M 15,2 C 15,1.4477153 14.552285,1 14,1 H 2 C 1.4477153,1 1,1.4477153 1,2 v 12 c 0,0.552285 0.4477153,1 1,1 h 12 c 0.552285,0 1,-0.447715 1,-1 z M 0,2 C 0,0.8954305 0.8954305,0 2,0 h 12 c 1.104569,0 2,0.8954305 2,2 v 12 c 0,1.104569 -0.895431,2 -2,2 H 2 C 0.8954305,16 0,15.104569 0,14 Z" id="path2" /><g id="g718" transform="translate(0,1.2499996)"><path d="M 7.5010125,7.9560661 5.355012,10.103066 c -0.472,0.472 -1.18,-0.2360003 -0.708,-0.7080003 L 7.6470125,6.3950659 c 0.195364,-0.195858 0.512636,-0.195858 0.708,0 l 3.0000005,2.9999998 c 0.472,0.472 -0.236,1.1800003 -0.708,0.7080003 L 8.5010125,7.9560661 c -0.431103,-0.417289 -0.523896,-0.423024 -1,0 z" style="" id="path566-5" /><path d="m 7.4989873,5.5439348 -2.1460003,-2.147 c -0.472,-0.472 -1.18,0.236 -0.708,0.708 l 3.0000003,3 c 0.1953639,0.195858 0.5126361,0.195858 0.708,0 l 2.9999997,-3 c 0.472,-0.472 -0.236,-1.18 -0.708,-0.708 l -2.1459997,2.147 c -0.4311027,0.417289 -0.5238956,0.423024 -1,0 z" style="" id="path566-6-3" /></g></svg>',Kn='<svg style="width: 46px; height: 46px" viewBox="-1.6 -1.6 19.2 19.2"><path d="M 15,2 C 15,1.4477153 14.552285,1 14,1 H 2 C 1.4477153,1 1,1.4477153 1,2 v 12 c 0,0.552285 0.4477153,1 1,1 h 12 c 0.552285,0 1,-0.447715 1,-1 z M 0,2 C 0,0.8954305 0.8954305,0 2,0 h 12 c 1.104569,0 2,0.8954305 2,2 v 12 c 0,1.104569 -0.895431,2 -2,2 H 2 C 0.8954305,16 0,15.104569 0,14 Z" id="path2" /><path d="m 7.4989873,7.7026182 -2.1460003,2.147 c -0.472,0.4719998 -1.18,-0.236 -0.708,-0.708 l 3.0000003,-3 c 0.1953639,-0.1958581 0.5126361,-0.1958581 0.708,0 l 2.9999997,3 c 0.472,0.472 -0.236,1.1799998 -0.708,0.708 l -2.1459997,-2.147 c -0.4311027,-0.417289 -0.5238956,-0.423024 -1,0 z" style="" id="path566-6-3" /></svg>',Qn='<svg style="width: 46px; height: 46px" viewBox="-1.6 -1.6 19.2 19.2"><path d="M 15,2 C 15,1.4477153 14.552285,1 14,1 H 2 C 1.4477153,1 1,1.4477153 1,2 v 12 c 0,0.552285 0.4477153,1 1,1 h 12 c 0.552285,0 1,-0.447715 1,-1 z M 0,2 C 0,0.8954305 0.8954305,0 2,0 h 12 c 1.104569,0 2,0.8954305 2,2 v 12 c 0,1.104569 -0.895431,2 -2,2 H 2 C 0.8954305,16 0,15.104569 0,14 Z" id="path2" /><path d="m 7.4989873,8.2973819 -2.1460003,-2.147 c -0.472,-0.472 -1.18,0.236 -0.708,0.708 l 3.0000003,3 c 0.1953639,0.1958581 0.5126361,0.1958581 0.708,0 l 2.9999997,-3 c 0.472,-0.472 -0.236,-1.18 -0.708,-0.708 l -2.1459997,2.147 c -0.4311027,0.417289 -0.5238956,0.423024 -1,0 z" style="" id="path566-6-3" /></svg>',Jn='<svg style="width: 46px; height: 46px" viewBox="-1.6 -1.6 19.2 19.2"><path d="M 15,2 C 15,1.4477153 14.552285,1 14,1 H 2 C 1.4477153,1 1,1.4477153 1,2 v 12 c 0,0.552285 0.4477153,1 1,1 h 12 c 0.552285,0 1,-0.447715 1,-1 z M 0,2 C 0,0.8954305 0.8954305,0 2,0 h 12 c 1.104569,0 2,0.8954305 2,2 v 12 c 0,1.104569 -0.895431,2 -2,2 H 2 C 0.8954305,16 0,15.104569 0,14 Z" id="path2" /><g id="g687" transform="translate(15.647255,-0.0288128)"><path d="m -8.1462425,10.484879 -2.1460005,2.146999 c -0.472,0.472 -1.18,-0.236 -0.708,-0.708 l 3.0000005,-2.9999994 c 0.195364,-0.195858 0.512636,-0.195858 0.708,0 l 3.0000005,2.9999994 c 0.472,0.472 -0.236,1.18 -0.708,0.708 l -2.1460005,-2.146999 c -0.431103,-0.417289 -0.523896,-0.423024 -1,0 z" style="" id="path566-5" /><path d="m -8.1482677,5.5727476 -2.1460003,-2.147 c -0.472,-0.472 -1.18,0.236 -0.708,0.708 l 3.0000003,3 c 0.1953639,0.195858 0.5126361,0.195858 0.708,0 l 2.9999997,-3 c 0.472,-0.472 -0.236,-1.18 -0.708,-0.708 l -2.1459997,2.147 c -0.4311027,0.417289 -0.5238956,0.423024 -1,0 z" style="" id="path566-6-3" /></g></svg>',tr='<svg style="width: 46px; height: 46px" viewBox="-1.6 -1.6 19.2 19.2"><path d="M 15,2 C 15,1.4477153 14.552285,1 14,1 H 2 C 1.4477153,1 1,1.4477153 1,2 v 12 c 0,0.552285 0.4477153,1 1,1 h 12 c 0.552285,0 1,-0.447715 1,-1 z M 0,2 C 0,0.8954305 0.8954305,0 2,0 h 12 c 1.104569,0 2,0.8954305 2,2 v 12 c 0,1.104569 -0.895431,2 -2,2 H 2 C 0.8954305,16 0,15.104569 0,14 Z" id="path2" /><g id="g611" transform="translate(0.2050748,-0.8829888)"><path d="m 7.2959375,11.933818 -2.146,-2.1469999 c -0.472,-0.4719998 -1.18,0.2359999 -0.708,0.7079999 l 3,3 c 0.195364,0.195858 0.512636,0.195858 0.708,0 l 3.0000005,-3 c 0.472,-0.472 -0.236,-1.1799997 -0.708,-0.7079999 L 8.2959375,11.933818 c -0.431103,0.417289 -0.523896,0.423024 -1,0 z" style="" id="path566" /><path d="m 7.2939123,5.8321596 -2.146,2.147 c -0.4719998,0.472 -1.1799998,-0.236 -0.708,-0.708 l 3,-3 c 0.1953639,-0.195858 0.5126361,-0.195858 0.708,0 l 2.9999997,3 c 0.472,0.472 -0.236,1.18 -0.708,0.708 l -2.1459997,-2.147 c -0.4311027,-0.417289 -0.5238956,-0.423024 -1,0 z" style="" id="path566-6" /></g></svg>',er='<svg style="width: 46px; height: 46px" viewBox="-1.6 -1.6 19.2 19.2"><path d="M 15,2 C 15,1.4477153 14.552285,1 14,1 H 2 C 1.4477153,1 1,1.4477153 1,2 v 12 c 0,0.552285 0.4477153,1 1,1 h 12 c 0.552285,0 1,-0.447715 1,-1 z M 0,2 C 0,0.8954305 0.8954305,0 2,0 h 12 c 1.104569,0 2,0.8954305 2,2 v 12 c 0,1.104569 -0.895431,2 -2,2 H 2 C 0.8954305,16 0,15.104569 0,14 Z" id="path2" /><path d="m 11.500447,8.5 c 0.666666,0 0.666666,-1 0,-1 H 4.444275 c -0.1571231,0 -0.224029,0.07336 -0.2978281,0.1459999 -0.1958579,0.195364 -0.1958579,0.5126361 0,0.7080001 0,0 0.113806,0.146 0.320186,0.146 z" style="" id="path887" /></svg>',ir='<svg class="ov-icon" width="46.08" height="46.08" font-size="2.88em" version="1.1" viewBox="-1.6 -1.6 19.2 19.2"><path d="m14 15c0.55228 0 1-0.44772 1-1v-12c0-0.55228-0.44772-1-1-1h-12c-0.55228 0-1 0.44772-1 1v12c0 0.55228 0.44772 1 1 1zm0-15c1.1046 0 2 0.89543 2 2v12c0 1.1046-0.89543 2-2 2h-12c-1.1046 0-2-0.89543-2-2v-12c0-1.1046 0.89543-2 2-2z" fill-rule="evenodd"/><g transform="translate(-1.1585)" fill-rule="evenodd">  <path d="m8.2964 7.5-2.147-2.146c-0.472-0.472 0.236-1.18 0.708-0.708l3 3c0.19586 0.19536 0.19586 0.51264 0 0.708l-3 3c-0.472 0.472-1.18-0.236-0.708-0.708l2.147-2.146c0.41729-0.4311 0.42302-0.5239 0-1z"/>  <path d="m12.323 4.4996c0-0.66667-1-0.66667-1 0v7.0562c0 0.15712 0.07336 0.22403 0.146 0.29783 0.19536 0.19586 0.51264 0.19586 0.708 0 0 0 0.146-0.11381 0.146-0.32019z"/></g></svg>',sr='<svg class="ov-icon" width="46.08" height="46.08" font-size="2.88em" version="1.1" viewBox="-1.6 -1.6 19.2 19.2"><path d="m2 15c-0.55228 0-1-0.44772-1-1v-12c0-0.55228 0.44772-1 1-1h12c0.55228 0 1 0.44772 1 1v12c0 0.55228-0.44772 1-1 1zm0-15c-1.1046 0-2 0.89543-2 2v12c0 1.1046 0.89543 2 2 2h12c1.1046 0 2-0.89543 2-2v-12c0-1.1046-0.89543-2-2-2z" fill-rule="evenodd"/><g transform="matrix(-1 0 0 1 17.159 0)" fill-rule="evenodd">  <path d="m8.2964 7.5-2.147-2.146c-0.472-0.472 0.236-1.18 0.708-0.708l3 3c0.19586 0.19536 0.19586 0.51264 0 0.708l-3 3c-0.472 0.472-1.18-0.236-0.708-0.708l2.147-2.146c0.41729-0.4311 0.42302-0.5239 0-1z"/>  <path d="m12.323 4.4996c0-0.66667-1-0.66667-1 0v7.0562c0 0.15712 0.07336 0.22403 0.146 0.29783 0.19536 0.19586 0.51264 0.19586 0.708 0 0 0 0.146-0.11381 0.146-0.32019z"/></g></svg>',nr=typeof window<"u"&&typeof window.document<"u";typeof process<"u"&&process.versions!=null&&process.versions.node!=null;const Pi=/^#?([0-9a-f]{3}|[0-9a-f]{6}|[0-9a-f]{8})$/i,ki=/^hsla?((\d{1,3}?),\s*(\d{1,3}%),\s*(\d{1,3}%)(,\s*[01]?\.?\d*)?)$/,$i=/^hsla[(]\s*0*(?:[12]?\d{1,2}|3(?:[0-5]\d|60))\s*(?:\s*,\s*0*(?:\d\d?(?:\.\d+)?\s*%|\.\d+\s*%|100(?:\.0*)?\s*%)){2}\s*,\s*0*(?:\.\d+|1(?:\.0*)?)\s*[)]$/,_i=/^rgba?((\d{1,3}%?),\s*(\d{1,3}%?),\s*(\d{1,3}%?)(,\s*[01]?\.?\d*)?)$/,Ni=/^^rgba[(](?:\s*0*(?:\d\d?(?:\.\d+)?(?:\s*%)?|\.\d+\s*%|100(?:\.0*)?\s*%|(?:1\d\d|2[0-4]\d|25[0-5])(?:\.\d+)?)\s*,){3}\s*0*(?:\.\d+|1(?:\.0*)?)\s*[)]$/;class Hi{#t={r:null,g:null,b:null,a:null,h:null,s:null,l:null,v:null,r16:null,g16:null,b16:null,a16:null,hex:null,hsl:null,hsla:null,rgb:null,rgba:null,isValid:!1};constructor(t){this.#s(t),Pi.test(t)&&this.#i(t),ki.test(t)&&this.#r(t),$i.test(t)&&this.#e(t),_i.test(t)&&this.#o(t),Ni.test(t)&&this.#n(t)}get value(){return this.#t}get isValid(){return this.#t.isValid}get hex(){return this.#t.hex.slice(0,-2)}get hexa(){return this.#t.hex}#s(t){if(nr){let i=document.getElementById("divValidColourTest");i||(i=document.createElement("div"),i.id="divValidColourTest"),i.style.backgroundColor="",i.style.backgroundColor=t,this.#t.isValid=!!i.style.backgroundColor.length}else this.#t.isValid=!!(Pi.test(t)||ki.test(t)||$i.test(t)||_i.test(t)||Ni.test(t))}setHex(t){let i=this.#t;[i.r16,i.g16,i.b16,i.a16]=t,i.hex="#"+i.r16+i.g16+i.b16+i.a16}setRGBA(t){let i=this.#t;[i.r,i.g,i.b,i.a]=t,i.rgb=`rgb(${t[0]},${t[1]},${t[2]})`,i.rgba=`rgb(${t[0]},${t[1]},${t[2]},${t[3]})`}setHSLA(t){let i=this.#t;[i.h,i.s,i.l,i.a]=t,i.hsl=`hsl(${t[0]},${t[1]}%,${t[2]}%)`,i.hsla=`hsl(${t[0]},${t[1]}%,${t[2]}%,${t[3]})`}#i(t){this.#t.hex=t;let i=t.length,s;switch(i){case 4:s=[`${t[1]}${t[1]}`,`${t[2]}${t[2]}`,`${t[3]}${t[3]}`,"ff"];break;case 7:s=[t.substr(1,2),t.substr(3,2),t.substr(5,2),"ff"];break;case 9:s=[t.substr(1,2),t.substr(3,2),t.substr(5,2),t.substr(7,2)];break}this.setHex(s),this.#u(s),this.#d(s)}#r(t){this.#t.hsl=t}#e(t){this.#t.hsla=t}#o(t){this.#t.rgb=t,this.#v(rgba)}#n(t){this.#t.rgba=t,this.#v(t)}#l(t){let{r:i,g:s,b:n,a:o}=this.#f(t);return i.length==1&&(i="0"+i),s.length==1&&(s="0"+s),n.length==1&&(n="0"+n),o.length==1&&(o="0"+o),this.value.r=i,this.value.g=s,this.value.b=n,this.value.a=o,this.setHex([i,s,n,o]),this}#a(t){let{r:i,g:s,b:n,a:o}=this.#f(t);i=parseInt(i,16)/255,s=parseInt(s,16)/255,n=parseInt(n,16)/255,o=parseInt(o,16)/255;const a=Math.max(i,s,n),h=a-Math.min(i,s,n),l=h?a===i?(s-n)/h:a===s?2+(n-i)/h:4+(i-s)/h:0;let c=[(60*l<0?60*l+360:60*l).toString(),(100*(h?a<=.5?h/(2*a-h):h/(2-(2*a-h)):0)).toString(),(100*(2*a-h)/2).toString(),o.toString()];return this.setHSLA(c),this}#c(t,i,s){i/=100,s/=100;const n=h=>(h+t/30)%12,o=i*Math.min(s,1-s),a=h=>s-o*Math.max(-1,Math.min(n(h)-3,Math.min(9-n(h),1)));return[255*a(0),255*a(8),255*a(4)]}#h(t,i,s){s/=100;const n=i*Math.min(s,1-s)/100,o=a=>{const h=(a+t/30)%12,l=s-n*Math.max(Math.min(h-3,9-h,1),-1);return Math.round(255*l).toString(16).padStart(2,"0")};return`#${o(0)}${o(8)}${o(4)}`}#u(t){m(t)&&(t=/([a-f\d]{2})/ig.exec(t));var i=[parseInt(t[0],16),parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)/255];this.setRGBA(i)}#d(t){m(t)&&(t=/([a-f\d]{2})/ig.exec(t));let i=parseInt(t[0],16),s=parseInt(t[1],16),n=parseInt(t[2],16),o=parseInt(t[3],16);i/=255,s/=255,n/=255,o/=255,this.setHSLA([i,s,n,o])}#f(t){let i,s,n,o,a=this.#t;if(a.r&&a.g&&a.b&&a.a)return{r:i,g:s,b:n,a:o}={...a};if(m(t)){let h=t.indexOf(",")>-1?",":" ";t=t.substr(4).split(")")[0].split(h)}if(x(t)){if(t.length<3||t.length>4)return!1;i=t[0],s=t[1],n=t[2],o=m(t[3])?t[3]:""}else if(p(t))i=t.r,s=t.g,n=t.b,o="a"in t?t.a:"";else return!1;return{r:i,g:s,b:n,a:o}}#v(t){let i,s,n=0,o=[],a=[],h=t.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+),?([^,\s)]+)?/i);h.shift();for(let l of h)s=l.indexOf("%")>-1,i=parseFloat(l),n<3&&s?i=Math.round(255*i/100):n==3&&(!s&&i>=0&&i<=1?i=Math.round(255*i):s&&i>=0&&i<=100?i=Math.round(255*i/100):i=""),o[n]=(i|1<<8).toString(16).slice(1),a[n++]=i;this.setHex(o),this.setRGBA(a),this.#d(this.#t.hex)}}const Bi=20,rr=20,or=new Hi(A.COLOUR_BORDER),Re=document.createElement("template");Re.innerHTML=`
<style>
  .scrollBarWidget {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: stretch;
    gap: 2px;
  }
  .scrollBar {
    position: relative;
    border: 1px solid var(--txc-time-scrollbar-color, ${A.COLOUR_BORDER});
    height: 20px;
    border-radius: 3px;
    flex-basis: 100%;
    overflow: hidden;
  }
  .scrollBar input {
    pointer-events: none;
    position: absolute;
    overflow: hidden;
    left: 0;
    top: 0;
    width: 100%;
    outline: none;
    height: 100%;
    margin: 0;
    padding: 0;
    background:  var(--txc-time-slider-color, #555);

  }
  .scrollBar input::-moz-range-thumb {
    -moz-appearance: none;
    appearance: none; 
    pointer-events: auto;
    position: relative;
    z-index: 10;
    outline: 0;
    height: 100%;
  }
  .scrollBar input::-webkit-slider-thumb {
    -webkit-appearance: none !important;
    appearance: none; 
    pointer-events: auto;
    position: relative;
    z-index: 1;
    height: 100%;
  }
  .scrollBar input::-moz-range-track {
    position: relative;
    z-index: -1;
    background-color: rgba(0, 0, 0, 1);
    border: 0;
  }
  .scrollBar input:last-of-type::-moz-range-track {
    -moz-appearance: none;
    background: none transparent;
    border: 0;
  }
  .scrollBar input[type="range"]::-webkit-slider-runnable-track {
    -webkit-appearance: none !important;
    appearance: none;
    background: none transparent;
    cursor: default;
    height: 1px; /* Required for Samsung internet based browsers */
    outline: 0;
  }
  .scrollBar input[type=range]::-moz-focus-outer {
    border: 0;
  }
  input[type=range] {
    -webkit-appearance: none;
    background: none;
  }

  input[type=range]::-webkit-slider-runnable-track {
    height: 5px;
    border: none;
    border-radius: 3px;
    background: transparent;
  }

  input[type=range]::-ms-track {
    height: 5px;
    background: transparent;
    border: none;
    border-radius: 3px;
  }

  input[type=range]::-moz-range-track {
    height: 5px;
    background: transparent;
    border: none;
    border-radius: 3px;
  }

  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    border: none;
    height: 20px;
    width: 16px;
    border-radius: 3px;
    background: var(--txc-time-slider-color, #555);
    margin-top: -10px;
    position: relative;
    z-index: 10000;
  }

  input[type=range]::-ms-thumb {
    -webkit-appearance: none;
    border: none;
    height: 20px;
    width: 16px;
    border-radius: 3px;
    background:  var(--txc-time-slider-color, #555);
    margin-top: -5px;
    position: relative;
    z-index: 10000;
  }

  input[type=range]::-moz-range-thumb {
    -webkit-appearance: none;
    border: none;
    height: 100%;
    width: 16px;
    border-radius: 3px;
    background:  var(--txc-time-slider-color, #555);
    margin-top: -5px;
    position: relative;
    z-index: 10000;
  }

  input[type=range]:focus {
    outline: none;
  }

  .handle {
    background-color: var(--txc-time-handle-color, ${or.hex}44); 
    width: 2px;
    height: 18px;
    margin: 1px;
    margin-left: 872.968px;
    margin-right: 0px;
    position: absolute;
  }
  .icon {
    flex-basis: ${Bi}px;
  }
  .icon svg {
    fill: var(--txc-time-icon-color, ${A.COLOUR_ICON});
    width: ${Bi}px;
    height: ${rr}px;
    margin-top: 1px;
  }
  .icon svg:hover {
    fill: var(--txc-time-icon-hover-color, ${A.COLOUR_ICONHOVER});
  }
</style>
<div class="scrollBarWidget">
  <span id="rwdStart" class="icon rwdStart">${sr}</span>
  <span class="scrollBar">
    <div class="viewport"></div>
    <input id="min" class="min" name="min" type="range" step="1" min="0" max="3000" />
    <input id="max" class="max" name="max" type="range" step="1" min="0" max="3000" />
    <div class="handle"></div>
  </span>
  <span id="fwdEnd" class="icon fwdEnd">${ir}</span>
</div>
`;class ar extends ${#t;constructor(){super(Re),this.#t=Re}destroy(){}connectedCallback(){this.doInit&&(this.doInit=!1,this.shadowRoot.appendChild(this.#t.content.cloneNode(!0)),document.getElementById("slider-bar"),this.max.addEventListener("input",this.onChangeSliderHandler.bind({self:this,input:this.max})),this.min.addEventListener("input",this.onChangeSliderHandler.bind({self:this,input:this.min})))}disconnectedCallback(){}get scrollBarWidget(){return this.shadowRoot.querySelector(".scrollBarWidget")}get rwdStart(){return this.shadowRoot.querySelector(".rwdStart")}get fwdEnd(){return this.shadowRoot.querySelector(".fwdEnd")}get scrollBar(){return this.shadowRoot.querySelector(".scrollBar")}get viewport(){return this.shadowRoot.querySelector(".viewport")}get handle(){return this.shadowRoot.querySelector(".handle")}get icons(){return this.shadowRoot.querySelectorAll("svg")}get max(){return this.shadowRoot.querySelector("#max")}get min(){return this.shadowRoot.querySelector("#min")}get sliders(){return this.shadowRoot.querySelectorAll("input")}get overviewCSS(){return this.shadowRoot.querySelector("style[title=overview]")}onChangeSliderHandler(){console.log(`${this.input.value}, ${this.input.getAttribute("max")}`)}}window.customElements.define("tradex-overview",ar);const Ui=document.createElement("template");Ui.innerHTML=`
<style>
  .viewport {
    width: 100%;
    height: 50%;
  }
</style>
<div class="viewport"></div>
<tradex-overview></tradex-overview>
`;class hr extends ${constructor(){super(Ui)}destroy(){}disconnectedCallback(){}createGraph(){}get viewport(){return this.shadowRoot.querySelector(".viewport")}get overview(){return this.shadowRoot.querySelector("tradex-overview")}}window.customElements.define("tradex-time",hr);const Wi=document.createElement("template");Wi.innerHTML=`
<style>
  .viewport {
    position: relative;
    width: 100%;
    height: 100%;
  }
</style>
  <div class="viewport"></div>
`;class lr extends ${constructor(){super(Wi)}destroy(){}disconnectedCallback(){}get viewport(){return this.shadowRoot.querySelector(".viewport")}}window.customElements.define("tradex-grid",lr);const zi=document.createElement("template");zi.innerHTML=`
<style>
  ::slotted(.legend) {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    white-space: nowrap;
    width: calc(100% - 1em); 
    margin: 0 0 0 1em;
    text-align: left;
  }
</style>
<div class="legends">
  <slot name="legend"></slot>
</div>
`;class cr extends ${#t;#s;#i;#r;#e;constructor(){super(zi)}destroy(){}connectedCallback(){this.doInit&&(this.doInit=!1,this.shadowRoot.appendChild(this.template.content.cloneNode(!0)),this.style.display="block",this.#s=this.shadowRoot.querySelector(".legend"),this.#i=this.shadowRoot.querySelector(".title"),this.#r=this.shadowRoot.querySelector("dl"),this.#e=this.shadowRoot.querySelector(".controls"))}disconnectedCallback(){}get elLegend(){return this.#s}get elTitle(){return this.#i}get elInputs(){return this.#r}get elControls(){return this.#e}get title(){return this.#t}set title(t){this.setTittle(t)}setTittle(t){!m||(this.#t=t,this.elTitle.innerHTML=t)}buildInputs(t){let i=0,s="",n,o="",a="display: inline; margin-left: ",h="display: inline; margin-left: .25em;";for(n in t.inputs){let l=t?.colours?.[i]?` color: ${t.colours[i]};`:"",c=t?.inputs?.[n]!==void 0?t.inputs[n]:o,u=t?.labels?.[i]?`${n}:`:o;a+=t?.labels?.[i]?"1em;":".25em",s+=`<dt style="${a}">${u}</dt>
      <dd style="${h}${l}">${c}</dd>`,++i}return s}buildControls(t){let i="",s=t.ID;return t?.type!=="chart"&&(i+=`<span id="${s}_up" class="control">${Kn}</span>`,i+=`<span id="${s}_down" class="control">${Qn}</span>`),i+=`<span id="${s}_collapse" class="control">${er}</span>`,i+=`<span id="${s}_maximize" class="control">${tr}</span>`,i+=`<span id="${s}_restore" class="control">${Jn}</span>`,i+=t?.type!=="chart"?`<span id="${s}_remove" class="control">${Zn}</span>`:"",i+=`<span id="${s}_config" class="control">${Oi}</span>`,i}}window.customElements.define("tradex-legends",cr);const Fi=document.createElement("template");Fi.innerHTML=`
<style>
  .viewport {
    position: relative;
    width: 100%;
    height: inherit;
    background: var(--txc-onchart-background, none);
  }
  .viewport canvas {
    position: absolute;
    top: 1px;
  }
  tradex-legends {
    position: absolute;
    top: 0;
    left: 0;
    z-index:100;
    width: 100%;
  }
</style>
<div class="viewport"></div>
<tradex-legends></tradex-legends>
`;class dr extends ${#t;#s;#i;#r;#e;constructor(){super(Fi)}destroy(){}connectedCallback(){this.doInit&&(this.doInit=!1,this.shadowRoot.appendChild(this.template.content.cloneNode(!0)),this.style.display="block",this.#s=this.shadowRoot.querySelector(".viewport"),this.#i=this.shadowRoot.querySelector("tradex-legends"))}disconnectedCallback(){}get viewport(){return this.#s}get legend(){return this.#i}}window.customElements.define("tradex-onchart",dr);const Vi=document.createElement("template");Vi.innerHTML=`
<style>
  .viewport {
    width: 100%;
    height: inherit;
    background: var(--txc-onchart-background, none);
  }
  tradex-legends {
    position: absolute;
    top: 0;
    left: 0;
    z-index:100;
    width: 100%;
  }
</style>
<tradex-legends></tradex-legends>
<div class="viewport"></div>
`;class ur extends ${#t;#s;#i;#r;#e;constructor(){super(Vi)}destroy(){}connectedCallback(){this.doInit&&(this.doInit=!1,this.shadowRoot.appendChild(this.template.content.cloneNode(!0)),this.#s=this.shadowRoot.querySelector(".viewport"),this.#i=this.shadowRoot.querySelector("tradex-legends"))}disconnectedCallback(){}get viewport(){return this.#s}get legend(){return this.#i}}window.customElements.define("tradex-offchart",ur);const Gi=document.createElement("template");Gi.innerHTML=`
<style>
  tradex-grid, tradex-onchart, tradex-offchart {
    overflow: hidden;
  }
  tradex-grid {
    position: absolute;
    height: inherit;
  }
  tradex-onchart {
    position: relative;
    height: 100%;
  }
  tradex-grid,
  tradex-onchart {
    display: block;
    width: 100%;
  }
  ::slotted(tradex-offchart) {
    display: block;
    position: relative;
    top: 1px;
    width: 100%;
    border-top: 1px solid;
  }
</style>
<tradex-grid></tradex-grid>
<tradex-onchart></tradex-onchart>
<slot name="offchart" id="offchart"></slot>
`;class gr extends ${#t;#s;#i;#r;constructor(){super(Gi)}destroy(){}connectedCallback(){super.connectedCallback(),this.previousDimensions()}disconnectedCallback(){}get grid(){return this.shadowRoot.querySelector("tradex-grid")}get onChart(){return this.shadowRoot.querySelector("tradex-onchart")}get offCharts(){return this.shadowRoot.querySelectorAll("tradex-offchart")}get offChartSlot(){return this.shadowRoot.querySelector("#offchart")}get width(){return this.clientWidth}get height(){return this.clientHeight}get oWidth(){return this.#t}get oHeight(){return this.#s}get widthDeltaR(){return this.clientWidth/this.#t}get heightDeltaR(){return this.clientHeight/this.#s}previousDimensions(){this.#t=this.#i?this.#i:this.clientWidth,this.#s=this.#r?this.#r:this.clientHeight,this.#i=this.clientWidth,this.#r=this.clientHeight}}window.customElements.define("tradex-rows",gr);const Yi=document.createElement("template");Yi.innerHTML=`
<style>
  #viewport {
    position: absolute;
    width: 100%;
    height: inherit;
    background: var(--txc-onchart-background, none);
    z-index: 0;
  }
  #viewport canvas {
    position: absolute;
    top: 1px;
  }
  tradex-rows {
    position:relative;
    overflow: hidden;
    width: calc(100% - ${ct}px);
    height: calc(100% - ${Ft}px);
    border: 1px solid;
    border-color: var(--txc-border-color, ${A.COLOUR_BORDER}); 
  }
  tradex-time {
    position: relative;
    width: calc(100% - ${ct}px);
    height: ${Ft}px;
    overflow: hidden;
    margin-left: 1px;
    z-index: 1;
  }
</style>
<div id="viewport"></div>
<tradex-rows></tradex-rows>
<tradex-time></tradex-time>
`;class fr extends ${#t;#s;constructor(){super(Yi)}destroy(){}disconnectedCallback(){}get viewport(){return this.shadowRoot.querySelector("#viewport")}get rows(){return this.shadowRoot.querySelector("tradex-rows")}get time(){return this.shadowRoot.querySelector("tradex-time")}start(t){this.#s=t,this.setMain()}rowNode(t,i){const s=` border-top: 1px solid ${i.theme.chart.BorderColour};`;return`
      <tradex-offchart slot="offchart" class="${t}" style="${s}">
      </tradex-offchart>
    `}setMain(){let t=g(this.#s?.time?.height)?this.#s.time.height:Ft,i=this.#s.tools.location=="none"?60:0;this.rows.style.height=`calc(100% - ${t}px)`,this.rows.style.left=`${i}px`,this.time.style.left=`${i}px`,this.viewport.style.left=`${i}px`}}window.customElements.define("tradex-main",fr);const qi=document.createElement("template");qi.innerHTML=`
  <slot></slot>
`;class mr extends ${constructor(){super(qi)}destroy(){}disconnectedCallback(){}get icons(){return this.shadowRoot.querySelector("slot").assignedElements()}}window.customElements.define("tradex-tools",mr);const Xi=document.createElement("template");Xi.innerHTML=`
<style>
  .viewport {
    width: 100%;
    height: 100%;
    margin-top: 2px;
    margin-left: 2px;
  }
</style>
<div class="viewport"></div>
<slot name="offchart" id="offchart"></slot>
`;class pr extends ${#t;#s;constructor(){super(Xi)}destroy(){}connectedCallback(){this.doInit&&(this.doInit=!1,this.shadowRoot.appendChild(this.template.content.cloneNode(!0)),this.style.display="block",this.#t=this.shadowRoot.querySelector(".viewport"),this.#s=this.shadowRoot.querySelector("#offchart"))}disconnectedCallback(){}get viewport(){return this.#t}get offCharts(){return this.shadowRoot.querySelectorAll("tradex-offchart")}get offChartSlot(){return this.#s}}window.customElements.define("tradex-scale",pr);const yr=`
<style>
  tradex-tools {
    position: absolute; 
    top: 0; left: 0;
    width: ${tt}px;
    height: 100%; 
    min-height: 100%; 
  }
  tradex-main {
    position: absolute; 
    top: 0;
    right: 0;
    width: calc(100% - ${tt}px);
    height: 100%;
  }
  tradex-scale {
    position: absolute; 
    top: 0; 
    right: 0; 
    width: ${ct}px; 
    height: 100%;
  }
</style>
<tradex-tools></tradex-tools>
<tradex-main></tradex-main>
<tradex-scale></tradex-scale>
`,ji=document.createElement("template");ji.innerHTML=yr;class vr extends ${#t;constructor(){super(ji)}destroy(){}disconnectedCallback(){}get tools(){return this.shadowRoot.querySelector("tradex-tools")}get main(){return this.shadowRoot.querySelector("tradex-main")}get scale(){return this.shadowRoot.querySelector("tradex-scale")}start(t){this.#t=t,this.setToolsLocation()}setYAxisLocation(t=this.#t?.yAxis?.location){let i=g(this.#t?.tools?.width)?this.#t.tools.width:tt,s;switch(t){case"left":s=i==0?0:ct,this.scale.style.left=`${i}px`,this.scale.style.right=void 0,this.main.style.left=void 0,this.main.style.right=`-${s}px`,this.main.style.width=`calc(100% - ${i}px)`;break;case"both":case"right":default:s=i==0?ct:0,this.scale.style.left=void 0,this.scale.style.right=0,this.main.style.left=void 0,this.main.style.right=`${s}px`,this.main.style.width=`calc(100% - ${i}px)`;break}}setToolsLocation(t=this.#t?.tools?.location){switch(this.#t.tools=this.#t.tools||{},t){case"none":case!1:this.#t.tools.location="none",this.#t.tools.width=0,this.tools.style.display="none",this.tools.style.width="0px";break;case"right":this.#t.tools.location="right",this.#t.tools.width=this.#t?.tools?.width||tt,this.tools.style.display="block",this.tools.style.left=void 0,this.tools.style.right=0,this.tools.style.width=`${tt}px`;break;case"left":default:this.#t.tools.location="left",this.#t.tools.width=this.#t?.tools?.width||tt,this.tools.style.display="block",this.tools.style.left=0,this.tools.style.right=void 0,this.tools.style.width=`${tt}px`;break}this.setYAxisLocation()}}window.customElements.define("tradex-body",vr);const Zi=document.createElement("template");Zi.innerHTML=`
  <style>
    .utilsOptions {
      display: inline-block; float: right;
    }
  </style>
  <slot></slot>
  <div class="utilsOptions">
  </div>
`;class xr extends ${constructor(){super(Zi)}destroy(){}disconnectedCallback(){}get icons(){return this.shadowRoot.querySelector("slot").assignedElements()[0].children}}window.customElements.define("tradex-utils",xr);const Ki=document.createElement("template");Ki.innerHTML=`
  <slot name="widget"></slot>
`;class wr extends ${constructor(){super(Ki)}destroy(){}disconnectedCallback(){}}window.customElements.define("tradex-widgets",wr);const Sr=`
  <style title="core">
    tradex-utils {
      height: ${J}px; 
      width: 100%; 
    }
    tradex-body {
      position: relative;
      height: calc(100% - ${J}px); 
      min-height: ${nt-J}px;
      width: 100%;
    }
    tradex-widgets {
      position: relative;
    }
  </style>
  <div style="display: none;">
    <slot></slot>
  </div>
  <tradex-utils></tradex-utils>
  <tradex-body></tradex-body>
  <tradex-widgets></tradex-widgets>
`;class Cr extends ${#t;#s;#i;#r;#e=zt;#o=nt;#n;#l;#a;#c;#h;constructor(){const t=document.createElement("template");t.innerHTML=Sr,super(t,"closed"),this.#r=t}destroy(){this.resizeObserver.disconnect()}static get observedAttributes(){return["config","disabled","height","stream","width"]}connectedCallback(){if(this.doInit){this.doInit=!1,this.shadowRoot.appendChild(this.#r.content.cloneNode(!0)),this.style.display="block",this.style.minHeight=mi,this.elWidgetsG=this.shadowRoot.querySelector("tradex-widgets"),this.elUtils=this.shadowRoot.querySelector("tradex-utils"),this.elBody=this.shadowRoot.querySelector("tradex-body"),this.elMain=this.elBody.main,this.elTime=this.elBody.main.time,this.elTools=this.elBody.tools,this.elYAxis=this.elBody.scale,this.previousDimensions();let t=this.getAttribute("height")||"100%",i=this.getAttribute("width")||"100%";this.setDimensions(i,t),this.resizeObserver=new ResizeObserver(Q(this.onResized,50,this)),this.resizeObserver.observe(this)}}disconnectedCallback(){this.resizeObserver.disconnect(),this.removeEventListener("click",this.onClick)}attributeChangedCallback(t,i,s){switch(t){case"config":break;case"disabled":break;case"height":this.height(s);break;case"width":this.width(s);break}}get id(){return this.getAttribute("id")}set id(t){this.setAttribute("id",t)}get disabled(){return this.hasAttribute("disabled")}set disabled(t){t?this.setAttribute("disabled",""):this.removeAttribute("disabled")}get width(){return this.offsetWidth}set width(t){this.setWidth(t)}get height(){return this.offsetHeight}set height(t){this.setHeight(t)}get oWidth(){return this.#n}get oHeight(){return this.#l}get widthDeltaR(){return this.offsetWidth/this.#n}get heightDeltaR(){return this.offsetHeight/this.#l}get stream(){}set stream(t){}get body(){return this.#t}get utils(){return this.#s}get widgets(){return this.#i}elStart(t){this.#h=t,this.setUtilsLocation()}onResized(t){console.log("onResize"),console.log(this.offsetWidth),console.log(this.offsetHeight),p(this.MainPane)&&this.MainPane.constructor.name==="MainPane"&&(this.previousDimensions(),this.emit("global_resize",{w:this.offsetWidth,h:this.offsetHeight}))}previousDimensions(){this.#n=this.#a?this.#a:this.offsetWidth,this.#l=this.#c?this.#c:this.offsetHeight,this.#a=this.offsetWidth,this.#c=this.offsetHeight}setWidth(t){g(t)?(this.#e=t,t+="px"):m(t)||(this.#e=this.parentElement.getBoundingClientRect().width,t=this.#e+"px"),this.style.width=t}setHeight(t){g(t)?(this.#o=t,t+="px"):m(t)||(this.#o=this.parentElement.getBoundingClientRect().height,w=this.#o+"px"),this.style.height=t}setWidthMin(t){this.style.minWidth=`var(--txc-min-width, ${t})`}setHeightMin(t){this.style.minHeight=`var(--txc-min-height, ${w})`}setWidthMax(t){this.style.minWidth=`var(--txc-max-width, ${t})`}setHeightMax(t){this.style.minHeight=`var(--txc-max-height, ${w})`}setDimensions(t,i){let s,n=this.width,o=this.height;if(!t||!i){const a=this.getBoundingClientRect(),h=this.parentElement.getBoundingClientRect();i=a.height?a.height:h.height?h.height:nt,t=a.width?a.width:h.width?h.width:zt}return s={width:this.width,height:this.height,resizeW:t/n,resizeH:i/o,resizeWDiff:t-n,resizeHDiff:i-o},this.setWidth(t),this.setHeight(i),s}setUtilsLocation(t=this.#h?.utils?.location){switch(this.#h.utils=this.#h.utils||{},t){case"none":case!1:this.#h.utils.location="none",this.#h.utils.height=0,this.elUtils.style.display="none",this.elUtils.style.height="0px",this.elBody.style.height="100%",this.elBody.style.minHeight=`${nt}px`;break;case"top":default:this.#h.utils.location="top",this.#h.utils.height=J,this.elUtils.style.display="block",this.elUtils.style.height=`${J}px`,this.elBody.style.height=`calc(100% - ${J}px)`,this.elBody.style.minHeight=`${nt-J}px`}}}var Mr=[{id:"indicators",name:"Indicators",icon:zn,event:"utils_indicators",sub:[]},{id:"timezone",name:"Timezone",icon:Fn,event:"utils_timezone"},{id:"screenshot",name:"Screenshot",icon:Wn,event:"utils_screenshot"},{id:"settings",name:"Settings",icon:Oi,event:"utils_settings"}];class Tr{#t="Utilities";#s="utils";#i;#r;#e;#o;#n;#l;#a={};constructor(t,i){this.#i=t,this.#r=i,this.#e=t.elUtils,this.#o=t.config?.utilsBar||Mr,this.#n=t.WidgetsG,this.#l=t.indicators||Ti,this.init()}log(t){this.#i.log(t)}info(t){this.#i.info(t)}warning(t){this.#i.warn(t)}error(t){this.#i.error(t)}get name(){return this.#t}get shortName(){return this.#s}get core(){return this.#i}get options(){return this.#r}get pos(){return this.dimensions}get dimensions(){return v.elementDimPos(this.#e)}init(){this.mount(this.#e),this.log(`${this.#t} instantiated`)}start(){this.initAllUtils(),this.eventsListen()}end(){const t=this.#i,i=v.findBySelectorAll(`#${t.id} .${hi} .icon-wrapper`);for(let s of i)for(let n of this.#o)n.id===id&&s.removeEventListener("click",this.onIconClick);this.off("utils_indicators",this.onIndicators),this.off("utils_timezone",this.onTimezone),this.off("utils_settings",this.onSettings),this.off("utils_screenshot",this.onScreenshot)}eventsListen(){this.on("utils_indicators",this.onIndicators.bind(this)),this.on("utils_timezone",this.onTimezone.bind(this)),this.on("utils_settings",this.onSettings.bind(this)),this.on("utils_screenshot",this.onScreenshot.bind(this))}on(t,i,s){this.#i.on(t,i,s)}off(t,i){this.#i.off(t,i)}emit(t,i){this.#i.emit(t,i)}onIconClick(t){let i=t.currentTarget.dataset.event,s=t.currentTarget.dataset.menu||!1,n={target:t.currentTarget.id,menu:s,evt:t.currentTarget.dataset.event};this.emit(i,n),s?this.emit("openMenu",n):(this.emit("menuItemSelected",n),this.emit("utilSelected",n))}mount(t){t.innerHTML=this.defaultNode()}initAllUtils(){const t=this.#i,i=v.findBySelectorAll(`#${t.id} .${hi} .icon-wrapper`);for(let s of i){let n=s.id.replace("TX_",""),o=s.querySelector("svg");o.style.fill=Gt.COLOUR_ICON,o.style.height="90%";for(let a of this.#o)if(a.id===n&&(s.addEventListener("click",this.onIconClick.bind(this)),a.id==="indicators"&&(a.sub=Object.values(this.#l)),a?.sub)){let h={content:a.sub,primary:s},l=this.#n.insert("Menu",h);s.dataset.menu=l.id,l.start()}}}defaultNode(){let i=`
    <div style="display: inline-block; float: right;">
    <style>
      svg {
        height: ${Gt.ICONSIZE};
        fill: ${Gt.COLOUR_ICON};
      }
    </style>
    `;for(const s of this.#o)i+=this.iconNode(s);return i+"</div>"}iconNode(t){const i=`display: inline-block; height: ${Gt.ICONSIZE}; padding-top: 2px`,s="sub"in t?'data-menu="true"':"";return`
      <div id="TX_${t.id}" data-event="${t.event}" ${s} class="icon-wrapper" style="${i}">${t.icon}</div>

    `}onIndicators(t){console.log("Indicator:",t)}onTimezone(t){console.log("Timezone:",t),this.#i.notImplemented()}onSettings(t){console.log("Settings:",t),this.#i.notImplemented()}onScreenshot(t){console.log("Screenshot:",t),this.#i.notImplemented()}}class q{static#t=0;static#s={};#i;#r=null;#e;#o;#n;#l;#a;#c;#h;#u;#d;#f;#v;#g;#m=[0,0];#A=!1;#p;constructor(t){this.#l=t,this.#r=t.cnt,this.#i=this.#l.ID||D("TX_Tool_"),this.#e=t.name,this.#a=t.core,this.#u=t.elements.elChart,this.#c={...t.parent},this.#g=t.target,this.#g.addTool(this),this.#f=this.#v.viewport,this.#d=this.#f.scene.canvas,this.#p=t.pos}get inCnt(){return this.#r}get ID(){return this.#i}get name(){return this.#e}get shortName(){return this.#o}get core(){return this.#a}get stateMachine(){return this.#a.stateMachine}get state(){return this.#a.getState()}get data(){return this.#a.chartData}get range(){return this.#a.range}get target(){return this.#g}set layerTool(t){this.#v=t}get layerTool(){return this.#v}get elViewport(){return this.#f}get cursorPos(){return this.#m}get cursorActive(){return this.#A}get cursorClick(){return this.#p}get candleW(){return this.#a.Timeline.candleW}get theme(){return this.#a.theme}get config(){return this.#a.config}get scrollPos(){return this.#a.scrollPos}get bufferPx(){return this.#a.bufferPx}static create(t,i){const s=++q.#t;i.cnt=s,i.modID=`${i.toolID}_${s}`,i.toolID=i.modID,i.target=t;const n=new i.tool(i);return q.#s[s]=n,t.chartToolAdd(n),n}static destroy(t){if(t.constructor.name==="Tool"){const i=t.inCnt;delete q.#s[i]}}end(){this.stop()}stop(){this.#h.off("mousemove",this.onMouseMove)}eventsListen(){this.#h=new j(this.#d,{disableContextMenu:!1}),this.#h.on("mousemove",this.onMouseMove.bind(this))}on(t,i,s){this.#a.on(t,i,s)}off(t,i){this.#a.off(t,i)}emit(t,i){this.#a.emit(t,i)}onMouseMove(t){this.#m=[Math.round(t.position.x),Math.round(t.position.y)],this.emit("tool_mousemove",this.#m)}createViewport(){this.config.buffer||BUFFERSIZE,this.#f.getBoundingClientRect().width,this.#n.chartH||this.#c.rowsH-1}draw(){}}class br extends q{constructor(t){super(t)}}class Kt extends q{#t=Qi.colour;#s=Qi.lineWidth;#i;constructor(t){super(t)}set colour(t=this.#t){this.#t=t}get colour(){return this.#t}set lineWidth(t){this.#s=g(t)?t:this.#s}get lineWidth(){return this.#s}set stateMachine(t){this.#i=new X(t,this)}get stateMachine(){return this.#i}start(){this.eventsListen();let[t,i]=this.cursorClick;this.layerTool.scene.clear();const n=this.layerTool.scene.context;n.save(),n.lineWidth=this.lineWidth,n.strokeStyle=this.colour,n.beginPath(),n.moveTo(t,i),n.lineTo(300,150),n.stroke(),n.closePath(),n.restore(),this.elViewport.render()}}class Lr extends q{constructor(t){super(t)}}class Ar extends q{constructor(t){super(t)}}class Er extends q{constructor(t){super(t)}}var Rr=[{id:"cursor",name:"Cursor",icon:Vn,event:"tool_activated"},{id:"line",name:"Line",icon:ht,event:"tool_activated",class:Kt,sub:[{id:"ray",name:"Ray",icon:ht,event:"tool_activated",class:Kt},{id:"hRay",name:"Horizontal Ray",icon:ht,event:"tool_activated",class:Kt},{id:"vRay",name:"Vertical Ray",icon:ht,event:"tool_activated",class:Kt}]},{id:"fibonacci",name:"Fibonacci",icon:Yn,event:"tool_activated",class:br,sub:[{id:"fib",name:"Not Implemented Yet",icon:ht}]},{id:"range",name:"Range",icon:Xn,event:"tool_activated",class:Ar,sub:[{id:"rng",name:"Not Implemented Yet",icon:ht}]},{id:"text",name:"Text",icon:jn,event:"tool_activated",class:Er,sub:[{id:"txt",name:"Not Implemented Yet",icon:ht}]},{id:"measure",name:"Measure",icon:qn,event:"tool_activated",class:Lr},{id:"delete",name:"Delete",icon:Gn,event:"tool_activated",class:void 0}];const Qi={colour:"#8888AACC",lineWidth:1};var Ji={id:"template",initial:"idle",context:{},states:{idle:{onEnter(r){console.log("idle: onEnter")},onExit(r){console.log("idle: onExit")},on:{tool_activated:{target:"tool_activated",action(r){this.context.origin.onToolActivated(r)}}}},tool_activated:{onEnter(r){},onExit(r){},on:{tool_targetSelected:{target:"tool_addToTarget",action(r){this.context.origin.onToolTargetSelected(r)}}}},tool_addToTarget:{onEnter(r){},onExit(r){},on:{always:{target:"idle",condition:"toolTarget",action(r){this.context.origin.addNewTool()}}}}},guards:{toolTarget(){return!0}}};class Dr{#t="Toolbar";#s="tools";#i;#r;#e;#o;#n;#l=q;#a;#c={};#h=void 0;#u;constructor(t,i){this.#i=t,this.#r=i,this.#o=t.elTools,this.#a=Rr||t.config.tools,this.#n=t.WidgetsG,this.init()}log(t){this.#i.log(t)}info(t){this.#i.info(t)}warning(t){this.#i.warn(t)}error(t){this.#i.error(t)}get name(){return this.#t}get shortName(){return this.#s}get core(){return this.#i}get options(){return this.#r}get pos(){return this.dimensions}get dimensions(){return v.elementDimPos(this.#o)}set stateMachine(t){this.#e=new X(t,this)}get stateMachine(){return this.#e}init(){this.mount(this.#o),this.log(`${this.#t} instantiated`)}start(){this.initAllTools(),this.addAllTools(),this.eventsListen(),Ji.context=this,this.stateMachine=Ji,this.stateMachine.start()}end(){this.stateMachine.destroy();const t=this.#i,i=v.findBySelectorAll(`#${t.id} .${li} .icon-wrapper`);for(let s of i)for(let n of this.#a)n.id===id&&s.removeEventListener("click",this.onIconClick);this.off("tool_selected",this.onToolSelect),this.off("tool_deselected",this.onToolDeselect)}eventsListen(){this.on("tool_selected",t=>{this.onToolSelect.bind(this)}),this.on("tool_deselected",t=>{this.onToolDeselect.bind(this)})}on(t,i,s){this.#i.on(t,i,s)}off(t,i){this.#i.off(t,i)}emit(t,i){this.#i.emit(t,i)}onIconClick(t){t.currentTarget.dataset.event;let i=t.currentTarget.dataset.menu||!1,s={target:t.currentTarget.id,menu:i,evt:t.currentTarget.dataset.event,tool:t.currentTarget.dataset.tool};i?this.emit("openMenu",s):this.emit("menuItemSelected",s)}onToolTargetSelected(t){console.log("tool_targetSelected",t.target),this.#u=t.target}onToolActivated(t){console.log("Tool activated:",t),this.#h=t}onToolSelect(t){}onToolDeselect(t){}mount(t){t.innerHTML=this.defaultNode()}initAllTools(){const t=this.#i,i=v.findBySelectorAll(`#${t.id} .${li} .icon-wrapper`);for(let s of i){let n=s.id,o=s.querySelector("svg");o.style.fill=Vt.COLOUR_ICON,o.style.width="90%";for(let a of this.#a)if(a.id===n)if(s.addEventListener("click",this.onIconClick.bind(this)),a?.sub){let h={content:a.sub,primary:s},l=this.#n.insert("Menu",h);s.dataset.menu=l.id,l.start();for(let c of a.sub)this.#c[c.id]=c.class}else this.#c[a.id]=a.class}}defaultNode(){let t=`
    <style>
      svg {
        height: ${Vt.ICONSIZE};
        fill: ${Vt.COLOUR_ICON};
      }
    </style>
    `;for(const i of this.#a)t+=this.iconNode(i);return t}iconNode(t){const i=`display: inline-block; height: ${Vt.ICONSIZE}; margin-left: -3px;`,s="sub"in t?'data-menu="true"':"";return`
      <div id="${t.id}" data-event="${t.event}" ${s} class="icon-wrapper" style="${i}">${t.icon}</div>

    `}addTool(t=this.#h,i=this.#u){let s={name:t,tool:this.#c[t],pos:i.cursorClick},n=this.#l.create(i,s);return n.start(),console.log(n),n}addNewTool(t,i){let s=this.addTool(t,i);this.activeTool=s,this.emit("tool_active",s),this.emit(`tool_${s.ID}_active`,s)}addAllTools(){}}class ts{#t;#s;#i;constructor(t){this.#s=t,this.#t=this.#s.core,this.#i=this.#t.Chart}get core(){return this.#t}get chart(){return this.#i}get parent(){return this.#s}get theme(){return this.#t.theme}get width(){return this.#i.width}get height(){return this.#i.height}get data(){return this.#i.data}get range(){return this.#i.range}get yDigits(){return this.#i.yAxisDigits}float2Int(t){return Rs(t)}numDigits(t){return Xe(t)}countDigits(t){return Es(t)}precision(t){return je(t)}}class Ir extends ts{#t=4;#s;#i=!0;constructor(t){super(t)}get range(){return this.parent.range}get width(){return this.parent.width}get interval(){return this.range.interval}get intervalStr(){return this.range.intervalStr}get timeStart(){return this.range.timeStart}get timeFinish(){return this.range.timeFinish}get rangeDuration(){return this.range.rangeDuration}get rangeLength(){return this.range.Length}get indexStart(){return this.range.indexStart}get indexEnd(){return this.range.indexEnd}get timeMax(){return this.range.timeMax}get timeMin(){return this.range.timeMin}get candleW(){return H(this.width/this.range.Length)}get candlesOnLayer(){return H(this.core.Chart.layerWidth/this.candleW)}get xAxisRatio(){return this.width/this.range.rangeDuration}set xAxisTicks(t){this.#t=g(t)?t:0}get xAxisTicks(){return this.#t}get xAxisGrads(){return this.#s}get scrollOffsetPx(){return this.core.scrollPos%this.candleW}get bufferPx(){return this.core.bufferPx}xPos(t){return H(this.range.rangeIndex(t)*this.candleW+this.candleW*.5)}t2Index(t){return this.range.rangeIndex(t)}t2Pixel(t){return this.xPos(t)}pixel2T(t){let i=this.pixel2Index(t);return this.range.value(i)[0]}pixel2Index(t){t-=this.candleW/2;let i=this.range.indexStart,s=H(t/this.candleW);return i+s}pixelOHLCV(t){let i=this.pixel2Index(t);return this.range.value(i)}xPosSnap2CandlePos(t){let i=t%this.candleW,s=i?this.candleW/2:0;return H(t-i+s)}xPos2Time(t){return this.pixel2T(t)}xPos2Index(t){return this.pixel2Index(t)}xPosOHLCV(t){return this.pixelOHLCV(t)}initXAxisGrads(){this.#s=this.calcXAxisGrads()}doCalcXAxisGrads(t){this.#s=this.calcXAxisGrads(t)}calcXAxisGrads(t=this.range.snapshot()){const i={entries:{},values:[],major:[],minor:[]},s=se(t.rangeDuration);i.units=s;for(let u in s)if(s[u]>0){i.units=[u,u],i.timeSpan=`${s[u]} ${u}`;break}const n=t.interval,{xStep:o,rank:a}=this.xStep(t),h=this.pixel2T(this.width)+o;let l=t.timeMin-t.timeMin%o-o,c=l;for(;l<h;){let u=Ot(l,"years"),f=Ot(l,"months"),y=Ot(l,"days");!(u in i.entries)&&u>=c?i.entries[u]=[this.dateTimeValue(u,n),this.t2Pixel(u),u,"major"]:!(f in i.entries)&&f>=c?i.entries[f]=[this.dateTimeValue(f,n),this.t2Pixel(f),f,"major"]:!(y in i.entries)&&y>=c&&(i.entries[y]=[this.dateTimeValue(y,n),this.t2Pixel(y),y,"major"]),i.entries[l]=[this.dateTimeValue(l,n),this.t2Pixel(l),l,"minor"],l+=o}return i.values=Object.values(i.entries),i}xStep(t){let i=Fs,s=this.#i?t.interval:1,n=mt[0],o=H(this.width/t.Length),a=ee[0],h=mt.indexOf(s);for(;h-->=0&&!(o*(mt[h]/s)>=i););return n=mt[h],a=ee[h],{xStep:n,rank:a}}dateTimeValue(t,i){if(t/M%1===0){const s=le(t);return s===1?ce(t)===0?Ge(t):Fe(t):s}else return i<L||i<R?ge(t):qe(t)}gradsWorker(){}}var es={id:"time",initial:"idle",context:{},states:{idle:{onEnter(r){},onExit(r){},on:{resize:{target:"resize",action(r){}},xAxis_scale:{target:"scale",action(r){}},xAxis_inc:{target:"incremental",action(r){}},xAxis_log:{target:"logarithmic",action(r){}},xAxis_100:{target:"percentual",action(r){}},chart_pan:{target:"chart_pan",action(r){}}}},resize:{onEnter(r){},onExit(r){},on:{someEvent:{target:"",action(r){}}}},chart_pan:{onEnter(r){},onExit(r){},on:{chart_pan:{target:"chart_pan",action(r){}},chart_panDone:{target:"idle",action(r){}}}}}};class De{static#t;#s;#i;#r;#e;#o={w:0,h:0};#n={w:0,h:0,x:0,y:0};#l={x:!1,y:!0};#a;#c={x:0,drag:!1};#h;#u;constructor(t){this.#s=De.#t++,this.#i=t.core,this.#r=v.isElement(t.elContainer)?t.elContainer:!1,this.#e=v.isElement(t.elHandle)?t.elHandle:!1,this.#u=E(t.callback)?t.callback:!1,v.isElement(this.#r)&&v.isElement(this.#e)&&(this.mount(),this.eventsListen())}eventsListen(){this.#h=new j(this.#e,{disableContextMenu:!1}),this.#h.on("mouseenter",Q(this.onMouseEnter,1,this,!0)),this.#h.on("mouseout",Q(this.onMouseOut,1,this,!0)),this.#h.on("drag",Ze(this.onHandleDrag,100,this)),this.#h.on("enddrag",this.onHandleDragDone.bind(this)),this.#h.on("mousedown",Q(this.onMouseDown,100,this,!0)),this.#h.on("mouseup",this.onMouseUp.bind(this))}on(t,i,s){this.#i.on(t,i,s)}off(t,i){this.#i.off(t,i)}emit(t,i){this.#i.emit(t,i)}onMouseEnter(){const t=getComputedStyle(this.#e).backgroundColor;t&&(this.colour=new Hi(t),this.#e.style.backgroundColor=this.colour.hex)}onMouseOut(){this.#e.style.backgroundColor=this.colour.hexa}onMouseDown(){}onMouseUp(t){this.onHandleDragDone(t)}onHandleDrag(t){this.#c.drag||(this.#c.drag=!0,this.#c.x=t.position.x),this.handlePos(t)}onHandleDragDone(t){this.handlePos(t),this.#c.drag=!1}mount(){this.#o.w=this.#r.getBoundingClientRect().width,this.#o.h=this.#r.getBoundingClientRect().height,this.#r.style.overflow="hidden",this.#n.w=this.#e.getBoundingClientRect().width,this.#n.h=this.#e.getBoundingClientRect().height,this.#e.style.marginRight=0,this.#e.style.position="absolute"}handlePos(t){let i=this.#i.range,s=parseInt(this.#e.style.marginLeft),n=this.#r.getBoundingClientRect().width,o=this.#e.getBoundingClientRect().width,a=n-o,h=t.position.x-this.#c.x,l=B(s+h,0,a),c=(i.dataLength+i.limitFuture+i.limitPast)/n,u=Math.floor(l*c);this.setHandleDims(l,o),this.#i.jumpToIndex(u)}setHandleDims(t,i){let s=this.#r.getBoundingClientRect().width;i=i||this.#e.getBoundingClientRect().width,t=t/s*100,this.#e.style.marginLeft=`${t}%`,i=i/s*100,this.#e.style.width=`${i}%`}setCursor(t){this.#e.style.cursor=t}}class Or extends k{#t=[0,0];#s;constructor(t,i=!1,s=!1,n,o,a){i=o.time.xAxis,super(t,i,s,n,o)}set position(t){this.target.setPosition(t[0],t[1])}draw(t){this.scene.clear();const i=this.scene.context,s=this.xAxis.xAxisGrads.values,n=0,o=this.theme.xAxis;i.save(),i.strokeStyle=o.colourTick,i.fillStyle=o.colourTick,i.font=`${o.fontWeight} ${o.fontSize}px ${o.fontFamily}`;for(let a of s){let h=H(a[1]),l=Math.floor(i.measureText(`${a[0]}`).width*.5);i.fillText(a[0],h-l+n,this.xAxis.xAxisTicks+12),i.beginPath(),i.moveTo(h+n,0),i.lineTo(h+n,this.xAxis.xAxisTicks),i.stroke()}i.restore()}}class Pr extends k{#t=[0,0];#s;constructor(t,i=!1,s=!1,n,o,a){i=o.time.xAxis,super(t,i,s,n,o)}set position(t){this.target.setPosition(t[0],t[1])}draw(){this.scene.clear();const t=this.scene.context;this.xAxis.xAxisGrads.values,this.theme.xAxis,t.save(),t.restore()}}const At={fontSize:12,fontWeight:"normal",fontFamily:"Helvetica Neue",paddingLeft:3,paddingRight:3,paddingTop:2,paddingBottom:2,borderSize:0,txtCol:"#000",bakCol:"#CCC"};function kr(r,t){return Math.round(r.measureText(t).width)}function Ie(r=At.fontSize,t=At.fontWeight,i=At.fontFamily){return`${t} ${r}px ${i}`}function Oe(r,t,i){r.font=Ie(i.fontSize,i.fontWeight,i.fontFamily);const s=kr(r,t),n=i.paddingLeft||0,o=i.paddingRight||0,a=i.borderSize||0;return n+o+s+a*2}function Pe(r){const t=r.paddingTop||0,i=r.paddingBottom||0,s=r.borderSize||0,n=r.fontSize||0;return t+i+n+s*2}function Qt(r,t,i,s,n){r.save(),r.font=Ie(n?.fontSize,n?.fontWeight,n?.fontFamily),r.textBaseline="top",r.fillStyle=n.bakCol||At.bakCol;let o=n.width||Oe(r,t,n),a=n.height||Pe(n);r.fillRect(i,s,o,a),r.fillStyle=n.txtCol||At.txtCol,i=i+n?.paddingLeft,s=s+n?.paddingTop,r.fillText(`${t}`,i,s),r.restore()}class $r extends k{#t=[0,0];constructor(t,i=!1,s=!1,n,o){i=o.time.xAxis,super(t,i,s,n,o),this.viewport=t.viewport}set position(t){this.target.setPosition(t[0],t[1])}draw(){const t=this.scene.context,i=this.target.viewport.container.getBoundingClientRect(),s=this.core.mousePos.x-i.left;let n=this.xAxis.xPos2Time(s),o=new Date(n),a=o.toUTCString(),h={fontSize:this.theme.xAxis.fontSize*1.05,fontWeight:this.theme.xAxis.fontWeight,fontFamily:this.theme.xAxis.fontFamily,txtCol:this.theme.xAxis.colourCursor,bakCol:this.theme.xAxis.colourCursorBG,paddingTop:5,paddingBottom:3,paddingLeft:4,paddingRight:4},l=Oe(t,a,h),c=s+this.core.bufferPx;c=this.xAxis.xPosSnap2CandlePos(c),c=c-Math.round(l*.5)-this.core.scrollPos-this.core.bufferPx,this.scene.clear(),t.save(),Qt(t,a,c,1,h),t.restore()}}const _r=[["labels",{class:Or,fixed:!1,required:!0}],["overlay",{class:Pr,fixed:!1,required:!0}],["cursor",{class:$r,fixed:!1,required:!0}]];class Nr{#t="Timeline";#s="time";#i;#r;#e;#o;#n;#l;#a;#c;#h;#u=new Map;#d;#f;#v;#g;#m;#A;#p;#C;#$;#S;#y;#M;#T={width:20,height:20,fill:"#aaa"};constructor(t,i){this.#e=t,this.#i=i,this.#r=i.elements.elTime,this.#o=t.Chart,this.#n=new Ir(this,this.#o),this.init()}log(t){this.#e.log(t)}info(t){this.#e.info(t)}warning(t){this.#e.warn(t)}error(t){this.#e.error(t)}get name(){return this.#t}get shortName(){return this.#s}get options(){return this.#i}get core(){return this.#e}get element(){return this.#r}get elViewport(){return this.#a}get height(){return this.#r.getBoundingClientRect().height}set width(t){this.setWidth(t)}get width(){return this.#r.getBoundingClientRect().width}get xAxis(){return this.#n}get xAxisWidth(){return this.#n.width}get xAxisRatio(){return this.#n.xAxisRatio}get layerLabels(){return this.#C}get layerOverlays(){return this.#$}get xAxisGrads(){return this.#n.xAxisGrads}get candleW(){return this.#n.candleW}get candlesOnLayer(){return this.#n.candlesOnLayer}get theme(){return this.#e.theme}get config(){return this.#e.config}get graph(){return this.#h}get viewport(){return this.#d}get navigation(){return this.#f}get range(){return this.#e.range}get pos(){return this.dimensions}get dimensions(){return v.elementDimPos(this.#r)}get bufferPx(){return this.#e.bufferPx}get scrollPos(){return this.#e.scrollPos}get scrollOffsetPx(){return this.#e.scrollPos%this.candleW}get smoothScrollOffset(){return this.#e.smoothScrollOffset}get rangeScrollOffset(){return this.#e.rangeScrollOffset}set stateMachine(t){this.#l=new X(t,this)}get stateMachine(){return this.#l}get time(){return this}init(){const t=this.#r;this.#a=t.viewport,this.#c=t.overview,this.#v=t.overview.icons,this.#g=t.overview.scrollBar,this.#m=t.overview.handle,this.#A=t.overview.rwdStart,this.#p=t.overview.fwdEnd;const i={core:this.#e,elContainer:this.#g,elHandle:this.#m,callback:null};this.#M=new De(i)}setWidth(t){this.#r.style.width=`${t}px`,this.#a.style.width=`${t}px`}setDimensions(t){const i=this.config.buffer||Nt,s=t.w,n=this.height,o=Math.round(s*((100+i)*.01));this.#h.setSize(s,n,o),this.draw()}start(){this.createGraph(),this.onSetRange(),this.#n.initXAxisGrads(),this.draw(),this.eventsListen(),es.context=this,this.stateMachine=es,this.stateMachine.start()}end(){this.stateMachine.destroy(),this.#d.destroy(),this.#y.off("dblclick",this.onDoubleClick),this.#y.off("pointerenter",this.onPointerEnter),this.#y.on("pointerdrag",this.onPointerDrag),this.#y=null,this.off("main_mousemove",this.drawCursorTime),this.off("setRange",this.onSetRange),this.#p.removeEventListener("click",Q),this.#A.removeEventListener("click",Q)}eventsListen(){let t=this.#h.viewport.scene.canvas;this.#y=new j(t,{disableContextMenu:!1}),this.#y.on("dblclick",this.onDoubleClick.bind(this)),this.#y.on("pointerenter",this.onPointerEnter.bind(this)),this.#y.on("pointerdrag",this.onPointerDrag.bind(this)),this.on("main_mousemove",this.#S.draw.bind(this.#S)),this.on("setRange",this.onSetRange.bind(this)),this.#p.addEventListener("click",Q(this.onMouseClick,1e3,this,!0)),this.#A.addEventListener("click",Q(this.onMouseClick,1e3,this,!0))}on(t,i,s){this.#e.on(t,i,s)}off(t,i){this.#e.off(t,i)}emit(t,i){this.#e.emit(t,i)}onMouseClick(t){switch(t?.currentTarget?.id||t.target.parentElement.id){case"fwdEnd":this.onFwdEnd();break;case"rwdStart":this.onRwdStart();break}}onPointerEnter(t){t.domEvent.target.style.cursor="ew-resize"}onPointerDrag(t){let i=this.range,s=i.indexStart-t.movement.x,n=i.indexEnd;i.set(s,n)}onDoubleClick(t){this.core.jumpToEnd(),this.core.MainPane.draw(void 0,!0)}onFwdEnd(){this.core.jumpToEnd(),this.core.MainPane.draw(void 0,!0)}onRwdStart(){this.core.jumpToStart(),this.core.MainPane.draw(void 0,!0)}onSetRange(){let t=this.range,i=t.indexStart;t.indexEnd;let s=this.#g.getBoundingClientRect().width,n=t.dataLength+t.limitFuture+t.limitPast,o=s/n,a=t.Length*o,h=(i+t.limitPast)*o;this.#M.setHandleDims(h,a)}t2Index(t){return this.#n.t2Index(t)}xPos(t){return this.#n.xPos(t)}xPosSnap2CandlePos(t){return this.#n.xPosSnap2CandlePos(t)}xPos2Time(t){return this.#n.xPos2Time(t)}xPos2Index(t){return this.#n.xPos2Index(t)}xPosOHLCV(t){return this.#n.xPosOHLCV(t)}createGraph(){let t=P(_r);this.#h=new Lt(this,this.#a,t,!1),this.#S=this.graph.overlays.get("cursor").instance,this.#C=this.graph.overlays.get("labels").instance,this.#$=this.graph.overlays.get("overlay").instance}addOverlays(t){for(let i of t);this.graph.addOverlays(Array.from(this.#u))}render(){this.#h.render()}draw(t=this.range,i=!0){this.#h.draw(t,i)}hideCursorTime(){this.#S.visible=!1,this.render()}showCursorTime(){this.#S.visible=!0,this.render()}}const Jt={renderQ:new Map,rendered:[],renderLog:!1,dropFrames:!0,graphs:[],range:{},init:function(r){!p(r)||(this.renderLog=r?.renderLog||!1,this.dropFrames=r?.dropFrames||!0,this.graphs=x(r?.graphs)?[...r.graphs]:[],this.range=p(r?.range)?r.range:{})},queueFrame:function(r=this.range,t=this.graphs,i=!1){this.renderQ.size>1&&this.dropFrames&&this.dropFrame();const s=Date.now();return r=r.snapshot(),this.renderQ.set(s,{graphs:t,range:r,update:i}),s},dropFrame:function(r=-1){r===-1&&(r=_s(this.renderQ)),this.renderQ.size>1&&this.renderQ.has(r)&&this.renderQ.delete(r)},getFrame:function(r=0){return this.renderQ.has(r)?this.renderQ.get(r):$s(this.renderQ)},frameDone:function(){if(this.renderQ.size===0)return;const r=ks(this.renderQ);this.renderLog&&this.rendered.push([r,Date.now()]),this.renderQ.delete(r)},start:function(){requestAnimationFrame(this.execute.bind(this))},execute:function(){if(requestAnimationFrame(this.execute.bind(this)),this.renderQ.size===0)return;const[r,t]=Ps(this.renderQ);if(t.range.constructor.name==="RangeSnapshot"){for(let i of t.graphs)E(i.draw)&&i.draw(t.range,t.update);for(let i of t.graphs)E(i.render)&&i.render();this.frameDone()}}};class is{#t;#s;#i;#r;#e;#o;#n;#l;#a;#c;#h;#u;#d;#f;#v;#g;#m;#A;#p;#C;#$;#S;#y=new Map;#M=new Map;#T;#U=new Map;#b=new Map;#x=[0,0];#D=!1;#E;#N;#R;#P;#O;#w;#L;#_;constructor(t,i){if(this.#e=t,!!p(i)){this.#o={...i},this.#s=i.name,this.#i=i.shortName,this.#a=this.#o.elements.elTarget,this.#d=this.#o.elements.elScale,this.#n=this.#o.parent,this.#O=t.theme,this.#N=t.settings,this.#r=i.type||"offChart";for(const s in this.#o)s in this.props()&&this.props()[s](this.#o[s])}}log(t){this.core.log(t)}info(t){this.core.info(t)}warn(t){this.core.warn(t)}error(t){this.core.error(t)}set id(t){this.#t=t}get id(){return this.#t?`${this.#t}`:`${this.#e.id}.${this.#s}`}get name(){return this.#s}get shortName(){return this.#i}get title(){return this.#P}get type(){return this.#r}get parent(){return this.#n}get core(){return this.#e}get options(){return this.#o}get element(){return this.#a}get pos(){return this.dimensions}get dimensions(){return v.elementDimPos(this.#a)}set width(t){this.setWidth(t)}get width(){return this.#a.getBoundingClientRect().width}set height(t){this.setHeight(t)}get height(){return this.#a.getBoundingClientRect().height}get data(){}get range(){return this.#e.range}get stream(){return this.#A}get cursorPos(){return this.#x}set cursorActive(t){this.#D=t}get cursorActive(){return this.#D}get cursorClick(){return this.#E}get candleW(){return this.#e.Timeline.candleW}get theme(){return this.#e.theme}get config(){return this.#e.config}get scrollPos(){return this.#e.scrollPos}get bufferPx(){return this.#e.bufferPx}get elCanvas(){return this.#g.viewport.scene.canvas}get elScale(){return this.#d}get elLegend(){return this.#a.legend}get elViewport(){return this.#a.viewport}set layerWidth(t){this.#g.layerWidth=t}get layerWidth(){return this.#g.layerWidth}set legend(t){this.#m=t}get legend(){return this.#m}set time(t){this.#v=t}get time(){return this.#v}set scale(t){this.#f=t}get scale(){return this.#f}get axes(){return"x"}set graph(t){this.#g=t}get graph(){return this.#g}get viewport(){return this.#g.viewport}get layerGrid(){return this.#g.overlays.get("grid").layer}get overlays(){return this.#M}get overlayGrid(){return this.#g.overlays.get("grid").instance}get overlayTools(){return this.#b}set stateMachine(t){this.#l=new X(t,this)}get stateMachine(){return this.#l}start(t){this.#v=this.#e.Timeline,this.createGraph(),this.#f.start(),this.draw(this.range),this.setCursor("crosshair"),t.id=this.id,t.context=this,this.stateMachine=t,this.stateMachine.start()}end(){this.stateMachine.destroy(),this.#f.end(),this.#g.destroy(),this.#L.off("pointerdrag",this.onChartDrag),this.#L.off("pointerdragend",this.onChartDrag),this.#L.off("pointermove",this.onMouseMove),this.#L.off("pointerenter",this.onMouseEnter),this.#L.off("pointerout",this.onMouseOut),this.#L.off("pointerdown",this.onMouseDown),this.#w=null,this.off("main_mousemove",this.onMouseMove),this.off(xt,this.onStreamListening),this.off(wt,this.onStreamNewValue),this.off(z,this.onStreamUpdate),this.off(Bt,this.onStreamNewValue)}eventsListen(){this.#L=new j(this.#a,{disableContextMenu:!1}),this.#L.on("pointerdrag",this.onChartDrag.bind(this)),this.#L.on("pointerdragend",this.onChartDragDone.bind(this)),this.#L.on("pointermove",this.onMouseMove.bind(this)),this.#L.on("pointerenter",this.onMouseEnter.bind(this)),this.#L.on("pointerout",this.onMouseOut.bind(this)),this.#L.on("pointerdown",this.onMouseDown.bind(this)),this.on("main_mousemove",this.updateLegends.bind(this)),this.on(xt,this.onStreamListening.bind(this)),this.on(wt,this.onStreamNewValue.bind(this)),this.on(z,this.onStreamUpdate.bind(this)),this.on(Bt,this.onStreamNewValue.bind(this))}on(t,i,s){this.#e.on(t,i,s)}off(t,i){this.#e.off(t,i)}emit(t,i){this.#e.emit(t,i)}onChartDrag(t){this.setCursor("grab"),this.core.MainPane.onChartDrag(t),this.scale.onChartDrag(t)}onChartDragDone(t){this.setCursor("crosshair"),this.core.MainPane.onChartDragDone(t)}onMouseMove(t){this.core.MainPane.onPointerActive(this),this.scale.layerCursor.visible=!0,this.graph.overlays.list.get("cursor").layer.visible=!0,this.#x=[Math.round(t.position.x),Math.round(t.position.y)],this.#f.onMouseMove(this.#x),this.emit(`${this.id}_mousemove`,this.#x)}onMouseEnter(t){this.core.MainPane.onPointerActive(this),this.#x=[Math.round(t.position.x),Math.round(t.position.y)],this.core.MainPane.onMouseEnter(),this.scale.layerCursor.visible=!0,this.graph.overlays.list.get("cursor").layer.visible=!0,this.emit(`${this.id}_mouseenter`,this.#x)}onMouseOut(t){this.#D=!1,this.#x=[Math.round(t.position.x),Math.round(t.position.y)],this.scale.layerCursor.visible=!1,this.emit(`${this.id}_mouseout`,this.#x)}onMouseDown(t){this.#E=[Math.floor(t.position.x),Math.floor(t.position.y)],this.stateMachine.state==="tool_activated"&&this.emit("tool_targetSelected",{target:this,position:t})}onStreamListening(t){this.#A!==t&&(this.#A=t)}onStreamNewValue(t){this.draw(this.range,!0)}props(){return{title:t=>this.#P=t,yAxisDigits:t=>this.setYAxisDigits(t)}}setHeight(t){g(t)||(t=this.height||this.#n.height),this.#a.style.height=`${t}px`,this.#d.style.height=`${t}px`,this.elViewport.style.height=`${t}px`,this.#f.setDimensions({w:null,h:t})}setDimensions(t){const i=this.config.buffer||Nt;let{w:s,h:n}=t;s=this.width,n=n||this.height,this.layerWidth=Math.round(s*((100+i)*.01)),this.graph.setSize(s,n,this.layerWidth),this.setHeight(n),this.draw(void 0,!0),this.core.MainPane.draw(void 0,!1)}setCursor(t){this.element.style.cursor=t}addIndicator(t){const i=this.type==="onChart",s=this.core.indicators[t.type].ind,n=s.constructor.type==="both"?i:s.prototype.onChart;if(t?.type in this.core.indicators&&i===n){const o={class:s,params:{overlay:t}};if(this.graph.addOverlay(t.name,o))return this.#M.set(t.name,o),!0}else return!1}addTool(t){let{layerConfig:i}=this.layerConfig(),s=new S.Layer(i);this.#y.set(t.id,s),this.#p.addLayer(s),t.layerTool=s,this.#b.set(t.id,t)}addTools(t){}overlayTools(){}overlayToolAdd(t){this.#b.set(t.id,t)}overlayToolDelete(t){this.#b.delete(t)}drawGrid(){this.layerGrid.setPosition(this.#e.scrollPos,0),this.overlayGrid.draw("y"),this.#g.render()}refresh(){this.#f.draw(),this.draw()}updateLegends(t=this.#x,i=!1){if(this.#e.isEmpty)return;const s=this.#m.list;for(const n in s)this.#m.update(n,{pos:t,candle:i})}render(){this.#g.render(),this.#f.render()}draw(t=this.range,i=!1){this.#g.draw(t,i)}drawGrid(){this.layerGrid.setPosition(this.core.scrollPos,0),this.overlayGrid.draw("y"),this.#g.render()}resize(t=this.width,i=this.height){}zoomRange(){this.draw(this.range,!0),this.emit("zoomDone")}}class Hr extends ts{#t;#s;#i;#r;#e=$t[0];#o="automatic";#n={automatic:{get max(){return this.range?.valueMax},get min(){return this.range?.valueMin},get mid(){return this.range?.valueMin+this.range?.valueDiff*.5},get diff(){return this.range?.valueDiff},get zoom(){return 1},get offset(){return 0},range:null},manual:{max:1,min:0,mid:.5,diff:1,zoom:1,offset:0}};#l=1.04;#a=Qe;#c=zs;#h=3;#u;#d;constructor(t,i,s=$t[0],n){super(t),this.#i=i,this.#s=t,this.#t=t.parent,this.yAxisType=s,n=n||this.core.range,this.#n.automatic.range=n,this.#d=new Proxy(n,{get:(o,a)=>{const h=this.#o,l=this.#n;switch(a){case"max":return l[h][a];case"min":return l[h][a];case"mid":return l[h][a];case"diff":return l[h][a];case"zoom":return l[h][a];case"offset":return l[h][a];default:return o[a]}}})}get chart(){return this.#i}get range(){return this.#d}get height(){return this.chart.height}get rangeH(){return this.#d.diff*this.yAxisPadding}get yAxisRatio(){return this.getYAxisRatio()}get yAxisPrecision(){return this.yAxisCalcPrecision}set yAxisPadding(t){this.#l=t}get yAxisPadding(){return this.#l}set yAxisType(t){this.#e=$t.includes(t)?t:$t[0]}get yAxisType(){return this.#e}set yAxisStep(t){this.#a=g(t)?t:Qe}get yAxisStep(){return this.#a}set yAxisTicks(t){this.#h=g(t)?t:0}get yAxisTicks(){return this.#h}get yAxisGrads(){return this.#u}set mode(t){this.setMode(t)}get mode(){return this.#o}set offset(t){this.setOffset(t)}get offset(){return this.#d.offset}set zoom(t){this.setZoom(t)}get zoom(){return this.#d.zoom}getYAxisRatio(){return this.height/this.#d.diff}yAxisRangeBounds(){}yAxisLog(){}yAxisCntDigits(t){return this.countDigits(t)}yAxisCalcPrecision(){let t=this.numDigits(this.#d.max);return this.yDigits-t}yAxisCursor(){}yPos(t){switch(this.yAxisType){case"percent":return H(this.p100toPixel(t));case"log":return H(this.$2Pixel(Ds(t)));default:return H(this.$2Pixel(t))}}yPos2Price(t){return this.pixel2$(t)}$2Pixel(t){const i=t-this.#d.min;return this.height-i*this.yAxisRatio}lastYData2Pixel(t){let i=t-this.core.stream.lastPriceMin;return this.height-i*this.yAxisRatio}pixel2$(t){let i=(this.height-t)/this.height,s=this.#d.diff*i;return this.#d.min+s}p100toPixel(t){let i=this.height/this.#d.diff;return(t-this.#d.max)*-1*i}yAxisTransform(){}setMode(t){if(!["automatic","manual"].includes(t))return!1;const i=this.#n;this.mode=="automatic"&&t=="manual"?(i.manual.zoom=0,i.manual.max=this.#d.valueMax,i.manual.min=this.#d.valueMin,this.#o=t):this.mode=="manual"&&t=="automatic"&&(i.manual.zoom=0,this.#o=t)}setOffset(t){if(!g(t)||t==0||this.#o!=="manual")return!1;const i=this.#n;let s=this.pixel2$(t*-1),n=this.pixel2$(this.height-t),o=s-n;i.manual.min=n,i.manual.max=s,i.manual.mid=o/2,i.manual.diff=o,i.manual.zoom=0}setZoom(t){if(!g(t)||this.#o!=="manual")return!1;const i=this.#n;let s=i.manual.min,n=i.manual.max;const o=n-s,a=o*.01,h=t*a;s-=h,n+=h,!(n<s||s<=1/0*-1||n>=1/0)&&(i.manual.max=n,i.manual.min=s,i.manual.mid=o/2,i.manual.diff=o,i.manual.zoom=h,this.calcGradations())}calcGradations(){let t,i,s;switch(this.yAxisType){case"percent":t=this.#d.max>0?this.#d.max:100,i=this.#d.min>0?this.#d.min:0,s=this.#d.offset,this.#u=this.gradations(t+s,i+s);break;default:t=this.#d.max>0?this.#d.max:1,i=this.#d.min>0?this.#d.min:0,s=this.#d.offset,this.#u=this.gradations(t+s,i+s);break}return this.#u}gradations(t,i,s=!0,n=!1){let o,a,h;const l=[];a=t-i,a=this.rangeH>0?this.rangeH:1,h=a/(this.height/(this.core.theme.yAxis.fontSize*1.75));let c=Math.pow(10,Math.ceil(Math.log10(h)));h<.25*c?c=.25*c:h<.5*c&&(c=.5*c);var u=Math.ceil(i/c)*c,f=Math.floor(t/c)*c;let y=this.height,T=(f-u)/c,O=this.height/T,U=this.countDigits(T),Et;for(var ut=u;ut<=f;ut+=c)o=this.countDigits(ut),Et=this.niceValue(o,s,U),l.push([Et,fe(y),o]),y-=O;return l}niceValue(t,i=!0,s){if(t.integers){let n=s.integers;if(n-2>0){let o=Is(10,n-2);return Math.floor(t.value/o)*o}else return i?(n=n>0?n:n*-1,fe(t.value,n)):Math.floor(t.value)}else{let n=t.decimals-s.decimals;return n=n>0?n:n*-1,fe(t.value,n)}}limitPrecision(t){let i=t.value,s=this.#c-t.total,n=4-t.integers;if(s<1){let o=B(t.decimals+s,0,100);i=Number.parseFloat(i).toFixed(o)}else if(n<1){let o=2-n;i=Number.parseFloat(i).toFixed(o)}return i}}var Br={id:"scale",initial:"idle",context:{},states:{idle:{onEnter(r){this.context.origin.setCursor("ns-resize")},onExit(r){},on:{resize:{target:"resize",action(r){}},yAxis_scale:{target:"scale",action(r){}},yAxis_inc:{target:"incremental",action(r){}},yAxis_log:{target:"logarithmic",action(r){}},yAxis_100:{target:"percentual",action(r){}},setRange:{target:"setRange",action(r){}}}},resize:{onEnter(r){},onExit(r){},on:{someEvent:{target:"",action(r){}}}},setRange:{onEnter(r){},onExit(r){},on:{always:{target:"idle",condition:"zoomDone",action(r){this.context.origin.draw()}}}}},guards:{receiver(){return this.eventData.scale.ID==this.context.origin.ID},zoomDone(){return!0}}};class Ur extends k{#t=[0,0];constructor(t,i,s,n,o,a){o=s,s=s.yAxis,super(t,i,s,n,o,a),this.viewport=t.viewport}set position(t){this.target.setPosition(t[0],t[1])}draw(t){if(!this.parent.parent.cursorActive)return;this.#t=x(t)?t:this.#t;let[i,s]=this.#t,n=this.parent.yPos2Price(s),o=this.parent.nicePrice(n),a={fontSize:this.theme.yAxis.fontSize*1.05,fontWeight:this.theme.yAxis.fontWeight,fontFamily:this.theme.yAxis.fontFamily,txtCol:this.theme.yAxis.colourCursor,bakCol:this.theme.yAxis.colourCursorBG,paddingTop:2,paddingBottom:2,paddingLeft:3,paddingRight:3,width:this.viewport.width},h=a.fontSize+a.paddingTop+a.paddingBottom,l=s-h*.5;const c=this.scene.context;this.scene.clear(),c.save(),c.fillStyle=a.bakCol,c.fillRect(1,l,this.width,h),Qt(c,`${o}`,1,l,a),c.restore()}erase(){this.scene.clear(),this.target.viewport.render()}}class Wr extends k{constructor(t,i,s,n,o,a){o=s,s=s.yAxis,super(t,i,s,n,o,a),this.viewport=t.viewport}set position(t){this.target.setPosition(t[0],t[1])}draw(){const t=this.scene.context,i=this.yAxis,s=this.yAxis.calcGradations()||[],n=this.theme.yAxis,o=it(n.tickMarker)?n.tickMarker:!0;let a=[],h;switch(n?.location){case"left":a=[this.width,this.width-i.yAxisTicks];break;case"right":default:a=[1,i.yAxisTicks];break}this.scene.clear(),t.save(),t.strokeStyle=n.colourTick,t.fillStyle=n.colourTick,t.font=`${n.fontWeight} ${n.fontSize}px ${n.fontFamily}`;for(let l of s)h=i.$2Pixel(l[0]),t.fillText(l[0],i.yAxisTicks+5,h+n.fontSize*.3),o&&(t.beginPath(),t.moveTo(a[0],h),t.lineTo(a[1],h),t.stroke());t.restore()}}class zr extends k{constructor(t,i,s,n,o,a){o=s,s=s.yAxis,super(t,i,s,n,o,a),this.viewport=t.viewport}set position(t){this.target.setPosition(t[0],t[1])}draw(){const t=this.scene.context;this.yAxis.yAxis,this.scene.clear(),t.save(),t.restore()}}class Fr extends k{constructor(t,i,s,n,o,a){o=s,s=s.yAxis,super(t,i,s,n,o,a),this.viewport=t.viewport}set position(t){this.target.setPosition(t[0],t[1])}draw(t){if(t===void 0)return;const i=this.scene.context,s=this.core.stream.constructor.name=="Stream"&&this.config.stream.tfCountDown;let n=t[4],o=this.parent.nicePrice(n),a={fontSize:F.FONTSIZE*1.05,fontWeight:F.FONTWEIGHT,fontFamily:F.FONTFAMILY,txtCol:"#FFFFFF",bakCol:F.COLOUR_CURSOR_BG,paddingTop:2,paddingBottom:2,paddingLeft:5,paddingRight:3,width:this.viewport.width},h=0,l=Pe(a),c=this.parent.yPos(n)-l*.5;this.scene.clear(),i.save(),t[4]>=t[1]?a.bakCol=this.theme.candle.UpBodyColour:a.bakCol=this.theme.candle.DnBodyColour,Qt(i,o,h,c,a),s&&(o=this.core.stream.countDownUpdate(),a.fontSize=a?.fontSize/1.1,Qt(i,o,h,c+l,a)),i.restore(),this.viewport.render()}}const Vr=[["labels",{class:Wr,fixed:!0,required:!0}],["overlay",{class:zr,fixed:!0,required:!0}],["price",{class:Fr,fixed:!0,required:!0}],["cursor",{class:Ur,fixed:!0,required:!0}]];class ss{#t;#s="Y Scale Axis";#i="scale";#r;#e;#o;#n;#l;#a;#c;#h;#u;#d;#f;#v;#g;#m;#A=new Map;#p;#C;#$;#S;constructor(t,i){this.#r=t,this.#e={...i},this.#h=this.#e.elScale,this.#l=this.#e.chart,this.#o=this.#e.parent,this.#t=this.#e.offChartID||D("TX_scale_"),this.init()}log(t){this.#r.log(t)}info(t){this.#r.info(t)}warning(t){this.#r.warn(t)}error(t){this.#r.error(t)}get ID(){return this.#t}get name(){return this.#s}get shortName(){return this.#i}get core(){return this.#r}get options(){return this.#e}get parent(){return this.#o}set height(t){this.setHeight(t)}get height(){return this.#h.getBoundingClientRect().height}get width(){return this.#h.getBoundingClientRect().width}get element(){return this.#h}get layerCursor(){return this.#m}get layerLabels(){return this.#f}get layerOverlays(){return this.#v}get layerPriceLine(){return this.#g}get yAxis(){return this.#c}set yAxisType(t){this.#c.yAxisType=YAXIS_TYPES.includes(t)?t:YAXIS_TYPES[0]}get yAxisType(){return this.#c.yAxisType}get yAxisHeight(){return this.#c.height}get yAxisRatio(){return this.#c.yAxisRatio}get yAxisGrads(){return this.#c.yAxisGrads}set graph(t){this.#p=t}get graph(){return this.#p}get viewport(){return this.#d}get pos(){return this.dimensions}get dimensions(){return v.elementDimPos(this.#h)}get theme(){return this.#r.theme}get config(){return this.#r.config}set scaleRange(t){this.setScaleRange(t)}set rangeMode(t){this.#c.mode=t}get rangeMode(){return this.#c.mode}set rangeYFactor(t){this.core.range.yFactor(t)}set yOffset(t){this.#c.offset=t}get yOffset(){return this.#c.offset}set stateMachine(t){this.#n=new X(t,this)}get stateMachine(){return this.#n}get Scale(){return this}init(){this.#u=this.#h.viewport||this.#h}start(){const t=this.#o.name=="OffChart"?this.#o.localRange:void 0;this.#c=new Hr(this,this,this.options.yAxisType,t),this.createGraph(),this.addOverlays([]),this.#c.calcGradations(),this.draw(),this.eventsListen();const i=P(Br);i.context=this,this.stateMachine=i,this.stateMachine.start()}end(){this.stateMachine.destroy(),this.#C=null,this.#d.destroy(),this.#C.on("pointerdrag",this.onDrag),this.#C.on("wheel",this.onMouseWheel),this.#C.on("dblclick",this.resetScaleRange),this.off(`${this.#o.ID}_mousemove`,this.onMouseMove),this.off(`${this.#o.ID}_mouseout`,this.#m.erase),this.off(z,this.onStreamUpdate),this.off("chart_pan",this.onMouseMove),this.off("chart_panDone",this.onMouseMove)}eventsListen(){let t=this.#p.viewport.scene.canvas;this.#C=new j(t,{disableContextMenu:!1}),this.#C.setCursor("ns-resize"),this.#C.on("pointerdrag",Ze(this.onDrag,100,this)),this.#C.on("pointerdragend",this.onDragDone.bind(this)),this.#C.on("wheel",this.onMouseWheel.bind(this)),this.#C.on("dblclick",this.resetScaleRange.bind(this)),this.on(`${this.#o.id}_mousemove`,this.onMouseMove.bind(this)),this.on(`${this.#o.id}_mouseout`,this.#m.erase.bind(this.#m)),this.on(z,this.#g.draw.bind(this.#g))}on(t,i,s){this.core.on(t,i,s)}off(t,i){this.core.off(t,i)}emit(t,i){this.core.emit(t,i)}onResize(t){this.setDimensions(t)}onMouseMove(t){this.#S=x(t)?t:[Math.floor(t.position.x),Math.floor(t.position.y)],this.#m.draw(this.#S)}onDrag(t){this.#S=[Math.floor(t.position.x),Math.floor(t.position.y),t.dragstart.x,t.dragstart.y,t.movement.x,t.movement.y],this.#S,this.setScaleRange(this.#S[5]),this.render()}onDragDone(t){}onMouseWheel(t){t.domEvent.preventDefault();const i=Math.sign(t.wheeldelta)*-1;this.setScaleRange(i),this.render()}onStreamUpdate(t){}onChartDrag(t){this.#c.mode==="manual"&&(this.#c.offset=this.#r.MainPane.cursorPos[5],this.parent.draw(this.range,!0),this.draw())}setHeight(t){this.#h.style.height=`${t}px`}setDimensions(t){const i=this.#h.getBoundingClientRect().width;this.#p.setSize(i,t.h,i),this.setHeight(t.h),this.draw()}setScaleRange(t){this.#c.mode=="automatic"&&(this.#c.mode="manual"),this.#c.zoom=t,this.parent.draw(this.range,!0),this.draw()}resetScaleRange(){this.#c.mode="automatic",this.parent.draw(this.range,!0),this.draw()}setCursor(t){this.#h.style.cursor=t}yPos(t){return this.#c.yPos(t)}yPosStream(t){return this.#c.lastYData2Pixel(t)}yPos2Price(t){return this.#c.yPos2Price(t)}nicePrice(t){let i=this.#c.countDigits(t);return this.#c.limitPrecision(i)}createGraph(){let t=P(Vr);this.graph=new Lt(this,this.#u,t,!1),this.#m=this.graph.overlays.get("cursor").instance,this.#f=this.graph.overlays.get("labels").instance,this.#v=this.graph.overlays.get("overlay").instance,this.#g=this.graph.overlays.get("price").instance}addOverlays(t){for(let i of t);this.graph.addOverlays(Array.from(this.#A))}render(){this.#p.render()}draw(t=this.range,i=!0){this.#p.draw(t,i),this.#o.drawGrid()}resize(t=this.width,i=this.height){this.setDimensions({w:t,h:i})}}class ns{#t;#s;#i;#r;#e;#o={width:18,height:18,fill:"#aaa"};#n;constructor(t,i){this.#t=t,this.#s={},this.#i=i,this.#r=i.core,this.eventsListen()}get list(){return this.#s}eventsListen(){this.moveEvent=new PointerEvent("pointermove",{bubbles:!0,cancelable:!0}),this.#e=new j(this.#t,{disableContextMenu:!1}),this.#e.on("pointermove",this.onMouseMove.bind(this))}onMouseMove(t){}onMouseClick(){}buildLegend(t){const i=this.#r.theme;let s="order: 1; display: inline; margin: 0 0 0 -1em;";const n=`${i.legend.text}; color: ${i.legend.colour}; text-align: left;`;let o="margin-right: 1em; white-space: nowrap;";const a="order:2; float: right; margin: 0 0.5em 0; opacity:0",h="onmouseover='this.style.opacity=1'",l="onmouseout='this.style.opacity=0'",c=this.#t;return o+=t?.type==="chart"?"font-size: 1.5em;":"font-size: 1.2em;",`
      <div slot="legend" id="${t.id}" class="legend" style="${n}">
        <div>
          <span slot="title" class="title" style="${o}">${t.title}</span>
          <dl style="${s}">${c.buildInputs(t)}</dl>
        </div>
        <div slot="controls" class="controls" style="${a}" ${h} ${l}>${c.buildControls(t)}</div>
      </div>
    `}add(t){if(!p(t)||!("title"in t))return!1;t.id=D(t?.id||"legend"),t.type=t?.type||"overlay",t.parent=this.#i.ID;const i=this.buildLegend(t);this.#t.insertAdjacentHTML("beforeend",i);const s=this.#t.querySelector(`#${t.id}`);this.#s[t.id]={el:s,type:t.type,source:t?.source},this.#n=s.querySelectorAll(".control");for(let n of this.#n){let o=n.querySelector("svg");o.style.width=`${this.#o.width}px`,o.style.height=`${this.#o.height}px`,o.style.fill=`${this.#o.fill}`,n.addEventListener("click",this.onMouseClick.bind(this))}return t.id}remove(t){if(!(t in this.#s)||this.#s[t].type==="chart")return!1;this.#s[t].el.remove(),delete this.#s[t];for(let i of this.#n)i.removeEventListener("click",this.onMouseClick);return!0}update(t,i){if(!p(i)||!(t in this.#s))return!1;let s=this.#s[t].source(i.pos);const n=this.#t.buildInputs(s);this.#t.querySelector(`#${t} dl`).innerHTML=n}}class Gr{constructor(t,i){this.scene=t,this.ctx=this.scene.context,this.width=this.scene.width,this.cfg={...jt,...i}}draw(t){const i=this.ctx,n=t.raw[4]>=t.raw[1]?this.cfg.volume.UpColour:this.cfg.volume.DnColour;i.save(),i.strokeStyle=n,i.fillStyle=n,i.fillRect(Math.floor(t.x),Math.floor(t.z-t.h),Math.floor(t.w),Math.floor(t.h)),i.restore()}}class Yr extends k{#t;#s;constructor(t,i=!1,s=!1,n,o,a){super(t,i=!1,s=!1,n,o,a),this.#t=new Gr(t.scene,n),this.theme.volume.Height=B(n?.volume?.Height,0,100)||100}set position(t){this.target.setPosition(t[0],t[1])}draw(t=this.core.range){this.scene.clear();const i=t.data,s=this.scene.height,n=this.xAxis.smoothScrollOffset||0,o=this.xAxis.candleW,a=o>5?Math.ceil(o*.8):o,h={x:0+n-this.xAxis.candleW,w:a,z:s},l=Math.floor(s*this.theme.volume.Height/100);let c=this.core.rangeScrollOffset,u=t.indexStart-c,f=t.Length+c*2,y=f,T=u,O,U=0;for(;y--;)O=t.value(T),O[4]!==null&&(U=O[5]>U?O[5]:U),T++;for(;f--;)O=t.value(u),h.x=H(this.xAxis.xPos(O[0])-a/2),O[4]!==null&&(h.h=l-l*((U-O[5])/U),h.raw=i[u],this.#t.draw(h)),u++}}class rs{areaCoordinates=[];constructor(t,i){this.scene=t,this.ctx=this.scene.context,this.width=this.scene.width,this.cfg={...jt,...i}}draw(t){const i=this.ctx,s=t.raw[4]>=t.raw[1],n=s?this.cfg.candle.UpBodyColour:this.cfg.candle.DnBodyColour,o=s?this.cfg.candle.UpWickColour:this.cfg.candle.DnWickColour;switch(this.cfg.candle.Type){case I.CANDLE_SOLID:this.fill=!0;break;case I.CANDLE_HOLLOW:case I.OHLC:this.fill=!1;break;case I.CANDLE_UP_HOLLOW:this.fill=!s;break;case I.CANDLE_DOWN_HOLLOW:this.fill=s}let a=Math.max(t.w-1,1);a=a>5?Math.ceil(a*.8):a;let h=Math.max(Math.floor(a*.5),1),l=Math.abs(t.o-t.c),c=t.c===t.o?1:2,u=t.x,f=Math.floor(u)-.5;if(i.save(),i.strokeStyle=o,i.beginPath(),i.moveTo(f,Math.floor(t.h)),this.cfg.candle.Type===I.OHLC?i.lineTo(f,Math.floor(t.l)):s?(i.lineTo(f,Math.floor(t.c)),i.moveTo(f,Math.floor(t.o))):(i.lineTo(f,Math.floor(t.o)),i.moveTo(f,Math.floor(t.c))),i.lineTo(f,Math.floor(t.l)),i.stroke(),t.w>1.5&&this.fill){i.fillStyle=n;let y=s?1:-1;i.rect(Math.floor(u-h),t.c,Math.floor(h*2),y*Math.max(l,c)),i.fill(),i.stroke()}else if(t.w>1.5&&!this.fill&&this.cfg.candle.Type!==I.OHLC){let y=s?1:-1;i.rect(Math.floor(u-h),t.c,Math.floor(h*2),y*Math.max(l,c)),i.stroke()}else this.cfg.candle.Type===I.OHLC?(i.beginPath(),i.moveTo(f-h,t.o),i.lineTo(f,t.o),i.moveTo(f,t.c),i.lineTo(f+h,t.c),i.stroke()):(i.strokeStyle=n,i.beginPath(),i.moveTo(f,Math.floor(Math.min(t.o,t.c))),i.lineTo(f,Math.floor(Math.max(t.o,t.c))+(t.o===t.c?1:0)),i.stroke());i.restore()}body(t){}area(t){this.areaCoordinates.push(t)}areaRender(){const t=this.areaCoordinates;if(!x(t)||t.length==0)return;let i=this.ctx,s=this.cfg.candle,n;Math.max(t[0].w-1,1),t[0].x;let o=[t[0].x,t[0].h];i.save(),i.strokeStyle=s.AreaLineColour||s.UpBodyColour||s.DnBodyColour,i.lineWidth=1,i.beginPath(),i.moveTo(t[0].x,t[0].h);let a=0;for(;a<t.length;)i.lineTo(t[a].x,t[a].h),a++;if(s?.Type=="area"){if(n=i.createLinearGradient(0,0,0,this.scene.height),x(s.AreaFillColour))for(let[h,l]of s.AreaFillColour.entries())n.addColorStop(h,l);else m()?n=s.AreaFillColour:n=s.UpBodyColour||s.DnBodyColour;i.stroke(),i.lineTo(t[a-1].x,this.scene.height),i.lineTo(o[0],this.scene.height),i.fillStyle=n,i.closePath(),i.fill()}else i.stroke();i.restore(),t.length=0}}class qr extends k{#t;constructor(t,i=!1,s=!1,n,o){super(t,i=!1,s=!1,n,o),this.#t=new rs(t.scene,n)}set position(t){this.target.setPosition(t[0],t[1])}draw(t=this.core.range){this.scene.clear();let i,s=this.theme.candle.Type;switch(s){case I.AREA:case I.LINE:i=u=>{this.#t.area({...u})};break;default:i=u=>{this.#t.draw(u)};break}const o={x:(this.xAxis.smoothScrollOffset||0)-this.xAxis.candleW,w:this.xAxis.candleW};let a=this.core.rangeScrollOffset,h=t.indexStart-a,l=t.Length+a*2,c;for(this.core.stream&&(this.core.stream.lastPriceMax=t.valueMax,this.core.stream.lastPriceMin=t.valueMin);l;){if(c=t.value(h),o.x=this.xAxis.xPos(c[0]),c?.[7]){this.core.stream.lastXPos=o.x,this.core.stream.lastYPos={o:o.o,h:o.h,l:o.l,c:o.c};break}c[4]!==null&&(o.o=this.yAxis.yPos(c[1]),o.h=this.yAxis.yPos(c[2]),o.l=this.yAxis.yPos(c[3]),o.c=this.yAxis.yPos(c[4]),o.raw=c,i(o)),h++,l--}(s===I.AREA||s===I.LINE)&&this.#t.areaRender()}}class Xr extends k{#t;constructor(t,i=!1,s=!1,n,o,a){super(t,i=!1,s=!1,n,o,a),this.#t=new rs(t.scene,n),this.theme.priceLineStyle=this.theme?.priceLineStyle||fn}set position(t){this.setPosition(t[0],t[1])}setPosition(t,i){this.core.stream!==void 0&&(this.target.setPosition(t,i),this.core.stream.lastScrollPos=this.core.scrollPos)}draw(){if(this.core.stream===void 0||!x(this.chart.streamCandle))return;this.scene.clear();const t=this.core.range,i=this.chart.streamCandle,s=this.theme.candle.Type===I.AREA||this.theme.candle.Type===I.LINE?a=>{this.areaRender(a)}:a=>{this.#t.draw(a)};this.xAxis.smoothScrollOffset;const o={x:this.core.stream.lastXPos,w:this.xAxis.candleW};o.o=this.yAxis.yPos(i[1]),o.h=this.yAxis.yPos(i[2]),o.l=this.yAxis.yPos(i[3]),o.c=this.yAxis.yPos(i[4]),o.raw=i,t.inRenderRange(i[0])&&s(o),i[4]>=i[1]?this.theme.priceLineStyle.strokeStyle=this.core.theme.candle.UpBodyColour:this.theme.priceLineStyle.strokeStyle=this.core.theme.candle.DnBodyColour,wn(this.scene.context,o.c,0,this.target.width,this.theme.priceLineStyle)}areaRender(t){const i=this.core.range,s=i.value(i.data.length-2);if(s===null)return;const n={x:this.xAxis.xPos(s[0]),o:this.yAxis.yPos(s[1]),h:this.yAxis.yPos(s[2]),l:this.yAxis.yPos(s[3]),c:this.yAxis.yPos(s[4])},o=this.scene.context,a=this.theme,h=a.candle.UpBodyColour||a.candle.DnBodyColour;Math.max(t.w-1,1),t.x;let l;if(o.save(),o.fillStyle=h,o.strokeStyle=h,o.lineWidth=1,o.beginPath(),o.moveTo(t.x,t.c),o.lineTo(n.x,n.h),a.candle.Type===I.AREA){if(l=o.createLinearGradient(0,0,0,this.scene.height),x(a.candle.AreaFillColour))for(let[c,u]of a.candle.AreaFillColour.entries())l.addColorStop(c,u);else isString()?l=a.candle.AreaFillColour:l=a.candle.UpBodyColour||a.candle.DnBodyColour;o.stroke(),o.lineTo(n.x,this.scene.height),o.lineTo(t.x,this.scene.height),o.fillStyle=l,o.closePath(),o.fill()}else o.stroke();o.restore()}}const te={FONTSIZE:50,FONTWEIGHT:"bold",FONTFAMILY:A.FONTFAMILY,COLOUR:"#181818"};class jr extends k{constructor(t,i=!1,s=!1,n,o,a){super(t,i,s,n,o,a),this.params.content=a?.content||""}set position(t){this.target.setPosition(0,0)}draw(){let t=m(this.config?.watermark?.text),i=m(this.config?.watermark?.imgURL);if(!t&&!i)return;this.scene.clear();const s=this.scene.context;s.save(),t?this.renderText():i&&this.renderImage(),s.restore()}renderText(){const t=this.core.config?.watermark?.fontSize,i=this.core.config?.watermark?.fontWeight,s=this.core.config?.watermark?.fontFamily,n=this.core.config?.watermark?.textColour,o={fontSize:t||te.FONTSIZE,fontWeight:i||te.FONTWEIGHT,fontFamily:s||te.FONTFAMILY,txtCol:n||te.COLOUR},a=this.config.watermark.text,h=this.scene.context;h.font=Ie(o?.fontSize,o?.fontWeight,o?.fontFamily),h.textBaseline="top",h.fillStyle=o.txtCol;const l=Pe(o),c=Oe(h,a,o),u=(this.scene.width-c)/2,f=(this.scene.height-l)/2;h.fillText(a,u,f)}renderImage(){this.scene.context}}var Zr={id:"chart",initial:"idle",context:{},states:{idle:{onEnter(r){this.context.origin.setCursor("crosshair")},onExit(r){},on:{xAxis_scale:{target:"xAxis_scale",action(r){}},chart_yAxisRedraw:{target:"chart_yAxisRedraw",action(r){}},chart_tool:{target:"chart_tool",action(r){}},tool_activated:{target:"tool_activated",action(r){this.context.origin.setCursor("default")}}}},xAxis_scale:{onEnter(r){},onExit(r){},on:{Idle:{target:"idle",action(r){}}}},chart_yAxisRedraw:{onEnter(r){},onExit(r){},on:{always:{target:"idle",condition:"yAxisRedraw",action(r){this.context.origin.drawGrid()}}}},tool_activated:{onEnter(r){},onExit(r){},on:{tool_targetSelected:{target:"idle",condition:"toolSelectedThis",action(r){console.log("tool_targetSelected:",r)}}}}},guards:{priceMaxMin(){return!0},toolSelectedThis(r,t){return this.eventData===this.context},yAxisRedraw(){return!0},zoomDone(){return!0}}};const Kr=[["watermark",{class:jr,fixed:!0,required:!0,params:{content:null}}],["grid",{class:Zt,fixed:!0,required:!0,params:{axes:"y"}}],["volume",{class:Yr,fixed:!1,required:!0,params:{maxVolumeH:bt.ONCHART_VOLUME_HEIGHT}}],["candles",{class:qr,fixed:!1,required:!0}],["stream",{class:Xr,fixed:!1,required:!0}],["cursor",{class:Ee,fixed:!0,required:!0}]];class Qr extends is{#t;#s=5;#i=2.5;#r;#e;#o;#n;#l;#a;constructor(t,i){i.type="onChart",super(t,i),this.#t=t.onChart,this.init(i)}set state(t){this.core.setState(t)}get state(){return this.core.getState()}get data(){return this.core.chartData}get streamCandle(){return this.#a}get onChart(){return this.#t}set priceDigits(t){this.setYAxisDigits(t)}get priceDigits(){return this.#r||PRICEDIGITS}get indicators(){return this.overlays}init(t){let i={id:"chart",title:this.title,type:"chart",source:this.legendInputs.bind(this)};this.legend=new ns(this.elLegend,this),this.legend.add(i);const s={...t};s.parent=this,s.chart=this,s.elScale=this.elScale,s.legends=this.legend,s.yAxisType="default",this.scale=new ss(this.core,s),this.log(`${this.name} instantiated`)}start(){super.start(Zr),this.eventsListen(),this.addOverlays(this.core.onChart),p(this.Stream)&&this.Stream}end(){this.off("chart_yAxisRedraw",this.onYAxisRedraw),super.end()}eventsListen(){super.eventsListen(),this.on("chart_yAxisRedraw",this.onYAxisRedraw.bind(this))}onStreamUpdate(t){this.#a=t,this.#l.draw(),this.#n.setPosition(this.core.stream.lastScrollPos,0),this.graph.render(),this.updateLegends(this.cursorPos,t)}onYAxisRedraw(){this.scale.draw(),this.draw(this.range,!0)}setDimensions(t){super.setDimensions(t),this.draw(this.range,!0)}setYAxisDigits(t){this.#r=g(t)&&t>=3?parseInt(t):PRICEDIGITS}getPriceDigits(){return this.#r}loadData(t){}updateData(t){}createGraph(){let t=new Map(P(Kr));if(t.has("volume")){const i=t.get("volume");i.params.maxVolumeH=this.theme?.volume?.Height||bt.ONCHART_VOLUME_HEIGHT,t.set("volume",i)}t=Array.from(t),this.graph=new Lt(this,this.elViewport,t,!1),this.#n=this.graph.overlays.get("stream").layer,this.#l=this.graph.overlays.get("stream").instance}addOverlays(t){for(let s of t){const n={fixed:!1,required:!1};s.type in this.core.indicators&&(n.class=this.core.indicators[s.type].ind,n.params={overlay:s},this.overlays.set(s.name,n))}const i=this.graph.addOverlays(Array.from(this.overlays));for(let s of i)s[0]||this.overlays.delete(s[0])}refresh(){this.scale.draw(),this.draw(this.range,!0)}time2XPos(t){return this.time.xPos(t)}price2YPos(t){return this.scale.yPos(t)}setPriceVolumePrecision(t){if(!g(t)||t<0){this.warning("setPriceVolumePrecision","pricePrecision","pricePrecision must be a number and greater than zero!!!");return}this.#e=t}setPriceVolumePrecision(t){if(!g(t)||t<0){logWarn("setPriceVolumePrecision","volumePrecision","volumePrecision must be a number and greater than zero!!!");return}this.#o=t}legendInputs(t=this.cursorPos,i){t=this.cursorPos;let s={},n=[],o=[!0,!0,!0,!0,!0],a=this.time.xPos2Index(t[0]-this.core.scrollPos);a=B(a,0,this.range.data.length-1);let h=this.range.data[a];return h[4]>=h[1]?n=new Array(5).fill(this.theme.candle.UpWickColour):n=new Array(5).fill(this.theme.candle.DnWickColour),s.O=this.scale.nicePrice(h[1]),s.H=this.scale.nicePrice(h[2]),s.L=this.scale.nicePrice(h[3]),s.C=this.scale.nicePrice(h[4]),s.V=this.scale.nicePrice(h[5]),{inputs:s,colours:n,labels:o}}}var Jr={id:"offChart",initial:"idle",context:{},states:{idle:{onEnter(r){this.context.origin.setCursor("crosshair")},onExit(r){},on:{chart_tool:{target:"chart_tool",action(r){}},xAxis_scale:{target:"xAxis_scale",action(r){}},offChart_mouseDown:{target:"offChart_mouseDown",action(r){}},offChart_mouseUp:{target:"offChart_mouseUp",action(r){}},tool_activated:{target:"tool_activated",action(r){this.context.origin.setCursor("default")}}}},xAxis_scale:{onEnter(r){},onExit(r){},on:{Idle:{target:"idle",action(r){}}}},offChart_mouseDown:{onEnter(r){},onExit(r){},on:{Idle:{target:"idle",action(r){}}}},offChart_mouseUp:{onEnter(r){},onExit(r){},on:{Idle:{target:"idle",action(r){}}}},tool_activated:{onEnter(r){},onExit(r){},on:{tool_targetSelected:{target:"idle",condition:"toolSelectedThis",action(r){console.log("tool_targetSelected:",r)}}}}},guards:{zoomDone(){return!0},toolSelectedThis(r,t){return this.eventData===this.context}}};const to=[["grid",{class:Zt,fixed:!0,required:!0,params:{axes:"y"}}],["cursor",{class:Ee,fixed:!0,required:!0}]];class eo extends is{#t;#s;#i;#r;#e;#o;#n;#l;#a=new Map;#c;#h;#u={valueMax:100,valueMin:0,valueDiff:100};#d;constructor(t,i){i.type="offChart",super(t,i),this.#t=this.options.offChartID||D("TX_OC_"),this.#e=i.offChart,this.overlays.set(i.offChart.name,i.offChart),this.init(i)}get elOffChart(){return this.element}get widgets(){return this.core.WidgetsG}get offChartID(){return this.#s}get localRange(){return this.#u}get data(){}get Divider(){return this.#o}init(t){const i={...t};i.parent=this,i.chart=this,i.elScale=this.elScale,this.#i=this.core.indicators[this.#e.type].ind,i.yAxisType=this.#i.scale,this.scale=new ss(this.core,i),this.time=this.core.Timeline}start(t){this.#s=t,super.start(Jr),this.eventsListen();const s={offChart:this};this.#o=this.widgets.insert("Divider",s),this.#o.start();let n=this.#c,o={id:this.options.offChart.type,title:this.options.offChart.name,type:this.options.offChart.type,source:n.legendInputs.bind(n)};this.legend=new ns(this.elLegend,this),this.legend.add(o)}end(){this.#o.end(),super.end()}eventsListen(){super.eventsListen()}onStreamUpdate(t){this.#h=t,this.graph.render(),this.updateLegends()}setDimensions(t){super.setDimensions(t),this.draw(void 0,!0)}createGraph(){const t=[this.#e.name,{class:this.#i,fixed:!1,required:!1,params:{overlay:this.#e}}],i=P(to);i.splice(1,0,t),this.graph=new Lt(this,this.elViewport,i),this.#c=this.graph.overlays.get(this.#e.name).instance}refresh(){this.scale.draw(),this.draw()}}var os={id:"main",initial:"idle",context:{},states:{idle:{onEnter(r){},onExit(r){},on:{chart_pan:{target:"chart_pan",action(r){}},setRange:{target:"setRange",action(r){}},chart_scrollTo:{target:"chart_scrollTo",action(r){}},addIndicator:{target:"addIndicator",action(r){}},divider_pointerdrag:{target:"divider_pointerdrag",action(r){}},global_resize:{target:"global_resize",action(r){}}}},chart_pan:{onEnter(r){this.context.origin.setCursor("grab")},onExit(r){},on:{chart_pan:{target:"chart_pan",action(r){this.context.origin.updateRange(r),this.context.origin.setCursor("grab")}},chart_panDone:{target:"idle",action(r){this.context.origin.updateRange(r),this.context.origin.setCursor("default")}}}},setRange:{onEnter(r){},onExit(r){},on:{always:{target:"idle",condition:"zoomDone",action(r){this.context.origin.zoomRange(r)}}}},chart_scrollTo:{onEnter(r){},onExit(r){},on:{always:{target:"idle",action(r){this.context.origin.updateRange(r)}}}},addIndicator:{onEnter(r){this.context.origin.addIndicator(r)},onExit(r){},on:{addIndicatorDone:{target:"idle",action(r){}}}},divider_mousedown:{onEnter(r){this.context.divider=r},onExit(r){},on:{main_mousemove:{target:"divider_mousemove",action(r){console.log(`${this.id}: transition from "${this.state}" to "divider_mousemove"`)}}}},divider_mousemove:{onEnter(r){console.log(`${this.id}: state: "${this.state}" - onEnter`);let t=this.context.divider;this.context.pair=this.context.origin.resizeRowPair(t,r)},onExit(r){},on:{main_mousemove:{target:"divider_mousemove",action(r){}},main_mouseup:{target:"idle",action(r){this.actions.removeProperty.call(this)}},divider_mouseup:{target:"idle",action(r){this.actions.removeProperty.call(this),console.log(`${this.id}: transition from "${this.state}" to "ilde"`)}}}},divider_pointerdrag:{onEnter(r){const t=[r.e.dragstart.x,r.e.dragstart.y,r.e.dragend.x,r.e.dragend.y,r.e.movement.x,r.e.movement.y];this.context.pair=this.context.origin.resizeRowPair(r,t)},onExit(r){},on:{divider_pointerdrag:{target:"divider_pointerdrag",action(r){}},divider_pointerdragend:{target:"idle",action(r){this.actions.removeProperty.call(this)}}}},global_resize:{onEnter(r){this.context.origin.setDimensions()},onExit(r){},on:{always:{target:"idle",condition:"resizeDone",action(r){}}}}},guards:{zoomDone(){return!0},resizeDone(){return!0}},actions:{removeProperty(){let r=this.context.pair.active,t=this.context.pair.prev;r.element.style.removeProperty("user-select"),t.element.style.removeProperty("user-select")}}};const io=[["grid",{class:Zt,fixed:!1,required:!0,params:{axes:"x"}}]];class so{#t="MainPane";#s="Main";#i;#r;#e;#o;#n;#l;#a;#c;#h;#u;#d=[];#f=[];#v;#g;#m;#A;#p;#C;#$;#S;#y=new Map;#M;#T;#U;#b=ni;#x=120;#D=si;#E=[0,0];#N={active:!1,start:[0,0],prev:[0,0],delta:[0,0]};#R;#P;#O;#w;constructor(t,i){this.#e=t,this.#i=i,this.#r=t,this.#l=this.#e.elMain,this.#n=this.#e.elYAxis,this.init(i)}log(t){this.#e.log(t)}info(t){this.#e.info(t)}warning(t){this.#e.warn(t)}error(t){this.#e.error(t)}get id(){return`${this.#e.id}.${this.#t}`}get name(){return this.#t}get shortName(){return this.#s}get core(){return this.#e}get chart(){return this.#M}get time(){return this.#T}get offCharts(){return this.#y}get options(){return this.#i}get element(){return this.#l}get width(){return this.#l.getBoundingClientRect().width}get height(){return this.#l.getBoundingClientRect().height}get chartW(){return this.#h.getBoundingClientRect().width}get chartH(){return this.#h.getBoundingClientRect().height}get rowsW(){return this.#a.getBoundingClientRect().width}get rowsH(){return this.#a.getBoundingClientRect().height}get rowMinH(){return this.#D}set rowMinH(t){g(t)&&(this.#D=Math.abs(t))}get pos(){return this.dimensions}get dimensions(){return v.elementDimPos(this.#l)}get range(){return this.#e.range}get cursorPos(){return this.#E}get candleW(){return this.#T.candleW}get theme(){return this.#e.theme}get config(){return this.#e.config}get buffer(){return this.#R}get bufferPx(){return this.getBufferPx()}get scrollPos(){return this.#e.scrollPos}set stateMachine(t){this.#o=new X(t,this)}get stateMachine(){return this.#o}get graph(){return this.#p}get indicators(){return{onchart:this.#M.indicators,offchart:this.#y}}get elements(){return{elTarget:this.#h,elTime:this.#c,elRows:this.#a,elChart:this.#h,elOffCharts:this.#d,elScale:this.#u}}init(t){this.#e,this.#P=this.#e.indicators,this.#a=this.#l.rows,this.#c=this.#l.time,this.#h=this.#l.rows.onChart,this.#v=this.#l.rows.grid,this.#m=this.#l.viewport,this.#u=this.#e.elBody.scale,t.name="Chart",t.shortName="Chart",t.parent=this,t.chartData=this.#e.chartData,t.onChart=this.#e.onChart,t.offChart=this.#e.offChart,t.rangeLimit=this.#e.rangeLimit,t.settings=this.#e.settings,t.elements={...t.elements,elTarget:this.#h,elTime:this.#c,elRows:this.#a,elChart:this.#h,elOffCharts:this.#d,elScale:this.#u},this.#T=new Nr(this.#e,t),this.#M=new Qr(this.#e,t),this.registerOffCharts(t),this.#R=g(this.config.buffer)?this.config.buffer:Nt,this.#D=g(this.config.rowMinH)?this.config.rowMinH:si,this.#b=g(this.config.offChartDefaultH)?this.config.offChartDefaultH:ni,this.rowsOldH=this.rowsH,this.log(`${this.#t} instantiated`)}start(){let t=0;this.#l.start(this.theme),this.#T.start(),this.#M.start(),this.#y.forEach((i,s)=>{i.start(t++)}),this.rowsOldH=this.rowsH,this.createGraph(),this.draw(this.range,!0),Jt.init({graphs:[this.#p],range:this.range}),Jt.start(),Jt.queueFrame(this.range,[this.#p],!1),this.eventsListen(),os.id=this.id,this.stateMachine=os,this.stateMachine.start()}end(){this.stateMachine.destroy(),this.#T.end(),this.#M.end(),this.#y.forEach((t,i)=>{t.end()}),this.#C.destroy(),this.#w.off("wheel",this.onMouseWheel),this.#w.off("pointerdrag",this.onChartDrag),this.#w.off("pointerdragend",this.onChartDragDone),this.#w.off("pointermove",this.onMouseMove),this.#w.off("pointerenter",this.onMouseEnter),this.#w.off("pointerout",this.onMouseOut),this.#w.off("keydown",this.onChartKeyDown),this.#w.off("keyup",this.onChartKeyDown),this.#w=null,this.off(wt,this.onNewStreamValue),this.off("setRange",this.draw)}eventsListen(){this.#a.tabIndex=0,this.#a.focus(),this.#w=new j(this.#a,{disableContextMenu:!1}),this.#w.on("keydown",this.onChartKeyDown.bind(this)),this.#w.on("keyup",this.onChartKeyUp.bind(this)),this.#w.on("wheel",this.onMouseWheel.bind(this)),this.#w.on("pointermove",this.onMouseMove.bind(this)),this.#w.on("pointerenter",this.onMouseEnter.bind(this)),this.#w.on("pointerout",this.onMouseOut.bind(this)),this.on(Bt,this.onFirstStreamValue.bind(this)),this.on(wt,this.onNewStreamValue.bind(this)),this.on("setRange",this.draw.bind(this)),this.on("scrollUpdate",this.draw.bind(this)),this.on("chart_render",this.draw.bind(this))}on(t,i,s){this.#e.on(t,i,s)}off(t,i){this.#e.off(t,i)}emit(t,i){this.#e.emit(t,i)}onMouseWheel(t){t.domEvent.preventDefault();const i=Math.sign(t.wheeldelta)*-1,s=this.range,n=s.indexStart-Math.floor(i*Ke*s.Length),o=s.indexEnd+Math.ceil(i*Ke*s.Length);this.#e.setRange(n,o),this.draw(this.range,!0)}onMouseMove(t){this.#E=[t.position.x,t.position.y,t.dragstart.x,t.dragstart.y,t.movement.x,t.movement.y],this.core.Chart.graph.overlays.list.get("cursor").layer.visible=!0;for(let[i,s]of this.offCharts)s.graph.overlays.list.get("cursor").layer.visible=!0;this.emit("main_mousemove",this.#E)}onMouseEnter(t){this.core.Timeline.showCursorTime(),this.core.Chart.graph.overlays.list.get("cursor").layer.visible=!0,this.core.Chart.graph.render();for(let[i,s]of this.offCharts)s.graph.overlays.list.get("cursor").layer.visible=!0,s.graph.render()}onMouseOut(t){this.core.Timeline.hideCursorTime(),this.onPointerActive(!1),this.core.Chart.graph.overlays.list.get("cursor").layer.visible=!1,this.core.Chart.graph.render();for(let[i,s]of this.offCharts)s.graph.overlays.list.get("cursor").layer.visible=!1,s.graph.render();this.draw()}onChartDrag(t){const i=this.#N;i.active?(i.delta=[t.position.x-i.prev[0],t.position.y-i.prev[1]],i.prev=[t.position.x,t.position.y]):(i.active=!0,i.start=[t.dragstart.x,t.dragstart.y],i.prev=i.start,i.delta=[t.movement.x,t.movement.y]),this.#E=[t.position.x,t.position.y,...i.start,...i.delta],this.emit("chart_pan",this.#E)}onChartDragDone(t){const i=this.#N;i.active=!1,i.delta=[0,0],this.#E=[...i.prev,...i.start,...i.delta],this.emit("chart_panDone",this.#E)}onChartKeyDown(t){let i=this.candleW>1?this.candleW:1;switch(t.key){case"ArrowLeft":this.emit("chart_pan",[0,null,i,null,i*-1,null]);break;case"ArrowRight":this.emit("chart_pan",[i,null,0,null,i,null]);break}}onChartKeyUp(t){let i=this.candleW>1?this.candleW:1;switch(t.key){case"ArrowLeft":this.emit("chart_panDone",[0,null,i,null,i*-1,null]);break;case"ArrowRight":this.emit("chart_panDone",[i,null,0,null,i,null]);break}}onFirstStreamValue(t){this.chart.scale.xAxis.calcXAxisGrads(this.range),this.draw(this.range,!0)}onNewStreamValue(t){}onPointerActive(t){t&&(t.cursorActive=!0,t.scale.layerCursor.visible=!0),t!==this.chart&&(this.chart.cursorActive=!1,this.chart.scale.layerCursor.visible=!1,this.chart.scale.layerCursor.erase()),this.#y.forEach((i,s)=>{t!==i&&(i.cursorActive=!1,i.scale.layerCursor.visible=!1,i.scale.layerCursor.erase())})}mount(t){this.#n.innerHTML=this.scaleNode(CLASS_CHART),this.#n.querySelector(`.${CLASS_CHART}`).style.height="100%",this.#n.querySelector(`.${CLASS_CHART} tradex-scale`).style.height="100%"}setWidth(t){}setHeight(t){}setDimensions(){this.#a.previousDimensions();let t=this.#a.heightDeltaR,i=Math.round(this.chartH*t),s=this.rowsW,n=this.rowsH,o=Math.round(s*((100+this.#R)*.01)),a={resizeH:t,mainH:this.element.height,mainW:this.element.width,rowsH:this.rowsH,rowsW:this.rowsW};this.#y.size==0&&i!=this.#a.height&&(i=this.#a.height),this.#e.scrollPos=-1,this.#T.setDimensions({w:s}),this.#p.setSize(s,n,o),this.#M.setDimensions({w:s,h:i}),this.#y.forEach((h,l)=>{i=Math.round(h.viewport.height*t),h.setDimensions({w:s,h:i}),h.Divider.setDividerPos()}),this.rowsOldH=this.rowsH,this.draw(this.range,!0),this.emit("rowsResize",a)}getBufferPx(){let t=Math.round(this.width*this.buffer/100),i=t%this.candleW;return t-i}setCursor(t){this.element.style.cursor=t}registerOffCharts(t){if(this.#e.offChart.length===0)return;for(const[o,a]of this.#e.offChart.entries())a.type in this.core.indicators||(this.#e.log(`offChart indicator ${this.#e.offChart.type} not added: not supported.`),this.#e.offChart.splice(o,1));let i=this.#b*this.#e.offChart.length,s=i/Math.log10(i*2)/100,n=Math.round(this.rowsH*s);t.offChartsH=s,this.#e.offChart.length===1?(t.rowH=Math.round(this.rowsH*this.#b/100),t.chartH=this.rowsH-t.rowH):(t.rowH=Math.round(n/this.#y.size),t.chartH=this.rowsH-n,t.height=t.rowH),t.chartH/this.rowsH*100,this.#h.style.height=`${t.chartH}px`,this.#M.scale.element.style.height=`${t.chartH}px`;for(let o of this.#e.offChart)t.rowY=t.chartH,this.addOffChart(o,t),t.rowY=t.chartH+t.rowH}addOffChart(t,i){let s,n;this.#a.insertAdjacentHTML("beforeend",this.#l.rowNode(t.type,this.#e)),s=this.#a.lastElementChild,this.#d.push(s),n=this.#a.offChartSlot.assignedElements().slice(-1)[0],n.style.height=`${i.rowH}px`,n.style.width="100%";let o,a;this.#n.insertAdjacentHTML("beforeend",this.scaleNode(t.type)),o=this.#n.lastElementChild,this.#f.push(o),a=this.#n.offChartSlot.assignedElements().slice(-1)[0],a.style.height=`${i.rowH}px`,a.style.width="100%",i.elements.elTarget=n,i.elements.elScale=a,i.offChart=t,i.name="OffChart",i.shortName="offChart";let h=new eo(this.#e,i);this.#y.set(h.id,h),this.emit("addOffChart",h)}addIndicator(t){const i=this.#P[t].ind;console.log("indicator:",i)}scaleNode(t){const i=gn+` width: 100%; border-top: 1px solid ${this.theme.chart.BorderColour};`;return`
    <div slot="offchart" class="viewport ${t}" style="$${i}"></div>
  `}createGraph(){let t=P(io);this.#p=new Lt(this,this.#m,t)}draw(t=this.range,i=!1){const s=[this.#p,this.#T,this.#M];this.time.xAxis.doCalcXAxisGrads(t),this.#y.forEach((n,o)=>{s.push(n)}),Jt.queueFrame(this.range,s,i)}updateRange(t){this.#e.updateRange(t)}zoomRange(){this.draw(this.range,!0)}resizeRowPair(t,i){let s=t.offChart,n=s.id,o=[...this.#y.keys()],a=o.indexOf(n),h=a==0?this.#M:this.#y.get(o[a]),l=s.height-i[5]-1,c=h.height+i[5];return l>=this.#D&&c>=this.#D&&(t.offChart.Divider.updateDividerPos(i),s.setDimensions({w:void 0,h:l}),h.setDimensions({w:void 0,h:c})),s.element.style.userSelect="none",h.element.style.userSelect="none",{active:s,prev:h}}}const no=150;class V{#t;#s;#i;#r;#e;#o;#n;#l;#a;static menuList={};static menuCnt=0;static class=ci;static name="Menus";static type="menu";static currentActive;constructor(t,i){this.#s=t,this.#i=i.core,this.#r=i,this.#t=i.id,this.#o=t.elements.elMenus,this.#e=this.#i.elWidgetsG,this.init()}static create(t,i){const s=`menu${++V.menuCnt}`;return i.id=s,V.menuList[s]=new V(t,i),V.menuList[s]}static destroy(t){V.menuList[t].end(),delete V.menuList[t]}get el(){return this.#n}get id(){return this.#t}get pos(){return this.dimensions}get dimensions(){return v.elementDimPos(this.#n)}init(){this.mount(this.#o)}start(){this.position(this.#r.primary),this.eventsListen()}end(){const t=this.#r;v.findBySelectorAll(`#${t.id} .${di} li`).forEach(s=>{s.removeEventListener("click",this.onMenuSelect)}),document.removeEventListener("click",this.onOutsideClickListener)}eventsListen(){const t=this.#i;v.findBySelectorAll(`#${t.id} #${this.#r.id} li`).forEach(s=>{s.addEventListener("click",this.onMenuSelect.bind(this))}),document.addEventListener("click",this.onOutsideClickListener.bind(this))}on(t,i,s){this.#i.on(t,i,s)}off(t,i){this.#i.off(t,i)}emit(t,i){this.#i.emit(t,i)}onMenuSelect(t){let i=t.currentTarget.dataset.event,s={target:t.currentTarget.id,menu:this.#t,evt:i};this.emit("menuItemSelected",s),this.emit("closeMenu",s)}onOutsideClickListener(t){if(!this.#n.contains(t.target)&&!this.#r.primary.contains(t.target)&&v.isVisible(this.#n)){let i={target:t.currentTarget.id,menu:this.#t};this.emit("closeMenu",i)}}mount(t){const i=this.#i;t.lastElementChild==null?t.innerHTML=this.menuNode():t.lastElementChild.insertAdjacentHTML("afterend",this.menuNode()),this.#n=v.findBySelector(`#${i.id} #${this.#r.id}`)}static defaultNode(){return`
      <div slot="widget" class="${ci}" style=""></div>
    `}menuNode(){const t=this.#r,i=`position: absolute; z-index: 1000; display: none; border: 1px solid ${Ce.COLOUR_BORDER}; background: ${Ce.COLOUR_BG}; color: ${Ce.COLOUR_TXT};`;let s=this.content(t);return`
      <div id="${t.id}" class="${di}" style="${i}">
        ${s}
      </div>
    `}content(t){const i=`list-style: none; text-align: left; margin:1em 1em 1em -2.5em; min-width: ${no}px`,s="padding: .25em 1em .25em 1em; white-space: nowrap;",n="display: inline-block; width: 4em;",o="cursor: pointer;",a=`onmouseover="this.style.background ='#222'"`,h=`onmouseout="this.style.background ='none'"`;let l=`<ul style="${i}">`;if(t?.content)for(let c of t.content)l+=`<li id="${c.id}" data-event="${c.event}" style="${s} ${o}" ${a} ${h}><a style="${o}"><span style="${n}">${c.id}</span><span>${c.name}</span></li></a>`;return l+="</ul>",l}position(t){let i=this.#e.getBoundingClientRect(),s=t.getBoundingClientRect();this.#n.style.left=Math.round(s.left-i.left)+"px",this.#n.style.top=Math.round(s.bottom-i.top)+"px"}remove(){}open(){let t=V.currentActive?.id||!1;t&&this.emit("closeMenu",{menu:t}),V.currentActive=this,this.#n.style.display="block";let i=v.elementDimPos(this.#n);if(i.left+i.width>this.#e.offsetWidth){let n=Math.floor(this.#e.offsetWidth-i.width);n=B(n,0,this.#e.offsetWidth),this.#n.style.left=`${n}px`}}close(){V.currentActive=null,this.#n.style.display="none",this.emit("menuClosed",this.id)}}class G{#t;#s;#i;#r;#e;#o;#n;#l;#a;static windowList={};static windowCnt=0;static class=gi;static name="Windows";static type="window";static currentActive=null;constructor(t,i){this.#s=t,this.#i=i.core,this.#r=i,this.#t=i.id,this.#o=t.elements.elWindows,this.#e=this.#i.elWidgetsG,this.init()}static create(t,i){const s=`window${++G.windowCnt}`;return i.id=s,G.windowList[s]=new G(t,i),G.windowList[s]}static destroy(t){G.windowList[t].end(),delete G.windowList[t]}get el(){return this.#n}get id(){return this.#t}get pos(){return this.dimensions}get config(){return this.#r}set config(t){this.#r=t}get dimensions(){return v.elementDimPos(this.#n)}init(){this.mount(this.#o)}start(){this.eventsListen(),this.open()}end(){document.removeEventListener("click",this.onOutsideClickListener)}eventsListen(){this.#i,this.on("closeWindow",t=>{t.window===this.#t&&this.close()})}on(t,i,s){this.#i.on(t,i,s)}off(t,i){this.#i.off(t,i)}emit(t,i){this.#i.emit(t,i)}onOutsideClickListener(t){if(!this.#n.contains(t.target)&&v.isVisible(this.#n)){let i={target:t.currentTarget.id,window:this.#t};this.emit("closeWindow",i)}}mount(t){const i=this.#i;t.lastElementChild==null?t.innerHTML=this.windowNode():t.lastElementChild.insertAdjacentHTML("afterend",this.windowNode()),this.#n=v.findBySelector(`#${i.id} #${this.#r.id}`);let s,n;if(this.#r.x&&this.#r.y)s=this.#r.x,n=this.#r.y;else{let o=v.elementDimPos(this.#n);s=(this.#i.width-o.width)/2,n=(this.#i.height-o.height)/2}this.#n.style.bottom=`${n}px`,this.#n.style.left=`${s}px`}static defaultNode(){return`
      <div slot="widget" class="${gi}" style=""></div>
    `}windowNode(){const t=this.#r,i=`position: absolute; z-index: 1000; display: block; border: 1px solid ${Me.COLOUR_BORDER}; background: ${Me.COLOUR_BG}; color: ${Me.COLOUR_TXT};`;let s=this.dragBar(t),n=this.content(t),o=this.closeIcon(t);return`
      <div id="${t.id}" class="${js}" style="${i}">
          ${s}
          ${o}
          ${n}
        </div>
      </div>
    `}content(t){const i="padding: 2em;";let s=t?.content?t.content:"";return`
      <div class="content" style="${i}">
        ${s}
      </div>
    `}dragBar(t){this.#i;const i="cursor: grab;",s=`onmouseover="this.style.background ='#222'"`,n=`onmouseout="this.style.background ='none'"`,o=`${i}`;let a="";return t.dragBar&&(a+=`
      <div class="dragBar" ${o} ${s} ${n}>
      </div>
    `),a}closeIcon(t){this.#i;const i="cursor: pointer;",s=`onmouseover="this.style.background ='#222'"`,n=`onmouseout="this.style.background ='none'"`,o=`${i}`;let a="";return t.closeIcon&&(a+=`
      <div class="closeIcon" ${o} ${s} ${n}>
        <span>X</span>
      </div>
    `),a}position(t){let i=this.#e.getBoundingClientRect(),s=t.getBoundingClientRect();this.#n.style.left=Math.round(s.left-i.left)+"px",this.#n.style.top=Math.round(s.bottom-i.top)+"px"}remove(){}open(){G.currentActive=this,this.#n.style.display="block",this.emit("windowOpened",this.id),setTimeout(()=>{document.addEventListener("click",this.onOutsideClickListener.bind(this))},1e3)}close(){G.currentActive=null,this.#n.style.display="none",this.emit("windowClosed",this.id),document.removeEventListener("click",this.onOutsideClickListener)}}class ro extends G{static type="window";constructor(t,i){super(),i.dragbar=!0,i.close=tue,this.config=i}}class et{#t;#s;#i;#r;#e;#o;#n;#l;#a;#c;#h;static dividerList={};static divideCnt=0;static class=ui;static name="Dividers";static type="divider";constructor(t,i){const s={...i};this.#r=t,this.#s=s.core,this.#i=s,this.#t=s.id,this.#e=s.offChart,this.#o=t.elements.elDividers,this.#l=this.#e.element,this.init()}static create(t,i){const s=`divider${++et.divideCnt}`;return i.id=s,et.dividerList[s]=new et(t,i),et.dividerList[s]}static destroy(t){et.dividerList[t].end(),delete et.dividerList[t]}get el(){return this.#n}get ID(){return this.#t}get offChart(){return this.#e}get config(){return this.#s.config}get pos(){return this.dimensions}get dimensions(){return v.elementDimPos(this.#n)}get height(){return this.#n.getBoundingClientRect().height}init(){this.mount()}start(){this.setCursor("n-resize"),this.eventsListen()}end(){this.#h.off("pointerenter",this.onMouseEnter),this.#h.off("pointerout",this.onMouseOut),this.#h.off("pointerdrag",this.onPointerDrag),this.#h.off("pointerdragend",this.onPointerDragEnd),this.#h=null,this.el.remove()}eventsListen(){this.#h=new j(this.#n,{disableContextMenu:!1}),this.#h.on("pointerenter",this.onMouseEnter.bind(this)),this.#h.on("pointerout",this.onMouseOut.bind(this)),this.#h.on("pointerdrag",this.onPointerDrag.bind(this)),this.#h.on("pointerdragend",this.onPointerDragEnd.bind(this))}on(t,i,s){this.#s.on(t,i,s)}off(t,i){this.#s.off(t,i)}emit(t,i){this.#s.emit(t,i)}onMouseEnter(){this.#n.style.background="#888888C0",this.#s.MainPane.onMouseEnter()}onMouseOut(){this.#n.style.background="#FFFFFF00",this.#s.MainPane.onMouseEnter()}onPointerDrag(t){this.#a=[t.position.x,t.position.y],this.emit(`${this.ID}_pointerdrag`,this.#a),this.emit("divider_pointerdrag",{id:this.ID,e:t,pos:this.#a,offChart:this.offChart})}onPointerDragEnd(t){"position"in t&&(this.#a=[t.position.x,t.position.y]),this.emit(`${this.ID}_pointerdragend`,this.#a),this.emit("divider_pointerdragend",{id:this.ID,e:t,pos:this.#a,offChart:this.offChart})}mount(){this.#o.lastElementChild==null?this.#o.innerHTML=this.dividerNode():this.#o.lastElementChild.insertAdjacentHTML("afterend",this.defaultNode()),this.#n=v.findBySelector(`#${this.#t}`,this.#o)}setCursor(t){this.#n.style.cursor=t}static defaultNode(){return`
  <div slot="widget" class="${ui}" style="position: absolute;"></div>
  `}dividerNode(){let t=this.#e.pos.top-v.elementDimPos(this.#o).top,i=this.#s.MainPane.rowsW+this.#s.scaleW,s=g(this.config.dividerHeight)?this.config.dividerHeight:Vs,n=this.#s.theme.tools.width;switch(t-=s/2,this.#s.theme.tools.location){case"left":break;case!1:case"none":case"right":n*=-1;break}const o=`position: absolute; top: ${t}px; left: ${n}px; z-index:100; width: ${i}px; height: ${s}px; background: #FFFFFF00;`;return`
      <div id="${this.#t}" class="divider" style="${o}"></div>
    `}updateDividerPos(t){let i=this.#n.offsetTop;i+=t[5],this.#n.style.top=`${i}px`}setDividerPos(){let t=this.#e.pos.top-v.elementDimPos(this.#o).top;t=t-this.height/2,this.#n.style.top=`${t}px`}}var as={id:"widgets",initial:"idle",context:{},states:{idle:{onEnter(r){console.log(`${this.id}: state: "${this.state}" - onEnter`)},onExit(r){console.log(`${this.id}: state: "${this.state}" - onExit (${this.event})`)},on:{openMenu:{target:"openMenu",action(r){console.log(`${this.id}: transition from "${this.state}" to "openMenu" on ${this.event}`)}}}},openMenu:{onEnter(r){console.log(`${this.id}: state: "${this.state}" - onEnter`)},onExit(r){console.log(`${this.id}: state: "${this.state}" - onExit (${this.event})`)},on:{closeMenu:{target:"idle",action(r){console.log(`${this.id}: transition from "${this.state}" to "idle" on "${this.event}"`)}}}},openWindow:{onEnter(r){console.log(`${this.id}: state: "${this.state}" - onEnter`)},onExit(r){console.log(`${this.id}: state: "${this.state}" - onExit (${this.event})`)},on:{closeWindow:{target:"idle",action(r){console.log(`${this.id}: transition from "${this.state}" to "idle" on "${this.event}"`)}}}}}};class oo{#t="Widgets";#s="widgets";#i;#r;#e;#o;#n={Dialogue:ro,Divider:et,Menu:V,Window:G};#l={};#a={};#c;#h;#u;constructor(t,i){this.#i=t,this.#r=i,this.#o={...this.#n,...i.widgets},this.#c=t.elWidgetsG,this.init()}log(t){this.#i.log(t)}info(t){this.#i.info(t)}warning(t){this.#i.warn(t)}error(t){this.#i.error(t)}get name(){return this.#t}get shortName(){return this.#s}get core(){return this.#i}get options(){return this.#r}get elements(){return this.#a}get instances(){return this.#l}set stateMachine(t){this.#e=new X(t,this)}get stateMachine(){return this.#e}init(){this.mount(this.#c);for(let t in this.#o){let i=this.#o[t],s=`el${i.name}`;this.#a[s]=this.#c.querySelector(`.${i.class}`)}}start(){this.eventsListen(),as.context=this,this.stateMachine=as,this.stateMachine.start()}end(){this.off("openMenu",this.onOpenMenu),this.off("closeMenu",this.onCloseMenu),this.off("offMenu",this.onCloseMenu),this.off("menuItemSelected",this.onMenuItemSelected),this.stateMachine.destroy()}eventsListen(){this.on("openMenu",this.onOpenMenu.bind(this)),this.on("closeMenu",this.onCloseMenu.bind(this)),this.on("offMenu",this.onCloseMenu.bind(this)),this.on("menuItemSelected",this.onMenuItemSelected.bind(this))}on(t,i,s){this.#i.on(t,i,s)}off(t,i){this.#i.off(t,i)}emit(t,i){this.#i.emit(t,i)}onResize(t){this.setDimensions(t)}onOpenMenu(t){console.log("onOpenMenu:",t),this.#l[t.menu].open()}onCloseMenu(t){console.log("onCloseMenu:",t),this.#l[t.menu].close()}onMenuItemSelected(t){this.emit(t.evt,t.target)}mount(t){t.innerHTML=this.defaultNode()}setWidth(t){this.#h=t}setHeight(t){this.#u=t}setDimensions(t){this.setWidth(t.mainW),this.setHeight(t.mainH)}defaultNode(){let t="",i=[];for(let s in this.#o){let n=this.#o[s];i.indexOf(n.type)===-1&&(t+=n.defaultNode(),i.push(n.type))}return t}insert(t,i){i.core=this.core;const s=this.#o[t].create(this,i);return this.#l[s.id]=s,s}remove(t,i){delete this.#l[i],this.#o[t].destroy(i)}}class C extends Cr{static#t=0;static#s={};static#i={};static#r=null;static#e=!1;static#o=null;static get talibPromise(){return C.#r}static get talibReady(){return C.#e}static get talibError(){return C.#o}static initErrMsg=`${vt} requires "talib-web" to function properly. Without it, some features maybe missing or broken.`;static permittedClassNames=["TradeXchart","Chart","MainPane","OffChart","OnChart","ScaleBar","Timeline","ToolsBar","UtilsBar","Widgets"];#n;#l=vt;#a=vt;#c=void 0;#h;#u;#d;#f;#v={};#g;#m;#A;#p;#C;#$;#S;#y;#M;#T=null;#U;#b={};#x={};#D=[];#E=!0;#N;#R;#P;#O=me;#w=Ti;#L;#_;#q;chartWMin=zt;chartHMin=nt;chartW_Reactive=!0;chartH_Reactive=!0;chartBGColour=A.COLOUR_BG;chartTxtColour=A.COLOUR_TXT;chartBorderColour=A.COLOUR_BORDER;utilsH=J;toolsW=tt;timeH=Ft;scaleW=ct;#z;#F;#k={chart:{},time:{}};#V;panes={utils:this.#z,tools:this.#F,main:this.#k};#I={rangeTotal:!0,range:{},total:{},timeFrameMS:0,timeFrame:"",timeZone:"",indexed:!1};logs=!1;infos=!1;warnings=!1;errors=!1;timer=!1;#G={x:0,y:0};#H=0;#K=0;#Q=[null,null,null,null];#Y;#B;#X;#j;#Z;#W=!1;#J={status:"idle",buffer:{n:!0,"1":{},"2":{}},curr:{frame:null,priority:0},cache:[]};static create(t={}){C.#t==0&&(C.#s.CPUCores=navigator.hardwareConcurrency,C.#s.api={permittedClassNames:C.permittedClassNames}),(typeof t.talib!="object"||typeof t.talib.init!="function")&&(C.#e=!1,C.#o=new Error(`${C.initErrMsg}`)),!C.#e&&C.#o===null&&(C.#r=t.talib.init(t.wasm)),C.#r.then(()=>{C.#e=!0},()=>{C.#e=!1})}static destroy(t){if(t.constructor.name==="TradeXchart"){t.end();const i=t.inCnt;delete C.#i[i]}}static cnt(){return C.#t++}constructor(){super(),this.#T=C.cnt(),this.#n=`${ai}_${this.#T}`,console.warn(`!WARNING!: ${vt} breaking changes since V 0.101.7`),console.log("TXC:",this.inCnt),this.oncontextmenu=window.oncontextmenu,this.#Y=Y}log(t){this.logs&&console.log(t)}info(t){this.infos&&console.info(t)}warning(t){this.warnings&&console.warn(t)}error(t){this.errors&&console.error(t)}time(t){this.timer&&console.time(t)}timeLog(t){this.timer&&console.timeLog(t)}timeEnd(t){this.timer&&console.timeEnd(t)}set id(t){this.#n=t}get id(){return this.#n}get name(){return this.#l}get shortName(){return this.#a}get mediator(){return this.#h}get options(){return this.#f}get config(){return this.#d}get core(){return this.#u}get inCnt(){return this.#T}set elUtils(t){this.#m=t}get elUtils(){return this.#m}set elTools(t){this.#p=t}get elTools(){return this.#p}set elBody(t){this.#A=t}get elBody(){return this.#A}set elMain(t){this.#C=t}get elMain(){return this.#C}set elTime(t){this.#S=t}get elTime(){return this.#S}set elYAxis(t){this.#y=t}get elYAxis(){return this.#y}set elWidgetsG(t){this.#M=t}get elWidgetsG(){return this.#M}get UtilsBar(){return this.#z}get ToolsBar(){return this.#F}get MainPane(){return this.#k}get Timeline(){return this.#k.time}get WidgetsG(){return this.#V}get Chart(){return this.#k.chart}get Indicators(){return this.#k.indicators}get state(){return this.#x}get chartData(){return this.#x.data.chart.data}get offChart(){return this.#x.data.offchart}get onChart(){return this.#x.data.onchart}get datasets(){return this.#x.data.datasets}get allData(){return{data:this.chartData,onChart:this.onChart,offChart:this.offChart,datasets:this.datasets}}get rangeLimit(){return g(this.#O)?this.#O:me}get range(){return this.#R}get time(){return this.#I}get TimeUtils(){return Ls}get theme(){return this.#_.getCurrent()}get settings(){return this.#x.data.chart.settings}get indicators(){return this.#w}get TALib(){return this.#L}get TALibReady(){return C.talibReady}get TALibError(){return C.talibError}get TALibPromise(){return C.talibPromise}get hub(){return this.#b}get candleW(){return this.Timeline.candleW}get candlesOnLayer(){return this.Timeline.candlesOnLayer}get buffer(){return this.MainPane.buffer}get bufferPx(){return this.MainPane.bufferPx}set scrollPos(t){this.setScrollPos(t)}get scrollPos(){return this.#H}get smoothScrollOffset(){return 0}get rangeScrollOffset(){return Math.floor(this.bufferPx/this.candleW)}get mousePos(){return this.#G}get pricePrecision(){return this.#j}get volumePrecision(){return this.#Z}set stream(t){return this.setStream(t)}get stream(){return this.#B}get worker(){return this.#Y}get isEmpty(){return this.#E}set candles(t){p(t)&&(this.#X=t)}get candles(){return this.#X}start(t){t={...C.create(t),...t},this.logs=t?.logs?t.logs:!1,this.infos=t?.infos?t.infos:!1,this.warnings=t?.warnings?t.warnings:!1,this.errors=t?.errors?t.errors:!1,this.timer=t?.timer?t.timer:!1,this.#d=t,this.#T=t.cnt||this.#T,this.#U=t.modID,this.#L=t.talib,this.#c=this,this.#u=this;let s=P(t?.state),n=t?.deepValidate||!1,o=t?.isCrypto||!1;this.#x=Ht.create(s,n,o),delete t.state,this.log(`Chart ${this.#n} created with a ${this.#x.status} state`);let a="1s",h=b;this.#E=!0,!p(t?.stream)&&this.#x.data.chart.data.length<2?(this.warning(`${vt} has no chart data or streaming provided.`),{tf:a,ms:h}=Rt(t?.timeFrame)):p(t?.stream)&&this.#x.data.chart.data.length<2?({tf:a,ms:h}=Rt(t?.timeFrame),this.#W=!0):(a=this.#x.data.chart.tf,h=this.#x.data.chart.tfms,this.#E=!1),this.#I.timeFrame=a,this.#I.timeFrameMS=h,console.log("tf:",a,"ms:",h);const l=p(t)&&m(t.id)?t.id:null;if(this.setID(l),this.classList.add(this.id),p(t))for(const c in t)c in this.props()&&this.props()[c](t[c]);if(this.getRange(null,null,{interval:this.#I.timeFrameMS,core:this}),this.#R.Length>1){const c=Ys(this.#I,this.#P),u=c?c+this.#O:this.chartData.length-1,f=c||u-this.#O;this.#O=u-f,this.setRange(f,u)}this.insertAdjacentHTML("beforebegin",`<style title="${this.id}_style"></style>`),this.#V=new oo(this,{widgets:t?.widgets}),this.#z=new Tr(this,t),this.#F=new Dr(this,t),this.#k=new so(this,t),this.setTheme(this.#q.ID),this.log(`${this.#l} instantiated`),this.log("...processing state"),this.#H=this.bufferPx*-1,this.eventsListen(),this.elStart(this.theme),this.elBody.start(this.theme),this.UtilsBar.start(),this.ToolsBar.start(),this.MainPane.start(),this.WidgetsG.start(),this.stream=this.#d.stream,this.#W&&this.on(z,this.delayedSetRange.bind(this)),this.refresh()}end(){this.log("...cleanup the mess"),this.removeEventListener("mousemove",this.onMouseMove),this.off(z,this.onStreamUpdate),this.UtilsBar.end(),this.ToolsBar.end(),this.MainPane.end(),this.WidgetsG.end(),this.#Y.end(),this.#x=null}eventsListen(){this.addEventListener("mousemove",this.onMouseMove.bind(this)),this.on(z,this.onStreamUpdate.bind(this))}on(t,i,s){!m(t)||!E(i)||(this.#b[t]||(this.#b[t]=[]),this.#b[t].push({handler:i,context:s}))}off(t,i){if(!m(t))return;const s=(this.#b[t]||[]).findIndex(n=>n===i);s>-1&&this.#b[t].splice(s,1),this.#b[t].length===0&&delete this.#b[t]}emit(t,i){!m(t)||(this.#b[t]||[]).forEach(s=>s.handler.call(s.context,i))}execute(t,i,s){}onMouseMove(t){this.#G.x=t.clientX,this.#G.y=t.clientY}onStreamUpdate(t){const i=this.range;if(i.inRange(t[0])){const s=i.valueMax,n=i.valueMin;(t[2]>s||t[3]<n)&&(this.setRange(i.indexStart,i.indexEnd),this.emit("chart_yAxisRedraw",this.range))}}props(){return{width:t=>this.setWidth(t),height:t=>this.setHeight(t),widthMin:t=>this.setWidthMin(t),heightMin:t=>this.setHeightMin(t),widthMax:t=>this.setWidthMax(t),heightMax:t=>this.setHeightMax(t),logs:t=>this.logs=it(t)?t:!1,infos:t=>this.infos=it(t)?t:!1,warnings:t=>this.warnings=it(t)?t:!1,errors:t=>this.errors=it(t)?t:!1,rangeStartTS:t=>this.#P=g(t)?t:void 0,rangeLimit:t=>this.#O=g(t)?t:me,indicators:t=>this.setIndicators(t),theme:t=>{this.#q=this.addTheme(t)},stream:t=>this.#B=p(t)?t:{},pricePrecision:t=>this.setPricePrecision(t),volumePrecision:t=>this.setVolumePrecision(t)}}getInCnt(){return this.#T}setID(t){m(t)?this.#n=t+this.#T:this.#n=ai+this.#T}getID(){return this.#n}getModID(){return this.#U}setDimensions(t,i){const s=super.setDimensions(t,i);this.emit("global_resize",s)}setUtilsH(t){this.utilsH=t,this.#m.style.height=`${t}px`}setToolsW(t){this.toolsW=t,this.#p.style.width=`${t}px`}setNotEmpty(){this.#E=!1}setPricePrecision(t){(!g(t)||t<0)&&(t=en),this.#j=t}setVolumePrecision(t){(!g(t)||t<0)&&(t=sn),this.#Z=t}addTheme(t){return this.#_=Te.create(t,this),this.#_}setTheme(t){this.#_.current=t;const i=this.#_,s=document.querySelector(`style[title=${this.id}_style]`),n=`var(--txc-border-color, ${i.chart.BorderColour}`;let o=`.${this.id} { `;o+=`--txc-background: ${i.chart.Background}; `,this.style.background=`var(--txc-background, ${i.chart.Background})`,this.style.border=`${i.chart.BorderThickness}px solid`,this.style.borderColor=n,o+=`--txc-border-color:  ${i.chart.BorderColour}; `,this.#C.rows.style.borderColor=n,o+=`--txc-time-scrollbar-color: ${i.chart.BorderColour}; `,o+=`--txc-time-handle-color: ${i.xAxis.handle}; `,o+=`--txc-time-slider-color: ${i.xAxis.slider}; `,o+=`--txc-time-cursor-fore: ${i.xAxis.colourCursor}; `,o+=`--txc-time-cursor-back: ${i.xAxis.colourCursorBG}; `,o+=`--txc-time-icon-color: ${i.icon.colour}; `,o+=`--txc-time-icon-hover-color: ${i.icon.hover}; `,this.#S.overview.scrollBar.style.borderColor=n,this.#S.overview.handle.style.backgroundColor=`var(--txc-time-handle-color, ${i.xAxis.handle})`,this.#S.overview.style.setProperty("--txc-time-slider-color",i.xAxis.slider),this.#S.overview.style.setProperty("--txc-time-icon-color",i.icon.colour),this.#S.overview.style.setProperty("--txc-time-icon-hover-color",i.icon.hover);for(let[a,h]of Object.entries(this.Chart.legend.list))h.el.style.color=`var(--txc-legend-color, ${i.legend.colour})`,h.el.style.font=`var(--txc-legend-font, ${i.legend.font})`;for(let a of this.#m.icons)a.className=="icon-wrapper"&&(a.children[0].style.fill=i.icon.colour);for(let a of this.#p.icons)a.className=="icon-wrapper"&&(a.children[0].style.fill=i.icon.colour);o+=" }",s.innerHTML=o}setScrollPos(t){t=Math.round(t),g(t)&&t<=0&&t>=this.bufferPx*-1?this.#H=t:this.emit("Error","setScrollPos: not a valid value")}setStream(t){if(this.stream?.constructor.name=="Stream")return this.error("Error: Invoke stopStream() before starting a new one."),!1;if(p(t))return this.allData.data.length==0&&m(t.timeFrame)&&({tf,ms}=Rt(t?.timeFrame),this.#I.timeFrame=tf,this.#I.timeFrameMS=ms),this.#B=new pe(this),this.#d.stream=this.#B.config,this.#B}stopStream(){this.stream.constructor.name=="Stream"&&this.stream.stop()}delayedSetRange(){for(;this.#W;){let t=this.range.Length*.5;this.setRange(t*-1,t),this.off(z,this.delayedSetRange),this.#W=!1}}updateRange(t){if(!x(t)||!g(t[4])||t[4]==0)return;let i,s;i=t[4],s=this.#H+i,s%this.candleW,s<this.bufferPx*-1?(s=0,this.offsetRange(this.rangeScrollOffset*-1)):s>0&&(s=this.bufferPx*-1,this.offsetRange(this.rangeScrollOffset)),this.#H=s,this.emit("scrollUpdate",s)}offsetRange(t){let i=this.range.indexStart-t,s=this.range.indexEnd-t;this.setRange(i,s)}getRange(t=0,i=0,s={}){this.#R=new Gs(this.allData,t,i,s),this.#R.interval=this.#I.timeFrameMS,this.#R.intervalStr=this.#I.timeFrame,this.#I.range=this.#R}setRange(t=0,i=this.rangeLimit){const s=this.config?.maxCandles?this.config.maxCandles:this.Chart?.layerWidth?this.Chart.layerWidth:this.Chart.width;this.#R.set(t,i,s)}jumpToIndex(t,i=!0,s=!0){let n=this.range.Length,o=t+n;i&&(t=B(t,0,this.range.dataLength)),s&&(t-=n/2,o-=n/2),this.setRange(t,o)}jumpToTS(t,i=!0,s=!0){let n=this.Timeline.xAxis.t2Index(t);this.jumpToIndex(n,i=!0,s=!0)}jumpToStart(t=!0,i=!0){this.jumpToIndex(0,t=!0,i=!0)}jumpToEnd(t=!0,i=!0){let s=this.range.dataLength-this.range.Length;i&&(s+=this.range.Length/2),this.jumpToIndex(s,t=!0,i=!1)}mergeData(t,i=!1,s=!0){if(!p(t))return!1;let n,o,a,h;const l=this.allData.data,c=t?.data||!1;this.allData?.onChart,t?.onChart,this.allData?.offChart,t?.offChart,this.allData?.dataset?.data;const u=t?.dataset?.data||!1,f=this.allData?.trades?.data;t?.trades?.data;const y=this.range.inRange(c[0][0])?1:0;if(x(c)&&c.length>0){if(n=c.length-1,o=l.length-1,l.length==0)this.allData.data.push(...c),s&&this.calcAllIndicators();else{const T=[l[0][0],l[o][0]],O=[c[0][0],c[n][0]],U=[Math.max(T[0],O[0]),Math.min(T[1],O[1])];U[1]>=U[0]||(this.allData.data.push(...c),s&&this.calcAllIndicators())}if(x(u)&&u.length>0)for(let T of u)x(T?.data)&&T?.data.length>0;if(x(f)&&f.length>0)for(let T of f);i&&(p(i)?(a=g(i.start)?i.start:this.range.indexStart,h=g(i.end)?i.end:this.range.indexEnd):(c[0][0]&&(a=this.range.indexStart+y),h=this.range.indexEnd+y),this.setRange(a,h))}}isIndicator(t){return!!(typeof t=="function"&&"onChart"in t.prototype&&E(t.prototype?.draw))}setIndicators(t,i=!1){if(!p(t))return!1;i&&(console.warn("Expunging all default indicators!"),this.#w={});for(const[s,n]of Object.entries(t))m(n?.id)&&m(n?.name)&&m(n?.event)&&this.isIndicator(n?.ind)&&(this.#w[s]=n);return!0}addIndicator(t,i=t,s={}){if(!m(t)&&!(t in this.#w)&&!m(i)&&!p(s))return!1;const n={type:t,name:i,...s};console.log(`Adding the ${i} : ${t} indicator`),this.#w[t].ind.prototype.onChart?this.Chart.addIndicator(n):this.#k.addIndicator(n),this.emit("addIndicatorDone",n)}hasStateIndicator(t,i="searchAll"){if(!m(t)||!m(i))return!1;const s=function(n,o){for(let a of o)return a?.id==n||a.name==n};if(i=="searchAll"){for(let n of this.allData)if(s(t,n))return!0;return!1}else if(i in this.allData)return s(t,d)}calcAllIndicators(){for(let t of this.Indicators.onchart.values())t.instance.calcIndicatorHistory();for(let t of this.Indicators.offchart.values())t.instance.calcIndicatorHistory()}resize(t,i){return!g(t)&&!g(i)?!1:(this.setDimensions(t,i),!0)}refresh(){let t=this.range.indexStart,i=this.range.indexEnd;this.setRange(t,i),this.MainPane.draw(void 0,!0)}notImplemented(){if(this.implemented)this.implemented.open();else{let i={content:`
        This feature is not implemented yet.
      `};this.implemented=this.#V.insert("Dialogue",i),this.implemented.start()}}}window.customElements.get("tradex-chart")||(document.head.insertAdjacentHTML("beforeend",mn),document.head.insertAdjacentHTML("beforeend",pn),window.customElements.define("tradex-chart",C)),_.Chart=C,_.DOM=v,_.Indicator=ot,_.Overlay=k,_.copyDeep=P,_.isPromise=$e,_.mergeDeep=st,_.uid=D,Object.defineProperties(_,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
